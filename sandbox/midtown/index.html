<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="Destroy cities as effectively as possible in this unique puzzle game!">
	<meta name="keywords" content="game, html5, indie, mobile, xdk">
	
		<meta name="oupengmobile" content="game,fullscreen,portrait">
	<title>Midtown Mayhem</title>
	<link rel="shortcut icon" href="media/images/icons/favicon.ico">
	<link rel="apple-touch-icon-precomposed" href="media/images/icons/114.png">
	<link rel="image_src" href="media/images/icons/114.png">
	<style>
		html, body {
			overflow: hidden;
			background: #000;
			margin: 0;
		}
		canvas {
			background: #000;
		}
		#djinn-game-info {
			display: none;
		}
	</style>
	
	</head>
<body>
	<div id="djinn-game-info">
		<h1>Midtown Mayhem</h1>
		<p>Destroy cities as effectively as possible in this unique puzzle game!</p>
		<p>game, html5, indie, mobile, xdk</p>
	</div>
	
	
	
	
		<script>
/*
Copyright © 2012 Lost Decade Games, LLC
Visit us on the web: http://www.lostdecadegames.com
Email us: hello@lostdecadegames.com
Follow us on Twitter: @LostDecadeGames
*/
__manifest={"version":"1.0.0","entry":"title","title":"Midtown Mayhem","description":"Destroy cities as effectively as possible in this unique puzzle game!","keywords":"game, html5, indie, mobile, xdk","shortName":"midtownMayhem","launch":"js/Shiv","favicon":"media/images/icons/favicon.ico","icons":{"16":"media/images/icons/16.png","19":"media/images/icons/19.png","29":"media/images/icons/29.png","42":"media/images/icons/42.png","48":"media/images/icons/48.png","114":"media/images/icons/114.png","128":"media/images/icons/128.png","256":"media/images/icons/256.png"},"sizes":[[640,1136]],"orientation":"portrait","port":8813};
__intl={"AREA_heartland":"Heartland","AREA_metro":"Metropolis","AREA_night":"Sin City","BACK":"Back","CONTINUE":"Continue","COPYRIGHT":"v%s © Lost Decade Games","DONE":"Done","OK":"OK","OPTIONS":"Options","PLAY":"Play","RESULTS":"Results","RETRY":"Retry","SCORE_N":"Damage: $%s","STAGE_SELECT":"Select a stage"};
/*!
 *  howler.js v1.1.14
 *  howlerjs.com
 *
 *  (c) 2013, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
var requirejs,require,define;(function(a){function i(a,b){var c=b&&b.split("/"),e=d.map,f=e&&e["*"]||{},g,h,i,j,k,l,m;if(a&&a.charAt(0)==="."&&b){c=c.slice(0,c.length-1),a=c.concat(a.split("/"));for(k=0;m=a[k];k++)if(m===".")a.splice(k,1),k-=1;else if(m===".."){if(k===1&&(a[2]===".."||a[0]===".."))return!0;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((c||f)&&e){g=a.split("/");for(k=g.length;k>0;k-=1){h=g.slice(0,k).join("/");if(c)for(l=c.length;l>0;l-=1){i=e[c.slice(0,l).join("/")];if(i){i=i[h];if(i){j=i;break}}}j=j||f[h];if(j){g.splice(0,k,j),a=g.join("/");break}}}return a}function j(b,c){return function(){return h.apply(a,f.call(arguments,0).concat([b,c]))}}function k(a){return function(b){return i(b,a)}}function l(a){return function(c){b[a]=c}}function m(d){if(c.hasOwnProperty(d)){var f=c[d];delete c[d],e[d]=!0,g.apply(a,f)}if(!b.hasOwnProperty(d))throw new Error("No "+d);return b[d]}function n(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=i(a.slice(0,e),b),a=a.slice(e+1),d=m(c),d&&d.normalize?a=d.normalize(a,k(b)):a=i(a,b)):a=i(a,b),{f:c?c+"!"+a:a,n:a,p:d}}function o(a){return function(){return d&&d.config&&d.config[a]||{}}}var b={},c={},d={},e={},f=[].slice,g,h;g=function(d,f,g,h){var i=[],k,p,q,r,s,t;h=h||d;if(typeof g=="function"){f=!f.length&&g.length?["require","exports","module"]:f;for(t=0;t<f.length;t++){s=n(f[t],h),q=s.f;if(q==="require")i[t]=j(d);else if(q==="exports")i[t]=b[d]={},k=!0;else if(q==="module")p=i[t]={id:d,uri:"",exports:b[d],config:o(d)};else if(b.hasOwnProperty(q)||c.hasOwnProperty(q))i[t]=m(q);else if(s.p)s.p.load(s.n,j(h,!0),l(q),{}),i[t]=b[q];else if(!e[q])throw new Error(d+" missing "+q)}r=g.apply(b[d],i);if(d)if(p&&p.exports!==a&&p.exports!==b[d])b[d]=p.exports;else if(r!==a||!k)b[d]=r}else d&&(b[d]=g)},requirejs=require=h=function(b,c,e,f){return typeof b=="string"?m(n(b,c).f):(b.splice||(d=b,c.splice?(b=c,c=e,e=null):b=a),c=c||function(){},f?g(a,b,c,e):setTimeout(function(){g(a,b,c,e)},15),h)},h.config=function(a){return d=a,h},define=function(a,b,d){b.splice||(d=b,b=[]),c[a]=[a,b,d]},define.amd={jQuery:!0}})(),define("../djinn/lib/almond",function(){});var djinn={version:"2.57.12"},bind=function(b,c){return typeof c=="string"&&(c=b[c]),function(){c.apply(b,arguments)}},clone=function(b){return JSON.parse(JSON.stringify(b))},merge=function(){var b={};for(var c=arguments.length-1;c>=0;--c){var d=arguments[c];if(typeof d!="object")continue;for(var e in d){var f=d[e];if(f===undefined)continue;f&&typeof f.concat=="function"?b[e]=f.concat([]):f&&f.constructor===Object?b[e]=arguments.callee(f,b[e]):b[e]=f}}return b},sprintf=function(b){for(var c=1,d=arguments.length;c<d;++c)b=b.replace(/%s/,arguments[c]);return b};if(typeof requestAnimationFrame=="undefined")var requestAnimationFrame=window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(function(){a(Date.now())},17)};var logger=typeof console!="undefined"?console:{error:function(){},info:function(){},log:function(){},warn:function(){}};typeof logger.info!="function"&&(logger.info=logger.log),define("djinn/global",function(){}),define("djinn/manifest",[],function(){return __manifest}),define("djinn/Class",[],function(){uidSeed=0;var a=!1,b=/\b_super\b/,c=function(){};return c.uid=0,c.extend=function(c){var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];var g=function(){!a&&this.init&&this.init.apply(this,arguments)};return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g.uid=String(++uidSeed),g},c}),define("djinn/Emitter",["djinn/Class"],function(a){return a.extend({init:function(a){var a=a||{};this._listenerKey=0,this._listeners={}},fire:function(a,b){for(var c in this._listeners){var d=this._listeners[c];if(d.eventName==a)if(d.method)d.method.apply(d.context,b);else if(d.methodName){var e=d.context[d.methodName];if(typeof e!="function")throw"Could not find method: "+d.methodName;e.apply(d.context,b)}}},on:function(a){var b={eventName:a};if(arguments.length==2)b.method=arguments[1];else{b.context=arguments[1];var c=arguments[2];typeof c=="string"?b.methodName=c:b.method=c}return this._listeners[++this._listenerKey]=b,this},removeListeners:function(){for(var a in this._listeners)delete this._listeners[a];this._listeners={}},removeListenersByContext:function(a){for(var b in this._listeners){var c=this._listeners[b];c.context===a&&delete this._listeners[b]}},off:function(a){var b=null;for(var c in this._listeners){var d=this._listeners[c];if(d.eventName==a)if(arguments.length==2){if(d.method==arguments[1]){b=c;break}}else{var e=arguments[1];if(e==d.context){var f=arguments[2];if(typeof f=="string"){if(f==d.methodName){b=c;break}}else{d.method=f;if(f==d.method){b=c;break}}}}}return b!==null&&delete this._listeners[b],this},remove:function(){this._listeners=null}})}),define("djinn/client",["djinn/Emitter","djinn/manifest"],function(a,b){var c=a.extend({init:function(a){this._super(a),this.debug=!1,this._detectEnvironment(),this._updateSize();if(this.isTouch){var b=bind(this,function(a){a.preventDefault()}),c=["touchstart","touchmove","touchend"];for(var d=0,e=c.length;d<e;++d)addEventListener(c[d],b,!1)}var f=bind(this,"_updateSize");window.addEventListener("resize",f,!1),window.addEventListener("orientationchange",f,!1),window.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",bind(this,"_onLoad"),!1),this._initVisibilityChange(),window.addEventListener("tizenhwkey",bind(this,"_onTizenHardwareKey"),!1)},vibrate:function(a){if(!navigator.vibrate)return;navigator.vibrate(a)},log:function(){if(arguments.length>1)var a=sprintf.apply(null,arguments);else var a=arguments[0];this.isXDK?AppMobi.webview.execute('console.log("'+a+'");'):console&&console.log&&console.log(a)},_detectEnvironment:function(){var a=this.userAgent=navigator.userAgent;this.pixelRatio=window.devicePixelRatio||1,this.isTouch=typeof window.ontouchstart!="undefined"||!this.isBrowser,this.isFullScreen=window.navigator.standalone===!0,this.isIPhone=/iPhone OS/.test(a),this.isIPad=/iPad/.test(a),this.isIOS=this.isIPhone||this.isIPad,this.isAndroid=/Android/.test(a),this.debug&&(this.log("[client._detectEnvironment] Debugging info:"),this.log("User Agent: %s",this.userAgent),this.log("Device: %s",this.deviceType),this.log("Pixel Ratio: %s",this.pixelRatio))},_queryWindowSize:function(){if(this.isXDK)return{width:AppMobi.canvas.width,height:AppMobi.canvas.height};var a={width:~~window.innerWidth,height:~~window.innerHeight};return a},_updateSize:function(){var a=this._queryWindowSize();if(a.width!==this.width||a.height!==this.height)this.width=a.width,this.height=a.height,this.debug&&this.log("[client._updateSize] %sx%s",this.width,this.height),this.fire("resize",[this.width,this.height,this.orientation])},_onLoad:function(){this._updateSize(),this.isAndroid&&setInterval(bind(this,"_updateSize"),500)},_initVisibilityChange:function(){var a=null;this._hiddenPropertyName=null,typeof document.hidden!="undefined"?(a="visibilitychange",this._hiddenPropertyName="hidden"):typeof document.webkitHidden!="undefined"?(a="webkitvisibilitychange",this._hiddenPropertyName="webkitHidden"):typeof document.mozHidden!="undefined"?(a="mozvisibilitychange",this._hiddenPropertyName="mozHidden"):typeof document.msHidden!="undefined"&&(a="msvisibilitychange",this._hiddenPropertyName="msHidden");if(!a)return;document.addEventListener(a,bind(this,"_onVisibilityChange"),!1)},_onVisibilityChange:function(){this.fire("visibilityChange",[this.hidden])},_onTizenHardwareKey:function(a){if(a.keyName)var b=a.keyName;else if(a.originalEvent&&a.originalEvent.keyName)var b=a.originalEvent.keyName;else var b=null;switch(b){case"back":tizen.application.getCurrentApplication().exit()}}});return Object.defineProperty(c.prototype,"orientation",{get:function(){var a=this.width>=this.height?"landscape":"portrait";return isNaN(window.orientation)&&b.orientation!=="both"?b.orientation:a}}),Object.defineProperty(c.prototype,"hidden",{get:function(){return this._hiddenPropertyName?document[this._hiddenPropertyName]:!1}}),Object.defineProperty(c.prototype,"deviceType",{get:function(){return this.isAndroid?"Android":this.isIPhone?"iPhone":this.isIPad?"iPad":"Unknown"}}),Object.defineProperty(c.prototype,"isBrowser",{get:function(){return document&&typeof document.querySelectorAll=="function"&&!this.isCocoonJS&&!this.isXDK}}),Object.defineProperty(c.prototype,"isCocoonJS",{get:function(){return navigator.isCocoonJS}}),Object.defineProperty(c.prototype,"isXDK",{get:function(){return typeof AppMobi!="undefined"}}),Object.defineProperty(c.prototype,"isTizen",{get:function(){return typeof tizen!="undefined"}}),new c}),define("djinn/assets",["djinn/client","djinn/manifest"],function(a,b){var c={},d={image:["png","jpg","jpeg","gif"],audio:["mp3"],font:["ttf"]},e={image:function(c,d,e){var f=new Image;f.onload=function(){f.ready=!0,d&&d(c,f)},f.onerror=function(){e&&e(c,f)};if(a.isBrowser&&c.substring(0,5)!="data:")var c=c+"?v="+b.version;return f.src=c,f},audio:function(b,c){if(typeof Audio=="undefined")return logger.warn("[assets] No Audio object: "+b),c&&c(b,null),null;var d=new Audio;if(d.canPlayType("audio/ogg")!==""&&!a.isTouch)b=b.replace(/\.mp3/,".ogg");else if(d.canPlayType("audio/mpeg")==="")return logger.warn("[assets] No audio support: "+b),c&&c(b,null),null;return a.isBrowser?(d.addEventListener("canplay",function(){if(d.ready)return;d.ready=!0,c&&c(b,d)},!1),d.src=b):(d.addEventListener("canplaythrough",function(){d.ready=!0,c&&c(b,d)}),d.src=b,d.load()),d},font:function(b,c){if(a.isBrowser){var d=/^.*\/([^\.]+)\.ttf$/.exec(b),e=d[1],f=sprintf("@font-face { font-family: '%s'; src: url('%s'); }",e,b),g=document.createElement("style");g&&(g.innerHTML=f,document.body.appendChild(g))}return c&&c(b,null),null}},f={};return f.cacheImage=function(a,b){c[a]=e.image(b)},f.load=function(a,b,d){if(!a||a.length<1){d&&d(null,null,0,0,1),b&&b();return}typeof a=="string"&&(a=[a]);var g=a.length,h=0,i=function(a,e){c[a]=e,++h;var f=h/g;d&&d(a,e,h,g,f),h>=g&&b&&b()},j=function(a,b){logger.error("[assets.load] Failed to load asset: "+a),i(a,b)};for(var k=0,l=a.length;k<l;++k){var m=a[k];if(typeof m!="string"||m.length<=0)--g,logger.info("[assets.load] Skipping empty asset path");if(c[m])i(m,c[m]);else{var n=f.inferAssetType(m);if(n&&e[n]){var o=e[n];c[m]=o(m,i,j)}else--g,logger.info("[assets.load] Skipping unknown asset type: "+m)}}},f.unload=function(a){typeof a=="string"&&(a=[a]);for(var b=0,d=a.length;b<d;++b)delete c[a[b]]},f.queryCache=function(a){return c[a]!==undefined},f.get=function(a){return f.queryCache(a)||(logger.warn("[assets.get] On-the-fly asset load: "+a),f.load(a)),c[a]},f.inferAssetType=function(a){var b=a.split("."),c=b.length>0?b.pop():"";for(var e in d)if(d[e].indexOf(c)!=-1)return e;return null},f}),define("djinn/globalTimer",["djinn/Emitter"],function(a){var b=1e3,c=120,d=a.extend({init:function(a){this._super(a),this.running=!1,this.fps=0,this.deltaTime=0,this.deltaTimeAverage=0,this.tickCount=0,this._lastUpdate=0,this._tickHistory=[]},start:function(){this.running=!0,this._lastUpdate=Date.now(),this._requestFrame()},stop:function(){this.running=!1},_requestFrame:function(){this.running&&requestAnimationFrame(bind(this,"_update"))},_update:function(a){++this.tickCount;var c=a-this._lastUpdate;c>b?(logger.warn("[globalTimer] dropping large tick: ",c),c=1):c<0&&(logger.warn("[globalTimer] negative delta: ",c),c=1),this._recordTick(c),this.deltaTime=c,this.fire("tick",[c]),this._lastUpdate=a,this._requestFrame()},_recordTick:function(a){var b=this._tickHistory.push(a);if(b>c){var d=0;for(var e=0;e<b;++e)d+=this._tickHistory[e];this.deltaTimeAverage=d/b,this.fps=~~(1e3/this.deltaTimeAverage),this._tickHistory=[]}}});return new d}),define("djinn/Timer",["djinn/Emitter","djinn/globalTimer"],function(a,b){var c=a.extend({init:function(a){this._super(),this._elapsed=0,this._loops=0,this._running=!1,this._tickHost=b,typeof a=="number"?this.interval=a:typeof a=="object"?(this.interval=Number(a.interval||1e3),this._tickHost=a.tickHost||this._tickHost):this.interval=1e3},reset:function(){return this.start()},start:function(a){return a!==undefined&&(this.interval=a),this._elapsed=0,this.resume()},resume:function(){return this._running||(this._tickHost.on("tick",this,"_update"),this._running=!0),this},stop:function(){return this._running&&(this._tickHost.off("tick",this,"_update"),this._running=!1),this},_update:function(a){this._elapsed+=a,this._elapsed>=this.interval&&(this._elapsed=0,++this._loops,this.fire("elapsed",[this._loops]))}});return Object.defineProperty(c.prototype,"elapsed",{get:function(){return this._elapsed}}),Object.defineProperty(c.prototype,"percentComplete",{get:function(){return this._elapsed/this.interval*100}}),Object.defineProperty(c.prototype,"running",{get:function(){return this._running},set:function(a){a?this.start():this.stop()}}),c}),define("djinn/audio/AudioBase",["djinn/Emitter","djinn/Timer","djinn/assets"],function(a,b,c){var d=a.extend({init:function(a){var a=merge(a,d.defaults);this._super(a),this.enabled=a.enabled,this.musicEnabled=a.musicEnabled,this.effectsEnabled=a.effectsEnabled,this._fades={},this._fadeTimer=(new b(100)).start(),this._fadeTimer.on("elapsed",this,"_onFadeTimerElapse")},preload:function(a){var b=[];for(var d=0,e=a.length;d<e;++d){var f=a[d],g=this._sounds[f];b.push(g.path)}b.length>0&&c.load(b)},configure:function(){},play:function(){},stop:function(a){this._fades[a]&&delete this._fades[a]},stopAll:function(){},setVolume:function(){},fadeIn:function(a,b){var b=b||{},c=b.volume||0;this._fades[a]={direction:"in",incrementAmount:b.incrementAmount||.05,volume:c,targetVolume:b.targetVolume||1},this.setVolume(a,c),this.play(a,b.currentTime)},fadeOut:function(a,b){var b=b||{},c=b.volume===undefined?1:b.volume;this._fades[a]={direction:"out",incrementAmount:b.incrementAmount||.05,volume:c,targetVolume:b.targetVolume||0},this.setVolume(a,c)},_onFadeTimerElapse:function(){for(var a in this._fades){var b=this._fades[a];b.direction=="out"?(b.volume-=b.incrementAmount,b.volume<=b.targetVolume&&(b.volume=b.targetVolume,this.stop(a),delete this._fades[a])):(b.volume+=b.incrementAmount,b.volume>=b.targetVolume&&(b.volume=b.targetVolume,delete this._fades[a])),this.setVolume(a,b.volume)}}});return Object.defineProperty(d.prototype,"enabled",{set:function(a){if(this._enabled===a)return;this.stopAll(),this._enabled=a;var b=this._enabled?"enable":"disable";this.fire(b)},get:function(){return this._enabled}}),d.defaults={enabled:!0,musicEnabled:!0,effectsEnabled:!0},d}),define("djinn/math/core",[],function(){var a={twoPi:Math.PI*2,sign:function(a){return a>0?1:a==0?0:-1},chance:function(b){var c=a.random(0,100)/100;return c<=b},random:function(a,b){return a instanceof Array?arguments.callee(0,a.length-1):Math.round(Math.random()*(b-a))+a},clamp:function(a,b,c){return Math.min(Math.max(a,b),c)},vary:function(b,c){return b+=a.random(-c,c)},scaleRange:function(a,b,c){return a+~~((b-a)*c)},combineRects:function(a,b){var c=a.x<b.x?a.x:b.x,d=a.y<b.y?a.y:b.y,e=a.x+a.width,f=a.y+a.height,g=b.x+b.width,h=b.y+b.height;return{x:c,y:d,width:(a.x+a.width>b.x+b.width?a.x+a.width:b.x+b.width)-c,height:(a.y+a.height>b.y+b.height?a.y+a.height:b.y+b.height)-d}},intersects:function(a,b){return a.x<b.x+b.width&&b.x<a.x+a.width&&a.y<b.y+b.height&&b.y<a.y+a.height},pointInRect:function(a,b){return a.x>b.x&&a.y>b.y&&a.x<b.x+b.width&&a.y<b.y+b.height},pointInCircle:function(a,b,c,d,e){var f=Math.pow(a-c,2)+Math.pow(b-d,2);return f<Math.pow(e,2)},pointDistance:function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},round:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}};return a}),define("djinn/audio/AudioGeneric",["../client","./AudioBase","../assets","../math/core"],function(a,b,c,d){return b.extend({configure:function(b){this._sounds=b.sounds;if(a.isCocoonJS&&ext&&ext.IDTK_APP)for(var c in this._sounds){var d=this._sounds[c];d.loop===!0&&ext.IDTK_APP.makeCall("addForceMusic",d.path)}},play:function(a,b){if(!this.enabled)return;var c=this._sounds[a];if(!c){logger.warn("[sound.play] invalid sound key",a);return}c.type=c.type||"effect";if(c.type==="music"&&!this.musicEnabled)return;if(c.type==="effect"&&!this.effectsEnabled)return;this._withAudioNode(a,function(a){b!==undefined&&(a.currentTime=b),a.play()})},setVolume:function(a,b){this._withAudioNode(a,function(a){a.volume=b})},stop:function(a){this._super(a),this._withAudioNode(a,function(a){a.pause()})},stopAll:function(){for(var a in this._sounds){var b=this._sounds[a];b&&c.queryCache(b.path)&&this.stop(a)}},_withAudioNode:function(a,b){var e=this._sounds[a];if(e&&e.path){var f=c.get(e.path);f&&f.ready&&(f.volume=d.clamp(e.volume||1,0,1),f.loop=Boolean(e.loop),b(f))}}})}),define("djinn/utils/request",["require","exports","module","../client"],function(a,b,c){var d=a("../client");b.params={},d.isBrowser&&location.href.replace(/[?&]+([^=&]+)=([^&#]*)/gi,function(a,c,d){b.params[c]=d})}),define("djinn/stage",["require","exports","module","./Emitter","./client","./math/core","./manifest","./utils/request"],function(a,b,c){var d=a("./Emitter"),e=a("./client"),f=a("./math/core"),g=a("./manifest"),h=a("./utils/request"),i=[],j=!1,k=["touchstart","touchmove","touchend"],l=["mousedown","mousemove","mouseup"],m=d.extend({init:function(a){this._super(a),this.eraseBeforeRender=!1,this._maxScale=Infinity,this.maintainAspectRatio=g.scaleMode!=="stretch",this.doubleBuffer=!1,this._buffer=null,this._bufferCtx=null,this.acceptInput=!1,this.xInput=0,this.yInput=0,this.inputDown=!1,this.viewportWidth=0,this.viewportHeight=0,this.canvas=null,this.ctx=null,this.xScale=1,this.yScale=1,e.isTizen&&(this.doubleBuffer=!0,this.eraseBeforeRender=!0);if(e.isXDK)var b=this.canvas=AppMobi.canvas;else{var c=this.isCocoonJS?"screencanvas":"canvas",b=this.canvas=document.createElement(c);b.width=e.width,b.height=e.height,e.isBrowser&&(b.style.position="absolute",b.style.left=0,b.style.top=0),document.body.appendChild(b)}this._initInput(),this.ctx=b.getContext("2d"),e.on("resize",this,"_autoSize")},matchSize:function(a){if(!a||a.length===0){logger.warn("[stage] sizes needs to be set in manifest",a);return}var b=null,c=Infinity,d=0,f=h.params.hd==="1",g=Math.min(e.width,e.height),i=Math.max(e.width,e.height);for(var j=0,k=a.length;j<k;++j){var l=a[j],m=Math.min(l[0],l[1]),n=Math.max(l[0],l[1]);if(f)n>d&&(b=[m,n],d=n,this.sizeIndex=j);else{var o=Math.abs(m*n-g*i);o<c&&(b=[m,n],c=o,this.sizeIndex=j)}}this.canvas.width=b[0],this.canvas.height=b[1],this._autoSize()},localizePoint:function(a,b){return e.isXDK?{x:a,y:b}:{x:Math.round((a-this.canvas.offsetLeft)*(1/this.xScale)),y:Math.round((b-this.canvas.offsetTop)*(1/this.yScale))}},renderView:function(a){var b=this.canvas,c=this.ctx;e.isXDK?c.clear():this.eraseBeforeRender&&c.clearRect(0,0,b.width,b.height);if(this.doubleBuffer){this._buffer||(this._buffer=this.createBuffer(b.width,b.height),this._bufferCtx=this._buffer.getContext("2d"));var d=this._buffer;this.eraseBeforeRender&&this._bufferCtx.clearRect(0,0,d.width,d.height),a.preRender(this._bufferCtx),c.drawImage(d,0,0,d.width,d.height,0,0,b.width,b.height)}else a.preRender(c);e.isXDK&&c.present()},createBuffer:function(a,b){var c=document.createElement("canvas");return c.width=Number(a),c.height=Number(b),c},getInputEvents:function(){var a=i;return i=[],a},requestFullScreen:function(){document.body.webkitRequestFullScreen()},cancelFullScreen:function(){document.webkitCancelFullScreen()},toggleFullScreen:function(){if(!this.canFullScreen)return;this.isFullScreen?this.cancelFullScreen():this.requestFullScreen()},setViewport:function(a,b){this.viewportWidth=a,this.viewportHeight=b,this._autoSize()},_getEventType:function(a){switch(a.type){case"touchstart":case"mousedown":return"inputStart";case"touchmove":case"mousemove":return"inputMove";case"touchend":case"mouseup":return"inputEnd"}},_handleInputEvent:function(a){if(!this.acceptInput)return;var b=-1,c=0,d=0;if(e.isTouch){var f=a.type==="touchend"?a.changedTouches[0]:a.touches[0];b=f.identifier,c=f.pageX,d=f.pageY}else c=a.pageX,d=a.pageY;var g={id:b,type:this._getEventType(a),point:this.localizePoint(c,d)};this.xInput=g.point.x,this.yInput=g.point.y,this.inputDown=g.type!=="inputEnd",i.push(g),this.fire(g.type,[g]),this.fire("input",[g]),j||(j=!0,this.fire("initialInput"))},_initInput:function(){var a=this.canvas,b=e.isTouch?k:l;for(var c=0,d=b.length;c<d;++c)a.addEventListener(b[c],bind(this,"_handleInputEvent"),!1)},_autoSize:function(){var a=this.canvas,b=Math.min(a.width,a.height),c=Math.max(a.width,a.height),d=g.orientation!=="both"&&g.forceOrientation,i=d?g.orientation:e.orientation;a.width=i=="portrait"?b:c,a.height=i=="portrait"?c:b;var j=this.viewportWidth||e.width,k=this.viewportHeight||e.height,l=j/a.width,m=k/a.height;e.isCocoonJS?(this.xScale=this.yScale=1,a.style.cssText="idtkscale:ScaleAspectFit;"):h.params.scale?this.xScale=this.yScale=Number(h.params.scale):this.maintainAspectRatio?this.xScale=this.yScale=Math.min(l,m):(this.xScale=l,this.yScale=m),e.log("[stage._autoSize] view: %sx%s, canvas: %sx%s, scale: %s, %s",j,k,a.width,a.height,f.round(this.xScale,3),f.round(this.yScale,3));var n="0 0";if(e.isIOS)var o=sprintf("scale3d(%s, %s, 1)",this.xScale,this.yScale);else var o=sprintf("scale(%s, %s)",this.xScale,this.yScale);if(e.isBrowser){var p=a.style;p.transformOrigin=n,p.transform=o;var q=["webkit","Moz","ms"];for(var r=0,s=q.length;r<s;++r){var t=q[r];p[t+"TransformOrigin"]=n,p[t+"Transform"]=o}p.left=e.width/2-a.width*this.xScale/2+"px",g.yStageAlign==="top"?p.top=0:p.top=e.height/2-a.height*this.yScale/2+"px"}this.fire("resize")}}),n=m.prototype;Object.defineProperty(n,"canFullScreen",{get:function(){return typeof document.webkitCancelFullScreen=="function"}}),Object.defineProperty(n,"isFullScreen",{get:function(){return document.webkitIsFullScreen}}),Object.defineProperty(n,"maxScale",{get:function(){return this._maxScale},set:function(a){this._maxScale=a,this._autoSize()}}),Object.defineProperty(n,"width",{get:function(){return this.canvas.width}}),Object.defineProperty(n,"height",{get:function(){return this.canvas.height}}),Object.defineProperty(n,"scaleWidth",{get:function(){return this.width*this.xScale}}),Object.defineProperty(n,"scaleHeight",{get:function(){return this.height*this.yScale}}),c.exports=new m}),define("djinn/audio/AudioSprite",["./AudioBase","../assets","../stage","../globalTimer"],function(a,b,c,d){return a.extend({configure:function(a){this._spritePath=a.spritePath,this._sounds=a.sounds,this._stopTime=null,c.on("initialInput",this,function(){if(!this._spritePath)return;b.load(this._spritePath),this._audioNode=b.get(this._spritePath),this._audioNode.play(),this._audioNode.pause()}),d.on("tick",this,"_onTick")},play:function(a){if(!this.enabled)return;this._withAudioNode(a,bind(this,function(a,b){this.stop(),a.currentTime=b.start,this._stopTime=b.start+b.duration,a.play()}))},stop:function(){this._stopTime=null,this._audioNode&&this._audioNode.pause()},_withAudioNode:function(a,b){var c=this._sounds[a];c&&c.duration>0&&this._audioNode&&this._audioNode.ready&&b(this._audioNode,c)},_onTick:function(){if(!this._stopTime||!this._audioNode)return;this._audioNode.currentTime>=this._stopTime&&this.stop()}})}),define("djinn/sound",["./client","./audio/AudioGeneric","./audio/AudioSprite"],function(a,b,c){return a.isTouch&&a.isBrowser&&!a.isTizen?new c:new b}),define("djinn/utils/keys",{tab:9,space:32,escape:27,backspace:8,enter:13,shift:16,up:38,down:40,left:37,right:39,n0:48,n1:49,n2:50,n3:51,n4:52,n5:53,n6:54,n7:55,n8:56,n9:59,w:87,a:65,s:83,d:68,c:67,x:88,e:69,m:77,q:81,z:90}),define("djinn/utils/array",["djinn/math/core"],function(a){var b={isArray:function(a){return a?typeof a.unshift=="function":!1},force:function(a){return b.isArray(a)?a:[a]},contains:function(a,b){return a.indexOf(b)!==-1},containsAny:function(a,c){for(var d=0,e=c.length;d<e;++d)if(b.contains(a,c[d]))return!0;return!1},removeValue:function(a,b){var c=a.indexOf(b);if(c===-1)return;a.splice(c,1)},addItems:function(a,b,c){for(var d=0,e=b.length;d<e;++d){var f=b[d];if(c&&a.indexOf(f)!==-1)continue;a.push(f)}},pushOnce:function(a,b){if(a.indexOf(b)!==-1)return;a.push(b)},pickRandom:function(b){var c=a.random(0,b.length-1);return b[c]},popRandom:function(b){var c=a.random(0,b.length-1),d=b[c];return b.splice(c,1),d},merge:function(a,b,c){var d=[];while(a.length>0&&b.length>0)c(a[0],b[0])<=0?d.push(a.shift()):d.push(b.shift());return d.concat(a,b)},sort:function(a,c){var d=a.length;if(d<2)return a;var e=Math.ceil(d/2);return b.merge(b.sort(a.slice(0,e),c),b.sort(a.slice(e),c),c)},shuffle:function(a){var b=a.length;if(b<1)return;while(--b){var c=Math.floor(Math.random()*(b+1)),d=a[c];a[c]=a[b],a[b]=d}return a},max:function(a){var b=a[0]||0;for(var c=0,d=a.length;c<d;++c)b=Math.max(a[c],b);return b},sum:function(a){var b=0;for(var c=0,d=a.length;c<d;++c){if(isNaN(a[c]))continue;b+=a[c]}return b}};return b}),define("djinn/keyboard",["djinn/Emitter","djinn/utils/keys","djinn/utils/array"],function(a,b,c){var d=a.extend({init:function(a){this._super(a),this._capture=[],this.keys=b,this._keysDown={},this._keyHistory=[],this._lastKeysDown={},this._shiftDown=!1,window.addEventListener("keydown",bind(this,"_handleKeyEvent"),!1),window.addEventListener("keyup",bind(this,"_handleKeyEvent"),!1)},capture:function(a){var b=this._capture;a.forEach(function(a){if(b.indexOf(a)!==-1)return;b.push(a)})},endFrame:function(){this._lastKeysDown={};for(var a in this._keysDown)this._lastKeysDown[a]=this._keysDown[a]},checkHistory:function(a){var b=a.length,c=this._keyHistory.slice(-b);if(c.length!=b)return!1;for(var d=0;d<b;d++)if(a[d]!==c[d])return!1;return!0},clearHistory:function(){this._keyHistory=[]},isDown:function(a,b){c.isArray(a)||(a=[a]);for(var d=0,e=a.length;d<e;++d)if(this._keysDown[a[d]])if(b!==!0||this._lastKeysDown[a[d]]!==!0)return!0;return!1},isShiftDown:function(){return this._shiftDown},isAnyDown:function(){for(var a in this._keysDown)return!0;return!1},clearKeys:function(a){var a=c.force(a);for(var b=0,d=a.length;b<d;++b)delete this._keysDown[a[b]]},_handleKeyEvent:function(a){this._capture.indexOf(a.keyCode)!==-1&&a.preventDefault(),a.type==="keydown"?(this._keysDown[a.keyCode]=!0,this._keyHistory.push(a.keyCode),this._keyHistory.length>50&&this._keyHistory.shift()):a.type==="keyup"&&delete this._keysDown[a.keyCode],this._shiftDown=a.shiftKey}});return new d}),define("djinn/utils/buttons",{dPadUp:12,dPadDown:13,dPadLeft:14,dPadRight:15,face1:0,face2:1,face3:2,face4:3,shoulderTopLeft:4,shoulderTopRight:5,shoulderBottomLeft:6,shoulderBottomRight:7,select:8,start:9,analogLeft:10,analogRight:11}),define("djinn/gamepad",["djinn/Emitter","djinn/utils/buttons","djinn/utils/array"],function(a,b,c){var d=.75,e=.25,f=.3,g=.3,h={up:function(a,b){return a.axes[1]<-b},down:function(a,b){return a.axes[1]>b},left:function(a,b){return a.axes[0]<-b},right:function(a,b){return a.axes[0]>b}},i=function(a){var b=navigator.getGamepads||navigator.webkitGetGamepads;if(!b)return null;var c=b.call(navigator),d=c[a||0];return d},j=a.extend({init:function(a){this._super(a),this.buttons=b,this.threshold=d,this._buttonsDown={},this._lastButtonsDown={}},exists:function(){return!!i()},endFrame:function(){this._lastButtonsDown={};for(var a in this._buttonsDown)this._lastButtonsDown[a]=this._buttonsDown[a]},getAnalogData:function(a){var b={x:0,y:0,magnitude:0,magnitudeNormal:0},c=i();if(!c)return b;var d=c.axes,h=a==="left",j=h?f:g,k=h?d[0]:d[2],l=h?d[1]:d[3];Math.abs(k)<e&&(k=0),Math.abs(l)<e&&(l=0);var m=Math.sqrt(k*k+l*l),n=k/m,o=l/m;if(m>j){m=Math.min(m,1),m-=j;var p=m/(1-j);b.x=k,b.y=l,b.xNormal=n,b.yNormal=o,b.magnitude=m,b.magnitudeNormal=p}return b},isButtonDown:function(a,b){var c=i();if(!c)return!1;var d=c.buttons[a]>this.threshold,e=d;return b&&(e=d&&!this._buttonsDown[a]),this._buttonsDown[a]=d,e},clearButtons:function(a){var b=i();if(!b)return!1;var a=c.force(a);a.forEach(function(a){b.buttons[a]=!1},this)},isDirectionDown:function(a,b){var c=i();return c?h[a](c,this.threshold):!1}});return new j}),define("djinn/utils/transitions",[],function(){var a={linear:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},inStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},outStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},bothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*.3);if(!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b},elasticOut:function(a,b,c,d,e,f){if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*.3);if(!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b},elasticBoth:function(a,b,c,d,e,f){if(a==0)return b;if((a/=d/2)==2)return b+c;f||(f=d*.3*1.5);if(!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return a<1?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b},backIn:function(a,b,c,d,e){return e===undefined&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},backOut:function(a,b,c,d,e){return e===undefined&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return e===undefined&&(e=1.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(b,c,d,e){return d-a.bounceOut(e-b,0,d,e)+c},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(b,c,d,e){return b<e/2?a.bounceIn(b*2,0,d,e)*.5+c:a.bounceOut(b*2-e,0,d,e)*.5+d*.5+c}};return a}),define("djinn/View",["djinn/client","djinn/Emitter","djinn/utils/transitions","djinn/assets","djinn/math/core","djinn/Timer","djinn/stage","djinn/utils/array","djinn/globalTimer"],function(a,b,c,d,e,f,g,h,i){var j=0,k=function(a,b){return a.z===b.z?a.id-b.id:a.z-b.z},l=b.extend({init:function(a){var b=++j;a=merge(a,{id:b,tag:"View_"+b},l.defaults),a.parent&&(a.width=a.width||a.parent.width,a.height=a.height||a.parent.height),this._super(a),this.id=a.id,this.tag=a.tag,this.x=a.x,this.y=a.y,this._z=a.z,this.anchorX=a.anchorX||a.width/2,this.anchorY=a.anchorY||a.height/2,this.rotation=a.rotation,this.boundingBox=a.boundingBox,this.width=a.width,this.height=a.height,this.scale=a.scale,this.scaleX=a.scaleX,this.scaleY=a.scaleY,this.visible=a.visible,this.opacity=a.opacity,this.clip=a.clip,this.backgroundColor=a.backgroundColor,this.overlayColor=a.overlayColor,this.compositeOperation=a.compositeOperation,this._image=null,this.imageX=a.imageX,this.imageY=a.imageY,this.flipHorizontal=a.flipHorizontal,this.flipVertical=a.flipVertical,this._savedProperties={},this.acceptInputEvents=a.acceptInputEvents,this.captureInputEvents=a.captureInputEvents,this.cancelInputEvents=a.cancelInputEvents,this.paused=a.paused,this.tickSpeed=a.tickSpeed,this.debug=a.debug,this.children=[],this._removedChildren=[],this.needsResort=!1,this.needsReflow=!1,this.layouts=a.layouts,this._tweenQueue=[],this._lastSortTick=0,this.autoSort=a.autoSort,this.autoSortDelay=a.autoSortDelay,this.recyclable=a.recyclable,a.image&&(this.image=a.image),a.bottom!==undefined&&(this.bottom=a.bottom),a.right!==undefined&&(this.right=a.right),a.parent&&a.parent.addChild(this)},saveProperties:function(a,b){var c={};for(var d=0,e=b.length;d<e;++d){var f=b[d];c[f]=this[f]}return this._savedProperties[a]=c,this},loadProperties:function(a){var b=this._savedProperties[a];for(var a in b)this[a]=b[a];return this},getProperty:function(a,b){var c=this._savedProperties[a];return c[b]},set:function(a){for(var b in a)this[b]=a[b];return this},addChild:function(a){a.parent&&a.removeFromParent(),a.parent=this,this.children.push(a),this.needsResort=!0},removeChild:function(a){a.parent==this&&this._removedChildren.indexOf(a)==-1&&(a.parent=null,this._removedChildren.push(a))},getChildByTag:function(a){for(var b=0,c=this.children.length;b<c;++b){var d=this.children[b];if(d.tag==a)return d}return null},removeChildren:function(){for(var a=0,b=this.children.length;a<b;++a){var c=this.children[a];c.removeFromParent()}},removeFromParent:function(){this.parent&&this.parent.removeChild(this),this.fire("removedFromParent",[this])},destroy:function(){this.removeListeners(),this.cancelTween(),this.removeFromParent(),this.destroyChildren(),this.recyclable&&l.recycle(this)},destroyChildren:function(){var a=this.children;for(var b=0,c=a.length;b<c;++b){var d=a[b];d.destroy()}},sortChildren:function(){if(!this.autoSort)return;var a=i.tickCount;if(a-this._lastSortTick<this.autoSortDelay)return;this.children.sort(k),this.needsResort=!1,this._lastSortTick=a},reflow:function(){this.debug&&logger.info(this.tag+": Reflow");var a=this._getCurrentLayout();a!=null&&this.applyLayout(a);for(var b=0,c=this.children.length;b<c;++b)this.children[b].reflow();this.needsReflow=!1},applyLayout:function(a){this.set(a.conf),a.align&&this.align.apply(this,a.align);for(var b=0,c=this.children.length;b<c;++b){var d=this.children[b];a.children&&a.children[d.tag]&&d.applyLayout(a.children[d.tag])}},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},toggle:function(){this.visible?this.hide():this.show()},intersects:function(a){return a instanceof l?e.intersects(a.boundingBox,this.boundingBox):a.width?e.intersects(a,this.boundingBox):e.pointInRect(a,this.boundingBox)},createBoundTimer:function(a,b){var c=new f({interval:a,tickHost:this});return c.on("elapsed",this,b),c},react:function(a){if(!this.canReact)return;if(this.captureInputEvents){var b={x:a.point.x-this.x,y:a.point.y-this.y};for(var c=this.children.length-1;c>=0;--c){var d=this.children[c];if(d.canReact&&d.intersects(b)){a.point.x=b.x,a.point.y=b.y,d.react(a);if(a.cancel===!0)return}}a.target||(a.target=this),a.point.x=b.x,a.point.y=b.y,this.fire(a.type,[a]),a.type==="inputStart"?this._inputStartID=a.id:a.type==="inputEnd"&&this._inputStartID===a.id&&(this.fire("inputPress",[a]),delete this._inputStartID)}this.cancelInputEvents&&(a.cancel=!0)},preTick:function(a){if(this.paused||!this.visible)return;var a=a*this.tickSpeed;this._cullChildren(),this._updateTween(a),this.tick&&this.tick(a),this.fire("tick",[a]);var b=this.children;for(var c=0,d=b.length;c<d;++c)b[c].preTick(a)},preRender:function(b){if(!this.visible||this.opacity<=0)return;this.needsResort&&this.sortChildren(),this.needsReflow&&this.reflow();var c=~~this.x,d=~~this.y,e=~~this.anchorX,f=~~this.anchorY;b.save();var g=this.compositeOpacity;g!==1&&(b.globalAlpha=g),this.compositeOperation&&(b.globalCompositeOperation=this.compositeOperation),b.translate(c+e,d+f),this.rotation!=0&&b.rotate(this.rotation),this.scale!=1?b.scale(this.scale,this.scale):(this.scaleX!=1||this.scaleY!=1)&&b.scale(this.scaleX,this.scaleY);if(this.flipHorizontal||this.flipVertical){var h=this.flipHorizontal?-1:1,i=this.flipVertical?-1:1;b.scale(h,i)}b.translate(-e,-f),this.clip&&!a.isXDK&&(b.beginPath(),b.rect(0,0,this.width,this.height),b.clip(),b.closePath()),this.render&&this.width>0&&this.height>0&&(this.render(b),this.debug&&this._renderDebug(b)),this.renderChildren(b),b.restore()},renderChildren:function(a){var b=this.children;for(var c=0,d=b.length;c<d;++c){var e=b[c];if(e.parent!==this)continue;e.preRender(a)}},render:function(a){var b=a;this.overlayColor&&(this._makeBuffer(),b=this._bufferContext),this._image&&this._image.ready?b.drawImage(this._image,this.imageX,this.imageY,this.width,this.height,0,0,this.width,this.height):this.backgroundColor&&(b.fillStyle=this.backgroundColor,b.fillRect(0,0,this.width,this.height)),this.overlayColor&&(b.globalCompositeOperation="source-atop",b.fillStyle=this.overlayColor,b.fillRect(0,0,this.width,this.height)),b!==a&&a.drawImage(this._bufferCanvas,0,0,this.width,this.height)},_makeBuffer:function(){if(this._bufferCanvas){this._bufferCanvas.width=this.width,this._bufferCanvas.height=this.height;return}this._bufferCanvas=g.createBuffer(this.width,this.height),this._bufferContext=this._bufferCanvas.getContext("2d")},align:function(a,b,c,d){if(!this.parent)return;if(a!==undefined&&a!==null){switch(a){case"left":this.x=0;break;case"right":this.right=this.parent.width;break;case"center":this.x=this.parent.width/2-this.width/2}this.x+=c||0}if(b!==undefined&&b!==null){switch(b){case"top":this.y=0;break;case"bottom":this.y=this.parent.height-this.height;break;case"center":this.y=this.parent.height/2-this.height/2}this.y+=d||0}return this},centerOn:function(a,b,c){typeof a=="number"&&logger.error("centerOn doesn't support numbers"),a.width=a.width||1,a.height=a.height||1;var d=a.x+a.width/2,e=a.y+a.height/2;return this.x=d-this.width/2+(b||0),this.y=e-this.height/2+(c||0),this},centerAnchor:function(){return this.anchorX=this.width/2,this.anchorY=this.height/2,this},tween:function(a,b,d,e){if(a!=null)for(var f in a){var g=a[f];typeof g!="object"&&(a[f]={from:null,to:g})}return this._tweenQueue.push({properties:a,duration:isNaN(b)?1e3:b,transition:d||c.linear,callback:e||null,elapsed:0}),this.visible||(logger.info(this.tag+": Auto-completing tween because this view is invisible"),this.completeTween()),this},delayTween:function(a,b){return this.tween(null,a,null,b)},cancelTween:function(a){return this._tweenQueue=[],a&&this.set(a),this},completeTween:function(a){var b=this._tweenQueue.length,c=this._tweenQueue.splice(0,b);for(var d=0;d<b;++d){var e=c[d];for(var f in e.properties)this[f]=e.properties[f].to;e.callback&&e.callback()}return a&&this.set(a),this},_updateTween:function(a){var b=this._tweenQueue,c=function(){var a=b.shift();a.callback&&a.callback()};while(a>0&&b.length>0){var d=b[0],e=d.duration-d.elapsed,f=Math.min(a,e);d.elapsed+=f,a-=f;if(d.properties===null){d.elapsed>=d.duration&&c();continue}var g=Math.ceil(d.duration/f),h=Math.floor(g*(d.elapsed/d.duration));if(h>=g||d.duration<=0){for(var i in d.properties)this[i]=d.properties[i].to;c()}else for(var i in d.properties){var j=d.properties[i];j.from==null&&(j.from=this[i]);var k=d.transition(h,j.from,j.to-j.from,g);this[i]=k}}},_cullChildren:function(){var a=this._removedChildren,b=a.length;if(b<1)return;var c=this.children;for(var d=0;d<b;++d){var e=a[d],f=c.indexOf(e);f!=-1?c.splice(f,1):logger.warn("Tried to remove non-child "+e.tag+" from "+this.tag)}a.splice(0,b)},_getCurrentLayout:function(){var a=g.width+"x"+g.height;return this._layouts&&this._layouts[a]?this._layouts[a]:null},_initLayouts:function(){if(this._layouts==null)return;var a=this._layouts.init,b=a?a.conf||{}:{},c=this._getCurrentLayout();c&&c.conf&&(b=merge(c.conf,b)),this.set(b);if(a&&a.children)for(var d in a.children){var e=a.children[d],f=e.conf||{},g=this._getCurrentLayout(),h=null;g!=null&&g.children&&g.children[d]&&(h=g.children[d],f=merge(h.conf,f));var i=e.ctor||l,j=new i(merge({parent:this,tag:d},f));h&&h.align&&j.align.apply(j,h.align)}this.reflow()},_renderDebug:function(a){a.lineWidth=1;var b=this.boundingBox,c=b.x-this.x,d=b.y-this.y;a.fillStyle="rgba(255, 0, 0, 0.15)",a.fillRect(c,d,b.width,b.height),a.strokeStyle="rgb(255, 0, 0)",a.strokeRect(c,d,b.width,b.height),a.strokeStyle="rgb(0, 0, 255)",a.strokeRect(0,0,this.width,this.height)}});l.transitions=c,Object.defineProperty(l.prototype,"right",{get:function(){return this.x+this.width},set:function(a){this.x=a-this.width}}),Object.defineProperty(l.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){this.y=a-this.height}}),Object.defineProperty(l.prototype,"z",{get:function(){return this._z},set:function(a){if(this._z===a)return;this._z=a,this.parent&&(this.parent.needsResort=!0)}}),Object.defineProperty(l.prototype,"image",{set:function(a){this._image=d.get(a)}}),Object.defineProperty(l.prototype,"center",{get:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}),Object.defineProperty(l.prototype,"boundingBox",{get:function(){var a=this._boundingBox;return a==null?{x:this.x,y:this.y,width:this.width,height:this.height}:{x:this.x+a.x,y:this.y+a.y,width:a.width,height:a.height}},set:function(a){this._boundingBox=a}}),Object.defineProperty(l.prototype,"compositeOpacity",{get:function(){var a=this.parent?this.parent.compositeOpacity:1;return this.opacity*a}}),Object.defineProperty(l.prototype,"layouts",{set:function(a){this._layouts=a,this._initLayouts()}}),Object.defineProperty(l.prototype,"canReact",{get:function(){return this.acceptInputEvents&&this.visible&&!this.paused}}),Object.defineProperty(l.prototype,"absolutePosition",{get:function(){var a=this.x,b=this.y,c=this;while(c.parent instanceof l)c=c.parent,a+=c.x,b+=c.y;return{x:a,y:b}}});var m={};return l.create=function(a,b){var c=a.uid,d=m[c];if(d&&d.length>0){var e=d.shift();return e.init(b),e}return new a(b)},l.recycle=function(a){var b=a.constructor.uid,c=m[b];c||(c=m[b]=[]),c.push(a)},l.defaults={parent:null,x:0,y:0,z:1,anchorX:null,anchorY:null,boundingBox:null,acceptInputEvents:!1,captureInputEvents:!0,cancelInputEvents:!1,debug:!1,layouts:null,rotation:0,recyclable:!1,clip:!1,width:0,height:0,scale:1,scaleX:1,scaleY:1,visible:!0,opacity:1,backgroundColor:null,overlayColor:null,compositeOperation:null,image:null,imageX:0,imageY:0,paused:!1,tickSpeed:1,flipHorizontal:!1,flipVertical:!1,autoSort:!0,autoSortDelay:1},l}),define("djinn/TextView",["djinn/View","djinn/client","djinn/stage"],function(a,b,c){var d=c.createBuffer(1,1),e=d.getContext("2d"),f=a.extend({init:function(a){a=merge(a,f.defaults),a.parent&&(!a.width||a.width<1)&&(a.width=a.parent.width);if(!a.height||a.height<1)a.height=a.fontSize;this._super(a),this._lineBuffer=null,this._rawText=null,this.color=a.color,this.fontSize=a.fontSize,this.fontFamily=a.fontFamily,this.shadowColor=a.shadowColor,this.shadowX=a.shadowX,this.shadowY=a.shadowY,this.strokeColor=a.strokeColor,this.strokeWidth=a.strokeWidth,this.textAlign=a.textAlign,this.verticalAlign=a.verticalAlign,this.text=a.text,this.wordWrap=a.wordWrap,this.autoWidth=a.autoWidth,this.autoWidthPadding=a.autoWidthPadding},render:function(a){this._super(a);if(this.text===undefined||this.text===null||this.text.length<1)return;this._lineBuffer==null&&this._bufferLines(this.text,a);var c=0,d=0;this.textAlign=="center"&&(c=this.width/2),this.textAlign=="right"&&(c=this.width),this.verticalAlign=="middle"&&(d=this.height/2),this._applyContextSettings(a);for(var e=0,f=this._lineBuffer.length;e<f;++e){var g=d+e*this.fontSize,h=this._lineBuffer[e];this.shadowColor&&(a.fillStyle=this.shadowColor,a.fillText(h,c+this.shadowX,g+this.shadowY)),(!b.isTouch||!b.isBrowser)&&this.strokeColor&&this.strokeWidth&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeText(h,c,g)),a.fillStyle=this.color,a.fillText(h,c,g)}},_applyContextSettings:function(a){var b=sprintf("%spx %s",this.fontSize,this.fontFamily);a.font=b,a.textAlign=this.textAlign,a.textBaseline=this.verticalAlign},_bufferLines:function(a,b){var a=String(a);this._lineBuffer=[];if(this.wordWrap){this._applyContextSettings(b);var c=a.split(" "),d=0;for(var e=0,f=c.length;e<f;++e){var g=this._lineBuffer[d]||"",h=g.length>0?g+" "+c[e]:c[e];g.length>0&&b.measureText(h).width>this.width?(++d,this._lineBuffer[d]=c[e]):this._lineBuffer[d]=h}}else this._lineBuffer.push(a)}});return Object.defineProperty(f.prototype,"text",{get:function(){return this._rawText},set:function(a){this._lineBuffer=null,this._rawText=a===undefined?null:String(a),this.autoWidth&&(this._applyContextSettings(e),this.width=e.measureText(this._rawText).width,this.width+=this.autoWidthPadding)}}),f.defaults={color:"rgb(0, 0, 0)",fontFamily:"Arial",fontSize:20,shadowColor:null,shadowX:1,shadowY:1,strokeColor:null,strokeWidth:null,text:"",textAlign:"left",verticalAlign:"top",wordWrap:!0,autoWidth:!1,autoWidthPadding:0},f}),define("djinn/helpers/RotateDeviceView",["djinn/View","djinn/TextView","djinn/manifest"],function(a,b,c){var d="%s works best in %s orientation. Please rotate your device.",e=a.extend({init:function(a){var a=merge(a,e.defaults);this._super(a),this._message=new b({parent:this,textAlign:"center",color:"white",fontSize:50,text:sprintf(d,c.title,c.orientation)}),this.reflow()},reflow:function(){this.set({width:this.parent.width,height:this.parent.height}),this._message.set({width:this.width}).align("center","center"),this._super()}});return e.defaults={backgroundColor:"black",visible:!1,z:Infinity},e}),define("djinn/ui/ProgressBar",["djinn/View"],function(a){return a.extend({init:function(a){var a=merge(a,{progress:0});this._super(a),this.progress=Number(a.progress)},render:function(a){this._super(a);var b=this.width*this.progress;a.fillStyle="rgb(100, 100, 100)",a.fillRect(0,0,b,this.height),a.lineWidth=2,a.strokeStyle="rgb(230, 230, 230)",a.strokeRect(0,0,this.width,this.height)}})}),define("djinn/utils/viewEffects",["djinn/math/core","djinn/utils/transitions"],function(a,b){return{alert:function(a,c,d){var c=c||{},e=a.z;a.z=Infinity,a.tween({scale:c.scale||1.5},(c.duration||500)/2,b.easeBoth,function(){c.midCallback&&c.midCallback()}).tween({scale:1},(c.duration||500)/2,b.easeBoth,function(){a.z=e,d&&d()})},burst:function(a,c,d){a.opacity=0,a.scale=.5,a.tween({opacity:1,rotation:Math.PI/2,scale:1.5},100,b.linear).tween({opacity:0},100,b.linear,function(){d&&d()})},buttonPress:function(a,c,d){a.tween({y:a.y+a.height/10},50,b.linear).tween({y:a.y},50,b.linear,d)},fadeOut:function(a,c,d){var c=c||{};a.tween({opacity:0},c.duration||1e3,b.linear,d)},fadeIn:function(a,c,d){var c=c||{};a.tween({opacity:1},c.duration||1e3,b.linear,d)},fadeInAndOut:function(a,b,c){var b=b||{},d=(b.duration||1e3)/2;a.completeTween({opacity:0,visible:!0}),a.tween({opacity:b.opacity||1},d).tween({opacity:0},d,null,c)},popIn:function(c,d,e){var d=d||{},f=a.random(1,2)==1?2:-2,g=a.clamp(c.x+c.width*f,0,c.parent.width-c.width),h=c.y;c.opacity=d.opacity||0,c.scale=d.scale||.5,c.y+=c.height/2,c.tween({opacity:1,scale:1,x:g,y:h},200,b.linear).tween({scale:1.25},50,b.linear).tween({scale:1},50,b.linear,e)},popOut:function(a,c,d){a.opacity=1,a.tween({scale:.75},50,b.linear).tween({opacity:0,scale:2},250,b.linear,d)},shake:function(a,b,c){a.completeTween();var b=b||{},d=b.iterations||10,e=(b.duration||250)/d,f=b.violence||6,g=a.x,h=a.y;for(var i=0;i<d;++i)a.tween({x:a.x+f*(i%2?1:-1)},e);a.delayTween(0,function(){a.x=g,a.y=h,c&&c()})},squishyAppear:function(a,c,d){var c=c||{},e=c.duration||500,f=c.scale||1;a.completeTween({scaleX:2*f,scaleY:0}),a.tween({scaleX:.5*f,scaleY:2*f},e*.3,b.linear).tween({scaleX:f,scaleY:f},e*.7,b.elasticOut,function(){d&&d()})},vibrate:function(b,c,d){b.completeTween();var c=c||{},e=c.iterations||10,f=(c.duration||250)/e,g=c.violence||6,h=b.x,i=b.y;for(var j=0;j<e;++j)b.tween({x:b.x+a.random(-g,g),y:b.y+a.random(-g,g)},f);b.delayTween(1,function(){b.x=h,b.y=i,d&&d()})}}}),define("djinn/helpers/LoadingScreen",["djinn/manifest","djinn/assets","djinn/View","djinn/TextView","djinn/ui/ProgressBar","djinn/utils/viewEffects","djinn/stage"],function(a,b,c,d,e,f,g){var h=merge(a.splash,{fadeDuration:1,displayDuration:0,backgroundColor:"rgb(0, 0, 0)",imageWidth:100,imageHeight:100});return c.extend({init:function(a){Object.defineProperty(this,"loadingProgress",{set:function(a){this._loadingBar.progress=a,this._loadingText.text="LOADING: "+~~(a*100)+"%"}});var a=merge({tag:"LoadingScreen",acceptInputEvents:!0,cancelInputEvents:!0,visible:!1,backgroundColor:h.backgroundColor,z:Infinity},a);this._super(a);if(h.images&&h.images.length>0){var f=h.images[g.sizeIndex];b.load(f.image),this._splashImage=(new c(merge({parent:this},f))).align("center","center")}var i=this.height*.05;this._loadingBar=(new e({parent:this,visible:!1,width:this.width*.8,height:i})).align("center","bottom",0,-i),this._loadingText=(new d({parent:this,visible:!1,text:"LOADING",textAlign:"center",verticalAlign:"middle",color:"rgb(255, 255, 255)",fontSize:~~(i*.75),height:i})).align("center","bottom",0,-i),this._uiDelayTimer=this.createBoundTimer(500,bind(this,"_onDelayElapsed")),this.on("inputStart",this,"_onInputStart")},show:function(a){this.set({opacity:0,visible:!0}),f.fadeIn(this,{duration:h.fadeDuration}),this.delayTween(h.displayDuration,function(){a&&a()}),this._uiDelayTimer.start()},hide:function(a){this.acceptInputEvents=!1,f.fadeOut(this,{duration:h.fadeDuration},bind(this,function(){this.visible=!1,a&&a()}))},_onDelayElapsed:function(){this._uiDelayTimer.stop(),this._loadingBar.progress<1&&(this._loadingText.visible=!0,this._loadingBar.visible=!0)},_onInputStart:function(a){this._onDelayElapsed(),this.completeTween()}})}),define("djinn/Collection",["djinn/utils/array","djinn/Emitter"],function(a,b){var c=b.extend({init:function(a){this._super(a),this.items=[],this._itemIDSeed=0,this._lookup={},this._length=0,this._indexPool=[]},add:function(a){typeof a.id=="undefined"&&(a.id=++this._itemIDSeed);if(this.has(a.id))return logger.warn("[Collection.add] Item ID conflict: "+a.id),null;if(this._indexPool.length>0){var b=this._indexPool.shift();this.items[b]=a}else{this._length=this.items.push(a);var b=this._length-1}return this._lookup[a.id]=b,this.fire("add",[a]),a.id},remove:function(a,b){var c=a.id||a,d=this._getIndex(c);if(!this._isValidIndex(d))return logger.warn("[Collection.remove] Tried to remove invalid item: "+c),null;var a=this.items[d];return this.items[d]=null,delete this._lookup[c],this._indexPool.push(d),b&&a.removeListeners&&a.removeListeners(),this.fire("remove",[a]),a},has:function(a){return this.get(a)!==null},get:function(a){var b=this._getIndex(a);if(isNaN(b)||b>=this._length)return null;var c=this.items[b]||null;return c},forEach:function(a,b){for(var c=0;c<this._length;++c){var d=this.items[c];if(d===null)continue;b?a.call(b,d,this):a(d,this)}},sort:function(){this.items.sort(function(a,b){return a?b?b.id-a.id:-1:1}),this._rebuild()},pickRandom:function(){return a.pickRandom(this.items)},removeAll:function(a){this.forEach(function(b,c){if(!b)return;this.remove(b.id,a)},this),this.items=[],this._lookup={},this._indexPool=[],this._length=0},_getIndex:function(a){return this._lookup[a]},_isValidIndex:function(a){return a>=0&&a<this._length},_rebuild:function(){this._lookup={},this._indexPool=[];for(var a=0,b=this.items.length;a<b;++a){var c=this.items[a];c?this._lookup[c.id]=a:this._indexPool.push(a)}}});return Object.defineProperty(c.prototype,"length",{get:function(){return this._length}}),c}),function(){var a={},b=null,c=!0,d=!1;if(typeof AudioContext!="undefined")b=new AudioContext;else if(typeof webkitAudioContext!="undefined")b=new webkitAudioContext;else if(typeof Audio!="undefined"){c=!1;try{new Audio}catch(e){d=!0}}else c=!1,d=!0;if(c){var f=typeof b.createGain=="undefined"?b.createGainNode():b.createGain();f.gain.value=1,f.connect(b.destination)}var g=function(){this._volume=1,this._muted=!1,this.usingWebAudio=c,this._howls=[]};g.prototype={volume:function(a){var b=this;a=parseFloat(a);if(a&&a>=0&&a<=1){b._volume=a,c&&(f.gain.value=a);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].volume=b._howls[d]._volume*b._volume;return b}return c?f.gain.value:b._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(a){var b=this;b._muted=a,c&&(f.gain.value=a?0:b._volume);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].muted=a}};var h=new g,i=null;if(!d){i=new Audio;var j={mp3:!!i.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var k=function(a){var b=this;b._autoplay=a.autoplay||!1,b._buffer=a.buffer||!1,b._duration=a.duration||0,b._format=a.format||null,b._loop=a.loop||!1,b._loaded=!1,b._sprite=a.sprite||{},b._src=a.src||"",b._pos3d=a.pos3d||[0,0,-0.5],b._volume=a.volume||1,b._urls=a.urls||[],b._rate=a.rate||1,b._onload=[a.onload||function(){}],b._onloaderror=[a.onloaderror||function(){}],b._onend=[a.onend||function(){}],b._onpause=[a.onpause||function(){}],b._onplay=[a.onplay||function(){}],b._onendTimer=[],b._webAudio=c&&!b._buffer,b._audioNode=[],b._webAudio&&b._setupAudioNode(),h._howls.push(b),b.load()};k.prototype={load:function(){var b=this,c=null;if(d){b.on("loaderror");return}for(var e=0;e<b._urls.length;e++){var f,g;if(b._format)f=b._format;else{g=b._urls[e].toLowerCase().split("?")[0],f=g.match(/.+\.([^?]+)(\?|$)/),f=f&&f.length>=2?f:g.match(/data\:audio\/([^?]+);/);if(!f){b.on("loaderror");return}f=f[1]}if(j[f]){c=b._urls[e];break}}if(!c){b.on("loaderror");return}b._src=c;if(b._webAudio)l(b,c);else{var i=new Audio;b._audioNode.push(i),i.src=c,i._pos=0,i.preload="auto",i.volume=h._muted?0:b._volume*h.volume(),a[c]=b;var k=function(){b._duration=i.duration,Object.getOwnPropertyNames(b._sprite).length===0&&(b._sprite={_default:[0,b._duration*1e3]}),b._loaded||(b._loaded=!0,b.on("load")),b._autoplay&&b.play(),i.removeEventListener("canplaythrough",k,!1)};i.addEventListener("canplaythrough",k,!1),i.load()}return b},urls:function(a){var b=this;return a?(b.stop(),b._urls=typeof a=="string"?[a]:a,b._loaded=!1,b.load(),b):b._urls},play:function(a,c){var d=this;typeof a=="function"&&(c=a);if(!a||typeof a=="function")a="_default";return d._loaded?d._sprite[a]?(d._inactiveNode(function(e){e._sprite=a;var f=e._pos>0?e._pos:d._sprite[a][0]/1e3,g=d._sprite[a][1]/1e3-e._pos,i=!!d._loop||!!d._sprite[a][2],j=typeof c=="string"?c:Math.round(Date.now()*Math.random())+"",k;(function(){var b={id:j,sprite:a,loop:i};k=setTimeout(function(){!d._webAudio&&i&&d.stop(b.id,b.timer).play(a,b.id),d._webAudio&&!i&&(d._nodeById(b.id).paused=!0),!d._webAudio&&!i&&d.stop(b.id,b.timer),d.on("end",j)},g*1e3),d._onendTimer.push(k),b.timer=d._onendTimer[d._onendTimer.length-1]})();if(d._webAudio){var l=d._sprite[a][0]/1e3,m=d._sprite[a][1]/1e3;e.id=j,e.paused=!1,n(d,[i,l,m],j),d._playStart=b.currentTime,e.gain.value=d._volume,typeof e.bufferSource.start=="undefined"?e.bufferSource.noteGrainOn(0,f,g):e.bufferSource.start(0,f,g)}else{if(e.readyState!==4)return d._clearEndTimer(k),function(){var b=d,f=a,g=c,h=e,i=function(){b.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),d;e.id=j,e.currentTime=f,e.muted=h._muted,e.volume=d._volume*h.volume(),setTimeout(function(){e.play()},0)}return d.on("play"),typeof c=="function"&&c(j),d}),d):(typeof c=="function"&&c(),d):(d.on("load",function(){d.play(a,c)}),d)},pause:function(a,b){var c=this;if(!c._loaded)return c.on("play",function(){c.pause(a)}),c;c._clearEndTimer(b||0);var d=a?c._nodeById(a):c._activeNode();if(d){d._pos=c.pos(null,a);if(c._webAudio){if(!d.bufferSource)return c;d.paused=!0,typeof d.bufferSource.stop=="undefined"?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else d.pause()}return c.on("pause"),c},stop:function(a,b){var c=this;if(!c._loaded)return c.on("play",function(){c.stop(a)}),c;c._clearEndTimer(b||0);var d=a?c._nodeById(a):c._activeNode();if(d){d._pos=0;if(c._webAudio){if(!d.bufferSource)return c;d.paused=!0,typeof d.bufferSource.stop=="undefined"?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else d.pause(),d.currentTime=0}return c},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=0:c.volume=0),b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=b._volume:c.volume=b._volume),b},volume:function(a,b){var c=this;a=parseFloat(a);if(a>=0&&a<=1){c._volume=a;if(!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();return d&&(c._webAudio?d.gain.value=a:d.volume=a*h.volume()),c}return c._volume},loop:function(a){var b=this;return typeof a=="boolean"?(b._loop=a,b):b._loop},sprite:function(a){var b=this;return typeof a=="object"?(b._sprite=a,b):b._sprite},pos:function(a,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(a)}),typeof a=="number"?d:d._pos||0;a=parseFloat(a);var e=c?d._nodeById(c):d._activeNode();if(e)return d._webAudio?a>=0?(e._pos=a,d.pause(c).play(e._sprite,c),d):e._pos+(b.currentTime-d._playStart):a>=0?(e.currentTime=a,d):e.currentTime;if(a>=0)return d;for(var f=0;f<d._audioNode.length;f++)if(d._audioNode[f].paused&&d._audioNode[f].readyState===4)return d._webAudio?d._audioNode[f]._pos:d._audioNode[f].currentTime},pos3d:function(a,b,c,d){var e=this;b=typeof b=="undefined"||!b?0:b,c=typeof c=="undefined"||!c?-0.5:c;if(!e._loaded)return e.on("play",function(){e.pos3d(a,b,c,d)}),e;if(a>=0||a<0){if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c))}return e}return e._pos3d},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"down":"up",i=g/.01,j=c/i;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var k=1;k<=i;k++)(function(){var a=f._volume+(h==="up"?.01:-0.01)*k,c=Math.round(1e3*a)/1e3,g=b;setTimeout(function(){f.volume(c,e),c===g&&d&&d()},j*k)})()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c(),e.pause(d),e.on("end")},d)},_nodeById:function(a){var b=this,c=b._audioNode[0];for(var d=0;d<b._audioNode.length;d++)if(b._audioNode[d].id===a){c=b._audioNode[d];break}return c},_activeNode:function(){var a=this,b=null;for(var c=0;c<a._audioNode.length;c++)if(!a._audioNode[c].paused){b=a._audioNode[c];break}return a._drainPool(),b},_inactiveNode:function(a){var b=this,c=null;for(var d=0;d<b._audioNode.length;d++)if(b._audioNode[d].paused&&b._audioNode[d].readyState===4){a(b._audioNode[d]),c=!0;break}b._drainPool();if(c)return;var e;b._webAudio?(e=b._setupAudioNode(),a(e)):(b.load(),e=b._audioNode[b._audioNode.length-1],e.addEventListener("loadedmetadata",function(){a(e)}))},_drainPool:function(){var a=this,b=0,c;for(c=0;c<a._audioNode.length;c++)a._audioNode[c].paused&&b++;for(c=a._audioNode.length-1;c>=0;c--){if(b<=5)break;a._audioNode[c].paused&&(a._webAudio&&a._audioNode[c].disconnect(0),b--,a._audioNode.splice(c,1))}},_clearEndTimer:function(a){var b=this,c=b._onendTimer.indexOf(a);c=c>=0?c:0,b._onendTimer[c]&&(clearTimeout(b._onendTimer[c]),b._onendTimer.splice(c,1))},_setupAudioNode:function(){var a=this,c=a._audioNode,d=a._audioNode.length;return c[d]=typeof b.createGain=="undefined"?b.createGainNode():b.createGain(),c[d].gain.value=a._volume,c[d].paused=!0,c[d]._pos=0,c[d].readyState=4,c[d].connect(f),c[d].panner=b.createPanner(),c[d].panner.setPosition(a._pos3d[0],a._pos3d[1],a._pos3d[2]),c[d].panner.connect(c[d]),c[d]},on:function(a,b){var c=this,d=c["_on"+a];if(typeof b=="function")d.push(b);else for(var e=0;e<d.length;e++)b?d[e].call(c,b):d[e].call(c);return c},off:function(a,b){var c=this,d=c["_on"+a],e=b.toString();for(var f=0;f<d.length;f++)if(e===d[f].toString()){d.splice(f,1);break}return c},unload:function(){var b=this,c=b._audioNode;for(var d=0;d<b._audioNode.length;d++)b.stop(c[d].id),b._webAudio?c[d].disconnect(0):c[d].src="";var e=h._howls.indexOf(b);e&&h._howls.splice(e,1),delete a[b._src],b=null}};if(c)var l=function(c,d){if(d in a)c._duration=a[d].duration,m(c);else{var e=new XMLHttpRequest;e.open("GET",d,!0),e.responseType="arraybuffer",e.onload=function(){b.decodeAudioData(e.response,function(b){b&&(a[d]=b,m(c,b))})},e.onerror=function(){c._webAudio&&(c._buffer=!0,c._webAudio=!1,c._audioNode=[],delete c._gainNode,c.load())};try{e.send()}catch(f){e.onerror()}}},m=function(a,b){a._duration=b?b.duration:a._duration,Object.getOwnPropertyNames(a._sprite).length===0&&(a._sprite={_default:[0,a._duration*1e3]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play()},n=function(c,d,e){var f=c._nodeById(e);f.bufferSource=b.createBufferSource(),f.bufferSource.buffer=a[c._src],f.bufferSource.connect(f.panner),f.bufferSource.loop=d[0],d[0]&&(f.bufferSource.loopStart=d[1],f.bufferSource.loopEnd=d[1]+d[2]),f.bufferSource.playbackRate.value=c._rate};typeof define=="function"&&define.amd&&define("djinn/audio/howler",[],function(){return{Howler:h,Howl:k}}),window.Howler=h,window.Howl=k}(),define("djinn/utils/base64",[],function(){var a={};return a.supported=Boolean(window.btoa&&window.atob),a.encode=function(a,b){return window.btoa?btoa(unescape(encodeURIComponent(String(a)))):a},a.decode=function(a,b){if(!window.atob)return a;try{a=decodeURIComponent(escape(atob(String(a))))}catch(c){logger.warn("[base64.decode] Could not decode: "+a),logger.warn("[base64.decode] "+c.message)}return a},a}),define("djinn/utils/crypt",["djinn/utils/base64"],function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="`1234567890-=[];',./~!@#$%^&*()_+{}|:<>?QWERTYUIOPASDFGHJKLZXCVBN",d=c.length,e=function(a){return a?a.length%d:0},f={};return f.encode=function(f,g){if(!a.supported)return f;var h=e(g),f=a.encode(f),i="";for(var j=0,k=f.length;j<k;++j){var l=b.indexOf(f[j]),m=(l+h)%d;i+=c[m]}return i},f.decode=function(f,g){if(!a.supported)return f;var h=e(g),i="";for(var j=0,k=f.length;j<k;++j){var l=c.indexOf(f[j]),m=l-h;m<0&&(m=d+m),i+=b[m]}return a.decode(i)},f}),define("djinn/utils/storage",["djinn/utils/crypt"],function(a){var b={};return b.set=function(b,c){var b=a.encode(b,b),c=a.encode(c,b);try{localStorage.setItem(b,c)}catch(d){logger.warn("[storage.set] Failed to set localStorage! Quota exceeded?"),logger.warn("[storage.set] "+d.message)}},b.get=function(b){var b=a.encode(b,b),c=null;try{c=localStorage.getItem(b)}catch(d){logger.warn("[storage.get] Failed to get: "+b),logger.warn("[storage.get] "+d.message)}return c&&(c=a.decode(c,b)),c},b.remove=function(b){var b=a.encode(b,b);try{localStorage.removeItem(b)}catch(c){logger.warn("[storage.remove] Failed to remove: "+b),logger.warn("[storage.remove] "+c.message)}},b.setObject=function(a,c){var d=JSON.stringify(c);return b.set(a,d)},b.getObject=function(a){var c=b.get(a),d=null;try{d=JSON.parse(c)}catch(e){logger.warn("[storage.getObject] Could not parse JSON: "+c),logger.warn("[storage.getObject] "+e.message)}return d},b}),define("djinn/utils/DataStore",["require","exports","module","../Emitter","./storage"],function(a,b,c){var d=a("../Emitter"),e=a("./storage"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.key=a.key,this.load()},load:function(){if(this.key){var a=e.getObject(this.key);this.data=a||{}}else this.data={}},save:function(){if(!this.key)return;e.setObject(this.key,this.data)},set:function(a,b){this.data[a]=b,this.save(),this.fire("set:"+a,[b])},get:function(a){return this.data[a]},toggle:function(a){this.set(a,!this.get(a))},increment:function(a){this.set(a,++this.get(a))}});b.defaults={key:null}}),define("djinn/audio/jukebox",["require","exports","module","./howler","../Emitter","../stage","../client","../manifest","../utils/DataStore"],function(a,b,c){var d=a("./howler"),e=a("../Emitter"),f=a("../stage"),g=a("../client"),h=a("../manifest"),i=a("../utils/DataStore"),j=d.Howler,k=d.Howl,l=e.extend({init:function(a){this._super(a),this.audioData=null,this.sounds={},this._inputTriggerKey=null,this._inputTriggerLoaded=!1,this._inputTriggerPlayed=!1,this._unmuteOnShow=!1,this._queue=[];var b=this.settings=new i({key:h.shortName+"_audio"});b.get("muted")&&this.mute(),g.on("visibilityChange",this,"_onClientVisibilityChange"),f.on("input",this,"_onStageInput")},configure:function(a){this.audioData=a,a.inputTriggerKey&&(this._inputTriggerKey=a.inputTriggerKey,this.load(this._inputTriggerKey,bind(this,"_onInputTriggerLoad")))},mute:function(){j.mute(),this.settings.set("muted",!0),this.fire("mute")},unmute:function(){j.unmute(),this.settings.set("muted",!1),this.fire("unmute")},toggleMute:function(){this.muted=!this.muted},load:function(a,b){var c=this.sounds;if(c[a])return c[a];var d=this._getAudioData(a);if(!d)return;var e=[d.path+".ogg",d.path+".mp3"],f=c[a]=new k({urls:e,loop:d.loop,volume:d.volume,onload:function(){b&&b()},onloaderror:function(){logger.warn("[jukebox.load] Failed to load: "+a)}});return f},play:function(a){if(!this.canPlay){this._queue.push(a);return}var b=this._getSound(a,!0);if(!b)return;b.play()},pause:function(a){var b=this._getSound(a);if(!b)return;b.pause()},stop:function(a){var b=this._getSound(a);if(!b)return;b.stop()},fadeIn:function(a,b){var c=this._getAudioData(a);if(!c)return;if(!this.canPlay){c.loop&&this._queue.push(a);return}var d=this._getSound(a,!0);if(!d)return;d.play().fade(0,c.volume||1,b)},fadeOut:function(a,b){var c=this._getSound(a);if(!c)return;c.fade(c.volume(),0,b)},_getAudioData:function(a){var b=this.audioData;return b&&b.sounds&&b.sounds[a]?b.sounds[a]:(logger.warn("[jukebox._getAudioData] No audio data: "+a),null)},_getSound:function(a,b){var c=this.sounds;if(c&&c[a])return c[a];if(b){var d=this.load(a);return d?d:(logger.warn("[jukebox._getSound] Unable to load sound: "+a),null)}return null},_onClientVisibilityChange:function(a){a?this.muted||(this.mute(),this._unmuteOnShow=!0):this._unmuteOnShow&&(this.unmute(),this._unmuteOnShow=!1)},_onInputTriggerLoad:function(){this._inputTriggerLoaded=!0},_onStageInput:function(a){if(this._inputTriggerPlayed||!this._inputTriggerLoaded)return;this.play(this._inputTriggerKey),this.stop(this._inputTriggerKey),this._inputTriggerPlayed=!0;while(this._queue.length>0){var b=this._queue.shift();this.play(b)}}}),m=l.prototype;Object.defineProperty(m,"canPlay",{get:function(){return!g.isTouch||this._inputTriggerPlayed}}),Object.defineProperty(m,"muted",{get:function(){return j._muted},set:function(a){a?this.mute():this.unmute()}}),c.exports=new l}),define("djinn/Scene",["require","exports","module","./View","./audio/jukebox"],function(a,b,c){var d=a("./View"),e=a("./audio/jukebox"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.musicKey=a.musicKey,this._isSetup=!1},setup:function(){},reset:function(){},activate:function(a){this.musicKey&&e.fadeIn(this.musicKey,500),this.captureInputEvents=!0},deactivate:function(a){this.musicKey&&e.fadeOut(this.musicKey,500),this.captureInputEvents=!1},cleanup:function(){this.musicKey&&e.stop(this.musicKey)},fireSceneEvent:function(a){var b={id:this.id,eventName:a};this.fire(a,[b])}});b.defaults={acceptInputEvents:!0,cancelInputEvents:!0,clip:!0,opacity:0,visible:!1,musicKey:null}}),define("djinn/masks/SpotlightMaskView",["djinn/View","djinn/stage"],function(a,b){var c=["width","height","spotlightX","spotlightY","spotlightRadius"];return a.extend({init:function(a){var a=merge(a,{backgroundColor:"rgb(0, 0, 0)",spotlightX:0,spotlightY:0,spotlightRadius:100});this._super(a),this._buffer=b.createBuffer(this.width,this.height),this._bufferDirty=!0,this.spotlightX=Number(a.spotlightX),this.spotlightY=Number(a.spotlightY),this.spotlightRadius=Number(a.spotlightRadius),this._cachedProps={},b.on("resize",this,function(){this._bufferDirty=!0})},render:function(a){var b=this._buffer;if(b.width!==this.width||b.height!==this.height)b.width=this.width,b.height=this.height,this._bufferDirty=!0;if(!this._bufferDirty)for(var d=0,e=c.length;d<e;++d){var f=c[d];if(this._cachedProps[f]!=this[f]){this._bufferDirty=!0;break}}if(this._bufferDirty){var g=b.getContext("2d");g.save(),g.clearRect(0,0,this.width,this.height),g.fillStyle=this.backgroundColor,g.fillRect(0,0,this.width,this.height),g.globalCompositeOperation="destination-out",g.beginPath(),g.arc(this.spotlightX,this.spotlightY,this.spotlightRadius,0,Math.PI*2,!0),g.fill(),g.closePath(),g.restore();for(var d=0,e=c.length;d<e;++d){var f=c[d];this._cachedProps[f]=this[f]}this._bufferDirty=!1}a.drawImage(this._buffer,0,0,this.width,this.height)}})}),define("djinn/utils/sceneTransitions",["require","exports","module","djinn/utils/transitions","djinn/masks/SpotlightMaskView"],function(a,b,c){var d=a("djinn/utils/transitions"),e=a("djinn/masks/SpotlightMaskView"),f=function(a,b){var b=merge(b,{visible:!0,opacity:1,scale:1,rotation:0,x:0,y:0});a.completeTween(b)},g=new e({backgroundColor:"black",visible:!1});return{zoomSpotlight:function(a,b,c){var e={duration:2e3};f(a),g.completeTween({width:a.width,height:a.height,visible:!0,z:Math.max(a.z,b.z)+1,opacity:0,spotlightX:a.width/2,spotlightY:a.height/2,spotlightRadius:0}),g.removeFromParent(),a.parent.addChild(g),a.tween({scale:2},e.duration),g.tween({opacity:1},e.duration,d.easeIn,function(){a.visible=!1,f(b),g.delayTween(500).tween({spotlightRadius:a.width},e.duration,d.easeIn,function(){g.visible=!1,g.removeFromParent(),c&&c()})})},spotlight:function(a,b,c){var e={duration:2e3};f(a),g.completeTween({width:a.width,height:a.height,visible:!0,spotlightX:a.width/2,spotlightY:a.height/2,spotlightRadius:a.width}),g.removeFromParent(),a.parent.addChild(g),g.tween({spotlightRadius:0},e.duration,d.easeIn,function(){a.visible=!1,f(b),g.delayTween(500).tween({spotlightRadius:a.width},e.duration,d.easeIn,function(){g.visible=!1,g.removeFromParent(),c&&c()})})},crossFade:function(a,b,c){f(a),f(b,{opacity:0}),a.tween({opacity:0},500,null,function(){a.visible=!1,c&&c()}),b.tween({opacity:1},500)},fade:function(a,b,c){f(a),f(b,{opacity:0}),a.tween({opacity:0},500,null,function(){a.visible=!1,b.tween({opacity:1},500,null,function(){c&&c()})})},slideUp:function(a,b,c){f(a),f(b,{y:b.parent.height}),a.tween({y:-a.height},500,d.easeIn,function(){a.visible=!1,c&&c()}),b.tween({y:0},500,d.easeIn)},slideDown:function(a,b,c){f(a),f(b,{bottom:0}),a.tween({y:a.height},500,d.easeIn,function(){a.visible=!1,c&&c()}),b.tween({y:0},500,d.easeIn)},slideLeft:function(a,b,c){f(a),f(b,{x:b.width}),a.tween({right:0},500,d.easeIn,function(){a.visible=!1,c&&c()}),b.tween({x:0},500,d.easeIn)},slideRight:function(a,b,c){f(a),f(b,{right:0}),a.tween({x:a.width},500,d.easeIn,function(){a.visible=!1,c&&c()}),b.tween({x:0},500,d.easeIn)},rotateIn:function(a,b,c){f(b,{scale:0,rotation:Math.PI}),b.tween({scale:1,rotation:0},1e3,null,function(){a.visible=!1,c&&c()})},none:function(a,b,c){f(b,{visible:!0}),a.visible=!1,c&&c()}}}),define("djinn/SceneDirector",["require","exports","module","djinn/Emitter","djinn/Collection","djinn/Scene","djinn/utils/sceneTransitions"],function(a,b,c){var d=a("djinn/Emitter"),e=a("djinn/Collection"),f=a("djinn/Scene"),g=a("djinn/utils/sceneTransitions"),b=c.exports=d.extend({init:function(a){this._super(a),this.backgroundColor=a.backgroundColor||"black",this.view=a.view},setup:function(a){this._data=a},load:function(){this._activeSceneId=null,this.scenes=new e,this._defaultScene=new f({parent:this.view,backgroundColor:this.backgroundColor,visible:!1});var a=this._data;for(var b in a){var c=a[b],d=new c.ctor({parent:this.view,id:b});for(var g in c.events)d.on(g,this,"_onSceneEvent");this.scenes.add(d)}},ready:function(){},activateScene:function(a,b){var c=this._activeSceneId,d=this.scenes.get(this._activeSceneId)||this._defaultScene,e=this.scenes.get(a);this._activeSceneId=a,e.isSetup||(e.setup(),e.isSetup=!0),e.reset(c);var b=g[b||"fade"];this.view.backgroundColor=this.backgroundColor,d&&(d.captureInputEvents=!1,d.deactivate(this._activeSceneId)),e.captureInputEvents=!1,b(d,e,bind(this,function(){this.view.backgroundColor=null,d.cleanup(a),e.activate(c)}))},_onSceneEvent:function(a){var b=this._data[a.id].events[a.eventName];this.activateScene(b.id,b.transition)}});Object.defineProperty(b.prototype,"activeSceneId",{get:function(){return this._activeSceneId}}),Object.defineProperty(b.prototype,"activeScene",{get:function(){return this.scenes.get(this._activeSceneId)}})}),define("djinn/metrics/googleAnalytics",[],function(){var a=window._gaq=window._gaq||[];return{id:"google",init:function(b){a.push(["_setAccount",b.account]),a.push(["_trackPageview"])},event:function(b){a.push(["_trackEvent",b,"defaultAction"])}}}),define("djinn/metrics/mixpanel",{id:"mixpanel",init:function(a){if(!window.mixpanel){logger.warn("Mixpanel library not found");return}mixpanel.init(a.account)},event:function(a){if(!window.mixpanel){logger.warn("Mixpanel library not found");return}mixpanel.track(a)}}),define("djinn/metrics/tracker",["djinn/manifest","djinn/utils/array","./googleAnalytics","./mixpanel"],function(a,b,c,d){var e=merge(a.metrics,{enabled:!1}),f=[c,d],g=function(){for(var a=0,b=f.length;a<b;++a){var c=f[a],d=e[c.id];if(!d)continue;c.enabled=!0,c.init&&c.init(d)}};return e.enabled&&g(),{event:function(a){if(!e.enabled)return;for(var b=0,c=f.length;b<c;++b){var d=f[b];if(!d.enabled)continue;d.event&&d.event(a)}}}}),define("djinn/Game",["require","exports","module","djinn/keyboard","djinn/gamepad","djinn/Emitter","djinn/globalTimer","djinn/client","djinn/stage","djinn/View","djinn/helpers/RotateDeviceView","djinn/helpers/LoadingScreen","djinn/manifest","djinn/assets","djinn/SceneDirector","djinn/metrics/tracker"],function(a,b,c){var d=a("djinn/keyboard"),e=a("djinn/gamepad"),f=a("djinn/Emitter"),g=a("djinn/globalTimer"),h=a("djinn/client"),i=a("djinn/stage"),j=a("djinn/View"),k=a("djinn/helpers/RotateDeviceView"),l=a("djinn/helpers/LoadingScreen"),m=a("djinn/manifest"),n=a("djinn/assets"),o=a("djinn/SceneDirector"),p=a("djinn/metrics/tracker"),b=c.exports=f.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.showLoadingScreen=a.showLoadingScreen,this.showRotateMessage=a.showRotateMessage,this._splashFinished=!1,this._loadingProgress=0,this.view=new j({tag:"GameRootView",acceptInputEvents:!0,width:i.width,height:i.height}),i.on("resize",this,"_onStageResize"),m.orientation!=="both"&&this.showRotateMessage&&(this._rotateDeviceView=new k({parent:this.view}),h.on("resize",this,"_onClientResize")),this._loadingScreen=new l({parent:this.view,visible:!1}),this._sceneDirector=new o({view:this.view})},run:function(){g.on("tick",this,"_update"),g.start(),this.showLoadingScreen?(i.eraseBeforeRender=!0,this._loadingScreen.show(bind(this,"_onSplashFinish"))):this._onClientResize()},stop:function(){g.stop(),g.off("tick",this)},setupScenes:function(a){this._sceneDirector.setup(a)},getSceneById:function(a){return this._sceneDirector.scenes.get(a)},getActiveSceneId:function(){return this._sceneDirector.activeSceneId},getActiveScene:function(){return this._sceneDirector.activeScene},activateScene:function(a,b){this._sceneDirector.activateScene(a,b)},preloadAssets:function(a){n.load(a,bind(this,"_onLoadComplete"),bind(this,"_onLoadProgress"))},_onLoadProgress:function(a,b,c,d,e){this._loadingProgress=e,this._loadingScreen.loadingProgress=this._loadingProgress,this._checkGameReady()},_onLoadComplete:function(){i.acceptInput=!0,p.event("gameLoad"),this._sceneDirector.load(),this.fire("load")},_update:function(a){this._react(),this.update&&this.update(a),this.view.preTick(a),this._render(),d.endFrame(),e.endFrame()},_react:function(){var a=i.getInputEvents(),b=a.length;for(var c=0;c<b;++c)this.view.react(a[c])},_render:function(){i.renderView(this.view)},_onClientResize:function(){if(!this._rotateDeviceView||!this.showRotateMessage)return;m.orientation!==h.orientation?this._rotateDeviceView.show():this._rotateDeviceView.hide()},_onStageResize:function(){this.view.width=i.width,this.view.height=i.height,this.view.reflow()},_onSplashFinish:function(){this._splashFinished=!0,this._checkGameReady()},_checkGameReady:function(){this._splashFinished&&this._loadingProgress===1&&(this._onClientResize(),this._loadingScreen.hide(bind(this,function(){i.eraseBeforeRender=!1,this._sceneDirector.ready(),this.fire("ready")})))}});b.defaults={showLoadingScreen:!1,showRotateMessage:!0}}),define("djinn/preferences",["djinn/Emitter","djinn/utils/storage","djinn/manifest"],function(a,b,c){var d=a.extend({init:function(a){this._super(a),this._storageKey=c.shortName+"_prefs",this._load()},setDefaults:function(a){for(var b in a)this._data[b]===undefined&&(this._data[b]=a[b]);this._save()},set:function(a,b){this._data[a]=b,this._save(),this.fire("set:"+a,[b])},toggle:function(a){this.set(a,!this.get(a))},get:function(a){return this._data[a]},_load:function(){var a=b.getObject(this._storageKey);this._data=a||{}},_save:function(){b.setObject(this._storageKey,this._data)}});return new d}),define("js/soundData",{sounds:{title:{path:"media/music/title.mp3",volume:1,loop:!0,type:"music"},gameplay:{path:"media/music/gameplay.mp3",volume:.75,loop:!0,type:"music"},button:{path:"media/sounds/button.mp3",volume:.6},tick:{path:"media/sounds/tick.mp3",volume:.6},explosion:{path:"media/sounds/explosion.mp3",volume:1},destroy:{path:"media/sounds/destroy.mp3",volume:.5},damage:{path:"media/sounds/damage.mp3",volume:.4}}}),define("djinn/intl",[],function(){var a=__intl||{},b={get:function(b){return a[b]?arguments.length==1?a[b]:(arguments[0]=a[b],sprintf.apply(arguments,arguments)):sprintf("[undefined intl: %s]",b)},getArray:function(b){return clone(a[b])},sort:function(a){return a.sort(function(a,c){var d=b.get(a),e=b.get(c);return d<e?-1:1}),a}};return b}),define("djinn/ui/Button",["djinn/View","djinn/TextView","djinn/utils/transitions","djinn/utils/viewEffects"],function(a,b,c,d){var e=a.extend({init:function(a){var a=merge(a,e.defaults);this._super(a),this._enabled=Boolean(a.enabled),this.textView=(new b(merge({parent:this,text:a.text},a.textConf||{},e.textDefaults))).align("center","center"),this.on("inputStart",this,"_onInputStart"),this.update()},_onInputStart:function(a){return!this._enabled||this._pressing===!0?(logger.log("[Button] This button is not enabled or already being pressed"),!1):(this._pressing=!0,d.buttonPress(this,{},bind(this,function(){this.fire("buttonPress",[a]),this._pressing=!1})),!0)},update:function(){}});return Object.defineProperty(e.prototype,"text",{set:function(a){this.textView.text=a}}),Object.defineProperty(e.prototype,"textConf",{set:function(a){this.textView.set(a)}}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a,this.update(),this.fire("change:enabled",[a])}}),e.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:"rgb(190, 190, 190)",width:200,height:40,enabled:!0},e.textDefaults={text:"",color:"rgb(0, 0, 0)",fontSize:30,textAlign:"center",verticalAlign:"middle"},e}),define("djinn/utils/Doll",["djinn/View"],function(a){var b=a.extend({init:function(a){this._super(a),this._animating=!1,this._currentAnimation=null,this._animationEndTimer=this.createBoundTimer(0,"_onAnimationEndTimerElapse"),this._partViews={},this.defaultAnimation=a.defaultAnimation,this._animations=a.animations,this._initPartViews(a.partsData,a.partsConf),this.defaultAnimation&&this.playAnimation(this.defaultAnimation)},_initPartViews:function(b,c){for(var d in c){var e=c[d],f=b[d]||{};this._partViews[d]=new a(merge(e,{parent:this,tag:d,anchorX:(f.anchorX||0)*e.width,anchorY:(f.anchorY||0)*e.height,imageX:f.imageX||0,imageY:f.imageY||0,rotation:f.rotation||0,x:(f.x||0)*this.width,y:(f.y||0)*this.height,width:e.width,height:e.height}))}},cancelAnimation:function(){this.forEachPart(function(a){a.cancelTween()})},completeAnimation:function(){this.forEachPart(function(a){a.completeTween()})},forEachPart:function(a){for(var b in this._partViews){var c=this._partViews[b];if(!c)continue;a(c,b)}},addPart:function(a,b){this._partViews[a]=b},destroyPart:function(a){this._partViews[a].removeFromParent(),this.removePart(a)},removePart:function(a){delete this._partViews[a]},getPart:function(a){return this._partViews[a]},_onAnimationEndTimerElapse:function(){this._animationEndTimer.stop(),this.loop?this.playAnimation(this._currentAnimation):(this._currentAnimation=null,this.defaultAnimation?this.playAnimation(this.defaultAnimation):this._animating=!1),this.fire("animationEnd")},playAnimation:function(b,c,d){if(!this._animations)return this;var e=this._animations[b];if(!e)return logger.warn("[playAnimation] animation not defined",b),this;this._animating=!0,b!=this._currentAnimation&&this.stopAnimation(),this._currentAnimation=b;var d=d||0,f=0,g=e.tweens;for(var h=d,i=g.length;h<i;++h){var j=g[h],k=j.duration;c!==undefined&&h===d&&(k=c);for(var l in j.parts){var m=clone(j.parts[l]);m.x&&(m.x*=this.width),m.y&&(m.y*=this.height);var n=this.getChildByTag(l);n&&n.tween(m,k,a.transitions[j.ease])}f+=k}return this._animationEndTimer.start(f),this},stopAnimation:function(){this._currentAnimation=null,this.cancelAnimation()},setPartViewsFromData:function(a){for(var b in a){var c=a[b],d=this._partViews[b];if(!d)continue;c.rotation!==undefined&&(d.rotation=c.rotation||0),c.x!==undefined&&(d.x=(c.x||0)*this.width),c.y!==undefined&&(d.y=(c.y||0)*this.height)}},showOnly:function(a){this.forEachPart(function(b,c){b.visible=c===a})}});return Object.defineProperty(b.prototype,"currentAnimation",{get:function(){return this._currentAnimation},set:function(a){this.playAnimation(a)}}),Object.defineProperty(b.prototype,"loop",{get:function(){var a=this._animations[this._currentAnimation];return a?a.loop!==!1:!1}}),Object.defineProperty(b.prototype,"overlayColor",{get:function(){return this._overlayColor},set:function(a){this._overlayColor=a,this.forEachPart(function(b){b.overlayColor=a})}}),b}),define("js/view/animations",{dumpTruck:{drive:{tweens:[{duration:100,ease:"linear",parts:{bed:{rotation:0,x:-0.04,y:-0.55},body:{rotation:0,x:-0.03,y:-0.3}}},{duration:500,ease:"linear",parts:{bed:{rotation:0,x:-0.04,y:-0.6},body:{rotation:0,x:-0.03,y:-0.35}}}]},dump:{tweens:[{duration:1e3,ease:"linear",parts:{bed:{rotation:.7,x:-0.04,y:-0.6},body:{rotation:0,x:-0.03,y:-0.3}}}]}},explosion:function(a){return{boom:{frameRate:24,frames:[[0,0],[a,0],[a*2,0],[a*3,0],[0,a],[a,a],[a*2,a],[a*3,a],[0,a*2],[a,a*2],[a*2,a*2],[a*3,a*2]],loop:!1}}}}),define("js/view/parts",{dumpTruck:{bed:{rotation:0,anchorX:.725,anchorY:.75,x:-0.04,y:-0.6},body:{rotation:0,anchorX:.5,anchorY:.5,x:-0.03,y:-0.3},frontWheel:{rotation:0,anchorX:.5,anchorY:.5,x:.03,y:.3},rearWheel:{rotation:0,anchorX:.5,anchorY:.5,x:.71,y:.3}}}),define("js/view/ui/DumpTruck",["require","exports","module","djinn/utils/Doll","djinn/utils/transitions","../animations","../parts"],function(a,b,c){var d=a("djinn/utils/Doll"),e=a("djinn/utils/transitions"),f=a("../animations"),g=a("../parts"),h="media/images/ui/dumpTruck.png",i=-20,b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.driveMod=-1},reset:function(){this.completeTween({right:i}).stopAnimation()},dump:function(a){this.driveMod=1,this.playAnimation("drive"),this.tween({x:40},1500,e.strongIn,bind(this,function(){this.playAnimation("dump"),a&&a()}))},leave:function(){this.driveMod=-1,this.playAnimation("drive"),this.tween({right:i},1500)},tick:function(a){var b=a/100*this.driveMod;this.currentAnimation==="drive"&&(this.getPart("frontWheel").rotation+=b,this.getPart("rearWheel").rotation+=b)}});b.defaults={animations:f.dumpTruck,partsConf:{bed:{image:h,imageY:100,width:208,height:68,z:3},body:{image:h,width:208,height:90},frontWheel:{image:h,imageY:200,width:60,height:60,z:2},rearWheel:{image:h,imageY:200,width:60,height:60,z:2}},partsData:g.dumpTruck,width:180,height:80}}),define("js/view/utils/style",["require","exports","module","djinn/TextView"],function(a,b,c){var d=a("djinn/TextView"),e={black:"rgba(20, 12, 28, %s)",white:"rgba(222, 238, 214, %s)",grey:"rgba(78, 74, 78, %s)",silver:"rgba(133, 149, 161, %s)",gold:"rgba(216, 186, 79, %s)",red:"rgba(133, 19, 20, %s)",green:"rgba(109, 170, 44, %s)",blue:"rgba(89, 125, 206, %s)",purple:"rgba(159, 76, 208, %s)",yellow:"rgba(241, 237, 121, %s)",orange:"rgba(210, 125, 44, %s)",brown:"rgba(128, 96, 65, %s)",darkBlue:"rgba(48, 52, 109, %s)",teal:"rgba(109, 194, 202, %s)"},f=function(a,b){return e[a]?sprintf(e[a],b||1):undefined},g=function(a,b){return a>.6?f("green",b):a>.3?f("orange",b):f("red",b)},h=function(a){return sprintf(a?"white":"grey")},i={blue:["darkBlue","blue","teal","white"],purple:["red","purple","blue","white"]},b={getColor:f,getProgressColor:g,getTextColor:h,spectrums:i};return d.defaults=merge({color:f("white"),fontFamily:"doppioOne",fontSize:32,strokeColor:f("black"),strokeWidth:5},d.defaults),b}),define("js/view/ui/Button",["require","exports","module","djinn/sound","djinn/ui/Button","../utils/style"],function(a,b,c){var d=a("djinn/sound"),e=a("djinn/ui/Button"),f=a("../utils/style"),b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},_onInputStart:function(a){d.play("button",0),this._super(a)}});b.defaults={image:"media/images/ui/button.png",textConf:{color:f.getColor("white")},width:240,height:100}}),define("djinn/utils/string",{parseNumber:function(a){return Number(a.replace(/([^0-9\.])/g,""))},formatNumber:function(a){var a=String(a),b=a.split("."),c=b[0],d=b.length>1?"."+b[1]:"",e=/(\d+)(\d{3})/;while(e.test(c))c=c.replace(e,"$1,$2");return c+d},formatTime:function(a){var b=~~(a/1e3)%60,c=~~(a/6e4)%60;return b<10&&(b="0"+b),sprintf("%s:%s",c,b)},ucfirst:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},hashCharCode:function(a){var b=0;if(a.length<1)return b;for(i=0,j=a.length;i<j;i++){var c=a.charCodeAt(i);b=(b<<5)-b+c,b|=0}return Math.abs(b)}}),define("djinn/math/PRNG",["require","exports","module","../utils/string","../utils/array"],function(a,b,c){var d=a("../utils/string"),e=a("../utils/array"),f=2147483648,g=1103515245,h=12345;c.exports=function(a){this.state=null,a&&this.seed(a)};var i=c.exports.prototype;i.seed=function(a){a?isNaN(a)&&(a=d.hashCharCode(String(a))):a=Math.floor(Math.random()*(f-1)),this.seedValue=a,this.state=a},i.normal=function(){return this.state===null?Math.random():(this.state=(g*this.state+h)%f,this.state/f)},i.integer=function(a){return Math.round(this.normal()*a)},i.range=function(a,b){return this.integer(b-a)+a},i.radians=function(a,b){var a=a||0,b=b||Math.PI*2,c=b-a;return a+c*this.normal()},i.chance=function(a){return this.normal()<=a},i.choice=function(a,b){if(a.length===0)return null;var c=this.integer(a.length-1),d=a[c];return b&&a.splice(c,1),d},i.weightedChoice=function(a){var b=arguments.length>1;if(b||e.isArray(a))a=this.autoWeight(b?arguments:a);var c=0,d={};for(var f in a){var g=~~(c*1e3);c+=a[f],d[f]={min:g,max:~~(c*1e3)}}var h=this.integer(~~(c*1e3)-1);for(var f in d){var i=d[f];if(h>=i.min&&h<i.max)return f}return logger.warn("[PRNG.weightedChoice] No matching option found!",h,d),null},i.weightedIndex=function(a,b){var c=[];for(var d=0;d<a;++d)c.push(d);var e=this.autoWeight(c,b);return+this.weightedChoice(e)},i.autoWeight=function(a,b){var b=b||2,c={},d=0;for(var e=0,f=a.length;e<f;++e){var g=Math.pow(f-e,b);c[a[e]]=g,d+=g}var h=1/d;for(var i in c)c[i]*=h;return c}}),define("djinn/math/random",["./PRNG"],function(a){return new a}),define("js/view/avatars/Block",["require","exports","module","djinn/View","djinn/math/random"],function(a,b,c){var d=a("djinn/View"),e=a("djinn/math/random"),f=100,g={officeSolid:{imageY:f},officeWindow:{imageY:f*2},officeGlass:{imageY:f*3},officeTop:{imageX:f*2,imageY:f*4},officeTNT:{imageY:f*5},officeBigTNT:{imageX:f,imageY:f*5},barnBottom:{image:"media/images/avatars/farm.png"},barnMiddle:{image:"media/images/avatars/farm.png",imageY:f},barnTop:{image:"media/images/avatars/farm.png",imageY:f*4},siloBottom:{image:"media/images/avatars/silo.png"},siloMiddle:{image:"media/images/avatars/silo.png",imageY:f},siloTNT:{image:"media/images/avatars/silo.png",imageY:f*2},siloTop:{image:"media/images/avatars/silo.png",imageY:f*4},nightBottom:{image:"media/images/avatars/night.png"},nightSolid:{image:"media/images/avatars/night.png",imageY:f},nightWindow:{image:"media/images/avatars/night.png",imageY:f*2},nightGlass:{image:"media/images/avatars/night.png",imageY:f*3},nightTop:{image:"media/images/avatars/night.png",imageX:f*2,imageY:f*4},nightTNT:{image:"media/images/avatars/night.png",imageY:f*5},night2Bottom:{image:"media/images/avatars/night2.png"},night2Solid:{image:"media/images/avatars/night2.png",imageY:f},night2Window:{image:"media/images/avatars/night2.png",imageY:f*2},night2Top:{image:"media/images/avatars/night2.png",imageY:f*4},night2TNT:{image:"media/images/avatars/night2.png",imageY:f*5}},h={officeTop:!0,nightTop:!0,night2Top:!0},b=c.exports=d.extend({init:function(a){var a=merge(a,g[a.type],b.defaults);this._super(a),a.type==="officeTop"&&(this.flipHorizontal=e.chance(.5),this.imageX=e.range(0,2)*this.width);if(h[a.type]){this._light=(new d({parent:this,image:"media/images/effects/light.png",opacity:0,y:2,width:18,height:18})).align("center");var c=this._lightTimer=this.createBoundTimer(0,"_onLightTimer");c.start(e.range(0,1e3))}},setDamage:function(a){this.imageX=a*f},_onLightTimer:function(){this._light.completeTween({opacity:1}).tween({opacity:0},1500,d.transitions.easeIn),this._lightTimer.start(3e3)}});b.defaults={image:"media/images/avatars/buildings.png",width:f,height:f}}),define("js/view/scenes/TitleScene",["require","exports","module","djinn/assets","djinn/sound","djinn/manifest","djinn/Scene","djinn/View","djinn/TextView","djinn/intl","../ui/Button","../ui/DumpTruck","../utils/style","../avatars/Block","../../soundData"],function(a,b,c){var d=a("djinn/assets"),e=a("djinn/sound"),f=a("djinn/manifest"),g=a("djinn/Scene"),h=a("djinn/View"),i=a("djinn/TextView"),j=a("djinn/intl"),k=a("../ui/Button"),l=a("../ui/DumpTruck"),m=a("../utils/style"),n=a("../avatars/Block"),o=a("../../soundData"),p="title",b=c.exports=g.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},setup:function(){(new h({parent:this,image:"media/images/ui/title.png",width:424,height:210})).align("center","top",0,100);var a=this._play=(new k({parent:this,text:j.get("PLAY")})).align("center","center");a.on("buttonPress",this,"_onPlay"),(new h({parent:this,image:"media/images/effects/nightGround.png",width:640,height:50})).align(null,"bottom"),this._setupCity();var b=this._truck=new l({parent:this,acceptInputEvents:!0,y:1020});b.on("inputStart",this,"_onTruckInputStart"),this._truckTimer=this.createBoundTimer(5e3,"_onTruckTimer"),(new i({parent:this,text:j.get("COPYRIGHT",f.version),fontSize:16,textAlign:"center"})).align(null,"bottom",0,-10)},_setupCity:function(){this._makeBlock("barnTop",1,1),this._makeBlock("barnBottom",1,0),this._makeBlock("officeTop",3,2),this._makeBlock("officeWindow",3,1),this._makeBlock("officeBottom",3,0),this._makeBlock("nightTop",5,3),this._makeBlock("nightWindow",5,2),this._makeBlock("nightSolid",5,1),this._makeBlock("nightBottom",5,0)},_makeBlock:function(a,b,c){new n({parent:this,type:a,x:b*n.defaults.width,y:994-n.defaults.height*c})},reset:function(){this._truckTimer.start(),this._onTruckTimer()},activate:function(a){a||d.load([o.sounds[p].path],function(){e.play(p,0)}),this.captureInputEvents=!0},_onPlay:function(){this.fireSceneEvent("play")},_onTruckTimer:function(){this._truck.completeTween({x:this.width}).tween({right:-this._truck.width},5e3).playAnimation("drive",1)},_onTruckInputStart:function(){this._truckTimer.stop(),this._truck.cancelTween(),this._truck.playAnimation("dump")}});b.defaults={image:"media/images/backdrops/skylineNight.png"}}),define("djinn/ViewCollection",["djinn/Collection"],function(a){return a.extend({remove:function(a,b,c){typeof a.removeFromParent!="function"&&(a=this.get(a));if(!a)return;c||a.removeFromParent(),this._super(a,b)}})}),define("djinn/ui/Counter",["djinn/TextView","djinn/utils/string"],function(a,b){return a.extend({init:function(a){this._super(a),this.displayNumber=Number(a.displayNumber||0),a.format&&(this.format=a.format)},format:function(a){return b.formatNumber(~~a)},tick:function(){var a=String(this.format(this.displayNumber));if(a===this.text)return;this.text=a}})}),define("js/view/ui/StarCount",["require","exports","module","djinn/View","djinn/ui/Counter","../utils/style"],function(a,b,c){var d=a("djinn/View"),e=a("djinn/ui/Counter"),f=a("../utils/style"),b=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.iconView=(new d({parent:this,image:"media/images/ui/icons.png",width:50,height:50})).align(null,"center"),this.textView=(new e({parent:this,displayNumber:0,fontSize:48,verticalAlign:"middle",x:this.iconView.right+10})).align(null,"center"),this.update(a.amount||0)},update:function(a){if(isNaN(a))return;this.textView.completeTween({displayNumber:a})},updateWithPolish:function(a,b){var c=this.textView;c.completeTween();var d=a-c.displayNumber;if(d===0){b&&b();return}var e=Math.min(Math.abs(d/2),2e3);c.tween({displayNumber:a},e,null,function(){emitter.stop(),b&&b()})}});return b.defaults={width:120,height:64},b}),define("djinn/math/Vector2",["djinn/Class"],function(a){var b=a.extend({init:function(a){return a===undefined&&(a={x:0,y:0}),typeof a=="number"?(this.x=Number(a),this.y=Number(arguments[1])):a.angle===undefined?(this.x=Number(a.x||0),this.y=Number(a.y||0)):(this.x=a.magnitude*Math.cos(a.angle),this.y=a.magnitude*Math.sin(a.angle)),this},add:function(a){return this.x+=a.x,this.y+=a.y,this},clone:function(){return new this.constructor({x:this.x,y:this.y})},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},getUnitVector:function(){return new b({angle:this.angle,magnitude:1})},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},distance:function(a){return b.distance(this,a)},minus:function(a){return new b({x:this.x-a.x,y:this.y-a.y})},normalize:function(){var a=this.magnitude();return a===0?this:this.scale(1/a)},scale:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return this.x/=a,this.y/=a,this},subtract:function(a){return this.x-=a.x,this.y-=a.y,this},toAngle:function(){return this.heading*(180/Math.PI)}});return Object.defineProperty(b.prototype,"angle",{get:function(){return Math.atan2(this.y,this.x)}}),Object.defineProperty(b.prototype,"heading",{get:function(){return Math.atan2(this.x,-this.y)}}),b.makeFromHeading=function(a,c){var c=Number(c)||1;return new b({x:Math.sin(a)*c,y:-Math.cos(a)*c})},b.magnitude=function(a,b){return Math.sqrt(a*a+b*b)},b.distance=function(a,c){var d=b.subtract(c,a);return b.magnitude(d.x,d.y)},b.subtract=function(a,c){return new b(a.x-c.x,a.y-c.y)},b}),define("djinn/math/QuadTree",["djinn/Class","djinn/math/core","djinn/utils/array"],function(a,b,c){var d=[],e={parent:-1,topLeft:0,topRight:1,bottomLeft:2,bottomRight:3},f=function(a){if(d.length>0){var b=d.pop();return b.set(a),b}return new g(a)},g=a.extend({init:function(a){var a=merge(a,{x:0,y:0,width:0,height:0,depth:0,maxChildren:2,maxDepth:4});this._nodes=[],this._children=[],this.set(a)},set:function(a){for(var b in a)this[b]=a[b]},insert:function(a){var b=this._nodes,c=this._children;if(b.length>0){var d=this._findInsertNode(a);d===e.parent?c.push(a):b[d].insert(a)}else c.push(a),c.length>this.maxChildren&&this.depth<this.maxDepth&&this.divide()},retrieve:function(a){var b=[],c=this._children;for(var d=0,e=c.length;d<e;++d)b.push(c[d]);if(this._nodes.length>0){var f=this._findIntersectNodes(a);for(var d=0,e=f.length;d<e;++d)b=b.concat(f[d].retrieve(a))}return b},divide:function(){var a=~~(this.width/2),b=~~(this.height/2),c=this._children;this._addNode(this.x,this.y,a,b),this._addNode(this.x+a,this.y,a,b),this._addNode(this.x,this.y+b,a,b),this._addNode(this.x+a,this.y+b,a,b),this._children=[];for(var d=0,e=c.length;d<e;++d)this.insert(c[d])},clear:function(){var a=this._nodes;while(a.length>0){var b=a.pop();b.clear(),d.push(b)}this._children=[],this._nodes=[]},_addNode:function(a,b,c,d){this._nodes.push(f({x:a,y:b,width:c,height:d,depth:this.depth+1,maxChildren:this.maxChildren,maxDepth:this.maxDepth}))},_findInsertNode:function(a){var b=this.x+this.width/2,c=this.y+this.height/2;return a.x+a.width<b?a.y+a.height<c?e.topLeft:a.y>=c?e.bottomLeft:e.parent:a.x>=b?a.y+a.height<c?e.topRight:a.y>=c?e.bottomRight:e.parent:e.parent},_findIntersectNodes:function(a){var b=[],c=this._nodes,d=this.x+this.width/2,f=this.y+this.height/2;return a.x<d&&(a.y<f&&b.push(c[e.topLeft]),a.y+a.height>=f&&b.push(c[e.bottomLeft])),a.x+a.width>=d&&(a.y<f&&b.push(c[e.topRight]),a.y+a.height>=f&&b.push(c[e.bottomRight])),b}}),h=a.extend({init:function(a){this.rootNode=f(a)},insert:function(a){var b=this.rootNode;if(c.isArray(a))for(var d=0,e=a.length;d<e;++d)b.insert(a[d]);else b.insert(a)},retrieve:function(a){return this.rootNode.retrieve(a)},clear:function(){this.rootNode.clear()},resize:function(a,b){this.width=a,this.height=b}});return Object.defineProperty(h.prototype,"width",{get:function(){return this.rootNode.width},set:function(a){this.clear(),this.rootNode.width=a}}),Object.defineProperty(h.prototype,"height",{get:function(){return this.rootNode.height},set:function(a){this.clear(),this.rootNode.height=a}}),h}),define("djinn/sim/coreComponents",{size:{width:50,height:50},position:{x:0,y:0},velocity:{x:0,y:0},gravity:{value:.001},collision:{groups:[],targets:[],despawnOnEnvCollide:!1},health:{value:1,max:1,destroyed:!1,despawnOnDestroy:!0},hazard:{damage:1,despawnOnCollide:!1}}),define("djinn/sim/Entity",["require","exports","module","../Emitter","../utils/array"],function(a,b,c){var d=a("../Emitter"),e=a("../utils/array");c.exports=d.extend({init:function(a,b){this._super(),this._componentKeys=[],this.id=null,this.type=a;for(var c in b)this.addComponent(c,b[c])},addComponent:function(a,b){this[a]=merge(b,this[a]),e.pushOnce(this._componentKeys,a),this.fire("componentAdd",[a])},removeComponent:function(a){delete this[a],e.removeValue(this._componentKeys,a),this.fire("componentRemove",[a])}})}),define("djinn/sim/shared/position",["require","exports","module"],function(a,b,c){b.getBounds=function(a){var b=a.position,c=a.size;return!b||!c?null:{x:b.x,y:b.y,width:c.width,height:c.height}},b.getCenter=function(a){var b=a.position,c=a.size;return!b||!c?null:{x:b.x+c.width/2,y:b.y+c.height/2}},b.centerOnEntity=function(a,c){var d=b.getCenter(c),e=a.position,f=a.size;e.x=~~(d.x-f.width/2),e.y=~~(d.y-f.height/2)}}),define("djinn/sim/World",["require","exports","module","../Emitter","../globalTimer","../Collection","../math/core","../math/Vector2","../math/QuadTree","../utils/array","./coreComponents","./Entity","./shared/position"],function(a,b,c){var d=a("../Emitter"),e=a("../globalTimer"),f=a("../Collection"),g=a("../math/core"),h=a("../math/Vector2"),i=a("../math/QuadTree"),j=a("../utils/array"),k=a("./coreComponents"),l=a("./Entity"),m=a("./shared/position");c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.width=a.width,this.height=a.height,this.tickStep=a.tickStep,this._tickPool=0,this.running=!1,this.elapsed=0,this.systems=[],this.entities=new f,this.quadTree=new i,this._entityIdSeed=0,this._components={},this._prefabs={},this.defineComponents(k),this.reset()},start:function(){if(this.running)return;this.running=!0,e.on("tick",this,"_onTick")},stop:function(){if(!this.running)return;this._tickPool=0,this.running=!1,e.off("tick",this,"_onTick")},reset:function(){this.stop(),this.elapsed=0,this._tickPool=0,this.entities.removeAll(!0),this.quadTree.resize(this.width,this.height),this.callSystems("onReset"),this.fire("reset")},addSystems:function(a){a=j.force(a),a.forEach(function(a){var b=new a;b.host=this,this.systems.push(b),this._callSystem(b,"onAdd")},this)},callSystems:function(a,b){var c=this.systems;for(var d=0,e=c.length;d<e;++d){var f=this._callSystem(c[d],a,b);if(f===!0)break}},defineComponents:function(a){for(var b in a)this._components[b]=a[b]},getComponent:function(a){return this._components[a]},definePrefabs:function(a){for(var b in a){var c=a[b],d={};for(var e in c)d[e]=this.getComponent(e);this._prefabs[b]=merge(c,d)}},getPrefab:function(a,b){var c=this._prefabs;return c[a]?b?merge(b,c[a]):c[a]:(logger.error("[Simulation.getPrefab] Invalid prefab ID: "+a),null)},createEntity:function(a,b){var c=this.getPrefab(a,b);return new l(a,c)},spawnEntity:function(a,b){a.id=++this._entityIdSeed,b&&m.centerOnEntity(a,b),this.entities.add(a),this.callSystems("onEntitySpawn",[a]),this.fire("entitySpawn",[a])},getEntity:function(a){return this.entities.get(a)},despawnEntity:function(a){this.entities.remove(a),this.callSystems("onEntityDespawn"),this.fire("entityDespawn",[a])},_callSystem:function(a,b,c){if(!a[b])return;return a[b].apply(a,c)},_onTick:function(a){this._tickPool+=a;var b=this.tickStep;while(this._tickPool>=b)this._tickPool-=b,this._update(b)},_update:function(a){var b=this.quadTree,c=this.entities;this.elapsed+=a,b.clear(),this.callSystems("onPreUpdate");for(var d=0,e=c.length;d<e;++d){var f=c.items[d];if(!f)continue;this.callSystems("onEntityUpdate",[f,a]);var g=m.getBounds(f);g.id=f.id,b.insert(g)}this.callSystems("onPostUpdate")}}),b.defaults={width:960,height:640,tickStep:16}}),define("djinn/sim/systems/Physics",["require","exports","module","djinn/Class"],function(a,b,c){var d=a("djinn/Class");c.exports=d.extend({onEntityUpdate:function(a,b){var c=a.position,d=a.velocity,e=a.gravity;if(!c||!d)return;e&&(d.y+=e.value*b/2),c.x+=~~(d.x*b),c.y+=~~(d.y*b),e&&(d.y+=e.value*b/2)}})}),define("djinn/sim/systems/Collision",["require","exports","module","../../Class","../../math/core","../../utils/array","../shared/position"],function(a,b,c){var d=a("../../Class"),e=a("../../math/core"),f=a("../../utils/array"),g=a("../shared/position");c.exports=d.extend({onPreUpdate:function(a){this._entities=[]},onEntityUpdate:function(a,b){if(!a.collision)return;this._entities.push(a);var c=this.host,d=a.size,e=a.position,f=!1,g=!1;e.x<0?(e.x=0,f=!0):e.x>c.width-d.width&&(e.x=c.width-d.width,f=!0),e.y<0?(e.y=0,g=!0):e.y>c.height-d.height&&(e.y=c.height-d.height,g=!0);if(f||g)c.callSystems("onEnvCollide",[a,f,g]),a.collision.despawnOnEnvCollide&&c.despawnEntity(a)},onPostUpdate:function(){var a=this._entities;for(var b=0,c=a.length;b<c;++b)this._checkEntityCollision(a[b])},_checkEntityCollision:function(a){var b=this.host,c=b.entities,d=b.quadTree,h=g.getBounds(a),i=a.collision.targets,j=d.retrieve(h);for(var k=0,l=j.length;k<l;++k){var m=j[k],n=m.id;if(n===a.id)continue;var o=c.get(n);if(!o||!o.collision)continue;var p=o.collision.groups;o.collision&&f.containsAny(i,p)&&e.intersects(m,h)&&b.callSystems("onEntityCollide",[a,o])}}})}),define("djinn/sim/shared/health",["require","exports","module"],function(a,b,c){b.getNormal=function(a){var b=a.health;if(!b)return;return b.value/b.max},b.reduce=function(a,c){var d=a.health;if(!d)return;var c=c||1;d.value=Math.max(d.value-c,0),a.fire("healthChange",[b.getNormal(a)])}}),define("djinn/sim/systems/Hazards",["require","exports","module","../../Class","../shared/health"],function(a,b,c){var d=a("../../Class"),e=a("../shared/health");c.exports=d.extend({onEntityUpdate:function(a){var b=a.health;if(!b)return;if(!b.destroyed&&b.value<=0){b.destroyed=!0;var c=this.host;c.callSystems("onEntityDestroy",[a]),b.despawnOnDestroy&&c.despawnEntity(a)}},onEntityCollide:function(a,b){if(!a.hazard||!b.health)return;e.reduce(b,a.hazard.damage),a.hazard.despawnOnCollide&&this.host.despawnEntity(a)}})}),define("js/sim/systems/Blocks",["require","exports","module","djinn/Class","djinn/utils/array","djinn/sim/shared/position","djinn/sim/shared/health"],function(a,b,c){var d=a("djinn/Class"),e=a("djinn/utils/array"),f=a("djinn/sim/shared/position"),g=a("djinn/sim/shared/health");c.exports=d.extend({onPostUpdate:function(){var a=this.host;if(a.gameOver)return;var b=0;a.entities.forEach(function(a){if(!this._isBlock(a))return;++b},this),b<=0&&a.endGame()},onEntityDestroy:function(a){if(!this._isBlock(a))return;var b=this.host;b.incrementScore(a.score.value),a.explosive&&(b.spawnEntity(b.createEntity("fireball",{velocity:{x:-0.6},hazard:{damage:a.explosive.damage}}),a),b.spawnEntity(b.createEntity("fireball",{velocity:{x:.6},hazard:{damage:a.explosive.damage}}),a))},onEnvCollide:function(a,b,c){if(!this._isBlock(a))return;c&&(a.velocity.y>.4&&(g.reduce(a,1),a.health.value<=0&&(a.score.value=1e3*a.score.combo)),a.velocity.y=0,a.score.combo=1)},onEntityCollide:function(a,b){if(!this._isBlock(a)||!this._isBlock(b))return;var c=a.position,d=b.position;if(c.y>d.y)return;a.velocity.y>.4&&(g.reduce(b,1),b.health.value<=0?(b.score.value=1e3*a.score.combo,++a.score.combo):a.score.combo=1),c.y=d.y-a.size.height,a.velocity.y=0;var e=f.getBounds(a);e.id=a.id,this.host.quadTree.insert(e)},_isBlock:function(a){var b=a.collision;return b?e.contains(b.groups,"block"):!1}})}),define("js/sim/customComponents",{size:{width:100,height:100},score:{value:500,combo:1},block:{position:"middle"},explosive:{damage:1}}),define("js/sim/prefabs/blocks",{barnBottom:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:2,max:2},block:{position:"bottom"},score:{}},barnMiddle:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:2,max:2},block:{},score:{}},barnTop:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},score:{}},siloBottom:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{position:"bottom"},score:{}},siloMiddle:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{},score:{}},siloTNT:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},explosive:{},score:{}},siloTop:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},score:{}},officeBottom:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{position:"bottom"},score:{}},officeSolid:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{},score:{}},officeWindow:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:2,max:2},block:{},score:{}},officeGlass:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},score:{}},officeTNT:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},explosive:{},score:{}},officeBigTNT:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},explosive:{damage:3},score:{}},officeTop:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},score:{}},nightBottom:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{position:"bottom"},score:{}},nightSolid:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{},score:{}},nightWindow:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:2,max:2},block:{},score:{}},nightGlass:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},score:{}},nightTNT:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},explosive:{},score:{}},nightTop:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},score:{}},night2Bottom:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{position:"bottom"},score:{}},night2Solid:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},block:{},score:{}},night2Window:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:2,max:2},block:{},score:{}},night2TNT:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},explosive:{},score:{}},night2Top:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},block:{},score:{}}}),define("js/sim/prefabs/players",{mandrill:{size:{width:60,height:60},position:{},velocity:{}}}),define("js/sim/prefabs/misc",{fireball:{size:{width:60,height:60},position:{},velocity:{},collision:{targets:["block"],despawnOnEnvCollide:!0},hazard:{despawnOnCollide:!0}}}),define("js/sim/stages",{heartland:{unlockStars:0,backdrop:"media/images/backdrops/skylineFarm.png",ground:"media/images/effects/farmGround.png",tile:"media/images/tiles/heartland.png",levelTile:"media/images/tiles/heartlandLevel.png",seed:1e3,blocks:[{types:["barnBottom","barnMiddle","barnTop"],height:[2,3]},{types:["siloBottom","siloMiddle","siloMiddle","siloTNT","siloTop"],height:[4,7]}],adjectives:["Wavy","Tranquil","Fresh","Silent","Crisp","Foggy","Rustic","Natural","Idyllic","Sunny","Vast","Sprawling","Misty","Amber","Simple","Green","Rural","Grassy","Wild"],nouns:["Grain","Farm","Hills","Wheat","Field","Plains","Ranch","Hearth","Harvest","Haystack","Meadow","Pasture","Acre","Barn","Silo","Lake","River"]},metro:{unlockStars:25,backdrop:"media/images/backdrops/skyline.png",ground:"media/images/effects/ground.png",tile:"media/images/tiles/metro.png",levelTile:"media/images/tiles/metroLevel.png",seed:2e3,blocks:[{types:["officeBottom","officeSolid","officeSolid","officeWindow","officeWindow","officeWindow","officeGlass","officeGlass","officeTNT","officeBigTNT","officeTop"],height:[4,8]}],adjectives:["Busy","Noisy","Crowded","Smoggy","Bustling","Active","Packed","Lively"],nouns:["Bus","Freeway","Sidewalk","Downtown","Uptown","Skyscraper","Alley"]},night:{unlockStars:50,backdrop:"media/images/backdrops/skylineNight.png",ground:"media/images/effects/nightGround.png",tile:"media/images/tiles/night.png",levelTile:"media/images/tiles/nightLevel.png",seed:3e3,blocks:[{types:["nightBottom","nightSolid","nightWindow","nightGlass","nightTNT","nightTop"],height:[6,9]},{types:["night2Bottom","night2Solid","night2Window","night2TNT","night2Top"],height:[5,7]}],adjectives:["Dark","Energized","Electric","Sinful","Midnight","Magic"],nouns:["Nightclub","Casino","Bar","Slots","Show","Tower","Hotel"]}}),define("js/sim/City",["require","exports","module","djinn/sim/World","djinn/math/core","djinn/math/PRNG","djinn/sim/systems/Physics","djinn/sim/systems/Collision","djinn/sim/systems/Hazards","./systems/Blocks","djinn/sim/shared/health","./customComponents","./prefabs/blocks","./prefabs/players","./prefabs/misc","./stages"],function(a,b,c){var d=a("djinn/sim/World"),e=a("djinn/math/core"),f=a("djinn/math/PRNG"),g=a("djinn/sim/systems/Physics"),h=a("djinn/sim/systems/Collision"),i=a("djinn/sim/systems/Hazards"),j=a("./systems/Blocks"),k=a("djinn/sim/shared/health"),l=a("./customComponents"),m=a("./prefabs/blocks"),n=a("./prefabs/players"),o=a("./prefabs/misc"),p=a("./stages"),q=new f,b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.addSystems([g,h,i,j]),this.defineComponents(l),this.definePrefabs(m),this.definePrefabs(n),this.definePrefabs(o),this.score=0,this.stageId=a.stageId,this.seed=a.seed,this.columns=a.columns,this.columnPadding=a.columnPadding,this.reset()},reset:function(){this._super(),this.gameOver=!1,this.score=0,this._scoreMax=0},endGame:function(){this.gameOver=!0,this.fire("gameOver",[this.score,this.starRating])},incrementScore:function(a){this.score+=a,this.fire("scoreChange",[this.score])},damageBlocks:function(a,b){var c={x:a,y:b,width:1,height:1},d=this.quadTree.retrieve(c),f=!1;d.forEach(function(a){if(f||!e.intersects(a,c))return;var b=this.getEntity(a.id);if(!b)return;k.reduce(b,1),f=!0},this)},generate:function(){q.seed(this.seed);var a=p[this.stageId],b=l.size.width,c=l.size.height,d=b*this.columns+this.columnPadding*(this.columns-1),e=~~(this.width/2-d/2);for(var f=0;f<this.columns;++f){var g=e+f*(b+this.columnPadding),h=q.choice(a.blocks),i=q.range(h.height[0],h.height[1]);for(var j=0;j<i;++j){if(j===i-1)var k=h.types[h.types.length-1];else if(j>0)var m=q.integer(h.types.length-3),k=h.types[m+1];else var k=h.types[0];this.spawnEntity(this.createEntity(k,{position:{x:g,y:this.height-(j+1)*c}})),j>0?this._scoreMax+=1e3*(i-j):this._scoreMax+=500}}}}),r=b.prototype;Object.defineProperty(r,"starRating",{get:function(){return Math.floor(5*(this.score/this._scoreMax))}}),b.defaults={width:640,height:1096,stageId:"heartland",seed:1,columns:5,columnPadding:23}}),define("js/sim/world",["require","exports","module","djinn/Emitter","djinn/manifest","djinn/utils/DataStore","djinn/utils/array","djinn/math/PRNG","./City","./stages"],function(a,b,c){var d=a("djinn/Emitter"),e=a("djinn/manifest"),f=a("djinn/utils/DataStore"),g=a("djinn/utils/array"),h=a("djinn/math/PRNG"),i=a("./City"),j=a("./stages"),k=new h,l=d.extend({init:function(a){this._super(a);var b=this.city=new i;this._stars=new f({key:e.shortName+"_stars"}),b.on("gameOver",this,"_onGameOver")},getTotalStars:function(){var a=0;for(var b in j)a+=this.getStarsByStage(b);return a},getStarsByStage:function(a){var b=this._stars.get(a)||[];return g.sum(b)},getStarsByLevel:function(a,b){var c=this._stars.get(a)||[];return c[b]||0},getLevelName:function(a,b){var c=j[a];k.seed(c.seed+b);var d=1e5,e=k.integer(d)%c.adjectives.length,f=k.integer(d)%c.nouns.length;return sprintf("%s %s",c.adjectives[e],c.nouns[f])},getCurrentLevelName:function(){var a=this.city,b=a.seed,c=a.stageId,d=j[c];return this.getLevelName(c,b-d.seed)},_onGameOver:function(a,b){var c=this.city,d=c.stageId,e=j[d],f=this._stars.get(d)||[],g=c.seed-e.seed;if(!f[g]||f[g]<b)f[g]=b,this._stars.set(d,f)}});c.exports=new l}),define("js/view/ui/StageTile",["require","exports","module","djinn/sound","djinn/View","djinn/TextView","djinn/intl","../../sim/world","../../sim/stages","./StarCount","../utils/style"],function(a,b,c){var d=a("djinn/sound"),e=a("djinn/View"),f=a("djinn/TextView"),g=a("djinn/intl"),h=a("../../sim/world"),i=a("../../sim/stages"),j=a("./StarCount"),k=a("../utils/style"),b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.locked=!1,this._title=(new f({parent:this,fontSize:50})).align("left","top",10,10),this._starCount=new j({parent:this,x:20,y:80}),this._overlay=new e({parent:this,backgroundColor:k.getColor("black",.6),visible:!1}),this._lock=(new e({parent:this,image:"media/images/ui/lock.png",y:20,visible:!1,width:138,height:158})).align("center"),this._lockStars=(new j({parent:this,visible:!1})).align("center","bottom",0,-10),this.setStage(a.stageId),this.on("inputPress",this,"_onInputPress")},lock:function(){this.locked=!0,this._overlay.visible=!0,this._lock.visible=!0,this._lockStars.visible=!0},unlock:function(){this.locked=!1,this._overlay.visible=!1,this._lock.visible=!1,this._lockStars.visible=!1},setStage:function(a){this.stageId=a,this.refresh()},refresh:function(){var a=i[this.stageId];if(!a)return;this.image=a.tile,this._title.text=g.get("AREA_"+this.stageId),this._starCount.update(h.getStarsByStage(this.stageId)),this._lockStars.update(a.unlockStars),h.getTotalStars()<a.unlockStars?this.lock():this.unlock()},_onInputPress:function(a){if(this.locked)return;d.play("button",0),this.fire("select",[this.stageId])}});b.defaults={acceptInputEvents:!0,cancelInputEvents:!0,width:640,height:250}}),define("js/view/scenes/StageSelectScene",["require","exports","module","djinn/Scene","djinn/intl","djinn/ViewCollection","djinn/TextView","djinn/utils/transitions","../ui/Button","../ui/StageTile","../utils/style","../../sim/world","../../sim/stages"],function(a,b,c){var d=a("djinn/Scene"),e=a("djinn/intl"),f=a("djinn/ViewCollection"),g=a("djinn/TextView"),h=a("djinn/utils/transitions"),i=a("../ui/Button"),j=a("../ui/StageTile"),k=a("../utils/style"),l=a("../../sim/world"),m=a("../../sim/stages"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},setup:function(){this._title=(new g({parent:this,text:e.get("STAGE_SELECT"),textAlign:"center",fontSize:60})).align("center","top",0,20),this._back=(new i({parent:this,text:e.get("BACK")})).align("center","bottom",0,-20),this._back.on("buttonPress",this,"_onBack"),this._stageTiles=new f;var a=154;for(var b in m){var c=new j({parent:this,id:b,stageId:b,y:a});c.on("select",this,"_onStageSelect"),this._stageTiles.add(c),a+=c.height+30}},reset:function(){this._stageTiles.forEach(function(a){a.refresh(),a.right=0})},activate:function(){this.captureInputEvents=!0;var a=0;this._stageTiles.forEach(function(b){b.completeTween().delayTween(a).tween({x:0},250,h.easeOut),a+=100})},deactivate:function(){},cleanup:function(){},_onStageSelect:function(a){l.city.stageId=a,this.fireSceneEvent("select")},_onBack:function(){this.fireSceneEvent("back")}});b.defaults={backgroundColor:k.getColor("black")}}),define("js/view/ui/LevelHeader",["require","exports","module","djinn/sound","djinn/View","djinn/TextView","djinn/intl","../../sim/world","../../sim/stages","./StarCount","../utils/style"],function(a,b,c){var d=a("djinn/sound"),e=a("djinn/View"),f=a("djinn/TextView"),g=a("djinn/intl"),h=a("../../sim/world"),i=a("../../sim/stages"),j=a("./StarCount"),k=a("../utils/style"),b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this._title=(new f({parent:this,fontSize:50})).align("left","top",10,10),this._starCount=new j({parent:this,x:20,y:80}),this.setStage(a.stageId)},setStage:function(a){this.stageId=a,this.refresh()},refresh:function(){var a=i[this.stageId];if(!a)return;this.image=a.levelTile,this._title.text=g.get("AREA_"+this.stageId),this._starCount.update(h.getStarsByStage(this.stageId))}});b.defaults={width:640,height:320}}),define("js/view/ui/LevelTile",["require","exports","module","djinn/sound","djinn/View","djinn/TextView","./StarCount","../utils/style"],function(a,b,c){var d=a("djinn/sound"),e=a("djinn/View"),f=a("djinn/TextView"),g=a("./StarCount"),h=a("../utils/style"),b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.seed=a.seed,this._name=(new f({parent:this,text:a.name,verticalAlign:"middle"})).align("left","center",10),this._stars=(new g({parent:this})).align("right","center"),this._stars.update(a.stars),this.on("inputPress",this,"_onInputPress")},_onInputPress:function(){d.play("button",0),this.fire("select",[this.seed])}});b.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:h.getColor("black",.5),width:640,height:100}}),define("js/view/scenes/LevelSelectScene",["require","exports","module","djinn/assets","djinn/sound","djinn/Scene","djinn/intl","djinn/ViewCollection","djinn/View","djinn/TextView","../../sim/world","../../sim/stages","../ui/Button","../ui/LevelHeader","../ui/LevelTile","../utils/style","../../soundData"],function(a,b,c){var d=a("djinn/assets"),e=a("djinn/sound"),f=a("djinn/Scene"),g=a("djinn/intl"),h=a("djinn/ViewCollection"),i=a("djinn/View"),j=a("djinn/TextView"),k=a("../../sim/world"),l=a("../../sim/stages"),m=a("../ui/Button"),n=a("../ui/LevelHeader"),o=a("../ui/LevelTile"),p=a("../utils/style"),q=a("../../soundData"),r="title",b=c.exports=f.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},setup:function(){this._levelHeader=new n({parent:this}),this._levelStrip=new i({parent:this,width:6400,height:500,y:this._levelHeader.bottom}),this._back=(new m({parent:this,text:g.get("BACK")})).align("center","bottom",0,-20),this._back.on("buttonPress",this,"_onBack"),this._levelButtons=new h},reset:function(){var a=k.city.stageId,b=l[a];this._levelButtons.removeAll(!0),this._levelHeader.setStage(a);for(var c=0;c<5;++c){var d=(new o({parent:this,y:364+c*120,seed:b.seed+c,name:k.getLevelName(a,c),stars:k.getStarsByLevel(a,c)})).on("select",this,"_onLevelSelect");this._levelButtons.add(d)}this.image=b.backdrop,this._levelButtons.forEach(function(a){a.right=0})},activate:function(a){(a==="city"||a==="results")&&d.load([q.sounds[r].path],function(){e.play(r,0)}),this.captureInputEvents=!0;var b=0;this._levelButtons.forEach(function(a){a.completeTween().delayTween(b).tween({x:0},250,i.transitions.easeOut),b+=100})},deactivate:function(a){a==="city"&&e.fadeOut(r,{incrementAmount:.1,volume:q.sounds[r].volume,targetVolume:0})},cleanup:function(a){a==="city"&&e.stop(r)},_onLevelSelect:function(a){k.city.seed=a,this.fireSceneEvent("select")},_onBack:function(){this.fireSceneEvent("back")}});b.defaults={}}),define("djinn/view/Simulation",["require","exports","module","../View","../ViewCollection"],function(a,b,c){var d=a("../View"),e=a("../ViewCollection");c.exports=d.extend({init:function(a){this._super(a),this.world=null,this.pawns=new e,this._pawnFactory=null,this._avatarFactory=null,this._pawnContainer=new d({parent:this})},attach:function(a){a.on("reset",this,"_onReset"),a.on("entitySpawn",this,"_onEntitySpawn"),a.on("entityDespawn",this,"_onEntityDespawn"),this.world=a},detach:function(){var a=this.world;this.world=null,a.removeListenersByContext(this),this.clean()},clean:function(){this.pawns.removeAll(!0),this._pawnContainer.destroyChildren()},setPawnFactory:function(a){this._pawnFactory=a},setAvatarFactory:function(a){this._avatarFactory=a},_onReset:function(){this.clean()},_onEntitySpawn:function(a){var b=this._pawnFactory.create(a.type,{parent:this._pawnContainer,entity:a}),c=this._avatarFactory.create(a.type);b.attachAvatar(c),this.pawns.add(b)},_onEntityDespawn:function(a){var b=this.pawns.get(a.id);b&&b.destroy(),this.pawns.remove(a.id)}})}),define("js/view/ui/Score",["require","exports","module","djinn/math/core","djinn/TextView","djinn/utils/string","../utils/style"],function(a,b,c){var d=a("djinn/math/core"),e=a("djinn/TextView"),f=a("djinn/utils/string"),g=a("../utils/style"),b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},displayAndDestroy:function(a){var b=d.scaleRange(1,2,a/5e3);this.completeTween({scale:0,text:"$"+f.formatNumber(a)}).tween({scale:b*1.5},100).tween({scale:b},100).tween({opacity:0,y:this.y-100},1e3).tween({},100,null,bind(this,function(){this.destroy()}))}});b.defaults={textAlign:"center",width:200,height:42}}),define("djinn/Factory",["djinn/Class"],function(a){return a.extend({init:function(a,b){this._factoryFallback=a,this._factoryExtensions=b},create:function(a,b){var b=merge(b,{type:a}),c=this._factoryExtensions;return a in c?new c[a](b):new this._factoryFallback(b)}})}),define("djinn/view/Pawn",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a);var c=this.entity=a.entity;c&&(this.id=c.id,this.sync())},attachAvatar:function(a){this.avatar=a,this.addChild(a),this.alignAvatar()},alignAvatar:function(){this.avatar.align("center","center")},sync:function(){var a=this.entity;if(!a)return;var b=a.size,c=a.position;this.x=c.x,this.y=c.y,this.width=b.width,this.height=b.height},tick:function(a){this.sync()}});b.defaults={width:32,height:32}}),define("js/view/utils/DamageBurst",["require","exports","module","djinn/math/core","djinn/View"],function(a,b,c){var d=a("djinn/math/core"),e=a("djinn/View"),b=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},animateAndDestroy:function(){this.completeTween({opacity:0,rotation:d.random(0,d.twoPi*10)/10,scale:.8+d.random(0,2)/10}).tween({opacity:1},50).tween({opacity:0},50,null,bind(this,function(){this.destroy()}))}});return b.defaults={image:"media/images/effects/starburst.png",width:160,height:160},b}),define("djinn/utils/ParticleEmitter",["djinn/math/random","djinn/globalTimer","djinn/View","djinn/utils/viewEffects"],function(a,b,c,d){var e=c.extend({init:function(a){var a=merge(a,e.defaults);this._super(a),this.particleConf=a.particleConf||{},this.ParticleConstructor=a.ParticleConstructor||c,this.fpsThreshold=a.fpsThreshold,this.randomizePositionInParent=a.randomizePositionInParent,this.spawnDelayRange=a.spawnDelayRange||[0,1e3],this.spawnTarget=a.spawnTarget||this,this._spawnTimer=this.createBoundTimer(0,"_onSpawnTimerElapse")},getRandomDelay:function(){var b=this.spawnDelayRange;return a.range(b[0],b[1])},_onSpawnTimerElapse:function(){this.fpsThreshold?b.fps>=this.fpsThreshold&&this.spawnParticle():this.spawnParticle(),this.start()},start:function(a){return this._spawnTimer.start(a||this.getRandomDelay()),this},stop:function(){this._spawnTimer.stop()},prepopulate:function(a,c){if(this.fpsThreshold&&b.fps<this.fpsThreshold)return this;var c=c||10,d=this.getRandomDelay(),e=[],f=0;while(f<a){f+=c,f>=d&&(e.push(this.spawnParticle()),d+=this.getRandomDelay());for(var g=0,h=e.length;g<h;++g){var i=e[g];i.tick&&i.tick(c)}}return this},spawnParticle:function(){var b=c.create(this.ParticleConstructor,merge({parent:this.spawnTarget},this.particleConf));return this.randomizePositionInParent&&(b.x=a.range(0,b.parent.width-b.width),b.y=a.range(0,b.parent.height-b.height)),this.fire("spawn",[b]),b},spawnParticles:function(a){for(var b=0;b<a;++b)this.spawnParticle()}});return e.defaults={autoSort:!1,fpsThreshold:0,randomizePositionInParent:!1},e}),define("djinn/utils/Particle",["djinn/math/core","djinn/View"],function(a,b){var c=b.extend({init:function(a){var a=merge(a,c.defaults);this._super(a),this.gravity=a.gravity||0,this.rotationSpeed=a.rotationSpeed,this.ttl=a.ttl||null,this.velocity=a.velocity||{x:0,y:0}},expire:function(){this.completeTween().tween({opacity:0},250,null,bind(this,function(){this.destroy()}))},tick:function(a){this._updatePositionFromVelocity(a),this._updateVelocityFromGravity(a),this._updateRotation(a),this._updateTTL(a)},_updatePositionFromVelocity:function(a){var b=a/1e3,c=this.velocity;this.x+=c.x*b,this.y+=c.y*b},_updateVelocityFromGravity:function(a){var b=this.gravity;if(!b)return;this.velocity.y+=b*(a/1e3)},_updateRotation:function(b){if(!this.rotationSpeed)return;this.rotation+=this.rotationSpeed*(b/1e3),this.rotation>a.twoPi?this.rotation-=a.twoPi:this.rotation<-a.twoPi&&(this.rotation+=a.twoPi)},_updateTTL:function(a){if(this.ttl===null)return;this.ttl-=a,this.ttl<=0&&(this.ttl=null,this.expire())}});return c.defaults={recyclable:!0},c}),define("js/view/utils/Guts",["require","exports","module","djinn/math/random","djinn/utils/Particle"],function(a,b,c){var d=a("djinn/math/random"),e=a("djinn/utils/Particle"),f=25,g={imageY:f*3},h={imageY:f*4},i={imageY:f*5},j={imageY:f*6},k={officeGlass:{imageY:f},officeWindow:{imageY:f*2},barnBottom:g,barnMiddle:g,barnTop:g,siloBottom:h,siloMiddle:h,siloTop:h,nightBottom:i,nightSolid:i,nightWindow:i,nightGlass:i,nightTNT:i,nightTop:i,night2Bottom:j,night2Solid:j,night2Window:j,night2TNT:j,night2Top:j},b=e.extend({init:function(a){var a=merge(a,k[a.type],b.defaults);this._super(a),this.flipHorizontal=d.chance(.5),d.chance(.7)?this.imageX=d.range(0,1)*f:this.imageX=d.range(2,3)*f;var c=a.spawnBounds;this.x=c.x+d.integer(c.width-f),this.y=c.y+d.integer(c.height-f),this.rotationSpeed=d.range(-6,6),this.velocity={x:d.range(-100,100),y:d.range(-100,-150)},this.ttl=d.range(1500,3e3)}});return b.defaults={gravity:200,image:"media/images/effects/guts.png",width:f,height:f,spawnBounds:{x:0,y:0,width:100,height:100}},b}),define("js/view/utils/GutsEmitter",["require","exports","module","djinn/math/random","djinn/utils/ParticleEmitter","./Guts"],function(a,b,c){var d=a("djinn/math/random"),e=a("djinn/utils/ParticleEmitter"),f=a("./Guts"),b=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},emitDamage:function(a){this.particleConf.type=a,this.spawnParticles(d.range(3,4))},emitDestroy:function(a){this.particleConf.type=a,this.spawnParticles(d.range(5,6))},emit:function(a){this.particleConf.type=a,this.spawnParticles(d.range(5,8))}});return b.defaults={ParticleConstructor:f},b}),define("js/view/utils/Debris",["require","exports","module","djinn/math/random","djinn/View"],function(a,b,c){var d=a("djinn/math/random"),e=a("djinn/View"),f=100,g={officeBottom:{image:"media/images/avatars/buildings.png"},siloBottom:{image:"media/images/avatars/silo.png"},barnBottom:{image:"media/images/avatars/farm.png"},nightBottom:{image:"media/images/avatars/night.png"},night2Bottom:{image:"media/images/avatars/night2.png"}},b=e.extend({init:function(a){var a=merge(a,g[a.type],b.defaults);this._super(a)}});return b.defaults={imageX:f*2,imageY:f*2,width:f,height:f},b}),define("js/view/pawns/Block",["require","exports","module","djinn/view/Pawn","djinn/sound","djinn/utils/viewEffects","../utils/DamageBurst","../utils/GutsEmitter","../utils/Debris"],function(a,b,c){var d=a("djinn/view/Pawn"),e=a("djinn/sound"),f=a("djinn/utils/viewEffects"),g=a("../utils/DamageBurst"),h=a("../utils/GutsEmitter"),i=a("../utils/Debris");c.exports=d.extend({init:function(a){this._super(a),this._gutsEmitter=new h({parent:this,spawnTarget:this.parent,z:999}),this.entity.on("healthChange",this,"_onHealthChange"),this._shakeTimer=this.createBoundTimer(500,"_onShakeTimer")},_onHealthChange:function(a){e.play("damage",0);var b=this.entity,c=b.position,d=b.size,h=b.health,j=Math.min(h.max-h.value,h.max-1);this.avatar.setDamage(j),(new g({parent:this.parent})).centerOn(this).animateAndDestroy(),f.shake(this.avatar),this._gutsEmitter.set({particleConf:{spawnBounds:{x:c.x,y:c.y,width:d.width,height:d.height}}}),h.value===1?(this._shakeTimer.start(),this._gutsEmitter.emitDamage(b.type)):h.value===0&&(e.play("destroy",0),this._gutsEmitter.emitDestroy(b.type),b.block.position==="bottom"&&(new i({parent:this.parent,type:b.type})).centerOn(this))},_onShakeTimer:function(){f.shake(this.avatar,{duration:500,violence:2})}})}),define("js/view/pawns/Fireball",["require","exports","module","djinn/view/Pawn","djinn/math/core"],function(a,b,c){var d=a("djinn/view/Pawn"),e=a("djinn/math/core");c.exports=d.extend({init:function(a){this._super(a)},attachAvatar:function(a){this._super(a),a.setFacing(e.sign(this.entity.velocity.x))}})}),define("js/view/utils/pawnMap",["require","exports","module","djinn/Factory","djinn/view/Pawn","../pawns/Block","../pawns/Fireball"],function(a,b,c){var d=a("djinn/Factory"),e=a("djinn/view/Pawn"),f=a("../pawns/Block"),g=a("../pawns/Fireball");c.exports=new d(e,{barnBottom:f,barnMiddle:f,barnTop:f,siloBottom:f,siloMiddle:f,siloTNT:f,siloTop:f,officeBottom:f,officeSolid:f,officeWindow:f,officeGlass:f,officeTNT:f,officeBigTNT:f,officeTop:f,nightBottom:f,nightSolid:f,nightWindow:f,nightGlass:f,nightTNT:f,nightTop:f,night2Bottom:f,night2Solid:f,night2Window:f,night2TNT:f,night2Top:f,fireball:g})}),define("js/view/avatars/Fireball",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},setFacing:function(a){this.flipHorizontal=a===1}});b.defaults={image:"media/images/avatars/fireball.png",width:100,height:100}}),define("js/view/avatars/Player",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),e=60,f={mandrill:{backgroundColor:"brown"}},b=c.exports=d.extend({init:function(a){var a=merge(a,f[a.type],b.defaults);this._super(a)}});b.defaults={width:e,height:e}}),define("js/view/utils/avatarMap",["require","exports","module","djinn/Factory","djinn/View","../avatars/Block","../avatars/Fireball","../avatars/Player"],function(a,b,c){var d=a("djinn/Factory"),e=a("djinn/View"),f=a("../avatars/Block"),g=a("../avatars/Fireball"),h=a("../avatars/Player");c.exports=new d(e,{mandrill:h,barnBottom:f,barnMiddle:f,barnTop:f,siloBottom:f,siloMiddle:f,siloTNT:f,siloTop:f,officeBottom:f,officeSolid:f,officeWindow:f,officeGlass:f,officeTNT:f,officeBigTNT:f,officeTop:f,nightBottom:f,nightSolid:f,nightWindow:f,nightGlass:f,nightTNT:f,nightTop:f,night2Bottom:f,night2Solid:f,night2Window:f,night2TNT:f,night2Top:f,fireball:g})}),define("js/view/utils/Cloud",["require","exports","module","djinn/View","djinn/math/random"],function(a,b,c){var d=a("djinn/View"),e=a("djinn/math/random"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a);var c=e.range(5,10)/10;this.opacity=c,this.scale=c,this.z=c*100},driftAndDestroy:function(){return this.tween({x:this.parent.width},18e4*(1-this.scale),null,bind(this,function(){this.destroy()}))}});b.defaults={image:"media/images/effects/cloud.png",width:114,height:68}}),define("js/view/utils/Smoke",["require","exports","module","djinn/math/random","djinn/View"],function(a,b,c){var d=a("djinn/math/random"),e=a("djinn/View"),f=100,b=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.opacity=d.range(2,6)/10,this.rotation=d.range(0,60)/10,this.scale=d.range(6,10)/10},fadeAndDestroy:function(){this.x+=d.range(-25,25),this.y+=d.range(-25,25),this.completeTween().tween({opacity:0,rotation:d.range(0,60)/10,x:this.x+d.range(-50,50)},d.range(2500,5e3),e.transitions.strongIn,bind(this,function(){this.destroy()}))},tick:function(a){this.y-=a/100}});return b.defaults={image:"media/images/effects/smoke.png",width:f,height:f},b}),define("djinn/Sprite",["djinn/math/core","djinn/View"],function(a,b){var c=b.extend({init:function(a){a=merge(a,{animations:{}}),this._super(a),this._animations=a.animations,this._animating=!1,this._currentAnimation=null,this._frameElapsed=0,this._frameIndex=0;for(var b in this._animations)this._animations[b]=merge(this._animations[b],{frames:[],frameRate:12,flipHorizontal:!1,flipVertical:!1,loop:!0})},tick:function(a){if(!this._animating||!this._currentAnimation)return;var b=this._animations[this._currentAnimation];this._frameElapsed+=a;if(this._frameElapsed>=1e3/b.frameRate){this._frameElapsed=0,++this._frameIndex;var c=b.frames.length-1;this._frameIndex>c&&(b.loop==0?(this._frameIndex=c,this._animating=!1,this.fire("animationEnd")):this._frameIndex=0),this._showFrame()}},playAnimation:function(a,b){if(this._currentAnimation!=a||b!==!1)this._animating=!0,this._currentAnimation=a,this._frameIndex=0,this._frameElapsed=0,this._showFrame();return this._animating=!0,this},resumeAnimation:function(a){this._animating=!0,this._currentAnimation=a,this._showFrame()},stopAnimation:function(){return this._animating=!1,this},_showFrame:function(){var a=this._animations[this._currentAnimation];if(a===undefined){logger.warn("Animation not defined: ",this._currentAnimation);return}var b=a.frames[this._frameIndex];this.imageX=b[0],this.imageY=b[1]}});return Object.defineProperty(c.prototype,"currentAnimation",{get:function(){return this._currentAnimation}}),Object.defineProperty(c.prototype,"frame",{get:function(){return this._frameIndex},set:function(b){this._frameIndex=a.clamp(b,0,this.frameCount-1)}}),Object.defineProperty(c.prototype,"frameCount",{get:function(){var a=this._animations[this._currentAnimation];return a&&a.frames&&a.frames.length||0}}),c}),define("js/view/utils/Explosion",["require","exports","module","djinn/math/random","djinn/Sprite","../animations"],function(a,b,c){var d=a("djinn/math/random"),e=a("djinn/Sprite"),f=a("../animations"),g=160,b=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.playAnimation("boom"),this.rotation=d.range(0,60)/10,this.tween({rotation:d.range(0,60)/10},500)},fadeAndDestroy:function(){this.completeTween().delayTween(500).tween({opacity:0,y:this.y-20},250,null,bind(this,function(){this.destroy()}))}});return b.defaults={animations:f.explosion(g),image:"media/images/effects/explosion.png",width:g,height:g},b}),define("js/view/City",["require","exports","module","djinn/view/Simulation","djinn/TextView","djinn/math/random","djinn/utils/viewEffects","djinn/sound","./ui/Score","./utils/style","./utils/pawnMap","./utils/avatarMap","./utils/Cloud","./utils/Smoke","./utils/Explosion"],function(a,b,c){var d=a("djinn/view/Simulation"),e=a("djinn/TextView"),f=a("djinn/math/random"),g=a("djinn/utils/viewEffects"),h=a("djinn/sound"),i=a("./ui/Score"),j=a("./utils/style"),k=a("./utils/pawnMap"),l=a("./utils/avatarMap"),m=a("./utils/Cloud"),n=a("./utils/Smoke"),o=a("./utils/Explosion"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.setPawnFactory(k),this.setAvatarFactory(l),this.on("inputStart",this,"_onInputStart"),this._cloudTimer=this.createBoundTimer(0,"_onCloudTimer");for(var c=0;c<3;++c){var d=this._onCloudTimer();d.x=f.range(0,this.width-d.width)}},_onEntityDespawn:function(a){(a.explosive||a.block&&a.block.position==="bottom")&&g.shake(this,{duration:350,violence:8});if(a.explosive){h.play("explosion",0);var b=a.position,c=a.size,d={x:b.x,y:b.y,width:c.width,height:c.height};(new o({parent:this,z:5})).centerOn(d).fadeAndDestroy()}if(a.score){var e=new i({parent:this,x:~~(a.position.x+a.size.width/2)-100,y:~~(a.position.y+a.size.height/2)-20,z:999});e.displayAndDestroy(a.score.value)}var b=a.position,c=a.size,d={x:b.x,y:b.y,width:c.width,height:c.height},j=f.range(3,5);for(var k=0;k<j;++k)(new n({parent:this})).centerOn(d).fadeAndDestroy();this._super(a)},_onInputStart:function(a){this.world.damageBlocks(a.point.x,a.point.y)},_onCloudTimer:function(){return this._cloudTimer.start(f.range(5e3,1e4)),(new m({parent:this,right:0,y:f.range(m.defaults.height,this.height/4)})).driftAndDestroy()}});b.defaults={width:640,height:1096,acceptInputEvents:!0,cancelInputEvents:!0,image:"media/images/backdrops/skyline.png",imageY:40}}),define("js/view/ui/MenuButton",["require","exports","module","djinn/sound","djinn/ui/Button"],function(a,b,c){var d=a("djinn/sound"),e=a("djinn/ui/Button"),f=100,b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},_onInputStart:function(a){d.play("button",0),this._super(a)}});b.defaults={image:"media/images/ui/icons.png",imageY:50,width:f,height:f}}),define("djinn/ui/Checkbox",["djinn/View","djinn/TextView","djinn/utils/transitions"],function(a,b,c){var d=a.extend({init:function(c){this._super(merge(c,d.defaults)),this._checked=Boolean(c.checked),this.iconView=new a(merge({tag:"iconView",parent:this},c.iconConf||{backgroundColor:"black",width:40,height:40})),this.textView=(new b(merge({tag:"textView",parent:this,text:c.text,textAlign:"left",verticalAlign:"middle",x:this.iconView.right+(c.pad||0)},c.textConf||{}))).align(null,"center"),this.on("inputStart",this,"_onInputStart"),this.update()},_onInputStart:function(a){this._checked=!this._checked,this.update(),this.fire("check",[this._checked])},update:function(){this.iconView.imageY=this._checked?0:this.iconView.height}});return d.defaults={acceptInputEvents:!0,cancelInputEvents:!0},Object.defineProperty(d.prototype,"text",{set:function(a){this.textView.text=a}}),Object.defineProperty(d.prototype,"checked",{set:function(a){this._checked=a,this.update()},get:function(){return this._checked}}),d}),define("js/view/ui/Checkbox",["require","exports","module","djinn/sound","djinn/ui/Checkbox","../utils/style"],function(a,b,c){var d=a("djinn/sound"),e=a("djinn/ui/Checkbox"),f=a("../utils/style"),b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},_onInputStart:function(a){d.play("tick",0),this._super(a)}});b.defaults={iconConf:{image:"media/images/ui/icons.png",imageX:100,width:80,height:80},pad:20,textConf:{color:f.getColor("white"),fontSize:40},width:400,height:80}}),define("js/view/ui/OptionsMenu",["require","exports","module","djinn/intl","djinn/sound","djinn/View","djinn/TextView","djinn/preferences","../utils/style","../ui/Checkbox","../ui/Button"],function(a,b,c){var d=a("djinn/intl"),e=a("djinn/sound"),f=a("djinn/View"),g=a("djinn/TextView"),h=a("djinn/preferences"),i=a("../utils/style"),j=a("../ui/Checkbox"),k=a("../ui/Button"),b=c.exports=f.extend({init:function(a){var a=merge(a,b.defaults);this._super(a);var c=new g({parent:this,text:d.get("OPTIONS"),textAlign:"center",y:20,height:80}),e=this._musicOption=(new j({parent:this,text:"Play music",y:200})).align("center");e.on("check",this,"_toggleMusic");var f=this._effectsOption=(new j({parent:this,text:"Play sounds",y:320})).align("center");f.on("check",this,"_toggleEffects");var h=(new k({parent:this,text:d.get("CONTINUE"),y:240})).align("right","bottom",-20,-20);h.on("buttonPress",this,"_onContinue");var i=(new k({parent:this,text:"Quit",y:320})).align("left","bottom",20,-20);i.on("buttonPress",this,"_onQuit"),this.refresh()},refresh:function(){this._musicOption.checked=e.musicEnabled,this._effectsOption.checked=e.effectsEnabled},_onContinue:function(){this.fire("continue")},_onQuit:function(){this.fire("quit")},_toggleMusic:function(){e.musicEnabled=!e.musicEnabled,h.set("musicEnabled",e.musicEnabled),this.refresh()},_toggleEffects:function(){e.effectsEnabled=!e.effectsEnabled,h.set("effectsEnabled",e.effectsEnabled),this.refresh()}});b.defaults={acceptInputEvents:!0,captureInputEvents:!0,backgroundColor:i.getColor("black",.7),height:640}}),define("js/view/scenes/CityScene",["require","exports","module","djinn/assets","djinn/sound","djinn/Scene","djinn/View","djinn/TextView","djinn/intl","djinn/utils/string","../../sim/world","../../sim/stages","../City","../ui/MenuButton","../ui/OptionsMenu","../../soundData"],function(a,b,c){var d=a("djinn/assets"),e=a("djinn/sound"),f=a("djinn/Scene"),g=a("djinn/View"),h=a("djinn/TextView"),i=a("djinn/intl"),j=a("djinn/utils/string"),k=a("../../sim/world"),l=a("../../sim/stages"),m=a("../City"),n=a("../ui/MenuButton"),o=a("../ui/OptionsMenu"),p=a("../../soundData"),q="gameplay";c.exports=f.extend({setup:function(){this._cityView=new m({parent:this}),this._ground=(new g({parent:this,image:"media/images/effects/ground.png",width:640,height:50,z:100})).align("center","bottom"),this._score=(new h({parent:this,fontSize:30,z:200})).align("left","top",10,10);var a=this._menuButton=(new n({parent:this,z:200})).align("right","top");a.on("buttonPress",this,"_toggleOptionsMenu"),this._overlay=new g({parent:this,acceptInputEvents:!0,cancelInputEvents:!0,visible:!1,z:300});var b=this._optionsMenu=(new o({parent:this,visible:!1,z:400})).align("center","center");b.on("continue",this,"_onContinue"),b.on("quit",this,"_onQuit");var c=k.city;c.on("scoreChange",this,"_onScoreChange"),c.on("gameOver",this,"_onGameOver"),this._cityView.attach(c)},reset:function(){var a=k.city;a.reset(),a.generate();var b=l[a.stageId];this._cityView.image=b.backdrop,this._ground.image=b.ground,this._onScoreChange(a.score)},activate:function(a){a==="levelSelect"&&d.load([p.sounds[q].path],function(){e.play(q,0)}),this.captureInputEvents=!0,k.city.start()},deactivate:function(a){a==="levelSelect"&&e.fadeOut(q,{incrementAmount:.1,volume:p.sounds[q].volume,targetVolume:0}),k.city.stop()},cleanup:function(a){a==="levelSelect"&&e.stop(q)},_onScoreChange:function(a){this._score.text=i.get("SCORE_N",j.formatNumber(a))},_onGameOver:function(){this.completeTween().delayTween(1e3,bind(this,function(){this.fireSceneEvent("gameOver")}))},_onContinue:function(){this._toggleOptionsMenu()},_onQuit:function(){this._overlay.hide(),this._optionsMenu.hide(),this.fireSceneEvent("quit")},_toggleOptionsMenu:function(){var a=this._optionsMenu;a.visible?e.play(q):e.stop(q),a.toggle(),this._overlay.toggle()}})}),define("js/view/ui/RubbleHill",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},reset:function(){this.completeTween({y:this.parent.height})},showScore:function(a,b){var c=a/5;this.delayTween(1500).tween({y:this.parent.height-this.height*c},a*250,null,b)}});b.defaults={image:"media/images/ui/rubbleHill.png",width:640,height:646}}),define("js/view/ui/Star",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),e=115,f="media/images/ui/stars.png",b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this._earned=new d({parent:this,image:f,imageY:e})},reset:function(){this._earned.hide()},got:function(){this._earned.completeTween({opacity:0,scale:2,visible:!0}).tween({opacity:1,scale:1})}});b.defaults={image:f,width:e,height:e}}),define("js/view/ui/StarRating",["require","exports","module","djinn/View","./Star"],function(a,b,c){var d=a("djinn/View"),e=a("./Star"),f=115,g=5,b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this._stars=[];for(var c=0;c<g;++c)this._stars[c]=new e({parent:this,x:c*e.defaults.width});this._pulseTimer=this.createBoundTimer(500,"_onPulseTimer")},forEachStar:function(a){for(var b=0;b<g;++b)a(this._stars[b],b)},reset:function(){this.forEachStar(function(a){a.reset()}),this._pulseTimer.stop()},showScore:function(a){this.forEachStar(function(b,c){c<a&&b.got()}),a===g&&this._pulseTimer.start()},_onPulseTimer:function(){this.completeTween().tween({scale:1.1},100).tween({scale:1},100)}});b.defaults={image:"media/images/ui/stars.png",width:e.defaults.width*5,height:f}}),define("js/view/utils/Rubble",["require","exports","module","djinn/math/random","djinn/utils/Particle"],function(a,b,c){var d=a("djinn/math/random"),e=a("djinn/utils/Particle"),f=25,b=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.flipHorizontal=d.chance(.5),d.chance(.7)?this.imageX=d.range(0,1)*f:this.imageX=d.range(2,3)*f,this.imageY=d.range(0,6)*f;var c=d.range(0,180);this.x=80+c,this.y=320,this.rotationSpeed=d.range(-6,6),this.velocity={x:d.range(100,200),y:d.range(-100,-300)},this.ttl=d.range(3e3,5e3)}});return b.defaults={gravity:500,image:"media/images/effects/guts.png",width:f,height:f},b}),define("js/view/utils/RubbleEmitter",["require","exports","module","djinn/math/random","djinn/utils/ParticleEmitter","./Rubble"],function(a,b,c){var d=a("djinn/math/random"),e=a("djinn/utils/ParticleEmitter"),f=a("./Rubble"),b=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},emit:function(a){this.particleConf.type=a,this.spawnParticles(d.range(100,200))}});return b.defaults={ParticleConstructor:f,spawnDelayRange:[0,10]},b}),define("js/view/scenes/ResultsScene",["require","exports","module","djinn/assets","djinn/sound","djinn/Scene","djinn/intl","djinn/View","djinn/TextView","djinn/utils/string","../ui/Button","../ui/RubbleHill","../ui/DumpTruck","../ui/StarRating","../utils/style","../utils/RubbleEmitter","../../sim/world","../../sim/stages","../../soundData"],function(a,b,c){var d=a("djinn/assets"),e=a("djinn/sound"),f=a("djinn/Scene"),g=a("djinn/intl"),h=a("djinn/View"),i=a("djinn/TextView"),j=a("djinn/utils/string"),k=a("../ui/Button"),l=a("../ui/RubbleHill"),m=a("../ui/DumpTruck"),n=a("../ui/StarRating"),o=a("../utils/style"),p=a("../utils/RubbleEmitter"),q=a("../../sim/world"),r=a("../../sim/stages"),s=a("../../soundData"),t="gameplay",b=c.exports=f.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},setup:function(){this._levelName=(new i({parent:this,text:"City of slackers",textAlign:"center",fontSize:60})).align("center","top",0,20),(new i({parent:this,text:g.get("RESULTS"),textAlign:"center"})).align("center","top",0,100),new h({parent:this,image:"media/images/ui/bridge.png",x:-40,y:440,z:2,width:294,height:120}),this._hill=new l({parent:this}),this._rubbleEmitter=new p({parent:this,rotation:Math.PI/4,spawnTarget:this,x:80,y:320,width:180,height:20,z:999}),this._truck=new m({parent:this,y:370}),this._score=(new i({parent:this,fontSize:40,textAlign:"center",y:200})).align("center"),this._stars=(new n({parent:this,y:700})).align("center"),this._retry=(new k({parent:this,text:g.get("RETRY"),z:10})).align("left","bottom",20,-20),this._retry.on("buttonPress",this,"_onRetry"),this._continue=(new k({parent:this,text:g.get("OK"),z:10})).align("right","bottom",-20,-20),this._continue.on("buttonPress",this,"_onContinue")},reset:function(){var a=q.city;this._levelName.text=q.getCurrentLevelName(),this.image=r[a.stageId].backdrop,this._score.text=g.get("SCORE_N",j.formatNumber(a.score)),this._stars.reset(),this._hill.reset(),this._truck.reset()},activate:function(){var a=q.city,b=a.starRating||5,c=this._hill,d=this._truck,e=this._rubbleEmitter,f=this._stars;this.captureInputEvents=!0,d.dump(function(){e.start(),c.showScore(b,function(){f.showScore(b),e.stop(),d.leave()})})},deactivate:function(a){a==="levelSelect"&&e.fadeOut(t,{incrementAmount:.1,volume:s.sounds[t].volume,targetVolume:0})},cleanup:function(a){a==="levelSelect"&&e.stop(t)},_onRetry:function(){this.fireSceneEvent("retry")},_onContinue:function(){this.fireSceneEvent("continue")}});b.defaults={width:640,height:1136}}),define("js/view/scenes/PurchaseScene",["require","exports","module","djinn/Scene","djinn/intl","djinn/TextView","../ui/Button","../utils/style"],function(a,b,c){var d=a("djinn/Scene"),e=a("djinn/intl"),f=a("djinn/TextView"),g=a("../ui/Button"),h=a("../utils/style"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},setup:function(){this._title=(new f({parent:this,text:"Buy somethin' will ya?",textAlign:"center",fontSize:60})).align("center","top",0,20),this._done=(new g({parent:this,text:e.get("DONE")})).align("center","bottom",0,-20),this._done.on("buttonPress",this,"_onDone")},reset:function(){},activate:function(){this.captureInputEvents=!0},deactivate:function(){},cleanup:function(){},_onDone:function(){this.fireSceneEvent("done")}});b.defaults={backgroundColor:h.getColor("black")}}),define("js/view/scenes",["require","exports","module","./scenes/TitleScene","./scenes/StageSelectScene","./scenes/LevelSelectScene","./scenes/CityScene","./scenes/ResultsScene","./scenes/PurchaseScene"],function(a,b,c){b.title={ctor:a("./scenes/TitleScene"),events:{play:{id:"stageSelect",transition:"fade"}}},b.stageSelect={ctor:a("./scenes/StageSelectScene"),events:{select:{id:"levelSelect",transition:"fade"},back:{id:"title",transition:"fade"}}},b.levelSelect={ctor:a("./scenes/LevelSelectScene"),events:{select:{id:"city",transition:"fade"},back:{id:"stageSelect",transition:"fade"}}},b.city={ctor:a("./scenes/CityScene"),events:{gameOver:{id:"results",transition:"fade"},quit:{id:"levelSelect",transition:"fade"}}},b.results={ctor:a("./scenes/ResultsScene"),events:{retry:{id:"city",transition:"fade"},"continue":{id:"levelSelect",transition:"fade"}}},b.purchase={ctor:a("./scenes/PurchaseScene"),events:{done:{id:"levelSelect",transition:"fade"}}}}),define("js/Shiv",["require","exports","module","djinn/manifest","djinn/assets","djinn/sound","djinn/Game","djinn/preferences","./soundData","./view/scenes"],function(a,b,c){var d=a("djinn/manifest"),e=a("djinn/assets"),f=a("djinn/sound"),g=a("djinn/Game"),h=a("djinn/preferences"),i=a("./soundData"),j=a("./view/scenes"),b=c.exports=g.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.setupScenes(j),h.setDefaults({musicEnabled:!0,effectsEnabled:!0}),f.configure(i),f.musicEnabled=h.get("musicEnabled")===!0,f.effectsEnabled=h.get("effectsEnabled")===!0,this.preloadAssets(["media/images/avatars/buildings.png","media/images/avatars/farm.png","media/images/avatars/fireball.png","media/images/avatars/silo.png","media/images/avatars/night.png","media/images/avatars/night2.png","media/images/effects/cloud.png","media/images/effects/explosion.png","media/images/effects/ground.png","media/images/effects/farmGround.png","media/images/effects/nightGround.png","media/images/effects/guts.png","media/images/effects/light.png","media/images/effects/smoke.png","media/images/effects/starburst.png","media/images/backdrops/skyline.png","media/images/backdrops/skylineFarm.png","media/images/backdrops/skylineNight.png","media/images/tiles/heartland.png","media/images/tiles/metro.png","media/images/tiles/night.png","media/images/tiles/heartlandLevel.png","media/images/tiles/metroLevel.png","media/images/tiles/nightLevel.png","media/images/ui/bridge.png","media/images/ui/button.png","media/images/ui/dumpTruck.png","media/images/ui/icons.png","media/images/ui/lock.png","media/images/ui/rubbleHill.png","media/images/ui/stars.png","media/images/ui/title.png"]),e.load(["media/fonts/doppioOne.ttf"]),this.on("load",this,"_onGameLoad"),this.on("ready",this,"_onGameReady")},_onGameLoad:function(){var a=[];for(var b in i.sounds){var c=i.sounds[b];if(c.type==="music")continue;a.push(c.path)}e.load(a)},_onGameReady:function(){this.activateScene(d.entry,"fade")}});b.defaults={showLoadingScreen:!0}});
require(["djinn/global","djinn/manifest","djinn/assets","djinn/stage"],function(a,b,c,d){d.matchSize(b.sizes),require(["js/Shiv"],function(a){var b=new a;b.run()})})</script>
	
	
	
	</body>
</html>