<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="A game for Intel Keynote">
	<meta name="keywords" content="">
	
		<meta name="oupengmobile" content="game,fullscreen,portrait">
	<title>Project Shiv</title>
	<link rel="shortcut icon" href="">
	<link rel="apple-touch-icon-precomposed" href="">
	<link rel="image_src" href="">
	<style>
		html, body {
			overflow: hidden;
			background: #000;
			margin: 0;
		}
		canvas {
			background: #000;
		}
		#djinn-game-info {
			display: none;
		}
	</style>
	
	</head>
<body>
	<div id="djinn-game-info">
		<h1>Project Shiv</h1>
		<p>A game for Intel Keynote</p>
		<p></p>
	</div>
	
	
	
	
		<script>
/*
Copyright Â© 2012 Lost Decade Games, LLC
Visit us on the web: http://www.lostdecadegames.com
Email us: hello@lostdecadegames.com
Follow us on Twitter: @LostDecadeGames
*/
__manifest={"title":"Project Shiv","description":"A game for Intel Keynote","shortName":"shiv","launch":"js/Shiv","entry":"city","sizes":[[640,1136]],"icons":{},"orientation":"portrait","version":"0.0.1","port":8813};
__intl={};
var requirejs,require,define;(function(a){function i(a,b){var c=b&&b.split("/"),e=d.map,f=e&&e["*"]||{},g,h,i,j,k,l,m;if(a&&a.charAt(0)==="."&&b){c=c.slice(0,c.length-1),a=c.concat(a.split("/"));for(k=0;m=a[k];k++)if(m===".")a.splice(k,1),k-=1;else if(m===".."){if(k===1&&(a[2]===".."||a[0]===".."))return!0;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((c||f)&&e){g=a.split("/");for(k=g.length;k>0;k-=1){h=g.slice(0,k).join("/");if(c)for(l=c.length;l>0;l-=1){i=e[c.slice(0,l).join("/")];if(i){i=i[h];if(i){j=i;break}}}j=j||f[h];if(j){g.splice(0,k,j),a=g.join("/");break}}}return a}function j(b,c){return function(){return h.apply(a,f.call(arguments,0).concat([b,c]))}}function k(a){return function(b){return i(b,a)}}function l(a){return function(c){b[a]=c}}function m(d){if(c.hasOwnProperty(d)){var f=c[d];delete c[d],e[d]=!0,g.apply(a,f)}if(!b.hasOwnProperty(d))throw new Error("No "+d);return b[d]}function n(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=i(a.slice(0,e),b),a=a.slice(e+1),d=m(c),d&&d.normalize?a=d.normalize(a,k(b)):a=i(a,b)):a=i(a,b),{f:c?c+"!"+a:a,n:a,p:d}}function o(a){return function(){return d&&d.config&&d.config[a]||{}}}var b={},c={},d={},e={},f=[].slice,g,h;g=function(d,f,g,h){var i=[],k,p,q,r,s,t;h=h||d;if(typeof g=="function"){f=!f.length&&g.length?["require","exports","module"]:f;for(t=0;t<f.length;t++){s=n(f[t],h),q=s.f;if(q==="require")i[t]=j(d);else if(q==="exports")i[t]=b[d]={},k=!0;else if(q==="module")p=i[t]={id:d,uri:"",exports:b[d],config:o(d)};else if(b.hasOwnProperty(q)||c.hasOwnProperty(q))i[t]=m(q);else if(s.p)s.p.load(s.n,j(h,!0),l(q),{}),i[t]=b[q];else if(!e[q])throw new Error(d+" missing "+q)}r=g.apply(b[d],i);if(d)if(p&&p.exports!==a&&p.exports!==b[d])b[d]=p.exports;else if(r!==a||!k)b[d]=r}else d&&(b[d]=g)},requirejs=require=h=function(b,c,e,f){return typeof b=="string"?m(n(b,c).f):(b.splice||(d=b,c.splice?(b=c,c=e,e=null):b=a),c=c||function(){},f?g(a,b,c,e):setTimeout(function(){g(a,b,c,e)},15),h)},h.config=function(a){return d=a,h},define=function(a,b,d){b.splice||(d=b,b=[]),c[a]=[a,b,d]},define.amd={jQuery:!0}})(),define("../djinn/lib/almond",function(){});var djinn={version:"2.53.4"},bind=function(b,c){return typeof c=="string"&&(c=b[c]),function(){c.apply(b,arguments)}},clone=function(b){return JSON.parse(JSON.stringify(b))},merge=function(){var b={};for(var c=arguments.length-1;c>=0;--c){var d=arguments[c];if(typeof d!="object")continue;for(var e in d){var f=d[e];if(f===undefined)continue;f&&typeof f.concat=="function"?b[e]=f.concat([]):f&&f.constructor===Object?b[e]=arguments.callee(f,b[e]):b[e]=f}}return b},sprintf=function(b){for(var c=1,d=arguments.length;c<d;++c)b=b.replace(/%s/,arguments[c]);return b};if(typeof requestAnimationFrame=="undefined")var requestAnimationFrame=window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(function(){a(Date.now())},17)};var logger=typeof console!="undefined"?console:{error:function(){},info:function(){},log:function(){},warn:function(){}};typeof logger.info!="function"&&(logger.info=logger.log),define("djinn/global",function(){}),define("djinn/manifest",[],function(){return __manifest}),define("djinn/utils/keys",{tab:9,space:32,escape:27,backspace:8,enter:13,shift:16,up:38,down:40,left:37,right:39,n0:48,n1:49,n2:50,n3:51,n4:52,n5:53,n6:54,n7:55,n8:56,n9:59,w:87,a:65,s:83,d:68,c:67,x:88,e:69,m:77,q:81,z:90}),define("djinn/math/core",[],function(){var a={twoPi:Math.PI*2,sign:function(a){return a>0?1:a==0?0:-1},chance:function(b){var c=a.random(0,100)/100;return c<=b},random:function(a,b){return a instanceof Array?arguments.callee(0,a.length-1):Math.round(Math.random()*(b-a))+a},clamp:function(a,b,c){return Math.min(Math.max(a,b),c)},vary:function(b,c){return b+=a.random(-c,c)},scaleRange:function(a,b,c){return a+~~((b-a)*c)},combineRects:function(a,b){var c=a.x<b.x?a.x:b.x,d=a.y<b.y?a.y:b.y,e=a.x+a.width,f=a.y+a.height,g=b.x+b.width,h=b.y+b.height;return{x:c,y:d,width:(a.x+a.width>b.x+b.width?a.x+a.width:b.x+b.width)-c,height:(a.y+a.height>b.y+b.height?a.y+a.height:b.y+b.height)-d}},intersects:function(a,b){return a.x<b.x+b.width&&b.x<a.x+a.width&&a.y<b.y+b.height&&b.y<a.y+a.height},pointInRect:function(a,b){return a.x>b.x&&a.y>b.y&&a.x<b.x+b.width&&a.y<b.y+b.height},pointInCircle:function(a,b,c,d,e){var f=Math.pow(a-c,2)+Math.pow(b-d,2);return f<Math.pow(e,2)},pointDistance:function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},round:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}};return a}),define("djinn/utils/array",["djinn/math/core"],function(a){var b={isArray:function(a){return a?typeof a.unshift=="function":!1},force:function(a){return b.isArray(a)?a:[a]},contains:function(a,b){return a.indexOf(b)!==-1},containsAny:function(a,c){for(var d=0,e=c.length;d<e;++d)if(b.contains(a,c[d]))return!0;return!1},removeValue:function(a,b){var c=a.indexOf(b);if(c===-1)return;a.splice(c,1)},addItems:function(a,b,c){for(var d=0,e=b.length;d<e;++d){var f=b[d];if(c&&a.indexOf(f)!==-1)continue;a.push(f)}},pushOnce:function(a,b){if(a.indexOf(b)!==-1)return;a.push(b)},pickRandom:function(b){var c=a.random(0,b.length-1);return b[c]},popRandom:function(b){var c=a.random(0,b.length-1),d=b[c];return b.splice(c,1),d},merge:function(a,b,c){var d=[];while(a.length>0&&b.length>0)c(a[0],b[0])<=0?d.push(a.shift()):d.push(b.shift());return d.concat(a,b)},sort:function(a,c){var d=a.length;if(d<2)return a;var e=Math.ceil(d/2);return b.merge(b.sort(a.slice(0,e),c),b.sort(a.slice(e),c),c)},shuffle:function(a){var b=a.length;if(b<1)return;while(--b){var c=Math.floor(Math.random()*(b+1)),d=a[c];a[c]=a[b],a[b]=d}return a},max:function(a){var b=a[0]||0;for(var c=0,d=a.length;c<d;++c)b=Math.max(a[c],b);return b}};return b}),define("djinn/utils/buttons",{dPadUp:12,dPadDown:13,dPadLeft:14,dPadRight:15,face1:0,face2:1,face3:2,face4:3,shoulderTopLeft:4,shoulderTopRight:5,shoulderBottomLeft:6,shoulderBottomRight:7,select:8,start:9,analogLeft:10,analogRight:11}),define("djinn/Class",[],function(){uidSeed=0;var a=!1,b=/\b_super\b/,c=function(){};return c.uid=0,c.extend=function(c){var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];var g=function(){!a&&this.init&&this.init.apply(this,arguments)};return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g.uid=String(++uidSeed),g},c}),define("djinn/Emitter",["djinn/Class"],function(a){return a.extend({init:function(a){var a=a||{};this._listenerKey=0,this._listeners={}},fire:function(a,b){for(var c in this._listeners){var d=this._listeners[c];if(d.eventName==a)if(d.method)d.method.apply(d.context,b);else if(d.methodName){var e=d.context[d.methodName];if(typeof e!="function")throw"Could not find method: "+d.methodName;e.apply(d.context,b)}}},on:function(a){var b={eventName:a};if(arguments.length==2)b.method=arguments[1];else{b.context=arguments[1];var c=arguments[2];typeof c=="string"?b.methodName=c:b.method=c}return this._listeners[++this._listenerKey]=b,this},removeListeners:function(){for(var a in this._listeners)delete this._listeners[a];this._listeners={}},removeListenersByContext:function(a){for(var b in this._listeners){var c=this._listeners[b];c.context===a&&delete this._listeners[b]}},off:function(a){var b=null;for(var c in this._listeners){var d=this._listeners[c];if(d.eventName==a)if(arguments.length==2){if(d.method==arguments[1]){b=c;break}}else{var e=arguments[1];if(e==d.context){var f=arguments[2];if(typeof f=="string"){if(f==d.methodName){b=c;break}}else{d.method=f;if(f==d.method){b=c;break}}}}}return b!==null&&delete this._listeners[b],this},remove:function(){this._listeners=null}})}),define("djinn/keyboard",["djinn/Emitter","djinn/utils/keys","djinn/utils/array"],function(a,b,c){var d=a.extend({init:function(a){this._super(a),this._capture=[],this.keys=b,this._keysDown={},this._keyHistory=[],this._lastKeysDown={},this._shiftDown=!1,window.addEventListener("keydown",bind(this,"_handleKeyEvent"),!1),window.addEventListener("keyup",bind(this,"_handleKeyEvent"),!1)},capture:function(a){var b=this._capture;a.forEach(function(a){if(b.indexOf(a)!==-1)return;b.push(a)})},endFrame:function(){this._lastKeysDown={};for(var a in this._keysDown)this._lastKeysDown[a]=this._keysDown[a]},checkHistory:function(a){var b=a.length,c=this._keyHistory.slice(-b);if(c.length!=b)return!1;for(var d=0;d<b;d++)if(a[d]!==c[d])return!1;return!0},clearHistory:function(){this._keyHistory=[]},isDown:function(a,b){c.isArray(a)||(a=[a]);for(var d=0,e=a.length;d<e;++d)if(this._keysDown[a[d]])if(b!==!0||this._lastKeysDown[a[d]]!==!0)return!0;return!1},isShiftDown:function(){return this._shiftDown},isAnyDown:function(){for(var a in this._keysDown)return!0;return!1},_handleKeyEvent:function(a){this._capture.indexOf(a.keyCode)!==-1&&a.preventDefault(),a.type==="keydown"?(this._keysDown[a.keyCode]=!0,this._keyHistory.push(a.keyCode),this._keyHistory.length>50&&this._keyHistory.shift()):a.type==="keyup"&&delete this._keysDown[a.keyCode],this._shiftDown=a.shiftKey}});return new d}),define("djinn/gamepad",["djinn/Emitter","djinn/utils/buttons"],function(a,b){var c=.75,d=.06,e=.2,f=.2,g={up:function(a,b){return a.axes[1]<-b},down:function(a,b){return a.axes[1]>b},left:function(a,b){return a.axes[0]<-b},right:function(a,b){return a.axes[0]>b}},h=function(a){var b=navigator.getGamepads||navigator.webkitGetGamepads;if(!b)return null;var c=b.call(navigator),d=c[a||0];return d},i=a.extend({init:function(a){this._super(a),this.buttons=b,this.threshold=c,this._buttonsDown={},this._lastButtonsDown={}},exists:function(){return!!h()},endFrame:function(){this._lastButtonsDown={};for(var a in this._buttonsDown)this._lastButtonsDown[a]=this._buttonsDown[a]},getAnalogData:function(a){var b={x:0,y:0,magnitude:0,magnitudeNormal:0},c=h();if(!c)return b;var g=c.axes,i=a==="left",j=i?e:f,k=i?g[0]:g[2],l=i?g[1]:g[3];Math.abs(k)<d&&(k=0),Math.abs(l)<d&&(l=0);var m=Math.sqrt(k*k+l*l),n=k/m,o=l/m;if(m>j){m=Math.min(m,1),m-=j;var p=m/(1-j);b.x=k,b.y=l,b.xNormal=n,b.yNormal=o,b.magnitude=m,b.magnitudeNormal=p}return b},isButtonDown:function(a,b){var c=h();if(!c)return!1;var d=c.buttons[a]>this.threshold,e=d;return b&&(e=d&&!this._buttonsDown[a]),this._buttonsDown[a]=d,e},isDirectionDown:function(a,b){var c=h();return c?g[a](c,this.threshold):!1}});return new i}),define("djinn/globalTimer",["djinn/Emitter"],function(a){var b=1e3,c=120,d=a.extend({init:function(a){this._super(a),this.running=!1,this.fps=0,this.deltaTime=0,this.deltaTimeAverage=0,this.tickCount=0,this._lastUpdate=0,this._tickHistory=[]},start:function(){this.running=!0,this._lastUpdate=Date.now(),this._requestFrame()},stop:function(){this.running=!1},_requestFrame:function(){this.running&&requestAnimationFrame(bind(this,"_update"))},_update:function(a){++this.tickCount;var c=a-this._lastUpdate;c>b?(logger.warn("[globalTimer] dropping large tick: ",c),c=1):c<0&&(logger.warn("[globalTimer] negative delta: ",c),c=1),this._recordTick(c),this.deltaTime=c,this.fire("tick",[c]),this._lastUpdate=a,this._requestFrame()},_recordTick:function(a){var b=this._tickHistory.push(a);if(b>c){var d=0;for(var e=0;e<b;++e)d+=this._tickHistory[e];this.deltaTimeAverage=d/b,this.fps=~~(1e3/this.deltaTimeAverage),this._tickHistory=[]}}});return new d}),define("djinn/client",["djinn/Emitter","djinn/manifest"],function(a,b){var c=a.extend({init:function(a){this._super(a),this.debug=!1,this._detectEnvironment(),this._updateSize();if(this.isTouch){var b=bind(this,function(a){a.preventDefault(),this._hideAddressBar()}),c=["touchstart","touchmove","touchend"];for(var d=0,e=c.length;d<e;++d)addEventListener(c[d],b,!1)}var f=bind(this,"_updateSize");window.addEventListener("resize",f,!1),window.addEventListener("orientationchange",f,!1),window.addEventListener("load",bind(this,"_onLoad"),!1)},vibrate:function(a){if(!navigator.vibrate)return;navigator.vibrate(a)},_detectEnvironment:function(){var a=this.userAgent=navigator.userAgent;this.pixelRatio=window.devicePixelRatio||1,this.isBrowser=document&&typeof document.querySelectorAll=="function"&&!this.isCocoonJS,this.isTouch=typeof window.ontouchstart!="undefined"||!this.isBrowser,this.isFullScreen=window.navigator.standalone===!0,this.isIPhone=/iPhone OS/.test(a),this.isIPad=/iPad/.test(a),this.isIOS=this.isIPhone||this.isIPad,this.isAndroid=/Android/.test(a),this.debug&&(logger.info("[client._detectEnvironment] Debugging info:"),logger.info("User Agent: "+this.userAgent),logger.info("Device: "+this.deviceType),logger.info("Pixel Ratio: "+this.pixelRatio))},_queryWindowSize:function(){var a=window.innerWidth,b=window.innerHeight;if(this.isTouch&&(this.isAndroid||this.isIPhone)){if(this.isIPhone){var c=[90,-90].indexOf(window.orientation)!==-1;a=c?screen.height:screen.width,b=c?screen.width:screen.height,b-=20,this.isFullScreen||(b-=c?32:44)}this._hideAddressBar()}return{width:Math.floor(a),height:Math.floor(b)}},_updateSize:function(){var a=this._queryWindowSize();if(a.width!==this.width||a.height!==this.height)this.width=a.width,this.height=a.height,this.debug&&logger.info(sprintf("[client._updateSize] %sx%s",width,height)),this.fire("resize",[this.width,this.height,this.orientation]),this._hideAddressBar()},_onLoad:function(){this._hideAddressBar(),this.isAndroid&&setInterval(bind(this,"_updateSize"),500)},_hideAddressBar:function(){if(!this.isTouch)return;setTimeout(function(){window.scrollTo(0,1)},10)}});return Object.defineProperty(c.prototype,"orientation",{get:function(){var a=this.width>=this.height?"landscape":"portrait";return isNaN(window.orientation)&&b.orientation!=="both"?b.orientation:a}}),Object.defineProperty(c.prototype,"deviceType",{get:function(){return this.isAndroid?"Android":this.isIPhone?"iPhone":this.isIPad?"iPad":"Unknown"}}),Object.defineProperty(c.prototype,"isCocoonJS",{get:function(){return navigator.isCocoonJS}}),new c}),define("djinn/utils/request",[],function(){var a={};return location.href.replace(/[?&]+([^=&]+)=([^&#]*)/gi,function(b,c,d){a[c]=d}),{params:a}}),define("djinn/stage",["djinn/Emitter","djinn/client","djinn/math/core","djinn/manifest","djinn/utils/request"],function(a,b,c,d,e){var f=null,g=null,h=1,i=[],j=!1,k=["touchstart","touchmove","touchend"],l=["mousedown","mousemove","mouseup"],m=a.extend({init:function(a){this._super(a),this.eraseBeforeRender=!1,this._maxScale=Infinity,this.xInput=0,this.yInput=0,this.inputDown=!1,this.viewportWidth=0,this.viewportHeight=0,f=document.createElement("canvas"),f.width=b.width,f.height=b.height,b.isBrowser&&(f.style.position="absolute",f.style.left=0,f.style.top=0),this._initInput();var c=document.body;if(b.isBrowser){var e=document.getElementById(d.gameContainer);c=e||c}c.appendChild(f),b._hideAddressBar(),g=f.getContext("2d"),b.on("resize",this,"_autoSize")},matchSize:function(a){if(!a||a.length===0){logger.warn("[stage] sizes needs to be set in manifest",a);return}var c=null,d=Infinity,g=0,h=e.params.hd==="1",i=Math.min(b.width,b.height),j=Math.max(b.width,b.height);for(var k=0,l=a.length;k<l;++k){var m=a[k],n=Math.min(m[0],m[1]),o=Math.max(m[0],m[1]);if(h)o>g&&(c=[n,o],g=o,this.sizeIndex=k);else{var p=Math.abs(n*o-i*j);p<d&&(c=[n,o],d=p,this.sizeIndex=k)}}f.width=c[0],f.height=c[1],this._autoSize()},localizePoint:function(a,b){return{x:Math.round((a-f.offsetLeft)*(1/h)),y:Math.round((b-f.offsetTop)*(1/h))}},renderView:function(a){this.eraseBeforeRender&&g.clearRect(0,0,f.width,f.height),a.preRender(g)},createBuffer:function(a,b){var c=document.createElement("canvas");return c.width=Number(a),c.height=Number(b),c.style.display="none",c},getInputEvents:function(){var a=i;return i=[],a},requestFullScreen:function(){document.body.webkitRequestFullScreen()},cancelFullScreen:function(){document.webkitCancelFullScreen()},toggleFullScreen:function(){if(!this.canFullScreen)return;this.isFullScreen?this.cancelFullScreen():this.requestFullScreen()},setViewport:function(a,b){this.viewportWidth=a,this.viewportHeight=b,this._autoSize()},_getEventType:function(a){switch(a.type){case"touchstart":case"mousedown":return"inputStart";case"touchmove":case"mousemove":return"inputMove";case"touchend":case"mouseup":return"inputEnd"}},_handleInputEvent:function(a){var c=-1,d=0,e=0;if(b.isTouch){var f=a.type==="touchend"?a.changedTouches[0]:a.touches[0];c=f.identifier,d=f.pageX,e=f.pageY}else d=a.pageX,e=a.pageY;var g={id:c,type:this._getEventType(a),point:this.localizePoint(d,e)};this.xInput=g.point.x,this.yInput=g.point.y,this.inputDown=g.type!=="inputEnd",i.push(g),this.fire(g.type,[g]),!j&&this.fire("initialInput"),j=!0},_initInput:function(){var a=b.isTouch?k:l;for(var c=0,d=a.length;c<d;++c)f.addEventListener(a[c],bind(this,"_handleInputEvent"),!1)},_autoSize:function(){var a=Math.min(f.width,f.height),d=Math.max(f.width,f.height);f.width=b.orientation=="portrait"?a:d,f.height=b.orientation=="portrait"?d:a;var g=this.viewportWidth||b.width,i=this.viewportHeight||b.height;h=Math.min(g/f.width,i/f.height),h=c.clamp(h,0,this.maxScale),b.isBrowser||(h=1,f.style.cssText="idtkscale:ScaleAspectFit;"),e.params.scale&&(h=Number(e.params.scale)),logger.info(sprintf("[stage._autoSize] %sx%s (%s, %s)",f.width,f.height,f.offsetLeft,f.offsetTop));var j="0 0";if(b.isIOS)var k="scale3d("+h+", "+h+", 1)";else var k="scale("+h+")";if(b.isBrowser){var l=f.style;l.transformOrigin=j,l.transform=k;var m=["webkit","Moz","ms"];for(var n=0,o=m.length;n<o;++n){var p=m[n];l[p+"TransformOrigin"]=j,l[p+"Transform"]=k}l.left=b.width/2-f.width*h/2+"px",l.top=b.height/2-f.height*h/2+"px"}this.fire("resize")}});return Object.defineProperty(m.prototype,"canFullScreen",{get:function(){return typeof document.webkitCancelFullScreen=="function"}}),Object.defineProperty(m.prototype,"canvas",{get:function(){return f}}),Object.defineProperty(m.prototype,"context",{get:function(){return g}}),Object.defineProperty(m.prototype,"scale",{get:function(){return h}}),Object.defineProperty(m.prototype,"isFullScreen",{get:function(){return document.webkitIsFullScreen}}),Object.defineProperty(m.prototype,"maxScale",{get:function(){return this._maxScale},set:function(a){this._maxScale=a,this._autoSize()}}),Object.defineProperty(m.prototype,"width",{get:function(){return f.width}}),Object.defineProperty(m.prototype,"height",{get:function(){return f.height}}),Object.defineProperty(m.prototype,"scaleWidth",{get:function(){return f.width*h}}),Object.defineProperty(m.prototype,"scaleHeight",{get:function(){return f.height*h}}),new m}),define("djinn/utils/transitions",[],function(){var a={linear:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},inStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},outStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},bothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*.3);if(!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b},elasticOut:function(a,b,c,d,e,f){if(a==0)return b;if((a/=d)==1)return b+c;f||(f=d*.3);if(!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b},elasticBoth:function(a,b,c,d,e,f){if(a==0)return b;if((a/=d/2)==2)return b+c;f||(f=d*.3*1.5);if(!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return a<1?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b},backIn:function(a,b,c,d,e){return e===undefined&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},backOut:function(a,b,c,d,e){return e===undefined&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return e===undefined&&(e=1.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(b,c,d,e){return d-a.bounceOut(e-b,0,d,e)+c},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(b,c,d,e){return b<e/2?a.bounceIn(b*2,0,d,e)*.5+c:a.bounceOut(b*2-e,0,d,e)*.5+d*.5+c}};return a}),define("djinn/Timer",["djinn/Emitter","djinn/globalTimer"],function(a,b){var c=a.extend({init:function(a){this._super(),this._elapsed=0,this._loops=0,this._running=!1,this._tickHost=b,typeof a=="number"?this.interval=a:typeof a=="object"?(this.interval=Number(a.interval||1e3),this._tickHost=a.tickHost||this._tickHost):this.interval=1e3},reset:function(){return this.start()},start:function(a){return a!==undefined&&(this.interval=a),this._elapsed=0,this.resume()},resume:function(){return this._running||(this._tickHost.on("tick",this,"_update"),this._running=!0),this},stop:function(){return this._running&&(this._tickHost.off("tick",this,"_update"),this._running=!1),this},_update:function(a){this._elapsed+=a,this._elapsed>=this.interval&&(this._elapsed=0,++this._loops,this.fire("elapsed",[this._loops]))}});return Object.defineProperty(c.prototype,"elapsed",{get:function(){return this._elapsed}}),Object.defineProperty(c.prototype,"percentComplete",{get:function(){return this._elapsed/this.interval*100}}),Object.defineProperty(c.prototype,"running",{get:function(){return this._running},set:function(a){a?this.start():this.stop()}}),c}),define("djinn/utils/viewEffects",["djinn/math/core","djinn/utils/transitions"],function(a,b){return{alert:function(a,c,d){var c=c||{},e=a.z;a.z=Infinity,a.tween({scale:c.scale||1.5},(c.duration||500)/2,b.easeBoth,function(){c.midCallback&&c.midCallback()}).tween({scale:1},(c.duration||500)/2,b.easeBoth,function(){a.z=e,d&&d()})},burst:function(a,c,d){a.opacity=0,a.scale=.5,a.tween({opacity:1,rotation:Math.PI/2,scale:1.5},100,b.linear).tween({opacity:0},100,b.linear,function(){d&&d()})},buttonPress:function(a,c,d){a.tween({y:a.y+a.height/10},50,b.linear).tween({y:a.y},50,b.linear,d)},fadeOut:function(a,c,d){var c=c||{};a.tween({opacity:0},c.duration||1e3,b.linear,d)},fadeIn:function(a,c,d){var c=c||{};a.tween({opacity:1},c.duration||1e3,b.linear,d)},fadeInAndOut:function(a,b,c){var b=b||{},d=(b.duration||1e3)/2;a.completeTween({opacity:0,visible:!0}),a.tween({opacity:b.opacity||1},d).tween({opacity:0},d,null,c)},popIn:function(c,d,e){var d=d||{},f=a.random(1,2)==1?2:-2,g=a.clamp(c.x+c.width*f,0,c.parent.width-c.width),h=c.y;c.opacity=d.opacity||0,c.scale=d.scale||.5,c.y+=c.height/2,c.tween({opacity:1,scale:1,x:g,y:h},200,b.linear).tween({scale:1.25},50,b.linear).tween({scale:1},50,b.linear,e)},popOut:function(a,c,d){a.opacity=1,a.tween({scale:.75},50,b.linear).tween({opacity:0,scale:2},250,b.linear,d)},shake:function(a,b,c){a.completeTween();var b=b||{},d=b.iterations||10,e=(b.duration||250)/d,f=b.violence||6,g=a.x,h=a.y;for(var i=0;i<d;++i)a.tween({x:a.x+f*(i%2?1:-1)},e);a.delayTween(0,function(){a.x=g,a.y=h,c&&c()})},squishyAppear:function(a,c,d){var c=c||{},e=c.duration||500,f=c.scale||1;a.completeTween({scaleX:2*f,scaleY:0}),a.tween({scaleX:.5*f,scaleY:2*f},e*.3,b.linear).tween({scaleX:f,scaleY:f},e*.7,b.elasticOut,function(){d&&d()})},vibrate:function(b,c,d){b.completeTween();var c=c||{},e=c.iterations||10,f=(c.duration||250)/e,g=c.violence||6,h=b.x,i=b.y;for(var j=0;j<e;++j)b.tween({x:b.x+a.random(-g,g),y:b.y+a.random(-g,g)},f);b.delayTween(1,function(){b.x=h,b.y=i,d&&d()})}}}),define("djinn/XHR",[],function(){return function(a,b,c,d){var c=c||{},e="",f=new XMLHttpRequest;f.open(a,b,!0);if(a.toUpperCase()=="POST"){for(var g in d)if(typeof d[g]=="object"&&d[g].length)for(var h=0,i=d[g].length;h<i;++h)e+=sprintf("%s[]=%s&",g,encodeURIComponent(d[g][h]));else e+=sprintf("%s=%s&",g,encodeURIComponent(d[g]));f.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}else f.setRequestHeader("Content-Type","application/x-javascript");f.onreadystatechange=function(){f.readyState==4&&(c.complete&&c.complete(f),f.status==200?c.success&&c.success(f.responseText):c.error&&c.error(f.status))},f.send(e||null)}}),define("djinn/assets",["djinn/client","djinn/XHR","djinn/manifest"],function(a,b,c){var d={},e={image:["png","jpg","jpeg","gif"],audio:["mp3"],font:["ttf"],json:["json"]},f={image:function(b,d,e){var f=new Image;f.onload=function(){f.ready=!0,d&&d(b,f)},f.onerror=function(){e&&e(b,f)};if(a.isBrowser&&b.substring(0,5)!="data:")var b=b+"?v="+c.version;return f.src=b,f},audio:function(b,c){if(typeof Audio=="undefined")return logger.warn("[assets] No Audio object: "+b),c&&c(b,null),null;var d=new Audio;if(d.canPlayType("audio/ogg")!=="")b=b.replace(/\.mp3/,".ogg");else if(d.canPlayType("audio/mpeg")==="")return logger.warn("[assets] No audio support: "+b),c&&c(b,null),null;return a.isBrowser?(d.addEventListener("canplay",function(){if(d.ready)return;d.ready=!0,c&&c(b,d)},!1),d.src=b):(d.addEventListener("canplaythrough",function(){d.ready=!0,c&&c(b,d)}),d.src=b,d.load()),d},font:function(a,b){var c=/^.*\/([^\.]+)\.ttf$/.exec(a),d=c[1],e=sprintf("@font-face { font-family: '%s'; src: url('%s'); }",d,a),f=document.createElement("style");return f&&(f.innerHTML=e,document.body.appendChild(f)),b&&b(a,null),null},data:function(a,c){return b("GET",a,{complete:function(b){c&&c(a,b.responseText)}}),""},json:function(a,b){var c=function(a,c){var d=JSON.parse(c);b&&b(a,d)};return f.data(a,c),{}}},g={};return g.cacheImage=function(a,b){d[a]=f.image(b)},g.load=function(a,b,c){if(!a||a.length<1){c&&c(null,null,0,0,1),b&&b();return}typeof a=="string"&&(a=[a]);var e=a.length,h=0,i=function(a,f){d[a]=f,++h;var g=h/e;c&&c(a,f,h,e,g),h>=e&&b&&b()},j=function(a,b){logger.error("[assets.load] Failed to load asset: "+a),i(a,b)};for(var k=0,l=a.length;k<l;++k){var m=a[k];if(typeof m!="string"||m.length<=0)logger.info("[assets.load] Skipping empty asset path"),--e;if(d[m])i(m,d[m]);else{var n=g.inferAssetType(m),o=f[n];d[m]=o(m,i,j)}}},g.unload=function(a){typeof a=="string"&&(a=[a]);for(var b=0,c=a.length;b<c;++b)delete d[a[b]]},g.queryCache=function(a){return d[a]!==undefined},g.get=function(a){return g.queryCache(a)||(logger.warn("[assets.get] On-the-fly asset load: "+a),g.load(a)),d[a]},g.inferAssetType=function(a){var b=a.split("."),c=b.length>0?b.pop():"";for(var d in e)if(e[d].indexOf(c)!=-1)return d;return"data"},g}),define("djinn/View",["djinn/Emitter","djinn/utils/transitions","djinn/assets","djinn/math/core","djinn/Timer","djinn/stage","djinn/utils/array","djinn/globalTimer"],function(a,b,c,d,e,f,g,h){var i=0,j=function(a,b){return a.z===b.z?a.id-b.id:a.z-b.z},k=a.extend({init:function(a){var b=++i;a=merge(a,{id:b,tag:"View_"+b},k.defaults),a.parent&&(a.width=a.width||a.parent.width,a.height=a.height||a.parent.height),this._super(a),this.id=a.id,this.tag=a.tag,this.x=a.x,this.y=a.y,this._z=a.z,this.anchorX=a.anchorX||a.width/2,this.anchorY=a.anchorY||a.height/2,this.rotation=a.rotation,this.boundingBox=a.boundingBox,this.width=a.width,this.height=a.height,this.scale=a.scale,this.scaleX=a.scaleX,this.scaleY=a.scaleY,this.visible=a.visible,this.opacity=a.opacity,this.clip=a.clip,this.backgroundColor=a.backgroundColor,this.overlayColor=a.overlayColor,this.compositeOperation=a.compositeOperation,this._image=null,this.imageX=a.imageX,this.imageY=a.imageY,this.flipHorizontal=a.flipHorizontal,this.flipVertical=a.flipVertical,this._savedProperties={},this.acceptInputEvents=a.acceptInputEvents,this.captureInputEvents=a.captureInputEvents,this.cancelInputEvents=a.cancelInputEvents,this.paused=a.paused,this.tickSpeed=a.tickSpeed,this.debug=a.debug,this.children=[],this._removedChildren=[],this.needsResort=!1,this.needsReflow=!1,this.layouts=a.layouts,this._tweenQueue=[],this._lastSortTick=0,this.autoSort=a.autoSort,this.autoSortDelay=a.autoSortDelay,this.recyclable=a.recyclable,a.image&&(this.image=a.image),a.bottom!==undefined&&(this.bottom=a.bottom),a.right!==undefined&&(this.right=a.right),a.parent&&a.parent.addChild(this)},saveProperties:function(a,b){var c={};for(var d=0,e=b.length;d<e;++d){var f=b[d];c[f]=this[f]}return this._savedProperties[a]=c,this},loadProperties:function(a){var b=this._savedProperties[a];for(var a in b)this[a]=b[a];return this},getProperty:function(a,b){var c=this._savedProperties[a];return c[b]},set:function(a){for(var b in a)this[b]=a[b];return this},addChild:function(a){a.parent&&a.removeFromParent(),a.parent=this,this.children.push(a),this.needsResort=!0},removeChild:function(a){a.parent==this&&this._removedChildren.indexOf(a)==-1&&(a.parent=null,this._removedChildren.push(a))},getChildByTag:function(a){for(var b=0,c=this.children.length;b<c;++b){var d=this.children[b];if(d.tag==a)return d}return null},removeChildren:function(){for(var a=0,b=this.children.length;a<b;++a){var c=this.children[a];c.removeFromParent()}},removeFromParent:function(){this.parent&&this.parent.removeChild(this),this.fire("removedFromParent",[this])},destroy:function(){this.removeListeners(),this.cancelTween(),this.removeFromParent();var a=this.children;for(var b=0,c=a.length;b<c;++b){var d=a[b];d.destroy()}this.recyclable&&k.recycle(this)},sortChildren:function(){if(!this.autoSort)return;var a=h.tickCount;if(a-this._lastSortTick<this.autoSortDelay)return;this.children.sort(j),this.needsResort=!1,this._lastSortTick=a},reflow:function(){this.debug&&logger.info(this.tag+": Reflow");var a=this._getCurrentLayout();a!=null&&this.applyLayout(a);for(var b=0,c=this.children.length;b<c;++b)this.children[b].reflow();this.needsReflow=!1},applyLayout:function(a){this.set(a.conf),a.align&&this.align.apply(this,a.align);for(var b=0,c=this.children.length;b<c;++b){var d=this.children[b];a.children&&a.children[d.tag]&&d.applyLayout(a.children[d.tag])}},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},toggle:function(){this.visible?this.hide():this.show()},intersects:function(a){return a instanceof k?d.intersects(a.boundingBox,this.boundingBox):a.width?d.intersects(a,this.boundingBox):d.pointInRect(a,this.boundingBox)},createBoundTimer:function(a,b){var c=new e({interval:a,tickHost:this});return c.on("elapsed",this,b),c},react:function(a){if(!this.canReact)return;if(this.captureInputEvents){var b={x:a.point.x-this.x,y:a.point.y-this.y};for(var c=this.children.length-1;c>=0;--c){var d=this.children[c];if(d.canReact&&d.intersects(b)){a.point.x=b.x,a.point.y=b.y,d.react(a);if(a.cancel===!0)return}}a.target||(a.target=this),a.point.x=b.x,a.point.y=b.y,this.fire(a.type,[a]),a.type==="inputStart"?this._inputStartID=a.id:a.type==="inputEnd"&&this._inputStartID===a.id&&(this.fire("inputPress",[a]),delete this._inputStartID)}this.cancelInputEvents&&(a.cancel=!0)},preTick:function(a){if(this.paused||!this.visible)return;var a=a*this.tickSpeed;this._cullChildren(),this._updateTween(a),this.tick&&this.tick(a),this.fire("tick",[a]);var b=this.children;for(var c=0,d=b.length;c<d;++c)b[c].preTick(a)},preRender:function(a){if(!this.visible||this.opacity<=0)return;this.needsResort&&this.sortChildren(),this.needsReflow&&this.reflow();var b=~~this.x,c=~~this.y,d=~~this.anchorX,e=~~this.anchorY;a.save();var f=this.compositeOpacity;f!==1&&(a.globalAlpha=f),this.compositeOperation&&(a.globalCompositeOperation=this.compositeOperation),a.translate(b+d,c+e),this.rotation!=0&&a.rotate(this.rotation),this.scale!=1?a.scale(this.scale,this.scale):(this.scaleX!=1||this.scaleY!=1)&&a.scale(this.scaleX,this.scaleY);if(this.flipHorizontal||this.flipVertical){var g=this.flipHorizontal?-1:1,h=this.flipVertical?-1:1;a.scale(g,h)}a.translate(-d,-e),this.clip&&(a.beginPath(),a.rect(0,0,this.width,this.height),a.clip(),a.closePath()),this.render&&this.width>0&&this.height>0&&(this.render(a),this.debug&&this._renderDebug(a)),this.renderChildren(a),a.restore()},renderChildren:function(a){var b=this.children;for(var c=0,d=b.length;c<d;++c){var e=b[c];if(e.parent!==this)continue;e.preRender(a)}},render:function(a){var b=a;this.overlayColor&&(this._makeBuffer(),b=this._bufferContext),this._image&&this._image.ready?b.drawImage(this._image,this.imageX,this.imageY,this.width,this.height,0,0,this.width,this.height):this.backgroundColor&&(b.fillStyle=this.backgroundColor,b.fillRect(0,0,this.width,this.height)),this.overlayColor&&(b.globalCompositeOperation="source-atop",b.fillStyle=this.overlayColor,b.fillRect(0,0,this.width,this.height)),b!==a&&a.drawImage(this._bufferCanvas,0,0,this.width,this.height)},_makeBuffer:function(){if(this._bufferCanvas){this._bufferCanvas.width=this.width,this._bufferCanvas.height=this.height;return}this._bufferCanvas=f.createBuffer(this.width,this.height),this._bufferContext=this._bufferCanvas.getContext("2d")},align:function(a,b,c,d){if(!this.parent)return;if(a!==undefined&&a!==null){switch(a){case"left":this.x=0;break;case"right":this.right=this.parent.width;break;case"center":this.x=this.parent.width/2-this.width/2}this.x+=c||0}if(b!==undefined&&b!==null){switch(b){case"top":this.y=0;break;case"bottom":this.y=this.parent.height-this.height;break;case"center":this.y=this.parent.height/2-this.height/2}this.y+=d||0}return this},centerOn:function(a,b,c){typeof a=="number"&&logger.error("centerOn doesn't support numbers"),a.width=a.width||1,a.height=a.height||1;var d=a.x+a.width/2,e=a.y+a.height/2;return this.x=d-this.width/2+(b||0),this.y=e-this.height/2+(c||0),this},centerAnchor:function(){return this.anchorX=this.width/2,this.anchorY=this.height/2,this},tween:function(a,c,d,e){if(a!=null)for(var f in a){var g=a[f];typeof g!="object"&&(a[f]={from:null,to:g})}return this._tweenQueue.push({properties:a,duration:isNaN(c)?1e3:c,transition:d||b.linear,callback:e||null,elapsed:0}),this.visible||(logger.info(this.tag+": Auto-completing tween because this view is invisible"),this.completeTween()),this},delayTween:function(a,b){return this.tween(null,a,null,b)},cancelTween:function(a){return this._tweenQueue=[],a&&this.set(a),this},completeTween:function(a){var b=this._tweenQueue.length,c=this._tweenQueue.splice(0,b);for(var d=0;d<b;++d){var e=c[d];for(var f in e.properties)this[f]=e.properties[f].to;e.callback&&e.callback()}return a&&this.set(a),this},_updateTween:function(a){var b=this._tweenQueue,c=function(){var a=b.shift();a.callback&&a.callback()};while(a>0&&b.length>0){var d=b[0],e=d.duration-d.elapsed,f=Math.min(a,e);d.elapsed+=f,a-=f;if(d.properties===null){d.elapsed>=d.duration&&c();continue}var g=Math.ceil(d.duration/f),h=Math.floor(g*(d.elapsed/d.duration));if(h>=g||d.duration<=0){for(var i in d.properties)this[i]=d.properties[i].to;c()}else for(var i in d.properties){var j=d.properties[i];j.from==null&&(j.from=this[i]);var k=d.transition(h,j.from,j.to-j.from,g);this[i]=k}}},_cullChildren:function(){var a=this._removedChildren,b=a.length;if(b<1)return;var c=this.children;for(var d=0;d<b;++d){var e=a[d],f=c.indexOf(e);f!=-1?c.splice(f,1):logger.warn("Tried to remove non-child "+e.tag+" from "+this.tag)}a.splice(0,b)},_getCurrentLayout:function(){var a=f.width+"x"+f.height;return this._layouts&&this._layouts[a]?this._layouts[a]:null},_initLayouts:function(){if(this._layouts==null)return;var a=this._layouts.init,b=a?a.conf||{}:{},c=this._getCurrentLayout();c&&c.conf&&(b=merge(c.conf,b)),this.set(b);if(a&&a.children)for(var d in a.children){var e=a.children[d],f=e.conf||{},g=this._getCurrentLayout(),h=null;g!=null&&g.children&&g.children[d]&&(h=g.children[d],f=merge(h.conf,f));var i=e.ctor||k,j=new i(merge({parent:this,tag:d},f));h&&h.align&&j.align.apply(j,h.align)}this.reflow()},_renderDebug:function(a){a.lineWidth=1;var b=this.boundingBox,c=b.x-this.x,d=b.y-this.y;a.fillStyle="rgba(255, 0, 0, 0.15)",a.fillRect(c,d,b.width,b.height),a.strokeStyle="rgb(255, 0, 0)",a.strokeRect(c,d,b.width,b.height),a.strokeStyle="rgb(0, 0, 255)",a.strokeRect(0,0,this.width,this.height)}});k.transitions=b,Object.defineProperty(k.prototype,"right",{get:function(){return this.x+this.width},set:function(a){this.x=a-this.width}}),Object.defineProperty(k.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){this.y=a-this.height}}),Object.defineProperty(k.prototype,"z",{get:function(){return this._z},set:function(a){if(this._z===a)return;this._z=a,this.parent&&(this.parent.needsResort=!0)}}),Object.defineProperty(k.prototype,"image",{set:function(a){this._image=c.get(a)}}),Object.defineProperty(k.prototype,"center",{get:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}}}),Object.defineProperty(k.prototype,"boundingBox",{get:function(){var a=this._boundingBox;return a==null?{x:this.x,y:this.y,width:this.width,height:this.height}:{x:this.x+a.x,y:this.y+a.y,width:a.width,height:a.height}},set:function(a){this._boundingBox=a}}),Object.defineProperty(k.prototype,"compositeOpacity",{get:function(){var a=this.parent?this.parent.compositeOpacity:1;return this.opacity*a}}),Object.defineProperty(k.prototype,"layouts",{set:function(a){this._layouts=a,this._initLayouts()}}),Object.defineProperty(k.prototype,"canReact",{get:function(){return this.acceptInputEvents&&this.visible&&!this.paused}}),Object.defineProperty(k.prototype,"absolutePosition",{get:function(){var a=this.x,b=this.y,c=this;while(c.parent instanceof k)c=c.parent,a+=c.x,b+=c.y;return{x:a,y:b}}});var l={};return k.create=function(a,b){var c=a.uid,d=l[c];if(d&&d.length>0){var e=d.shift();return e.init(b),e}return new a(b)},k.recycle=function(a){var b=a.constructor.uid,c=l[b];c||(c=l[b]=[]),c.push(a)},k.defaults={parent:null,x:0,y:0,z:1,anchorX:null,anchorY:null,boundingBox:null,acceptInputEvents:!1,captureInputEvents:!0,cancelInputEvents:!1,debug:!1,layouts:null,rotation:0,recyclable:!1,clip:!1,width:0,height:0,scale:1,scaleX:1,scaleY:1,visible:!0,opacity:1,backgroundColor:null,overlayColor:null,compositeOperation:null,image:null,imageX:0,imageY:0,paused:!1,tickSpeed:1,flipHorizontal:!1,flipVertical:!1,autoSort:!0,autoSortDelay:1},k}),define("djinn/TextView",["djinn/View","djinn/client","djinn/stage"],function(a,b,c){var d=c.createBuffer(1,1),e=d.getContext("2d"),f=a.extend({init:function(a){a=merge(a,f.defaults),a.parent&&(!a.width||a.width<1)&&(a.width=a.parent.width);if(!a.height||a.height<1)a.height=a.fontSize;this._super(a),this._lineBuffer=null,this._rawText=null,this.color=a.color,this.fontSize=a.fontSize,this.fontFamily=a.fontFamily,this.shadowColor=a.shadowColor,this.shadowX=a.shadowX,this.shadowY=a.shadowY,this.strokeColor=a.strokeColor,this.strokeWidth=a.strokeWidth,this.textAlign=a.textAlign,this.verticalAlign=a.verticalAlign,this.text=a.text,this.wordWrap=a.wordWrap,this.autoWidth=a.autoWidth,this.autoWidthPadding=a.autoWidthPadding},render:function(a){this._super(a);if(this.text===undefined||this.text===null||this.text.length<1)return;this._lineBuffer==null&&this._bufferLines(this.text,a);var c=0,d=0;this.textAlign=="center"&&(c=this.width/2),this.textAlign=="right"&&(c=this.width),this.verticalAlign=="middle"&&(d=this.height/2),this._applyContextSettings(a);for(var e=0,f=this._lineBuffer.length;e<f;++e){var g=d+e*this.fontSize,h=this._lineBuffer[e];this.shadowColor&&(a.fillStyle=this.shadowColor,a.fillText(h,c+this.shadowX,g+this.shadowY)),(!b.isTouch||!b.isBrowser)&&this.strokeColor&&this.strokeWidth&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeText(h,c,g)),a.fillStyle=this.color,a.fillText(h,c,g)}},_applyContextSettings:function(a){var b=sprintf("%spx %s",this.fontSize,this.fontFamily);a.font=b,a.textAlign=this.textAlign,a.textBaseline=this.verticalAlign},_bufferLines:function(a,b){var a=String(a);this._lineBuffer=[];if(this.wordWrap){this._applyContextSettings(b);var c=a.split(" "),d=0;for(var e=0,f=c.length;e<f;++e){var g=this._lineBuffer[d]||"",h=g.length>0?g+" "+c[e]:c[e];g.length>0&&b.measureText(h).width>this.width?(++d,this._lineBuffer[d]=c[e]):this._lineBuffer[d]=h}}else this._lineBuffer.push(a)}});return Object.defineProperty(f.prototype,"text",{get:function(){return this._rawText},set:function(a){this._lineBuffer=null,this._rawText=a===undefined?null:String(a),this.autoWidth&&(this._applyContextSettings(e),this.width=e.measureText(this._rawText).width,this.width+=this.autoWidthPadding)}}),f.defaults={color:"rgb(0, 0, 0)",fontFamily:"Arial",fontSize:20,shadowColor:null,shadowX:1,shadowY:1,strokeColor:null,strokeWidth:null,text:"",textAlign:"left",verticalAlign:"top",wordWrap:!0,autoWidth:!1,autoWidthPadding:0},f}),define("djinn/helpers/RotateDeviceView",["djinn/View","djinn/TextView","djinn/manifest"],function(a,b,c){var d="%s works best in %s orientation. Please rotate your device.",e=a.extend({init:function(a){var a=merge(a,e.defaults);this._super(a),this._message=new b({parent:this,textAlign:"center",color:"white",fontSize:50,text:sprintf(d,c.title,c.orientation)}),this.reflow()},reflow:function(){this.set({width:this.parent.width,height:this.parent.height}),this._message.set({width:this.width}).align("center","center"),this._super()}});return e.defaults={backgroundColor:"black",visible:!1,z:Infinity},e}),define("djinn/ui/ProgressBar",["djinn/View"],function(a){return a.extend({init:function(a){var a=merge(a,{progress:0});this._super(a),this.progress=Number(a.progress)},render:function(a){this._super(a);var b=this.width*this.progress;a.fillStyle="rgb(100, 100, 100)",a.fillRect(0,0,b,this.height),a.lineWidth=2,a.strokeStyle="rgb(230, 230, 230)",a.strokeRect(0,0,this.width,this.height)}})}),define("djinn/helpers/LoadingScreen",["djinn/manifest","djinn/assets","djinn/View","djinn/TextView","djinn/ui/ProgressBar","djinn/utils/viewEffects","djinn/stage"],function(a,b,c,d,e,f,g){var h=merge(a.splash,{fadeDuration:1,displayDuration:0,backgroundColor:"rgb(0, 0, 0)",imageWidth:100,imageHeight:100});return c.extend({init:function(a){Object.defineProperty(this,"loadingProgress",{set:function(a){this._loadingBar.progress=a,this._loadingText.text="LOADING: "+~~(a*100)+"%"}});var a=merge({tag:"LoadingScreen",acceptInputEvents:!0,cancelInputEvents:!0,visible:!1,backgroundColor:h.backgroundColor,z:Infinity},a);this._super(a);if(h.images&&h.images.length>0){var f=h.images[g.sizeIndex];b.load(f.image),this._splashImage=(new c(merge({parent:this},f))).align("center","center")}var i=this.height*.05;this._loadingBar=(new e({parent:this,visible:!1,width:this.width*.8,height:i})).align("center","bottom",0,-i),this._loadingText=(new d({parent:this,visible:!1,text:"LOADING",textAlign:"center",verticalAlign:"middle",color:"rgb(255, 255, 255)",fontSize:~~(i*.75),height:i})).align("center","bottom",0,-i),this._uiDelayTimer=this.createBoundTimer(500,bind(this,"_onDelayElapsed")),this.on("inputStart",this,"_onInputStart")},show:function(a){this.set({opacity:0,visible:!0}),f.fadeIn(this,{duration:h.fadeDuration}),this.delayTween(h.displayDuration,function(){a&&a()}),this._uiDelayTimer.start()},hide:function(a){this.acceptInputEvents=!1,f.fadeOut(this,{duration:h.fadeDuration},bind(this,function(){this.visible=!1,a&&a()}))},_onDelayElapsed:function(){this._uiDelayTimer.stop(),this._loadingBar.progress<1&&(this._loadingText.visible=!0,this._loadingBar.visible=!0)},_onInputStart:function(a){this._onDelayElapsed(),this.completeTween()}})}),define("djinn/Collection",["djinn/utils/array","djinn/Emitter"],function(a,b){var c=b.extend({init:function(a){this._super(a),this.items=[],this._itemIDSeed=0,this._lookup={},this._length=0,this._indexPool=[]},add:function(a){typeof a.id=="undefined"&&(a.id=++this._itemIDSeed);if(this.has(a.id))return logger.warn("[Collection.add] Item ID conflict: "+a.id),null;if(this._indexPool.length>0){var b=this._indexPool.shift();this.items[b]=a}else{this._length=this.items.push(a);var b=this._length-1}return this._lookup[a.id]=b,this.fire("add",[a]),a.id},remove:function(a,b){var c=a.id||a,d=this._getIndex(c);if(!this._isValidIndex(d))return logger.warn("[Collection.remove] Tried to remove invalid item: "+c),null;var a=this.items[d];return this.items[d]=null,delete this._lookup[c],this._indexPool.push(d),b&&a.removeListeners&&a.removeListeners(),this.fire("remove",[a]),a},has:function(a){return this.get(a)!==null},get:function(a){var b=this._getIndex(a);if(isNaN(b)||b>=this._length)return null;var c=this.items[b]||null;return c},forEach:function(a,b){for(var c=0;c<this._length;++c){var d=this.items[c];if(d===null)continue;b?a.call(b,d,this):a(d,this)}},sort:function(){this.items.sort(function(a,b){return a?b?b.id-a.id:-1:1}),this._rebuild()},pickRandom:function(){return a.pickRandom(this.items)},removeAll:function(a){this.forEach(function(b,c){if(!b)return;this.remove(b.id,a)},this),this.items=[],this._lookup={},this._indexPool=[],this._length=0},_getIndex:function(a){return this._lookup[a]},_isValidIndex:function(a){return a>=0&&a<this._length},_rebuild:function(){this._lookup={},this._indexPool=[];for(var a=0,b=this.items.length;a<b;++a){var c=this.items[a];c?this._lookup[c.id]=a:this._indexPool.push(a)}}});return Object.defineProperty(c.prototype,"length",{get:function(){return this._length}}),c}),define("djinn/Scene",["djinn/View"],function(a){return a.extend({init:function(a){this._super(merge(a,{acceptInputEvents:!0,cancelInputEvents:!0,clip:!0,opacity:0,visible:!1})),this._isSetup=!1},setup:function(){logger.warn(sprintf("[%s] setup needs to be overwritten",this.id))},reset:function(){logger.warn(sprintf("[%s] reset needs to be overwritten",this.id))},activate:function(a){logger.warn(sprintf("[%s] activate needs to be overwritten",this.id))},deactivate:function(a){},cleanup:function(){},fireSceneEvent:function(a){var b={id:this.id,eventName:a};this.fire(a,[b])}})}),define("djinn/masks/SpotlightMaskView",["djinn/View","djinn/stage"],function(a,b){var c=["width","height","spotlightX","spotlightY","spotlightRadius"];return a.extend({init:function(a){var a=merge(a,{backgroundColor:"rgb(0, 0, 0)",spotlightX:0,spotlightY:0,spotlightRadius:100});this._super(a),this._buffer=b.createBuffer(this.width,this.height),this._bufferDirty=!0,this.spotlightX=Number(a.spotlightX),this.spotlightY=Number(a.spotlightY),this.spotlightRadius=Number(a.spotlightRadius),this._cachedProps={},b.on("resize",this,function(){this._bufferDirty=!0})},render:function(a){var b=this._buffer;if(b.width!==this.width||b.height!==this.height)b.width=this.width,b.height=this.height,this._bufferDirty=!0;if(!this._bufferDirty)for(var d=0,e=c.length;d<e;++d){var f=c[d];if(this._cachedProps[f]!=this[f]){this._bufferDirty=!0;break}}if(this._bufferDirty){var g=b.getContext("2d");g.save(),g.clearRect(0,0,this.width,this.height),g.fillStyle=this.backgroundColor,g.fillRect(0,0,this.width,this.height),g.globalCompositeOperation="destination-out",g.beginPath(),g.arc(this.spotlightX,this.spotlightY,this.spotlightRadius,0,Math.PI*2,!0),g.fill(),g.closePath(),g.restore();for(var d=0,e=c.length;d<e;++d){var f=c[d];this._cachedProps[f]=this[f]}this._bufferDirty=!1}a.drawImage(this._buffer,0,0,this.width,this.height)}})}),define("djinn/utils/sceneTransitions",["djinn/utils/transitions","djinn/masks/SpotlightMaskView"],function(a,b){var c=function(a,b){var b=merge(b,{visible:!0,opacity:1,scale:1,rotation:0,x:0,y:0});a.completeTween(b)},d=new b({backgroundColor:"black",visible:!1});return{zoomSpotlight:function(b,e,f){var g={duration:2e3};c(b),d.completeTween({width:b.width,height:b.height,visible:!0,z:Math.max(b.z,e.z)+1,opacity:0,spotlightX:b.width/2,spotlightY:b.height/2,spotlightRadius:0}),d.removeFromParent(),b.parent.addChild(d),b.tween({scale:2},g.duration),d.tween({opacity:1},g.duration,a.easeIn,function(){b.visible=!1,c(e),d.delayTween(500).tween({spotlightRadius:b.width},g.duration,a.easeIn,function(){d.visible=!1,d.removeFromParent(),f&&f()})})},spotlight:function(b,e,f){var g={duration:2e3};c(b),d.completeTween({width:b.width,height:b.height,visible:!0,spotlightX:b.width/2,spotlightY:b.height/2,spotlightRadius:b.width}),d.removeFromParent(),b.parent.addChild(d),d.tween({spotlightRadius:0},g.duration,a.easeIn,function(){b.visible=!1,c(e),d.delayTween(500).tween({spotlightRadius:b.width},g.duration,a.easeIn,function(){d.visible=!1,d.removeFromParent(),f&&f()})})},crossFade:function(a,b,d){c(a),c(b,{opacity:0}),a.tween({opacity:0},500,null,function(){a.visible=!1,d&&d()}),b.tween({opacity:1},500)},fade:function(a,b,d){c(a),c(b,{opacity:0}),a.tween({opacity:0},500,null,function(){a.visible=!1,b.tween({opacity:1},500,null,function(){d&&d()})})},slideUp:function(b,d,e){c(b),c(d,{y:d.parent.height}),b.tween({y:-b.height},500,a.easeIn,function(){b.visible=!1,e&&e()}),d.tween({y:0},500,a.easeIn)},slideDown:function(b,d,e){c(b),c(d,{bottom:0}),b.tween({y:b.height},500,a.easeIn,function(){b.visible=!1,e&&e()}),d.tween({y:0},500,a.easeIn)},slideLeft:function(b,d,e){c(b),c(d,{x:d.width}),b.tween({right:0},500,a.easeIn,function(){b.visible=!1,e&&e()}),d.tween({x:0},500,a.easeIn)},slideRight:function(b,d,e){c(b),c(d,{right:0}),b.tween({x:b.width},500,a.easeIn,function(){b.visible=!1,e&&e()}),d.tween({x:0},500,a.easeIn)},rotateIn:function(a,b,d){c(b,{scale:0,rotation:Math.PI}),b.tween({scale:1,rotation:0},1e3,null,function(){a.visible=!1,d&&d()})},none:function(a,b,d){c(b,{visible:!0}),a.visible=!1,d&&d()}}}),define("djinn/SceneDirector",["require","exports","module","djinn/Emitter","djinn/Collection","djinn/Scene","djinn/utils/sceneTransitions"],function(a,b,c){var d=a("djinn/Emitter"),e=a("djinn/Collection"),f=a("djinn/Scene"),g=a("djinn/utils/sceneTransitions"),b=c.exports=d.extend({init:function(a){this._super(a),this.backgroundColor=a.backgroundColor||"black",this.view=a.view},setup:function(a){this._data=a},load:function(){this._activeSceneId=null,this.scenes=new e,this._defaultScene=new f({parent:this.view,backgroundColor:this.backgroundColor,visible:!1});var a=this._data;for(var b in a){var c=a[b],d=new c.ctor({parent:this.view,id:b});for(var g in c.events)d.on(g,this,"_onSceneEvent");this.scenes.add(d)}},ready:function(){},activateScene:function(a,b){var c=this._activeSceneId,d=this.scenes.get(this._activeSceneId)||this._defaultScene,e=this.scenes.get(a);this._activeSceneId=a,e.isSetup||(e.setup(),e.isSetup=!0),e.reset(c);var b=g[b||"fade"];this.view.backgroundColor=this.backgroundColor,d&&(d.captureInputEvents=!1,d.deactivate(this._activeSceneId)),e.captureInputEvents=!1,b(d,e,bind(this,function(){this.view.backgroundColor=null,d.cleanup(a),e.activate(c)}))},_onSceneEvent:function(a){var b=this._data[a.id].events[a.eventName];this.activateScene(b.id,b.transition)}});Object.defineProperty(b.prototype,"activeSceneId",{get:function(){return this._activeSceneId}}),Object.defineProperty(b.prototype,"activeScene",{get:function(){return this.scenes.get(this._activeSceneId)}})}),define("djinn/metrics/googleAnalytics",[],function(){var a=window._gaq=window._gaq||[];return{id:"google",init:function(b){a.push(["_setAccount",b.account]),a.push(["_trackPageview"])},event:function(b){a.push(["_trackEvent",b,"defaultAction"])}}}),define("djinn/metrics/mixpanel",{id:"mixpanel",init:function(a){if(!window.mixpanel){logger.warn("Mixpanel library not found");return}mixpanel.init(a.account)},event:function(a){if(!window.mixpanel){logger.warn("Mixpanel library not found");return}mixpanel.track(a)}}),define("djinn/metrics/tracker",["djinn/manifest","djinn/utils/array","./googleAnalytics","./mixpanel"],function(a,b,c,d){var e=merge(a.metrics,{enabled:!1}),f=[c,d],g=function(){for(var a=0,b=f.length;a<b;++a){var c=f[a],d=e[c.id];if(!d)continue;c.enabled=!0,c.init&&c.init(d)}};return e.enabled&&g(),{event:function(a){if(!e.enabled)return;for(var b=0,c=f.length;b<c;++b){var d=f[b];if(!d.enabled)continue;d.event&&d.event(a)}}}}),define("djinn/Game",["djinn/keyboard","djinn/gamepad","djinn/Emitter","djinn/globalTimer","djinn/client","djinn/stage","djinn/View","djinn/TextView","djinn/helpers/RotateDeviceView","djinn/helpers/LoadingScreen","djinn/manifest","djinn/assets","djinn/SceneDirector","djinn/metrics/tracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){return c.extend({init:function(a){var a=merge(a,{showLoadingScreen:!1});this._super(a),this.showLoadingScreen=a.showLoadingScreen,this._splashFinished=!1,this._loadingProgress=0,this.view=new g({tag:"GameRootView",acceptInputEvents:!0,width:f.width,height:f.height}),f.on("resize",this,"_onStageResize"),k.orientation!=="both"&&(this._rotateDeviceView=new i({parent:this.view}),e.on("resize",this,"_onClientResize")),this._loadingScreen=new j({parent:this.view,visible:!1}),this._sceneDirector=new m({view:this.view})},run:function(){d.on("tick",this,"_update"),d.start(),this.showLoadingScreen?(f.eraseBeforeRender=!0,this._loadingScreen.show(bind(this,"_onSplashFinish"))):this._onClientResize()},stop:function(){d.stop(),d.off("tick",this)},setupScenes:function(a){this._sceneDirector.setup(a)},getSceneById:function(a){return this._sceneDirector.scenes.get(a)},getActiveSceneId:function(){return this._sceneDirector.activeSceneId},getActiveScene:function(){return this._sceneDirector.activeScene},activateScene:function(a,b){this._sceneDirector.activateScene(a,b)},preloadAssets:function(a){l.load(a,bind(this,"_onLoadComplete"),bind(this,"_onLoadProgress"))},_onLoadProgress:function(a,b,c,d,e){this._loadingProgress=e,this._loadingScreen.loadingProgress=this._loadingProgress,this._checkGameReady()},_onLoadComplete:function(){n.event("gameLoad"),this._sceneDirector.load(),this.fire("load")},_update:function(c){this._react(),this.update&&this.update(c),this.view.preTick(c),this._render(),a.endFrame(),b.endFrame()},_react:function(){var a=f.getInputEvents(),b=a.length;for(var c=0;c<b;++c)this.view.react(a[c])},_render:function(){f.renderView(this.view)},_onClientResize:function(){if(!this._rotateDeviceView)return;k.orientation!==e.orientation?this._rotateDeviceView.show():this._rotateDeviceView.hide()},_onStageResize:function(){this.view.width=f.width,this.view.height=f.height,this.view.reflow()},_onSplashFinish:function(){this._splashFinished=!0,this._checkGameReady()},_checkGameReady:function(){this._splashFinished&&this._loadingProgress===1&&(this._onClientResize(),this._loadingScreen.hide(bind(this,function(){f.eraseBeforeRender=!1,this._sceneDirector.ready(),this.fire("ready")})))}})}),define("djinn/ui/Button",["djinn/View","djinn/TextView","djinn/utils/transitions","djinn/utils/viewEffects"],function(a,b,c,d){var e=a.extend({init:function(a){var a=merge(a,e.defaults);this._super(a),this._enabled=Boolean(a.enabled),this.textView=(new b(merge({parent:this,text:a.text},a.textConf||{},e.textDefaults))).align("center","center"),this.on("inputStart",this,"_onInputStart"),this.update()},_onInputStart:function(a){return!this._enabled||this._pressing===!0?(logger.log("[Button] This button is not enabled or already being pressed"),!1):(this._pressing=!0,d.buttonPress(this,{},bind(this,function(){this.fire("buttonPress",[a]),this._pressing=!1})),!0)},update:function(){}});return Object.defineProperty(e.prototype,"text",{set:function(a){this.textView.text=a}}),Object.defineProperty(e.prototype,"textConf",{set:function(a){this.textView.set(a)}}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a,this.update(),this.fire("change:enabled",[a])}}),e.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:"rgb(190, 190, 190)",width:200,height:40,enabled:!0},e.textDefaults={text:"",color:"rgb(0, 0, 0)",fontSize:30,textAlign:"center",verticalAlign:"middle"},e}),define("js/view/scenes/TitleScene",["require","exports","module","djinn/Scene","djinn/TextView","djinn/ui/Button"],function(a,b,c){var d=a("djinn/Scene"),e=a("djinn/TextView"),f=a("djinn/ui/Button"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a)},setup:function(){this._title=(new e({parent:this,text:"SHIV",fontSize:40,color:"white",textAlign:"center"})).align("center","top",0,20),this._play=(new f({parent:this,text:"Play"})).align("center","center"),this._play.on("buttonPress",this,"_onPlay")},reset:function(){},activate:function(){this.captureInputEvents=!0},deactivate:function(){},cleanup:function(){},_onPlay:function(){this.fireSceneEvent("play")}});b.defaults={backgroundColor:"green"}}),define("djinn/math/Vector2",["djinn/Class"],function(a){var b=a.extend({init:function(a){return a===undefined&&(a={x:0,y:0}),typeof a=="number"?(this.x=Number(a),this.y=Number(arguments[1])):a.angle===undefined?(this.x=Number(a.x||0),this.y=Number(a.y||0)):(this.x=a.magnitude*Math.cos(a.angle),this.y=a.magnitude*Math.sin(a.angle)),this},add:function(a){return this.x+=a.x,this.y+=a.y,this},clone:function(){return new this.constructor({x:this.x,y:this.y})},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},getUnitVector:function(){return new b({angle:this.angle,magnitude:1})},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},distance:function(a){return b.distance(this,a)},minus:function(a){return new b({x:this.x-a.x,y:this.y-a.y})},normalize:function(){var a=this.magnitude();return a===0?this:this.scale(1/a)},scale:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return this.x/=a,this.y/=a,this},subtract:function(a){return this.x-=a.x,this.y-=a.y,this},toAngle:function(){return this.heading*(180/Math.PI)}});return Object.defineProperty(b.prototype,"angle",{get:function(){return Math.atan2(this.y,this.x)}}),Object.defineProperty(b.prototype,"heading",{get:function(){return Math.atan2(this.x,-this.y)}}),b.makeFromHeading=function(a,c){var c=Number(c)||1;return new b({x:Math.sin(a)*c,y:-Math.cos(a)*c})},b.magnitude=function(a,b){return Math.sqrt(a*a+b*b)},b.distance=function(a,c){var d=b.subtract(c,a);return b.magnitude(d.x,d.y)},b.subtract=function(a,c){return new b(a.x-c.x,a.y-c.y)},b}),define("djinn/math/QuadTree",["djinn/Class","djinn/math/core","djinn/utils/array"],function(a,b,c){var d=[],e={parent:-1,topLeft:0,topRight:1,bottomLeft:2,bottomRight:3},f=function(a){if(d.length>0){var b=d.pop();return b.set(a),b}return new g(a)},g=a.extend({init:function(a){var a=merge(a,{x:0,y:0,width:0,height:0,depth:0,maxChildren:2,maxDepth:4});this._nodes=[],this._children=[],this.set(a)},set:function(a){for(var b in a)this[b]=a[b]},insert:function(a){var b=this._nodes,c=this._children;if(b.length>0){var d=this._findInsertNode(a);d===e.parent?c.push(a):b[d].insert(a)}else c.push(a),c.length>this.maxChildren&&this.depth<this.maxDepth&&this.divide()},retrieve:function(a){var b=[],c=this._children;for(var d=0,e=c.length;d<e;++d)b.push(c[d]);if(this._nodes.length>0){var f=this._findIntersectNodes(a);for(var d=0,e=f.length;d<e;++d)b=b.concat(f[d].retrieve(a))}return b},divide:function(){var a=~~(this.width/2),b=~~(this.height/2),c=this._children;this._addNode(this.x,this.y,a,b),this._addNode(this.x+a,this.y,a,b),this._addNode(this.x,this.y+b,a,b),this._addNode(this.x+a,this.y+b,a,b),this._children=[];for(var d=0,e=c.length;d<e;++d)this.insert(c[d])},clear:function(){var a=this._nodes;while(a.length>0){var b=a.pop();b.clear(),d.push(b)}this._children=[],this._nodes=[]},_addNode:function(a,b,c,d){this._nodes.push(f({x:a,y:b,width:c,height:d,depth:this.depth+1,maxChildren:this.maxChildren,maxDepth:this.maxDepth}))},_findInsertNode:function(a){var b=this.x+this.width/2,c=this.y+this.height/2;return a.x+a.width<b?a.y+a.height<c?e.topLeft:a.y>=c?e.bottomLeft:e.parent:a.x>=b?a.y+a.height<c?e.topRight:a.y>=c?e.bottomRight:e.parent:e.parent},_findIntersectNodes:function(a){var b=[],c=this._nodes,d=this.x+this.width/2,f=this.y+this.height/2;return a.x<d&&(a.y<f&&b.push(c[e.topLeft]),a.y+a.height>=f&&b.push(c[e.bottomLeft])),a.x+a.width>=d&&(a.y<f&&b.push(c[e.topRight]),a.y+a.height>=f&&b.push(c[e.bottomRight])),b}}),h=a.extend({init:function(a){this.rootNode=f(a)},insert:function(a){var b=this.rootNode;if(c.isArray(a))for(var d=0,e=a.length;d<e;++d)b.insert(a[d]);else b.insert(a)},retrieve:function(a){return this.rootNode.retrieve(a)},clear:function(){this.rootNode.clear()},resize:function(a,b){this.width=a,this.height=b}});return Object.defineProperty(h.prototype,"width",{get:function(){return this.rootNode.width},set:function(a){this.clear(),this.rootNode.width=a}}),Object.defineProperty(h.prototype,"height",{get:function(){return this.rootNode.height},set:function(a){this.clear(),this.rootNode.height=a}}),h}),define("djinn/sim/coreComponents",{size:{width:50,height:50},position:{x:0,y:0},velocity:{x:0,y:0},gravity:{value:.001},collision:{groups:[],targets:[]},health:{value:1,max:1}}),define("djinn/sim/Entity",["require","exports","module","../Emitter","../utils/array"],function(a,b,c){var d=a("../Emitter"),e=a("../utils/array");c.exports=d.extend({init:function(a,b){this._super(),this._componentKeys=[],this.id=null,this.type=a;for(var c in b)this.addComponent(c,b[c])},addComponent:function(a,b){this[a]=merge(b,this[a]),e.pushOnce(this._componentKeys,a),this.fire("componentAdd",[a])},removeComponent:function(a){delete this[a],e.removeValue(this._componentKeys,a),this.fire("componentRemove",[a])}})}),define("djinn/sim/shared/position",["require","exports","module"],function(a,b,c){b.getBounds=function(a){var b=a.position,c=a.size;return!b||!c?null:{x:b.x,y:b.y,width:c.width,height:c.height}},b.getCenter=function(a){var b=a.position,c=a.size;return!b||!c?null:{x:b.x+c.width/2,y:b.y+c.height/2}}}),define("djinn/sim/World",["require","exports","module","../Emitter","../globalTimer","../Collection","../math/core","../math/Vector2","../math/QuadTree","../utils/array","./coreComponents","./Entity","./shared/position"],function(a,b,c){var d=a("../Emitter"),e=a("../globalTimer"),f=a("../Collection"),g=a("../math/core"),h=a("../math/Vector2"),i=a("../math/QuadTree"),j=a("../utils/array"),k=a("./coreComponents"),l=a("./Entity"),m=a("./shared/position");c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.width=a.width,this.height=a.height,this.tickStep=a.tickStep,this._tickPool=0,this.running=!1,this.elapsed=0,this.systems=[],this.entities=new f,this.quadTree=new i,this._entityIdSeed=0,this._components={},this._prefabs={},this.defineComponents(k),this.reset()},start:function(){if(this.running)return;this.running=!0,e.on("tick",this,"_onTick")},stop:function(){if(!this.running)return;this._tickPool=0,this.running=!1,e.off("tick",this,"_onTick")},reset:function(){this.stop(),this.elapsed=0,this._tickPool=0,this.entities.removeAll(),this.quadTree.resize(this.width,this.height),this.callSystems("onReset"),this.fire("reset")},addSystems:function(a){a=j.force(a),a.forEach(function(a){var b=new a;b.host=this,this.systems.push(b),this._callSystem(b,"onAdd")},this)},callSystems:function(a,b){var c=this.systems;for(var d=0,e=c.length;d<e;++d){var f=this._callSystem(c[d],a,b);if(f===!0)break}},defineComponents:function(a){for(var b in a)this._components[b]=a[b]},getComponent:function(a){return this._components[a]},definePrefabs:function(a){for(var b in a){var c=a[b],d={};for(var e in c)d[e]=this.getComponent(e);this._prefabs[b]=merge(c,d)}},getPrefab:function(a,b){var c=this._prefabs;return c[a]?b?merge(b,c[a]):c[a]:(logger.error("[Simulation.getPrefab] Invalid prefab ID: "+a),null)},createEntity:function(a,b){var c=this.getPrefab(a,b);return new l(a,c)},spawnEntity:function(a){a.id=++this._entityIdSeed,this.entities.add(a),this.callSystems("onEntitySpawn",[a]),this.fire("entitySpawn",[a])},getEntity:function(a){return this.entities.get(a)},despawnEntity:function(a){this.entities.remove(a),this.callSystems("onEntityDespawn"),this.fire("entityDespawn",[a])},_callSystem:function(a,b,c){if(!a[b])return;return a[b].apply(a,c)},_onTick:function(a){this._tickPool+=a;var b=this.tickStep;while(this._tickPool>=b)this._tickPool-=b,this._update(b)},_update:function(a){var b=this.quadTree,c=this.entities;this.elapsed+=a,b.clear(),this.callSystems("onPreUpdate");for(var d=0,e=c.length;d<e;++d){var f=c.items[d];if(!f)continue;this.callSystems("onEntityUpdate",[f,a]);var g=m.getBounds(f);g.id=f.id,b.insert(g)}this.callSystems("onPostUpdate")}}),b.defaults={width:960,height:640,tickStep:16}}),define("djinn/utils/string",{parseNumber:function(a){return Number(a.replace(/([^0-9\.])/g,""))},formatNumber:function(a){var a=String(a),b=a.split("."),c=b[0],d=b.length>1?"."+b[1]:"",e=/(\d+)(\d{3})/;while(e.test(c))c=c.replace(e,"$1,$2");return c+d},formatTime:function(a){var b=~~(a/1e3)%60,c=~~(a/6e4)%60;return b<10&&(b="0"+b),sprintf("%s:%s",c,b)},ucfirst:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},hashCharCode:function(a){var b=0;if(a.length<1)return b;for(i=0,j=a.length;i<j;i++){var c=a.charCodeAt(i);b=(b<<5)-b+c,b|=0}return Math.abs(b)}}),define("djinn/math/PRNG",["require","exports","module","../utils/string","../utils/array"],function(a,b,c){var d=a("../utils/string"),e=a("../utils/array"),f=2147483648,g=1103515245,h=12345;c.exports=function(a){this.state=null,a&&this.seed(a)};var i=c.exports.prototype;i.seed=function(a){a?isNaN(a)&&(a=d.hashCharCode(String(a))):a=Math.floor(Math.random()*(f-1)),this.seedValue=a,this.state=a},i.normal=function(){return this.state===null?Math.random():(this.state=(g*this.state+h)%f,this.state/f)},i.integer=function(a){return Math.round(this.normal()*a)},i.range=function(a,b){return this.integer(b-a)+a},i.radians=function(a,b){var a=a||0,b=b||Math.PI*2,c=b-a;return a+c*this.normal()},i.chance=function(a){return this.normal()<=a},i.choice=function(a,b){if(a.length===0)return null;var c=this.integer(a.length-1),d=a[c];return b&&a.splice(c,1),d},i.weightedChoice=function(a){var b=arguments.length>1;if(b||e.isArray(a))a=this.autoWeight(b?arguments:a);var c=0,d={};for(var f in a){var g=~~(c*1e3);c+=a[f],d[f]={min:g,max:~~(c*1e3)}}var h=this.integer(~~(c*1e3)-1);for(var f in d){var i=d[f];if(h>=i.min&&h<i.max)return f}return logger.warn("[PRNG.weightedChoice] No matching option found!",h,d),null},i.weightedIndex=function(a,b){var c=[];for(var d=0;d<a;++d)c.push(d);var e=this.autoWeight(c,b);return+this.weightedChoice(e)},i.autoWeight=function(a,b){var b=b||2,c={},d=0;for(var e=0,f=a.length;e<f;++e){var g=Math.pow(f-e,b);c[a[e]]=g,d+=g}var h=1/d;for(var i in c)c[i]*=h;return c}}),define("djinn/sim/systems/Physics",["require","exports","module","djinn/Class"],function(a,b,c){var d=a("djinn/Class");c.exports=d.extend({onEntityUpdate:function(a,b){var c=a.position,d=a.velocity,e=a.gravity;if(!c||!d)return;e&&(d.y+=e.value*b/2),c.x+=~~(d.x*b),c.y+=~~(d.y*b),e&&(d.y+=e.value*b/2)}})}),define("djinn/sim/systems/Collision",["require","exports","module","../../Class","../../math/core","../../utils/array","../shared/position"],function(a,b,c){var d=a("../../Class"),e=a("../../math/core"),f=a("../../utils/array"),g=a("../shared/position");c.exports=d.extend({onPreUpdate:function(a){this._entities=[]},onEntityUpdate:function(a,b){if(!a.collision)return;this._entities.push(a);var c=this.host,d=a.size,e=a.position,f=!1,g=!1;e.x<0?(e.x=0,f=!0):e.x>c.width-d.width&&(e.x=c.width-d.width,f=!0),e.y<0?(e.y=0,g=!0):e.y>c.height-d.height&&(e.y=c.height-d.height,g=!0),(f||g)&&c.callSystems("onEnvCollide",[a,f,g])},onPostUpdate:function(){var a=this._entities;for(var b=0,c=a.length;b<c;++b)this._checkEntityCollision(a[b])},_checkEntityCollision:function(a){var b=this.host,c=b.entities,d=b.quadTree,h=g.getBounds(a),i=a.collision.targets,j=d.retrieve(h);for(var k=0,l=j.length;k<l;++k){var m=j[k],n=m.id;if(n===a.id)continue;var o=c.get(n);if(!o||!o.collision)continue;var p=o.collision.groups;o.collision&&f.containsAny(i,p)&&e.intersects(m,h)&&b.callSystems("onEntityCollide",[a,o])}}})}),define("djinn/sim/shared/health",["require","exports","module"],function(a,b,c){b.getNormal=function(a){var b=a.health;if(!b)return;return b.value/b.max},b.reduce=function(a,c){var d=a.health;if(!d)return;var c=c||1;d.value=Math.max(d.value-c,0),a.fire("healthChange",[b.getNormal(a)])}}),define("js/sim/systems/Blocks",["require","exports","module","djinn/Class","djinn/utils/array","djinn/sim/shared/position","djinn/sim/shared/health"],function(a,b,c){var d=a("djinn/Class"),e=a("djinn/utils/array"),f=a("djinn/sim/shared/position"),g=a("djinn/sim/shared/health");c.exports=d.extend({onPostUpdate:function(){var a=this.host;if(a.gameOver)return;var b=0;a.entities.forEach(function(a){if(!this._isBlock(a))return;++b},this),b<=0&&a.endGame()},onEntityUpdate:function(a){if(!this._isBlock(a))return;a.health.value<=0&&(this.host.incrementScore(a.score.value),this.host.despawnEntity(a))},onEnvCollide:function(a,b,c){if(!this._isBlock(a))return;c&&(a.velocity.y>.4&&(g.reduce(a,1),a.health.value<=0&&(a.score.value=1e3*a.score.combo)),a.velocity.y=0,a.score.combo=1)},onEntityCollide:function(a,b){if(!this._isBlock(a)||!this._isBlock(b))return;var c=a.position,d=b.position;if(c.y>d.y)return;a.velocity.y>.4&&(g.reduce(b,1),b.health.value<=0?(b.score.value=1e3*a.score.combo,++a.score.combo):a.score.combo=1),c.y=d.y-a.size.height,a.velocity.y=0},_isBlock:function(a){var b=a.collision;return b?e.contains(b.groups,"block"):!1}})}),define("js/sim/customComponents",{size:{width:100,height:100},score:{value:500,combo:1}}),define("js/sim/prefabs/blocks",{officeBottom:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},score:{}},officeSolid:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:3,max:3},score:{}},officeWindow:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:2,max:2},score:{}},officeGlass:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},score:{}},officeTop:{size:{},position:{},velocity:{},gravity:{},collision:{groups:["block"],targets:["block"]},health:{value:1,max:1},score:{}}}),define("js/sim/prefabs/players",{mandrill:{size:{width:60,height:60},position:{},velocity:{}}}),define("js/sim/City",["require","exports","module","djinn/sim/World","djinn/math/core","djinn/math/PRNG","djinn/sim/systems/Physics","djinn/sim/systems/Collision","./systems/Blocks","djinn/sim/shared/health","./customComponents","./prefabs/blocks","./prefabs/players"],function(a,b,c){var d=a("djinn/sim/World"),e=a("djinn/math/core"),f=a("djinn/math/PRNG"),g=a("djinn/sim/systems/Physics"),h=a("djinn/sim/systems/Collision"),i=a("./systems/Blocks"),j=a("djinn/sim/shared/health"),k=a("./customComponents"),l=a("./prefabs/blocks"),m=a("./prefabs/players"),n=new f,b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.addSystems([g,h,i]),this.defineComponents(k),this.definePrefabs(l),this.definePrefabs(m),this.score=0,this.seed=a.seed,this.columns=a.columns,this.columnPadding=a.columnPadding,this.columnHeightMin=a.columnHeightMin,this.columnHeightMax=a.columnHeightMax,this.blockTypes=a.blockTypes,this.blockBottomType=a.blockBottomType,this.blockTopType=a.blockTopType,this.reset()},reset:function(){this.gameOver=!1,this.score=0,this._scoreMax=0},endGame:function(){this.gameOver=!0,logger.info("GAME OVER!"),logger.info("Score: "+this.score),logger.info(sprintf("Stars: %s/%s",this.starRating,5))},incrementScore:function(a){this.score+=a,this.fire("scoreChange",[this.score])},damageBlocks:function(a,b){var c={x:a,y:b,width:1,height:1},d=this.quadTree.retrieve(c);d.forEach(function(a){if(!e.intersects(a,c))return;var b=this.getEntity(a.id);if(!b)return;j.reduce(b,1)},this)},generate:function(){n.seed(this.seed);var a=k.size.width,b=k.size.height,c=a*this.columns+this.columnPadding*(this.columns-1),d=~~(this.width/2-c/2);for(var e=0;e<this.columns;++e){var f=n.range(this.columnHeightMin,this.columnHeightMax),g=d+e*(a+this.columnPadding);for(var h=0;h<f;++h){if(h===f-1)var i=this.blockTopType;else if(h>0)var i=n.choice(this.blockTypes);else var i=this.blockBottomType;this.spawnEntity(this.createEntity(i,{position:{x:g,y:this.height-b-h*b}})),h>0?this._scoreMax+=1e3*(f-h):this._scoreMax+=500}}}}),o=b.prototype;Object.defineProperty(o,"starRating",{get:function(){return Math.floor(5*(this.score/this._scoreMax))}}),b.defaults={width:640,height:1136,seed:1,columns:5,columnPadding:23,columnHeightMin:4,columnHeightMax:8,blockTypes:["officeSolid","officeWindow","officeGlass"],blockBottomType:"officeBottom",blockTopType:"officeTop"}}),define("djinn/ViewCollection",["djinn/Collection"],function(a){return a.extend({remove:function(a,b,c){typeof a.removeFromParent!="function"&&(a=this.get(a));if(!a)return;c||a.removeFromParent(),this._super(a,b)}})}),define("djinn/view/Simulation",["require","exports","module","../View","../ViewCollection"],function(a,b,c){var d=a("../View"),e=a("../ViewCollection");c.exports=d.extend({init:function(a){this._super(a),this.world=null,this.pawns=new e,this._pawnFactory=null,this._avatarFactory=null,this._pawnContainer=new d({parent:this})},attach:function(a){a.on("entitySpawn",this,"_onEntitySpawn"),a.on("entityDespawn",this,"_onEntityDespawn"),this.world=a},detach:function(){var a=this.world;this.world=null,a.removeListenersByContext(this)},setPawnFactory:function(a){this._pawnFactory=a},setAvatarFactory:function(a){this._avatarFactory=a},_onEntitySpawn:function(a){var b=this._pawnFactory.create(a.type,{parent:this._pawnContainer,entity:a}),c=this._avatarFactory.create(a.type);b.attachAvatar(c),this.pawns.add(b)},_onEntityDespawn:function(a){var b=this.pawns.get(a.id);b.destroy(),this.pawns.remove(a.id)}})}),define("djinn/Factory",["djinn/Class"],function(a){return a.extend({init:function(a,b){this._factoryFallback=a,this._factoryExtensions=b},create:function(a,b){var b=merge(b,{type:a}),c=this._factoryExtensions;return a in c?new c[a](b):new this._factoryFallback(b)}})}),define("djinn/view/Pawn",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a);var c=this.entity=a.entity;c&&(this.id=c.id,this.sync())},attachAvatar:function(a){this.avatar=a,this.addChild(a),this.alignAvatar()},alignAvatar:function(){this.avatar.align("center","center")},sync:function(){var a=this.entity;if(!a)return;var b=a.size,c=a.position;this.x=c.x,this.y=c.y,this.width=b.width,this.height=b.height},tick:function(a){this.sync()}});b.defaults={width:32,height:32}}),define("js/view/pawns/Block",["require","exports","module","djinn/view/Pawn"],function(a,b,c){var d=a("djinn/view/Pawn");c.exports=d.extend({init:function(a){this._super(a),this.entity.on("healthChange",this,"_onHealthChange")},_onHealthChange:function(a){this.avatar.setHealth(a)}})}),define("js/view/utils/pawnMap",["require","exports","module","djinn/Factory","djinn/view/Pawn","../pawns/Block"],function(a,b,c){var d=a("djinn/Factory"),e=a("djinn/view/Pawn"),f=a("../pawns/Block");c.exports=new d(e,{officeBottom:f,officeSolid:f,officeWindow:f,officeGlass:f,officeTop:f})}),define("js/view/avatars/Block",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),e=100,f={officeSolid:{imageY:e},officeWindow:{imageY:e*2},officeGlass:{imageY:e*3},officeTop:{imageY:e*4}},b=c.exports=d.extend({init:function(a){var a=merge(a,f[a.type],b.defaults);this._super(a)},setHealth:function(a){a<.34?this.imageX=e*2:a<.67?this.imageX=e:this.imageX=0}});b.defaults={image:"media/images/avatars/buildings.png",width:e,height:e}}),define("js/view/avatars/Player",["require","exports","module","djinn/View"],function(a,b,c){var d=a("djinn/View"),e=60,f={mandrill:{backgroundColor:"brown"}},b=c.exports=d.extend({init:function(a){var a=merge(a,f[a.type],b.defaults);this._super(a)}});b.defaults={width:e,height:e}}),define("js/view/utils/avatarMap",["require","exports","module","djinn/Factory","djinn/View","../avatars/Block","../avatars/Player"],function(a,b,c){var d=a("djinn/Factory"),e=a("djinn/View"),f=a("../avatars/Block"),g=a("../avatars/Player");c.exports=new d(e,{mandrill:g,officeBottom:f,officeSolid:f,officeWindow:f,officeGlass:f,officeTop:f})}),define("js/view/City",["require","exports","module","djinn/view/Simulation","./utils/pawnMap","./utils/avatarMap"],function(a,b,c){var d=a("djinn/view/Simulation"),e=a("./utils/pawnMap"),f=a("./utils/avatarMap"),b=c.exports=d.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.setPawnFactory(e),this.setAvatarFactory(f),this.on("inputStart",this,"_onInputStart")},_onInputStart:function(a){this.world.damageBlocks(a.point.x,a.point.y)}});b.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:"dodgerblue"}}),define("js/view/scenes/CityScene",["require","exports","module","djinn/Scene","djinn/View","djinn/TextView","../../sim/City","../City"],function(a,b,c){var d=a("djinn/Scene"),e=a("djinn/View"),f=a("djinn/TextView"),g=a("../../sim/City"),h=a("../City");c.exports=d.extend({setup:function(){this._city=new g,this._cityView=new h({parent:this,y:-40}),this._ground=(new e({parent:this,image:"media/images/effects/ground.png",width:640,height:50,z:100})).align("center","bottom"),this._score=(new f({parent:this,text:"Score: 0",fontSize:30,z:200})).align("left","top",10,10),this._city.on("scoreChange",this,"_onScoreChange"),this._cityView.attach(this._city),this._city.generate()},reset:function(){},activate:function(){this._city.start(),this.captureInputEvents=!0},deactivate:function(){},cleanup:function(){},_onScoreChange:function(a){this._score.text="Score: "+a}})}),define("js/view/scenes",["require","exports","module","./scenes/TitleScene","./scenes/CityScene"],function(a,b,c){b.title={ctor:a("./scenes/TitleScene"),events:{play:{id:"city",transition:"fade"}}},b.city={ctor:a("./scenes/CityScene"),events:{}}}),define("js/Shiv",["require","exports","module","djinn/manifest","djinn/Game","./view/scenes"],function(a,b,c){var d=a("djinn/manifest"),e=a("djinn/Game"),f=a("./view/scenes"),b=c.exports=e.extend({init:function(a){var a=merge(a,b.defaults);this._super(a),this.setupScenes(f),this.preloadAssets(["media/images/avatars/buildings.png","media/images/effects/ground.png"]),this.on("load",this,"_onGameLoad"),this.on("ready",this,"_onGameReady")},_onGameLoad:function(){},_onGameReady:function(){this.activateScene(d.entry,"fade")}});b.defaults={showLoadingScreen:!0}});
require(["djinn/global","djinn/manifest","djinn/assets","djinn/stage"],function(a,b,c,d){d.matchSize(b.sizes),require(["js/Shiv"],function(a){var b=new a;b.run()})})</script>
	
	
	
	</body>
</html>