
/*
Djinn Copyright © 2010-2016 Lost Decade Games, LLC

Indie Game Sim Copyright © 2016-2016 Lost Decade Games, LLC

Web: http://www.lostdecadegames.com
Email: hello@lostdecadegames.com
Twitter: @LostDecadeGames
*/

// Djinn globally accessible functions
// Everything in here should have a damn good reason for being global :)

// Bind a function to a specific context
// Global because function.bind is slower than a custom implementation
// Used everywhere, a lot so it'd be really tedious to include a file for bind
var bind = function globalBind (context, fn) {
	if (typeof fn == "string") {
		fn = context[fn];
	}
	return function globalBindInner () {
		fn.apply(context, arguments);
	};
};

// Merge N objects together
// I'd rather this live in utils/object but it's used in so many places :(
// TODO: Figure out how to move this out of global without a huge mess
var merge = function globalMerge () {
	var merged = {};
	for (var i = arguments.length - 1; i >= 0; --i) {
		var toMerge = arguments[i];

		if (typeof toMerge != "object") { continue; }

		for (var key in toMerge) {
			var prop = toMerge[key];
			if (prop === undefined) { continue; }

			if (prop && typeof prop.concat == "function") {
				// An array
				merged[key] = prop.concat([]);
			} else if (prop && prop.constructor === Object) {
				// A merge-able object
				merged[key] = arguments.callee(prop, merged[key]);
			} else {
				// A scalar or un-mergeable object
				// WARNING: This will copy the reference to an object!
				merged[key] = prop;
			}
		}
	}
	return merged;
};

var djinn = {
	manifest: {"title":"Indie Game Sim","description":"Design your own games for fame and fortune.","keywords":"indie game sim, game, dev, development, indie, sim, simulation, simulator, platformer, creation, windows","version":"0.5.2","shortName":"igs","node-main":"app.js","entry":"share","launch":"js/Main","port":8832,"pixelated":true,"cursor":false,"size":[256,144],"icons":{"16":"media/images/icons/16.png","19":"media/images/icons/19.png","29":"media/images/icons/29.png","42":"media/images/icons/42.png","48":"media/images/icons/48.png","114":"media/images/icons/114.png","128":"media/images/icons/128.png","256":"media/images/icons/256.png","favicon":"media/images/icons/favicon.ico"},"developer":{"name":"Lost Decade Games, LLC","minCopyrightYear":2016,"url":"http://www.lostdecadegames.com","email":"hello@lostdecadegames.com","twitter":"@LostDecadeGames"}},
	platform: ""
};

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
 *  howler.js v1.1.21
 *  howlerjs.com
 *
 *  (c) 2013-2014, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */

/*
	var blue = [89, 125, 206];
	var complementaryColor = function(c) {
		return [ (c[0] ^ 0xff), (c[1] ^ 0xff), (c[2] ^ 0xff) ];
	};
	var cc = complementaryColor(blue);
	var r = cc[0];
	var g = cc[1];
	var b = cc[2];
	this.backgroundColor = "rgb("+r+","+g+","+b+")";
	*/

!function(){var e,t,n;!function(i){function a(e,t){return _.call(e,t)}function s(e,t){var i,n,a,s,r,o,l,h,u,d,c,p=t&&t.split("/"),g=y.map,m=g&&g["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=e.split("/"),r=e.length-1,y.nodeIdCompat&&b.test(e[r])&&(e[r]=e[r].replace(b,"")),e=p.concat(e),u=0;u<e.length;u+=1)if(c=e[u],"."===c)e.splice(u,1),u-=1;else if(".."===c){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||m)&&g){for(i=e.split("/"),u=i.length;u>0;u-=1){if(n=i.slice(0,u).join("/"),p)for(d=p.length;d>0;d-=1)if(a=g[p.slice(0,d).join("/")],a&&(a=a[n])){s=a,o=u;break}if(s)break;!l&&m&&m[n]&&(l=m[n],h=u)}!s&&l&&(s=l,o=h),s&&(i.splice(0,o,s),e=i.join("/"))}return e}function r(e,t){return function(){return p.apply(i,x.call(arguments,0).concat([e,t]))}}function o(e){return function(t){return s(t,e)}}function l(e){return function(t){f[e]=t}}function h(e){if(a(v,e)){var t=v[e];delete v[e],w[e]=!0,c.apply(i,t)}if(!a(f,e)&&!a(w,e))throw new Error("No "+e);return f[e]}function u(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function d(e){return function(){return y&&y.config&&y.config[e]||{}}}var c,p,g,m,f={},v={},y={},w={},_=Object.prototype.hasOwnProperty,x=[].slice,b=/\.js$/;g=function(e,t){var i,n=u(e),a=n[0];return e=n[1],a&&(a=s(a,t),i=h(a)),a?e=i&&i.normalize?i.normalize(e,o(t)):s(e,t):(e=s(e,t),n=u(e),a=n[0],e=n[1],a&&(i=h(a))),{f:a?a+"!"+e:e,n:e,pr:a,p:i}},m={require:function(e){return r(e)},exports:function(e){var t=f[e];return"undefined"!=typeof t?t:f[e]={}},module:function(e){return{id:e,uri:"",exports:f[e],config:d(e)}}},c=function(e,t,n,s){var o,u,d,c,p,y,_=[],x=typeof n;if(s=s||e,"undefined"===x||"function"===x){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(c=g(t[p],s),u=c.f,"require"===u)_[p]=m.require(e);else if("exports"===u)_[p]=m.exports(e),y=!0;else if("module"===u)o=_[p]=m.module(e);else if(a(f,u)||a(v,u)||a(w,u))_[p]=h(u);else{if(!c.p)throw new Error(e+" missing "+u);c.p.load(c.n,r(s,!0),l(u),{}),_[p]=f[u]}d=n?n.apply(f[e],_):void 0,e&&(o&&o.exports!==i&&o.exports!==f[e]?f[e]=o.exports:d===i&&y||(f[e]=d))}else e&&(f[e]=n)},e=t=p=function(e,t,n,a,s){if("string"==typeof e)return m[e]?m[e](t):h(g(e,t).f);if(!e.splice){if(y=e,y.deps&&p(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=i}return t=t||function(){},"function"==typeof n&&(n=a,a=s),a?c(i,e,t,n):setTimeout(function(){c(i,e,t,n)},4),p},p.config=function(e){return p(e)},e._defined=f,n=function(e,t,i){t.splice||(i=t,t=[]),a(f,e)||a(v,e)||(v[e]=[e,t,i])},n.amd={jQuery:!0}}(),n("../djinn/lib/require/almond-0.2.9",function(){}),n("djinn/utils/pool",["require","exports","module"],function(e,t,i){var n={};t.create=function(e){n[e]||(n[e]=[])},t.get=function(e){return t.create(e),n[e].length>0?n[e].pop():null},t.put=function(e,i){t.create(e),n[e].push(i)}}),n("djinn/Class",["require","exports","module","./utils/pool"],function(e,t,i){var n=(e("./utils/pool"),function(){var e=Object.create(this.prototype);return this.apply(e,arguments),e}),a=function(){},s=0,r=!1,o=/\b_super\b/,l=function(){};return l.uid=0,l.extend=function(e){var t=this.prototype;r=!0;var i=new this;r=!1;for(var a in e)i[a]="function"==typeof e[a]&&"function"==typeof t[a]&&o.test(e[a])?function(e,i){return function(){var n=this._super;this._super=t[e];var a=i.apply(this,arguments);return this._super=n,a}}(a,e[a]):e[a];var l=function(){!r&&this.init&&this.init.apply(this,arguments)};return l.prototype=i,l.prototype.constructor=l,l.extend=arguments.callee,l.create=n,l.uid="Class_"+String(++s),l},l.prototype.dispose=a,l}),n("djinn/Emitter",["require","exports","module","./Class"],function(e,t,i){var n=e("./Class");i.exports=n.extend({init:function(){this._listeners={}},dispose:function(){this.removeAllListeners(),this._super()},fire:function(e,t){if(this._listeners){var i=this._listeners[e];if(i)for(var n=0,a=i.length;a>n;++n){var s=i[n];s&&s.method.apply(s.context,t)}}},on:function(e){var t=this._listeners[e];if(t||(t=this._listeners[e]=[]),2===arguments.length)t.push({context:this,method:arguments[1]});else{var i=arguments[1],n=arguments[2];"string"==typeof n&&(i[n]||console.warn("[Emitter.on] method doesn't exist",n),n=i[n]),t.push({context:i,method:n})}return this},removeListener:function(e,t){var i=this._listeners[e];if(i){if(void 0===t)this._listeners[e]=[];else for(var n=i.length-1;n>=0;--n)i[n].context===t&&i.splice(n,1);return this}},removeAllListeners:function(){return this._listeners={},this},removeListenersByContext:function(e){for(var t in this._listeners)for(var i=this._listeners[t],n=i.length-1;n>=0;--n)i[n].context===e&&i.splice(n,1);return this}})}),n("djinn/utils/object",["require","exports","module"],function(e,t,i){t.clone=function(e){return JSON.parse(JSON.stringify(e))},t.getKeys=function(e){var t=[];for(var i in e)t.push(i);return t},t.getLength=function(e){var t=0;for(var i in e)++t;return t},t.getRandomKey=function(e){return random.choice(t.getKeys(e))},t.merge=function(){for(var e={},t=arguments.length-1;t>=0;--t){var i=arguments[t];if("object"==typeof i)for(var n in i){var a=i[n];void 0!==a&&(a&&"function"==typeof a.concat?e[n]=a.concat([]):a&&a.constructor===Object?e[n]=arguments.callee(a,e[n]):e[n]=a)}}return e}}),n("djinn/utils/string",["require","exports","module"],function(e,t,n){t.formatMoney=function(e){var i=t.formatNumber(e);return"."===i.substr(i.length-2,1)&&(i+="0"),i},t.formatNumber=function(e){for(var e=String(e),t=e.split("."),i=t[0],n=t.length>1?"."+t[1]:"",a=/(\d+)(\d{3})/;a.test(i);)i=i.replace(a,"$1,$2");return i+n},t.formatOrdinalNumber=function(e){var e=String(e),t="";switch(e.slice(-1)){case"1":t="st";break;case"2":t="nd";break;case"3":t="rd";break;default:t="th"}return e+t},t.formatTime=function(e,i){var n=Math.floor(e%1e3),a=Math.floor(e/1e3)%60,s=Math.floor(e/6e4)%60,r=Math.floor(e/36e5)%24;return a=t.padLeft(a,"0",2),i>0&&(n=t.padLeft(n,"0",3),a+="."+n.substr(0,i)),r>0?(s=t.padLeft(s,"0",2),t.sprintf("%s:%s:%s",r,s,a)):t.sprintf("%s:%s",s,a)},t.hashCharCode=function(e){var t=0;if(e.length<1)return t;for(i=0,j=e.length;i<j;i++){var n=e.charCodeAt(i);t=(t<<5)-t+n,t|=0}return Math.abs(t)},t.padLeft=function(e,t,i){for(var e=String(e),n=i-e.length,a=0;n>a;++a)e=t+e;return e},t.parseNumber=function(e){return Number(e.replace(/([^0-9\.])/g,""))},t.ucfirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t.sprintf=function(){for(var e=arguments[0],t=arguments.length,i=1;t>i;++i)e=e.replace(/%s/,arguments[i]);return e},t.updateCharAtIndex=function(e,t,i){return e.substr(0,t)+i+e.substr(t+1)}}),n("djinn/math/core",["require","exports","module"],function(e,t,i){t.twoPi=2*Math.PI,t.isNumber=function(e){return null!==e&&!isNaN(e)},t.sign=function(e){return e>0?1:0==e?0:-1},t.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},t.round=function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i},t.normalize=function(e,t,i){return(e-t)/(i-t)},t.map=function(e,i,n,a,s){return t.lerp(a,s,t.normalize(e,i,n))},t.lerp=function(e,t,i,n){var a=e+(t-e)*i;return n?Math.round(a):a},t.distance=function(e,t,i,n){return Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))},t.approximately=function(e,t){return Math.abs(e-t)<Number.EPSILON},t.wrapRadians=function(e){return(e+t.twoPi)%t.twoPi},t.snapRadians=function(e,t){return e*Math.round(e/t)},t.indexToX=function(e,t){return e%t},t.indexToY=function(e,t){return Math.floor(e/t)},t.gridToIndex=function(e,t){return t*width+e},t.random=function(e,t){return e instanceof Array?arguments.callee(0,e.length-1):Math.round(Math.random()*(t-e))+e},t.intersects=function(e,t){return e.x<t.x+t.width&&t.x<e.x+e.width&&e.y<t.y+t.height&&t.y<e.y+e.height},t.pointInCircle=function(e,t,i,n,a){var s=Math.pow(e-i,2)+Math.pow(t-n,2);return s<Math.pow(a,2)},t.pointDistance=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}}),n("djinn/utils/array",["require","exports","module","../math/core"],function(e,t,i){var n=e("../math/core"),a=function(e,t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)};t.isArray=function(e){return e?"function"==typeof e.unshift:!1},t.clone=function(e){return e.concat()},t.force=function(e){return t.isArray(e)?e:[e]},t.contains=function(e,t){return-1!==e.indexOf(t)},t.unique=function(e){for(var t={},i=[],n=0,a=0,s=e.length;s>a;++a){var r=e[a];t[r]||(t[r]=!0,i[n++]=r)}return i},t.containsAny=function(e,i){for(var n=0,a=i.length;a>n;++n)if(t.contains(e,i[n]))return!0;return!1},t.remove=function(e,i){if(t.isArray(i))for(var n=0,s=i.length;s>n;++n)a(e,i[n]);else a(e,i)},t.removeValue=function(e,t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},t.removeIndices=function(e,t){t.length>1&&t.sort(function(e,t){return t-e});for(var i=0,n=t.length;n>i;++i)e.splice(t[i],1)},t.addItems=function(e,t,i){for(var n=0,a=t.length;a>n;++n){var s=t[n];i&&-1!==e.indexOf(s)||e.push(s)}},t.pushOnce=function(e,t){-1===e.indexOf(t)&&e.push(t)},t.pickRandom=function(e){var t=n.random(0,e.length-1);return e[t]},t.popRandom=function(e){var t=n.random(0,e.length-1),i=e[t];return e.splice(t,1),i},t.merge=function(e,t,i){for(var n=[];e.length>0&&t.length>0;)i(e[0],t[0])<=0?n.push(e.shift()):n.push(t.shift());return n.concat(e,t)},t.sort=function(e,i){var n=e.length;if(2>n)return e;var a=Math.ceil(n/2);return t.merge(t.sort(e.slice(0,a),i),t.sort(e.slice(a),i),i)},t.shuffle=function(e){var t=e.length;if(!(1>t)){for(;--t;){var i=Math.floor(Math.random()*(t+1)),n=e[i];e[i]=e[t],e[t]=n}return e}},t.max=function(e){for(var t=e[0]||0,i=0,n=e.length;n>i;++i)t=Math.max(e[i],t);return t},t.sum=function(e){for(var t=0,i=0,n=e.length;n>i;++i)isNaN(e[i])||(t+=e[i]);return t},t.last=function(e){return e[t.lastIndex(e)]},t.lastIndex=function(e){return e.length-1}}),n("djinn/math/PRNG",["require","exports","module","../utils/string","../utils/array"],function(e,t,i){var n=e("../utils/string"),a=e("../utils/array"),s=2147483648,r=1103515245,o=12345;i.exports=function(e){this.state=null,e&&this.seed(e)};var l=i.exports.prototype;l.seed=function(e){e?isNaN(e)&&(e=n.hashCharCode(String(e))):e=Math.floor(Math.random()*(s-1)),this.seedValue=e,this.state=e},l.normal=function(){return null===this.state?Math.random():(this.state=(r*this.state+o)%s,this.state/s)},l.integer=function(e){return Math.round(this.normal()*e)},l.range=function(e,t){return this.integer(t-e)+e},l.radians=function(e,t){var e=e||0,t=t||2*Math.PI,i=t-e;return e+i*this.normal()},l.chance=function(e){return this.normal()<=e},l.choice=function(e,t){if(0===e.length)return null;var i=this.integer(e.length-1),n=e[i];return t&&e.splice(i,1),n},l.weightedChoice=function(e){var t=arguments.length>1;(t||a.isArray(e))&&(e=this.autoWeight(t?arguments:e));var i=0,n={};for(var s in e){var r=~~(1e3*i);i+=e[s],n[s]={min:r,max:~~(1e3*i)}}var o=this.integer(~~(1e3*i)-1);for(var s in n){var l=n[s];if(o>=l.min&&o<l.max)return s}return console.warn("[PRNG.weightedChoice] No matching option found!",o,n),null},l.weightedIndex=function(e,t){for(var i=[],n=0;e>n;++n)i.push(n);var a=this.autoWeight(i,t);return+this.weightedChoice(a)},l.autoWeight=function(e,t){for(var t=t||2,i={},n=0,a=0,s=e.length;s>a;++a){var r=Math.pow(s-a,t);i[e[a]]=r,n+=r}var o=1/n;for(var l in i)i[l]*=o;return i},l.shuffle=function(e){var t=e.length;if(!(2>t))for(var i=0;t>i;++i){var n=this.range(i,t-1),a=e[i];e[i]=e[n],e[n]=a}}}),n("djinn/math/random",["require","exports","module","./PRNG"],function(e,t,i){var n=e("./PRNG");return new n}),n("djinn/utils/intl",["require","exports","module","../Emitter","./object","./string","../math/random"],function(e,t,i){var n=e("../Emitter"),a=e("./object"),s=e("./string"),r=e("../math/random"),o=n.extend({init:function(e){this._super(e),this._languages={},this._currentLangCode=null},addLanguage:function(e){this._languages[e.code]=e},setLanguage:function(e){this._currentLangCode=e},get:function(e){var t=this._getString(e);return t?arguments.length>1?(arguments[0]=t,s.sprintf.apply(null,arguments)):t:s.sprintf("[Missing intl: %s]",e)},random:function(e){return r.choice(this._getString(e))},pluralize:function(e,t){var e=t>1?e+"_PLURAL":e;return this.get(e,t)},exists:function(e){var t=this._getString(e);return t&&t.length>0},getArray:function(e){return a.clone(this._getString(e))},_getString:function(e){return this._languages[this._currentLangCode].strings[e]}});i.exports=new o}),n("js/intl/en",{code:"en",strings:{FUN:"%sx FUN!",moveUp:"Move up",moveDown:"Move down",moveLeft:"Move left",moveRight:"Move right",action:"Action",negate:"Negate",danger:"DANGER!",bling:"BLING!",cool:"COOL!",ride:"RIDE!",zoom:"ZOOM!"}}),n("djinn/core/time",["require","exports","module"],function(e,t,i){const n=50;var a=!1,s=0,r=null,o=function(e){t.deltaTime=Math.min(e-s,n),s=e,r&&r(t.deltaTime),a&&requestAnimationFrame(o)};t.deltaTime=0,t.start=function(e){a||(a=!0,r=e,requestAnimationFrame(o))},t.stop=function(){a&&(a=!1)}}),n("djinn/manifest",["require","exports","module"],function(e,t,i){i.exports=djinn.manifest}),n("djinn/client",["require","exports","module","djinn/Emitter","djinn/manifest","djinn/utils/string"],function(e,t,i){var n=e("djinn/Emitter"),a=e("djinn/manifest"),s=e("djinn/utils/string"),t=n.extend({init:function(e){if(this._super(e),this.debug=!1,this._detectEnvironment(),this._updateSize(),this.isTouch)for(var t=bind(this,function(e){e.preventDefault()}),i=["touchstart","touchmove","touchend"],n=0,a=i.length;a>n;++n)addEventListener(i[n],t,!1);window.addEventListener("error",bind(this,"_onError"),!1);var s=bind(this,"_updateSize");window.addEventListener("resize",s,!1),window.addEventListener("orientationchange",s,!1),window.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",bind(this,"_onLoad"),!1),window.addEventListener("blur",this._onBlur.bind(this),!1),this._initVisibilityChange()},enterFullscreen:function(){this["native"]&&nw.Window.get().enterFullscreen()},toggleFullscreen:function(){this["native"]&&nw.Window.get().toggleFullscreen()},open:function(e){this["native"]?nw.Shell.openExternal(e):location.href=e},quit:function(){this["native"]&&nw.App.quit()},vibrate:function(e){navigator.vibrate&&navigator.vibrate(e)},log:function(){if(arguments.length>1)var e=s.sprintf.apply(null,arguments);else var e=arguments[0];console.log(e)},_detectEnvironment:function(){var e=this.userAgent=navigator.userAgent;if(this.pixelRatio=window.devicePixelRatio||1,this.isTouch="undefined"!=typeof window.ontouchstart||!this.isBrowser,this.isIPhone=/iPhone OS/.test(e),this.isIPad=/iPad/.test(e),this.isIOS=this.isIPhone||this.isIPad,this.isAndroid=/Android/.test(e),this["native"]){var t=nw.Window.get(),i=bind(this,"_onFullscreenChange");t.on("enter-fullscreen",i),t.on("restore",i)}this.debug&&(this.log("[client._detectEnvironment] Debugging info:"),this.log("User Agent: %s",this.userAgent),this.log("Device: %s",this.deviceType),this.log("Pixel Ratio: %s",this.pixelRatio))},_queryWindowSize:function(){var e={width:~~window.innerWidth,height:~~window.innerHeight};return e},_updateSize:function(){var e=this._queryWindowSize();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this.debug&&this.log("[client._updateSize] %sx%s",this.width,this.height),this.fire("resize",[this.width,this.height,this.orientation]))},_onError:function(e){this.fire("error",[e])},_onLoad:function(){this._updateSize(),this.isAndroid&&setInterval(bind(this,"_updateSize"),500)},_initVisibilityChange:function(){var e=null;this._hiddenPropertyName=null,"undefined"!=typeof document.hidden?(e="visibilitychange",this._hiddenPropertyName="hidden"):"undefined"!=typeof document.webkitHidden?(e="webkitvisibilitychange",this._hiddenPropertyName="webkitHidden"):"undefined"!=typeof document.mozHidden?(e="mozvisibilitychange",this._hiddenPropertyName="mozHidden"):"undefined"!=typeof document.msHidden&&(e="msvisibilitychange",this._hiddenPropertyName="msHidden"),e&&document.addEventListener(e,bind(this,"_onVisibilityChange"),!1)},_onVisibilityChange:function(){this.fire("visibilityChange",[this.hidden]),this.hidden&&this._onBlur()},_onFullscreenChange:function(){this.fire("fullscreenChange",[this.fullscreen])},_onBlur:function(){this.fire("blur")}}),r=t.prototype;Object.defineProperty(r,"native",{get:function(){return"undefined"!=typeof nw}}),Object.defineProperty(t.prototype,"orientation",{get:function(){var e=this.width>=this.height?"landscape":"portrait";return isNaN(window.orientation)&&"both"!==a.orientation?a.orientation:e}}),Object.defineProperty(t.prototype,"hidden",{get:function(){return this._hiddenPropertyName?document[this._hiddenPropertyName]:!1}}),Object.defineProperty(t.prototype,"fullscreen",{get:function(){return this["native"]?nw.Window.get().isFullscreen():!1}}),Object.defineProperty(t.prototype,"deviceType",{get:function(){return this.isAndroid?"Android":this.isIPhone?"iPhone":this.isIPad?"iPad":"Unknown"}}),Object.defineProperty(t.prototype,"isBrowser",{get:function(){return document&&"function"==typeof document.querySelectorAll&&!this.isCocoonJS}}),Object.defineProperty(t.prototype,"isCocoonJS",{get:function(){return navigator.isCocoonJS}}),Object.defineProperty(t.prototype,"isSteam",{get:function(){return"steam"===djinn.platform}}),i.exports=new t}),n("djinn/input/keys",["require","exports","module"],function(e,t,i){i.exports={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,n0:48,n1:49,n2:50,n3:51,n4:52,n5:53,n6:54,n7:55,n8:56,n9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindow:91,rightWindow:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semicolon:186,equal:197,comma:188,dash:189,period:190,slash:191,grave:192,openBracket:219,backSlash:220,closeBracket:221,quote:222}}),n("djinn/input/keyboard",["require","exports","module","../Emitter","../client","../utils/array","./keys"],function(e,t,i){var n=e("../Emitter"),a=e("../client"),s=e("../utils/array"),r=e("./keys"),o=n.extend({init:function(e){this._super(e),this._capture=[],this.binds={},this.keys=r,this._keysDown={},this._keyHistory=[],this._lastKeysDown={},this._shiftDown=!1,this.bind({up:["up","w"],left:["left","a"],down:["down","s"],right:["right","d"],accept:["enter","space"],negate:["escape"]}),window.addEventListener("keydown",bind(this,"_handleKeyEvent"),!1),window.addEventListener("keyup",bind(this,"_handleKeyEvent"),!1),a.on("blur",this,"_onClientBlur")},bind:function(e){var t=this.binds;for(var i in e){var n=t[i]=[],a=s.force(e[i]);a.forEach(function(e){n.push(r[e])}),this.capture(n)}},test:function(e,t){var i=this.binds[e];return i?this.isDown(i,t):!1},capture:function(e){var t=this._capture;e.forEach(function(e){-1===t.indexOf(e)&&t.push(e)})},endFrame:function(){this._lastKeysDown={};for(var e in this._keysDown)this._lastKeysDown[e]=this._keysDown[e]},checkHistory:function(e){var t=e.length,i=this._keyHistory.slice(-t);if(i.length!=t)return!1;for(var n=0;t>n;n++)if(e[n]!==i[n])return!1;return!0},clearHistory:function(){this._keyHistory=[]},isDown:function(e,t){s.isArray(e)||(e=[e]);for(var i=0,n=e.length;n>i;++i)if(this._keysDown[e[i]]&&(t!==!0||this._lastKeysDown[e[i]]!==!0))return!0;return!1},isShiftDown:function(){return this._shiftDown},isAnyDown:function(){for(var e in this._keysDown)return!0;return!1},clearKeys:function(e){for(var e=s.force(e),t=0,i=e.length;i>t;++t)delete this._keysDown[e[t]]},getKeyAliasByCode:function(e){for(var t in r)if(e===r[t])return t;return null},_handleKeyEvent:function(e){-1!==this._capture.indexOf(e.keyCode)&&e.preventDefault(),"keydown"===e.type?(this._keysDown[e.keyCode]=!0,this._keyHistory.push(e.keyCode),this._keyHistory.length>50&&this._keyHistory.shift(),this.fire("keyDown",[e.keyCode])):"keyup"===e.type&&delete this._keysDown[e.keyCode],this._shiftDown=e.shiftKey},_onClientBlur:function(){this._keysDown={},this._lastKeysDown={}}});i.exports=new o}),n("djinn/math/Vector2",["require","exports","module","../Class"],function(e,t,i){var n=e("../Class"),t=i.exports=n.extend({init:function(e){if(2===arguments.length)this.x=arguments[0],this.y=arguments[1];else if("object"==typeof e)if(void 0!==e.angle){var t=e.magnitude||1;this.x=Math.cos(e.angle)*t,this.y=Math.sin(e.angle)*t}else this.x=e.x||0,this.y=e.y||0;else this.zero()},set:function(e,t){return this.x=e,this.y=t,this},setRadians:function(e,t){var t=t||1;return this.x=Math.sin(e)*t,this.y=-Math.cos(e)*t,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},clone:function(){return new this.constructor({x:this.x,y:this.y})},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},distance:function(e){return t.distance(this,e)},normalize:function(){var e=this.magnitude();return 0===e?this:this.scale(1/e)},snap:function(e){var t=e*Math.round(this.heading/e);return this.x=Math.sin(t),this.y=-Math.cos(t),this},scale:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e,this.y/=e,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this},dot:function(e){return t.dot(this.x,this.y,e.x,e.y)},zero:function(){return this.x=0,this.y=0,this},rotate:function(e){var t=Math.sin(e),i=-Math.cos(e),n=this.x*i-this.y*t,a=this.x*t+this.y*i;return this.x=n,this.y=a,this}}),a=t.prototype;Object.defineProperty(a,"angle",{get:function(){return Math.atan2(this.y,this.x)}}),Object.defineProperty(a,"heading",{get:function(){return Math.atan2(this.x,-this.y)}}),t.fromAngle=function(e){return t.create(Math.sin(e),-Math.cos(e))},t.makeFromHeading=function(e,i){var i=Number(i)||1;return new t({x:Math.sin(e)*i,y:-Math.cos(e)*i})},t.magnitude=function(e,t){return Math.sqrt(e*e+t*t)},t.distance=function(e,i){var n=t.subtract(i,e);return t.magnitude(n.x,n.y)},t.subtract=function(e,i){return new t(e.x-i.x,e.y-i.y)},t.dot=function(e,t,i,n){return e*i+t*n},t.angle=function(e,t){return Math.atan2(e,-t)},t.angleX=function(e){return Math.sin(e)},t.angleY=function(e){return-Math.cos(e)},t.angleBetween=function(e,i,n,a){var s=t.dot(e,i,n,a),r=t.magnitude(e,i),o=t.magnitude(n,a);return Math.acos(s/(r*o))}}),n("djinn/input/buttons",{dPadUp:12,dPadDown:13,dPadLeft:14,dPadRight:15,face1:0,face2:1,face3:2,face4:3,a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,ls:10,rs:11,shoulderTopLeft:4,shoulderTopRight:5,shoulderBottomLeft:6,shoulderBottomRight:7,select:8,start:9,analogLeft:10,analogRight:11}),n("djinn/platforms/nwf",["require","exports","module","../Emitter","../utils/array","../input/buttons"],function(e,t,i){var n=e("../Emitter"),a=e("../utils/array"),s=e("../input/buttons"),r={12:"GAMEPAD_UP",13:"GAMEPAD_DOWN",14:"GAMEPAD_LEFT",15:"GAMEPAD_RIGHT",0:"GAMEPAD_A",1:"GAMEPAD_B",2:"GAMEPAD_X",3:"GAMEPAD_Y",9:"GAMEPAD_PLUS",8:"GAMEPAD_MINUS",4:"GAMEPAD_L",5:"GAMEPAD_R",6:"GAMEPAD_ZL",7:"GAMEPAD_ZR"},o={up:function(e,t){return e.leftStick.movementY<-t},down:function(e,t){return e.leftStick.movementY>t},left:function(e,t){return e.rightStick.movementX<-t},right:function(e,t){return e.rightStick.movementX>t}},l=n.extend({init:function(e){var e=merge(e,l.defaults);this._super(e),this.analogThreshold=e.analogThreshold,this.threshold=e.threshold,this.analogDeadZoneLeft=e.analogDeadZoneLeft,this.analogDeadZoneRight=e.analogDeadZoneRight,this.buttons=s;var t=nwf.input.WiiUGamePad;this.ControllerButton=nwf.input.ControllerButton,this.gamepad=t.getController(t.GAMEPAD_1),this._buttonsDown={},this._lastButtonsDown={},this._directionsDown={},this._lastDirectionsDown={}},exists:function(){return!!this.gamepad},endFrame:function(){this._lastButtonsDown={};for(var e in this._buttonsDown)this._lastButtonsDown[e]=this._buttonsDown[e];this._lastDirectionsDown={};for(var e in this._directionsDown)this._lastDirectionsDown[e]=this._directionsDown[e]},getAnalogData:function(e){var t={x:0,y:0,magnitude:0,magnitudeNormal:0},i=this.gamepad;if(!i)return t;var n="left"===e,a=n?i.leftStick:i.rightStick,s=n?this.analogDeadZoneLeft:this.analogDeadZoneRight,r=a.movementX,o=a.movementY,l=this.analogThreshold;Math.abs(r)<l&&(r=0),Math.abs(o)<l&&(o=0);var h=Math.sqrt(r*r+o*o),u=r/h,d=o/h;if(h>s){h=Math.min(h,1),h-=s;var c=h/(1-s);t.x=r,t.y=o,t.xNormal=u,t.yNormal=d,t.magnitude=h,t.magnitudeNormal=c}return t},clearButtons:function(e){var e=a.force(e);e.forEach(function(e){delete this._buttonsDown[e]},this)},isButtonDown:function(e,t){var i=this.gamepad;if(!i)return!1;var n=(i.buttons[e],!1),a=i.buttons,s=this.ControllerButton,o=r[e];a.isButtonPressed(s[o])&&(n=!0);var l=n;return t&&(l=n&&!this._buttonsDown[e]),this._buttonsDown[e]=n,l},isDirectionDown:function(e,t){var i=this.gamepad;if(!i)return!1;var n=o[e](i,this.threshold),a=n;return t&&(a=n&&!this._directionsDown[e]),this._directionsDown[e]=n,a}});l.defaults={threshold:.75,analogThreshold:.25,analogDeadZoneLeft:.3,analogDeadZoneRight:.3},i.exports=l}),n("djinn/input/gamepad",["require","exports","module","../Emitter","../math/Vector2","../utils/array","./buttons","../platforms/nwf"],function(e,t,i){var n=e("../Emitter"),a=e("../math/Vector2"),s=e("../utils/array"),r=e("./buttons");if(window.nwf){var o=e("../platforms/nwf");return void(i.exports=new o)}var l={up:function(e,t){return e.axes[1]<-t},down:function(e,t){return e.axes[1]>t},left:function(e,t){return e.axes[0]<-t},right:function(e,t){return e.axes[0]>t}},h=navigator.getGamepads||navigator.webkitGetGamepads,u=n.extend({init:function(e){var e=merge(e,u.defaults);this._super(e),this._gamepadIndex=-1,this.binds={},this.ignoreInputThisFrame=!1,this.threshold=e.threshold,this.analogSnapLeft=e.analogSnapLeft,this.analogSnapRight=e.analogSnapRight,this.analogDeadZoneLeft=e.analogDeadZoneLeft,this.analogDeadZoneRight=e.analogDeadZoneRight,this.buttons=r,this._buttonsDown={},this._lastButtonsDown={},this._directionsDown={},this._lastDirectionsDown={},this.bind({accept:"face1",negate:"start"})},bind:function(e){var t=this.binds;for(var i in e)t[i]=e[i]},test:function(e,t){var i=this.binds[e];return i?this.isButtonDown(r[i],t):!1},_getGamepad:function(){var e=h.call(navigator);if(-1===this._gamepadIndex)for(var t=0;t<e.length;++t){var i=e[t];if(i&&i.buttons)for(var n=0;n<i.buttons.length;++n){var a=i.buttons[n];if(!isNaN(a)&&a>this.threshold||a&&a.pressed)return void(this._gamepadIndex=t)}}return this._gamepadIndex>=0&&e[this._gamepadIndex]?e[this._gamepadIndex]:null},exists:function(){return null!==this._getGamepad()},endFrame:function(){this.ignoreInputThisFrame=!1,this._lastButtonsDown={};for(var e in this._buttonsDown)this._lastButtonsDown[e]=this._buttonsDown[e];this._lastDirectionsDown={};for(var e in this._directionsDown)this._lastDirectionsDown[e]=this._directionsDown[e]},getAnalogData:function(e){var t={x:0,y:0,angle:0,magnitude:0},i=this._getGamepad();if(!i)return t;var n=i.axes,s="left"===e,r=s?this.analogDeadZoneLeft:this.analogDeadZoneRight,o=s?this.analogSnapLeft:this.analogSnapRight,l=s?n[0]:n[2],h=s?n[1]:n[3],u=a.magnitude(l,h);if(r>u)return t;var d=Math.atan2(l,-h);if(o){var c=Math.PI/4;d=c*Math.round(d/c)}return t.x=Math.sin(d),t.y=-Math.cos(d),t.angle=d,t.magnitude=Math.min(u,1),t},clearButtons:function(e){var t=this._getGamepad();if(!t)return!1;var e=s.force(e);e.forEach(function(e){delete this._buttonsDown[e]},this)},isButtonDown:function(e,t){if(this.ignoreInputThisFrame)return!1;var i=this._getGamepad();if(!i)return!1;var n=i.buttons[e];if(void 0!==n){var a=n;n.value&&(a=n.value);var s=a>this.threshold,r=s;return t&&(r=s&&!this._buttonsDown[e]),this._buttonsDown[e]=s,r}},isDirectionDown:function(e,t){var i=this._getGamepad();if(!i)return!1;var n=l[e](i,this.threshold),a=n;return t&&(a=n&&!this._directionsDown[e]),this._directionsDown[e]=n,a}});u.defaults={threshold:.75,analogSnapLeft:!1,analogSnapRight:!1,analogDeadZoneLeft:.3,analogDeadZoneRight:.3},i.exports=new u}),n("djinn/utils/request",["require","exports","module","../client"],function(e,t,i){var n=e("../client");t.params={},n.isBrowser&&location.href.replace(/[?&]+([^=&]+)=([^&#]*)/gi,function(e,i,n){t.params[i]=n})}),n("djinn/stage",["require","exports","module","./Emitter","./client","./math/core","./manifest","./utils/string","./utils/request"],function(e,t,i){var n=e("./Emitter"),a=e("./client"),s=e("./math/core"),r=e("./manifest"),o=e("./utils/string"),l=e("./utils/request"),h=[],u=!1,d=["mousedown","mousemove","mouseup"],c=["touchstart","touchmove","touchend"],p=n.extend({init:function(e){this._super(e),this.eraseBeforeRender=!1,this._maxScale=1/0,this.maintainAspectRatio="stretch"!==r.scaleMode,this.acceptInput=!1,this.acceptMouseInput=!0,this.acceptTouchInput=!1,this.xInput=0,this.yInput=0,this.inputDown=!1,this.viewportWidth=0,this.viewportHeight=0,this.canvas=null,this.ctx=null,this.xScale=1,this.yScale=1;var t=this.isCocoonJS?"screencanvas":"canvas",i=this.canvas=document.createElement(t);i.width=r.size[0],i.height=r.size[1],r.pixelated&&(i.className="pixelated"),r.cursor===!1&&(i.style.cursor="none"),a.isBrowser&&(i.style.position="absolute",i.style.left=0,i.style.top=0),document.body.appendChild(i),a.on("error",this,"_onError"),this._initInput(),this.ctx=i.getContext("2d"),this._autoSize(),a.on("resize",this,"_autoSize")},localizePoint:function(e,t){return{x:Math.round((e-this.canvas.offsetLeft)*(1/this.xScale)),y:Math.round((t-this.canvas.offsetTop)*(1/this.yScale))}},renderView:function(e){var t=this.canvas,i=this.ctx;this.eraseBeforeRender&&i.clearRect(0,0,t.width,t.height),e.preRender(i)},createBuffer:function(e,t){var i=document.createElement("canvas");return i.width=Number(e),i.height=Number(t),i},getInputEvents:function(){var e=h;return h=[],e},requestFullScreen:function(){document.body.webkitRequestFullScreen()},cancelFullScreen:function(){document.webkitCancelFullScreen()},toggleFullScreen:function(){this.canFullScreen&&(this.isFullScreen?this.cancelFullScreen():this.requestFullScreen())},setViewport:function(e,t){this.viewportWidth=e,this.viewportHeight=t,this._autoSize()},_getEventType:function(e){switch(e.type){case"touchstart":case"mousedown":return"inputStart";case"touchmove":case"mousemove":return"inputMove";case"touchend":case"mouseup":return"inputEnd"}},_handleMouseEvent:function(e){this.acceptInput&&this.acceptMouseInput&&this._handleInputEvent(e)},_handleTouchEvent:function(e){this.acceptInput&&this.acceptTouchInput&&this._handleInputEvent(e)},_handleContextEvent:function(e){e.preventDefault()},_handleWheelEvent:function(e){this.fire("wheel",[e.deltaX,e.deltaY])},_handleMouseOutEvent:function(){this.fire("inputEnd")},_handleInputEvent:function(e){if(this.acceptInput){var t=-1,i=0,n=0;if(a.isTouch&&e.touches&&e.changedTouches){var s="touchend"===e.type?e.changedTouches[0]:e.touches[0];t=s.identifier,i=s.pageX,n=s.pageY}else i=e.pageX,n=e.pageY;var r={id:t,type:this._getEventType(e),point:this.localizePoint(i,n),rightClick:2===e.button?!0:!1};this.xInput=r.point.x,this.yInput=r.point.y,this.inputDown="inputEnd"!==r.type,h.push(r),this.fire(r.type,[r]),this.fire("input",[r]),u||(u=!0,this.fire("initialInput"))}},_initInput:function(){var e=this.canvas,t=bind(this,"_handleMouseEvent");d.forEach(function(i){e.addEventListener(i,t,!1)});var i=bind(this,"_handleTouchEvent");c.forEach(function(t){e.addEventListener(t,i,!1)});var n=bind(this,"_handleContextEvent");e.addEventListener("contextmenu",n,!1);var a=bind(this,"_handleWheelEvent");e.addEventListener("wheel",a,!1);var s=bind(this,"_handleMouseOutEvent");e.addEventListener("mouseout",s,!1)},_autoSize:function(){var e=this.canvas,t=Math.min(e.width,e.height),i=Math.max(e.width,e.height),n="both"!==r.orientation&&r.forceOrientation,h=n?r.orientation:a.orientation;
e.width="portrait"==h?t:i,e.height="portrait"==h?i:t;var u=this.viewportWidth||a.width,d=this.viewportHeight||a.height,c=u/e.width,p=d/e.height;a.isCocoonJS?(this.xScale=this.yScale=1,e.style.cssText="idtkscale:ScaleAspectFit;"):l.params.scale?this.xScale=this.yScale=Number(l.params.scale):this.maintainAspectRatio?this.xScale=this.yScale=Math.min(c,p):(this.xScale=c,this.yScale=p),a.log("[stage._autoSize] view: %sx%s, canvas: %sx%s, scale: %s, %s",u,d,e.width,e.height,s.round(this.xScale,3),s.round(this.yScale,3));var g="0 0";if(a.isIOS)var m=o.sprintf("scale3d(%s, %s, 1)",this.xScale,this.yScale);else var m=o.sprintf("scale(%s, %s)",this.xScale,this.yScale);if(a.isBrowser){var f=e.style;f.transformOrigin=g,f.transform=m;for(var v=["webkit","Moz","ms"],y=0,w=v.length;w>y;++y){var _=v[y];f[_+"TransformOrigin"]=g,f[_+"Transform"]=m}f.left=a.width/2-e.width*this.xScale/2+"px","top"===r.yStageAlign?f.top=0:f.top=a.height/2-e.height*this.yScale/2+"px"}this.fire("resize")},_onError:function(e){var t=this.canvas,i=this.ctx,n=[e.message,e.filename+":"+e.lineno,""].concat(e.error.stack.split("\n")),a=Math.round(.025*t.height),s=Math.round(1.35*a);i.fillStyle="#30346D",i.fillRect(0,0,t.width,t.height),i.fillStyle="#DEEED6",i.font=a+"px monospace",i.textBaseline="top";var r=5;n.forEach(function(e){i.fillText(e,10,r),r+=s})}}),g=p.prototype;Object.defineProperty(g,"canFullScreen",{get:function(){return"function"==typeof document.webkitCancelFullScreen}}),Object.defineProperty(g,"isFullScreen",{get:function(){return document.webkitIsFullScreen}}),Object.defineProperty(g,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e,this._autoSize()}}),Object.defineProperty(g,"width",{get:function(){return this.canvas.width}}),Object.defineProperty(g,"height",{get:function(){return this.canvas.height}}),Object.defineProperty(g,"scaleWidth",{get:function(){return this.width*this.xScale}}),Object.defineProperty(g,"scaleHeight",{get:function(){return this.height*this.yScale}}),i.exports=new p}),n("djinn/assets",["require","exports","module","djinn/client","djinn/manifest","djinn/utils/string"],function(e,t,i){var n=e("djinn/client"),a=e("djinn/manifest"),s=e("djinn/utils/string"),r={},o={image:["png","jpg","jpeg","gif"],audio:["mp3","ogg"],font:["ttf"]},l={image:function(e,t,i){var s=new Image;if(s.onload=function(){s.ready=!0,t&&t(e,s)},s.onerror=function(){i&&i(e,s)},n.isBrowser&&"data:"!=e.substring(0,5))var e=e+"?v="+a.version;return s.src=e,s},audio:function(e,t){if("undefined"==typeof Audio)return console.warn("[assets] No Audio object: "+e),t&&t(e,null),null;var i=new Audio;if(""!==i.canPlayType("audio/ogg"))e=e.replace(/\.mp3/,".ogg");else if(""===i.canPlayType("audio/mpeg"))return console.warn("[assets] No audio support: "+e),t&&t(e,null),null;return n.isBrowser?(i.addEventListener("canplay",function(){i.ready||(i.ready=!0,t&&t(e,i))},!1),i.src=e):(i.addEventListener("canplaythrough",function(){i.ready=!0,t&&t(e,i)}),i.src=e,i.load()),i},font:function(e,t){if(n.isBrowser){var i=/^.*\/([^\.]+)\.ttf$/.exec(e),a=i[1],r=s.sprintf("@font-face { font-family: '%s'; src: url('%s'); }",a,e),o=document.createElement("style");o&&(o.innerHTML=r,document.head.appendChild(o))}return t&&t(e,null),null}};t.cacheImage=function(e,t){r[e]=l.image(t)},t.load=function(e,i,n){if(!e||e.length<1)return n&&n(null,null,0,0,1),void(i&&i());"string"==typeof e&&(e=[e]);for(var a=e.length,s=0,o=function(e,t){r[e]=t,++s;var o=s/a;n&&n(e,t,s,a,o),s>=a&&i&&i()},h=function(e,t){console.error("[assets.load] Failed to load asset: "+e),o(e,t)},u=0,d=e.length;d>u;++u){var c=e[u];if(("string"!=typeof c||c.length<=0)&&(--a,console.info("[assets.load] Skipping empty asset path")),r[c])o(c,r[c]);else{var p=t.inferAssetType(c);if(p&&l[p]){var g=l[p];r[c]=g(c,o,h)}else--a,console.info("[assets.load] Skipping unknown asset type: "+c)}}},t.unload=function(e){"string"==typeof e&&(e=[e]);for(var t=0,i=e.length;i>t;++t)delete r[e[t]]},t.queryCache=function(e){return void 0!==r[e]},t.get=function(e){return t.queryCache(e)||(console.warn("[assets.get] On-the-fly asset load: "+e),t.load(e)),r[e]},t.inferAssetType=function(e){var t=e.split("."),i=t.length>0?t.pop():"";for(var n in o)if(-1!=o[n].indexOf(i))return n;return null}}),n("djinn/math/collision",["require","exports","module"],function(e,t,i){var n=function(e,t,i){var n=null;if(Math.abs(e)<1e-6)n=Math.abs(t)<1e-6?Math.abs(i)<1e-6?[0,0]:null:[-i/t,-i/t];else{var a=t*t-4*e*i;a>=0&&(a=Math.sqrt(a),e=2*e,n=[(-t-a)/e,(-t+a)/e])}return n};t.intercept=function(e,t,i,a,s,r,o){var l=i-e,h=a-t,u=s*s+r*r-o*o,d=2*(s*l+r*h),c=l*l+h*h,p=n(u,d,c),g=null;if(p){var m=p[0],f=p[1],v=Math.min(m,f);0>v&&(v=Math.max(m,f)),v>0&&(g={x:i+s*v,y:a+r*v})}return g},t.testPointInRect=function(e,t){return e.x>t.x&&e.y>t.y&&e.x<t.x+t.width&&e.y<t.y+t.height},t.testPointCircle=function(e,t,i,n,a){var s=Math.pow(e-i,2)+Math.pow(t-n,2);return s<Math.pow(a,2)},t.testAABB=function(e,t){var i={contacts:[],normal:{x:0,y:0},penetration:0},n={x:t.x+t.width/2-(e.x+e.width/2),y:t.y+t.height/2-(e.y+e.height/2)},a=(e.x+e.width-e.x)/2,s=(e.y+e.height-e.y)/2,r=(t.x+t.width-t.x)/2,o=(t.y+t.height-t.y)/2,l=a+r-Math.abs(n.x),h=s+o-Math.abs(n.y);return 0>=l||0>=h?i:(i.contacts.push({x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}),i.contacts.push({x:Math.min(e.x+e.width,t.x+t.width),y:Math.min(e.y+e.height,t.y+t.height)}),h>l?(i.normal.x=n.x<0?1:-1,i.penetration=l):(i.normal.y=n.y<0?1:-1,i.penetration=h),i)}}),n("djinn/utils/transitions",[],function(){var e={linear:function(e,t,i,n){return i*e/n+t},easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeBoth:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},inStrong:function(e,t,i,n){return i*(e/=n)*e*e*e+t},outStrong:function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},bothStrong:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},elasticIn:function(e,t,i,n,a,s){if(0==e)return t;if(1==(e/=n))return t+i;if(s||(s=.3*n),!a||a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return-(a*Math.pow(2,10*(e-=1))*Math.sin((e*n-r)*(2*Math.PI)/s))+t},elasticOut:function(e,t,i,n,a,s){if(0==e)return t;if(1==(e/=n))return t+i;if(s||(s=.3*n),!a||a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return a*Math.pow(2,-10*e)*Math.sin((e*n-r)*(2*Math.PI)/s)+i+t},elasticBoth:function(e,t,i,n,a,s){if(0==e)return t;if(2==(e/=n/2))return t+i;if(s||(s=n*(.3*1.5)),!a||a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return 1>e?-.5*(a*Math.pow(2,10*(e-=1))*Math.sin((e*n-r)*(2*Math.PI)/s))+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*n-r)*(2*Math.PI)/s)*.5+i+t},backIn:function(e,t,i,n,a){return void 0===a&&(a=1.70158),i*(e/=n)*e*((a+1)*e-a)+t},backOut:function(e,t,i,n,a){return void 0===a&&(a=1.70158),i*((e=e/n-1)*e*((a+1)*e+a)+1)+t},backBoth:function(e,t,i,n,a){return void 0===a&&(a=1.70158),(e/=n/2)<1?i/2*(e*e*(((a*=1.525)+1)*e-a))+t:i/2*((e-=2)*e*(((a*=1.525)+1)*e+a)+2)+t},bounceIn:function(t,i,n,a){return n-e.bounceOut(a-t,0,n,a)+i},bounceOut:function(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:2/2.75>e?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},bounceBoth:function(t,i,n,a){return a/2>t?.5*e.bounceIn(2*t,0,n,a)+i:.5*e.bounceOut(2*t-a,0,n,a)+.5*n+i}};return e}),n("djinn/utils/Timer",["require","exports","module"],function(e,t,i){var t=i.exports=function(e,t){this.running=!1,this.elapsed=0,this.interval=e||1e3,this.callback=t},n=t.prototype;n.start=function(e){return void 0!==e&&(this.interval=e),this.elapsed=0,this.running=!0,this},n.stop=function(){this.running=!1},n.update=function(e){this.running&&(this.elapsed+=e,this.elapsed>=this.interval&&(this.elapsed-=this.interval,this.callback&&this.callback()))}}),n("djinn/view/utils/canvas",["require","exports","module"],function(e,t,i){t.create=function(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i},t.fill=function(e,t){e.fillStyle=t,e.fill()},t.stroke=function(e,t,i){e.strokeStyle=t,e.lineWidth=i,e.stroke()},t.fillAndStroke=function(e,t,i,n){t&&(e.fillStyle=t,e.fill()),i&&n>0&&(e.lineWidth=n,e.strokeStyle=i,e.stroke())},t.drawTailRect=function(e,t,i,n,a,s,r,o,l){var h=Math.round(r*n),u=Math.round(h-o/2),d=Math.round(h+o/2);e.beginPath(),e.moveTo(t+s,i),e.lineTo(t+n-s,i),e.quadraticCurveTo(t+n,i,t+n,i+s),e.lineTo(t+n,i+a-s),e.quadraticCurveTo(t+n,i+a,t+n-s,i+a),e.lineTo(d,i+a),e.lineTo(h,i+a+l),e.lineTo(u,i+a),e.lineTo(t+s,i+a),e.quadraticCurveTo(t,i+a,t,i+a-s),e.lineTo(t,i+s),e.quadraticCurveTo(t,i,t+s,i),e.closePath()},t.drawRect=function(e,i,n,a,s,r,o,l,h){h>0?(e.beginPath(),e.moveTo(i+h,n),e.lineTo(i+a-h,n),e.quadraticCurveTo(i+a,n,i+a,n+h),e.lineTo(i+a,n+s-h),e.quadraticCurveTo(i+a,n+s,i+a-h,n+s),e.lineTo(i+h,n+s),e.quadraticCurveTo(i,n+s,i,n+s-h),e.lineTo(i,n+h),e.quadraticCurveTo(i,n,i+h,n),e.closePath(),t.fillAndStroke(e,r,o,l)):(r&&(e.fillStyle=r,e.fillRect(i,n,a,s)),o&&l>0&&(e.strokeStyle=o,e.lineWidth=l,e.strokeRect(i,n,a,s)))},t.drawCircle=function(e,i,n,a,s,r,o){e.beginPath(),e.arc(i,n,a,0,2*Math.PI),e.closePath(),t.fillAndStroke(e,s,r,o)},t.drawPolygon=function(e,i,n,a,s){e.beginPath(),e.moveTo(i[0],i[1]);for(var r=2,o=i.length;o>r;r+=2)e.lineTo(i[r],i[r+1]);e.closePath(),t.fillAndStroke(e,n,a,s)},t.drawLine=function(e,t,i,n){e.beginPath(),e.moveTo(t[0],t[1]);for(var a=2,s=t.length;s>a;a+=2)e.lineTo(t[a],t[a+1]);e.closePath(),e.strokeStyle=i,e.lineWidth=n,e.stroke()},t.drawText=function(e,t,i,n,a,s,r,o,l,h,u,d,c){e.font=a,l&&(e.textAlign=l),h&&(e.textBaseline=h),u&&(e.fillStyle=u,e.fillText(t,i+d,n+c)),r&&o>0&&(e.lineWidth=2*o,e.strokeStyle=r,e.strokeText(t,i,n)),s&&(e.fillStyle=s,e.fillText(t,i,n))},t.getTextWidth=function(e,t,i){e.font=i;var n=e.measureText(t);return n.width},t.filter=function(e,t,i,n,a,s){var r=e.getImageData(t,i,n,a),o=r.data;s(o),e.putImageData(r,t,i)}}),n("djinn/view/View",["require","exports","module","../Emitter","../assets","../math/core","../math/collision","../utils/array","../utils/transitions","../utils/Timer","./utils/canvas"],function(e,t,i){var n=e("../Emitter"),a=e("../assets"),s=e("../math/core"),r=e("../math/collision"),o=e("../utils/array"),l=e("../utils/transitions"),h=e("../utils/Timer"),u=e("./utils/canvas"),d={a:1,b:0,c:0,d:1,tx:0,ty:0},c=0,p=function(e,t){return e.z===t.z?e.id-t.id:e.z-t.z},t=i.exports=n.extend({init:function(e){var i=++c;e=merge(e,{id:i,tag:"View_"+i},t.defaults),e.parent&&(e.width=e.width||e.parent.width,e.height=e.height||e.parent.height),this._super(e),this.id=e.id,this.tag=e.tag,this.x=e.x,this.y=e.y,this.z=e.z,this.rotation=e.rotation,this.pivotX=e.pivotX,this.pivotY=e.pivotY,this.anchorX=e.anchorX,this.anchorY=e.anchorY,this.width=e.width,this.height=e.height,this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.flipX=e.flipX,this.flipY=e.flipY,e.scale&&(this.scale=e.scale),this.alpha=1,this.transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this.visible=e.visible,this.opacity=e.opacity,this.clip=e.clip,this.backgroundColor=e.backgroundColor,this.overlayColor=e.overlayColor,this.compositeOperation=e.compositeOperation,this.imageSmoothingEnabled=e.imageSmoothingEnabled,this._image=null,this.imageX=e.imageX,this.imageY=e.imageY,this.acceptInputEvents=e.acceptInputEvents,this.captureInputEvents=e.captureInputEvents,this.cancelInputEvents=e.cancelInputEvents,this.paused=e.paused,this.tickSpeed=e.tickSpeed,this.autoSortChildren=e.autoSortChildren,this.buffer=e.buffer,this.bufferPadding=e.bufferPadding,this._buffer=null,this._bufferDirty=!0,this.debug=e.debug,this.children=[],this._removedChildren=[],this._tweenQueue=[],e.image&&(this.image=e.image),void 0!==e.left&&(this.left=e.left),void 0!==e.top&&(this.top=e.top),void 0!==e.bottom&&(this.bottom=e.bottom),void 0!==e.right&&(this.right=e.right),e.parent&&e.parent.addChild(this),this._inputStartID=null},dispose:function(){this._buffer=null,this.removeFromParent(),this.cancelTween(),this.disposeChildren(),this._super()},disposeChildren:function(){for(var e=this.children,t=0,i=e.length;i>t;++t)e[t].dispose()},set:function(e){for(var t in e)this[t]=e[t];return this},resize:function(e,t){this.width=e,this.height=t},addChild:function(e){e.parent&&e.removeFromParent(),e.parent=this,this.children.push(e)},removeChild:function(e){e.parent==this&&-1==this._removedChildren.indexOf(e)&&(e.parent=null,this._removedChildren.push(e))},getChildByTag:function(e){for(var t=0,i=this.children.length;i>t;++t){var n=this.children[t];if(n.tag==e)return n}return null},removeChildren:function(){for(var e=0,t=this.children.length;t>e;++e){var i=this.children[e];i.removeFromParent()}},removeFromParent:function(){this.parent&&this.parent.removeChild(this),this.fire("removedFromParent",[this])},sortChildren:function(){this.children.sort(p)},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},toggle:function(){return this.visible?this.hide():this.show()},shrinkwrap:function(e,t){e!==!1&&(this.width=0),t!==!1&&(this.height=0);for(var i=this.children,n=0,a=i.length;a>n;++n){var s=i[n];s.parent===this&&s.visible&&(e!==!1&&s.right>this.width&&(this.width=s.right),t!==!1&&s.bottom>this.height&&(this.height=s.bottom))}return this},redrawBuffer:function(){return this._bufferDirty=!0,this},react:function(e){if(this.canReact){if(this.captureInputEvents){for(var t={x:e.point.x-this.left,y:e.point.y-this.top},i=this.children.length-1;i>=0;--i){var n=this.children[i];!e.cancel&&n.canReact&&r.testPointInRect(t,n.bounds)?(e.point.x=t.x,e.point.y=t.y,n.react(e)):n.endInputHover()}e.target||(e.target=this),e.point.x=t.x,e.point.y=t.y,this.fire(e.type,[e]),"inputStart"===e.type?this._inputStartID=e.id:"inputEnd"===e.type&&this._inputStartID===e.id?(this.fire("inputPress",[e]),this._inputStartID=null):"inputMove"!==e.type||this._inputHover||(this._inputHover=!0,this.fire("inputEnter",[e]))}this.cancelInputEvents&&(e.cancel=!0)}},endInputHover:function(){if(this._inputHover){this._inputHover=!1,this.fire("inputLeave");for(var e=this.children,t=e.length-1;t>=0;--t){var i=e[t];i.endInputHover()}}},preTick:function(e){if(!this.paused&&this.visible){var e=e*this.tickSpeed;this._cullChildren(),this._updateTween(e),this._updateTimers(e),this.tick&&this.tick(e),this.fire("tick",[e]);for(var t=this.children,i=0,n=t.length;n>i;++i)t[i].preTick(e)}},preRender:function(e){if(this.visible&&!(this.opacity<=0)){this._updateTransform();var t=this.transform;e.setTransform(t.a,t.c,t.b,t.d,t.tx+.5|0,t.ty+.5|0),e.globalAlpha=this.alpha;var i=this.compositeOperation;if(i){var n=e.globalCompositeOperation;e.globalCompositeOperation=i}var a=this.imageSmoothingEnabled;a===!1&&(e.imageSmoothingEnabled=!1),this.clip&&(e.save(),e.beginPath(),e.rect(0,0,this.width,this.height),e.clip()),this.buffer?this._renderBuffer(e):(this.render(e),this.debug&&this._renderDebug(e),this.renderChildren(e)),i&&(e.globalCompositeOperation=n),this.clip&&e.restore()}},renderChildren:function(e){this.autoSortChildren&&this.sortChildren();for(var t=this.children,i=0,n=t.length;n>i;++i){var a=t[i];a.parent===this&&a.preRender(e)}},render:function(e){var t=e;this.overlayColor&&(this._makeBuffer(),t=this._bufferContext),this._image&&this._image.ready?t.drawImage(this._image,this.imageX,this.imageY,this.width,this.height,0,0,this.width,this.height):this.backgroundColor&&(t.fillStyle=this.backgroundColor,t.fillRect(0,0,this.width,this.height)),this.overlayColor&&(t.globalCompositeOperation="source-atop",t.fillStyle=this.overlayColor,t.fillRect(0,0,this.width,this.height)),t!==e&&e.drawImage(this._bufferCanvas,0,0,this.width,this.height)},_updateTransform:function(){var e=Math.sin(this.rotation),t=Math.cos(this.rotation),i=this.parent,n=this.transform,a=i?i.transform:d,s=this.pivotX*this.width,r=this.pivotY*this.height,o=this.x,l=this.y,h=this.anchorX*this.width,u=this.anchorY*this.height,c=this.scaleX,p=this.scaleY;this.flipX&&(c*=-1),this.flipY&&(p*=-1);var g=t*c,m=-e*p,f=e*c,v=t*p,y=o+s-g*s-r*m,w=l+r-v*r-s*f,_=a.a,x=a.b,b=a.c,k=a.d;n.a=_*g+x*f,n.b=_*m+x*v,n.c=b*g+k*f,n.d=b*m+k*v,n.tx=_*y+x*w+a.tx-h,n.ty=b*y+k*w+a.ty-u;var j=i?i.alpha:1;this.alpha=this.opacity*j},_makeBuffer:function(){return this._bufferCanvas?(this._bufferCanvas.width=this.width,void(this._bufferCanvas.height=this.height)):(this._bufferCanvas=u.create(this.width,this.height),void(this._bufferContext=this._bufferCanvas.getContext("2d")))},align:function(e,t,i,n){if(!this.parent)return this;if(e){switch(e){case"left":this.left=0;break;case"right":this.right=this.parent.width;break;case"center":this.centerX=this.parent.width/2}this.left+=i||0}if(t){switch(t){case"top":this.top=0;break;case"bottom":this.bottom=this.parent.height;break;case"center":this.centerY=this.parent.height/2}this.top+=n||0}return this},centerOn:function(e,t,i){return void 0!==e.centerX?(this.centerX=e.centerX+(t||0),this.centerY=e.centerY+(i||0)):void 0!==e.width?(this.centerX=e.x+e.width/2+(t||0),this.centerY=e.y+e.height/2+(i||0)):(this.centerX=e.x+(t||0),this.centerY=e.y+(i||0)),this},tween:function(e,t,i,n){if(null!=e){var e=merge(e);for(var a in e){var s=e[a];"object"!=typeof s&&(e[a]={from:null,to:s})}}return this._tweenQueue.push({properties:e,duration:isNaN(t)?1e3:t,transition:i||l.linear,callback:n||null,elapsed:0}),this.visible||this.completeTween(),this},delayTween:function(e,t){return this.tween(null,e,null,t)},cancelTween:function(e){return this._tweenQueue=[],e&&this.set(e),this},completeTween:function(e){for(var t=this._tweenQueue.length,i=this._tweenQueue.splice(0,t),n=0;t>n;++n){var a=i[n];for(var s in a.properties)this[s]=a.properties[s].to;a.callback&&a.callback()}return e&&this.set(e),this},_updateTween:function(e){for(var t=this._tweenQueue,i=function(){var e=t.shift();e.callback&&e.callback()};e>0&&t.length>0;){var n=t[0],a=n.duration-n.elapsed,s=Math.min(e,a);if(n.elapsed+=s,e-=s,null!==n.properties)if(n.elapsed>=n.duration||n.duration<=0){for(var r in n.properties)this[r]=n.properties[r].to;i()}else for(var r in n.properties){var o=n.properties[r];null==o.from&&(o.from=this[r]);var l=n.transition(n.elapsed,o.from,o.to-o.from,n.duration);this[r]=l}else n.elapsed>=n.duration&&i()}},createTimer:function(e,t){"string"==typeof t&&(t=this[t].bind(this));var i=new h(e,t);return this._timers||(this._timers=[]),this._timers.push(i),i},removeTimer:function(e){o.removeValue(this._timers,e)},_updateTimers:function(e){if(this._timers)for(var t=this._timers.length-1;t>=0;--t)this._timers[t].update(e)},_cullChildren:function(){var e=this._removedChildren,t=e.length;if(!(1>t)){for(var i=this.children,n=0;t>n;++n){var a=e[n],s=i.indexOf(a);-1!=s?i.splice(s,1):console.warn("Tried to remove non-child "+a.tag+" from "+this.tag)}e.splice(0,t)}},_resizeBuffer:function(){var e=this._buffer,t=this.bufferPadding;e.width=this.width+2*t,e.height=this.height+2*t},_checkBuffer:function(){},_renderBuffer:function(e){var t=this._buffer;if(this._bufferDirty||this._checkBuffer(),this._bufferDirty){t||(t=this._buffer=u.create(1,1)),this._resizeBuffer();var i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);var n=this.bufferPadding,a=this.x,s=this.y,r=this.parent,o=this.anchorX,l=this.anchorY,h=this.opacity;this.x=n,this.y=n,this.parent=null,this.anchorX=0,this.anchorY=0,this.opacity=1,this._updateTransform(),0!==n&&i.translate(n,n),this.render(i),this.debug&&this._renderDebug(i),this.renderChildren(i),this.x=a,this.y=s,this.anchorX=o,this.anchorY=l,this.opacity=h,this.parent=r,this._bufferDirty=!1}var d=Math.round(this.width/2-t.width/2),c=Math.round(this.height/2-t.height/2);e.drawImage(t,0,0,t.width,t.height,d,c,t.width,t.height)},_renderDebug:function(e){u.drawRect(e,0,0,this.width,this.height,null,"blue",1)}});t.transitions=l;var g=t.prototype;Object.defineProperty(g,"left",{get:function(){return this.x-this.anchorX*this.width},set:function(e){this.x=e+this.anchorX*this.width}}),Object.defineProperty(g,"top",{get:function(){return this.y-this.anchorY*this.height},set:function(e){this.y=e+this.anchorY*this.height}}),Object.defineProperty(g,"right",{get:function(){return this.left+this.width},set:function(e){this.left=e-this.width}}),Object.defineProperty(g,"bottom",{get:function(){return this.top+this.height},set:function(e){this.top=e-this.height}}),Object.defineProperty(g,"centerX",{get:function(){return this.left+this.width/2},set:function(e){this.left=e-this.width/2}}),Object.defineProperty(g,"centerY",{get:function(){return this.top+this.height/2},set:function(e){this.top=e-this.height/2}}),Object.defineProperty(g,"bounds",{get:function(){return{x:this.left,y:this.top,width:this.width,height:this.height}}}),Object.defineProperty(g,"scale",{get:function(){return Math.max(this.scaleX,this.scaleY)},set:function(e){this.scaleX=e,this.scaleY=e}}),Object.defineProperty(g,"scaleWidth",{get:function(){return this.width*this.scaleX}}),Object.defineProperty(g,"scaleHeight",{get:function(){return this.height*this.scaleY}}),Object.defineProperty(g,"image",{set:function(e){this._image=a.get(e)}}),Object.defineProperty(g,"center",{get:function(){return{x:this.centerX,y:this.centerY}}}),Object.defineProperty(g,"canReact",{get:function(){return this.acceptInputEvents&&this.visible&&!this.paused}}),Object.defineProperty(g,"imageIndex",{set:function(e){var t=Math.floor(this._image.width/this.width);this.imageX=s.indexToX(e,t)*this.width,this.imageY=s.indexToY(e,t)*this.height}}),t.defaults={parent:null,x:0,y:0,z:1,pivotX:.5,pivotY:.5,anchorX:0,anchorY:0,acceptInputEvents:!1,captureInputEvents:!0,cancelInputEvents:!1,debug:!1,rotation:0,clip:!1,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,visible:!0,opacity:1,backgroundColor:null,overlayColor:null,compositeOperation:null,image:null,imageX:0,imageY:0,paused:!1,tickSpeed:1,buffer:!1,bufferPadding:0,autoSortChildren:!1}}),n("djinn/TextView",["require","exports","module","./view/View","./utils/string"],function(e,t,i){var n=e("./view/View"),a=e("./utils/string"),t=i.exports=n.extend({init:function(e){e=merge(e,t.defaults),e.parent&&(!e.width||e.width<1)&&(e.width=e.parent.width),(!e.height||e.height<1)&&(e.height=e.fontSize),this._super(e),this._lineBuffer=null,this._rawText=null,this.color=e.color,this.fontSize=e.fontSize,this.fontFamily=e.fontFamily,this.shadowColor=e.shadowColor,this.shadowX=e.shadowX,this.shadowY=e.shadowY,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth,this.textAlign=e.textAlign,this.verticalAlign=e.verticalAlign,this.wordWrap=e.wordWrap,this.autoSize=e.autoSize,this.text=e.text},render:function(e){if(this._super(e),!(void 0===this.text||null===this.text||this.text.length<1)){null==this._lineBuffer&&this._bufferLines(this.text,e);var t=0,i=0;"center"==this.textAlign&&(t=this.width/2),"right"==this.textAlign&&(t=this.width),"middle"==this.verticalAlign&&(i=this.height/2),this._applyContextSettings(e);var n=e.measureText(this._rawText),a=~~n.width;this.autoSize&&a!==this.width&&(this.width=a,this.height=this.fontSize,this.fire("autoSize"));for(var s=0,r=this._lineBuffer.length;r>s;++s){var o=i+s*this.fontSize,l=this._lineBuffer[s];this.shadowColor&&(e.fillStyle=this.shadowColor,e.fillText(l,t+this.shadowX,o+this.shadowY)),this.strokeColor&&this.strokeWidth&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.strokeText(l,t,o)),e.fillStyle=this.color,e.fillText(l,t,o)}}},_applyContextSettings:function(e){var t=a.sprintf("%spx %s",this.fontSize,this.fontFamily);e.font=t,e.textAlign=this.textAlign,e.textBaseline=this.verticalAlign,e.lineWidth=this.strokeWidth},_bufferLines:function(e,t){var e=String(e);if(this._lineBuffer=[],this.wordWrap){this._applyContextSettings(t);for(var i=e.split(" "),n=0,a=0,s=i.length;s>a;++a){var r=this._lineBuffer[n]||"",o=r.length>0?r+" "+i[a]:i[a];r.length>0&&t.measureText(o).width>this.width?(++n,this._lineBuffer[n]=i[a]):this._lineBuffer[n]=o}}else this._lineBuffer.push(e)}});Object.defineProperty(t.prototype,"text",{get:function(){return this._rawText},set:function(e){this._lineBuffer=null,this._rawText=void 0===e?null:String(e)}}),t.defaults={color:"rgb(0, 0, 0)",fontFamily:"Arial",fontSize:20,shadowColor:null,shadowX:1,shadowY:1,strokeColor:null,strokeWidth:null,text:"",textAlign:"left",verticalAlign:"top",wordWrap:!0,autoSize:!1}}),n("djinn/ui/ProgressBar",["djinn/view/View"],function(e){return e.extend({init:function(e){var e=merge(e,{progress:0});this._super(e),this.progress=Number(e.progress)},render:function(e){this._super(e);var t=this.width*this.progress;e.fillStyle="rgb(100, 100, 100)",e.fillRect(0,0,t,this.height),e.lineWidth=2,e.strokeStyle="rgb(230, 230, 230)",e.strokeRect(0,0,this.width,this.height)}})}),n("djinn/utils/viewEffects",["djinn/math/core","djinn/utils/transitions"],function(e,t){return{alert:function(e,i,n){var i=i||{},a=e.z;e.completeTween({z:1/0}).tween({scale:i.scale||1.5},(i.duration||500)/2,t.easeBoth,function(){i.midCallback&&i.midCallback()}).tween({scale:1},(i.duration||500)/2,t.easeBoth,function(){e.z=a,n&&n()})},burst:function(e,i,n){e.completeTween({opacity:0,scale:.5}),e.tween({opacity:1,rotation:Math.PI/2,scale:1.5},100,t.linear).tween({opacity:0},100,t.linear,function(){n&&n()})},buttonPress:function(e,i,n){e.completeTween().tween({y:e.y+e.height/10},50,t.linear).tween({y:e.y},50,t.linear,n)},fadeOut:function(e,i,n){var i=i||{};e.completeTween().tween({opacity:0},i.duration||500,t.linear,n)},fadeIn:function(e,i,n){var i=i||{};e.completeTween().tween({opacity:1},i.duration||500,t.linear,n)},fadeInAndOut:function(e,t,i){var t=t||{},n=(t.duration||1e3)/2;e.completeTween({opacity:0,visible:!0}),e.tween({opacity:t.opacity||1},n).tween({opacity:0},n,null,i)},popIn:function(i,n,a){var n=n||{},s=1==e.random(1,2)?2:-2,r=e.clamp(i.x+i.width*s,0,i.parent.width-i.width),o=i.y;i.completeTween({opacity:n.opacity||0,scale:n.scale||.5}),i.y+=i.height/2,i.tween({opacity:1,scale:1,x:r,y:o},200,t.linear).tween({scale:1.25},50,t.linear).tween({scale:1},50,t.linear,a)},popOut:function(e,i,n){e.completeTween({opacity:1}).tween({scale:.75},50,t.linear).tween({opacity:0,scale:2},250,t.linear,n)},shake:function(e,t,i){e.completeTween();for(var t=t||{},n=t.iterations||10,a=(t.duration||250)/n,s=t.violence||6,r=e.x,o=e.y,l=0;n>l;++l)e.tween({x:e.x+s*(l%2?1:-1)},a);e.delayTween(0,function(){e.x=r,e.y=o,i&&i()})},squishyAppear:function(e,i,n){var i=i||{},a=i.duration||500,s=i.scale||1;e.completeTween({scaleX:2*s,scaleY:0}),e.tween({scaleX:.5*s,scaleY:2*s},.3*a,t.linear).tween({scaleX:s,scaleY:s},.7*a,t.elasticOut,function(){n&&n()})},squishyDisappear:function(e,i,n){var i=i||{},a=i.duration||500,s=i.scale||1;e.completeTween({scaleX:s,scaleY:s}),e.tween({scaleX:.5*s,scaleY:2*s},.3*a,t.linear).tween({scaleX:2*s,scaleY:0},.7*a,t.elasticOut,function(){n&&n()})},vibrate:function(t,i,n){t.completeTween();for(var i=i||{},a=i.iterations||10,s=(i.duration||250)/a,r=i.violence||6,o=t.x,l=t.y,h=0;a>h;++h)t.tween({x:t.x+e.random(-r,r),y:t.y+e.random(-r,r)},s);t.delayTween(1,function(){t.x=o,t.y=l,n&&n()})}}}),n("djinn/helpers/LoadingScreen",["djinn/manifest","djinn/assets","djinn/view/View","djinn/TextView","djinn/ui/ProgressBar","djinn/utils/viewEffects","djinn/stage"],function(e,t,i,n,a,s,r){var o=merge(e.splash,{fadeDuration:1,displayDuration:0,backgroundColor:"rgb(0, 0, 0)",imageWidth:100,imageHeight:100});return i.extend({init:function(e){Object.defineProperty(this,"loadingProgress",{set:function(e){this._loadingBar.progress=e,this._loadingText.text="LOADING: "+~~(100*e)+"%"}});var e=merge({tag:"LoadingScreen",acceptInputEvents:!0,cancelInputEvents:!0,visible:!1,backgroundColor:o.backgroundColor,z:1/0},e);if(this._super(e),o.images&&o.images.length>0){var s=o.images[r.sizeIndex];t.load(s.image),this._splashImage=new i(merge({parent:this},s)).align("center","center")}var l=.05*this.height;this._loadingBar=new a({parent:this,visible:!1,width:.8*this.width,height:l}).align("center","bottom",0,-l),this._loadingText=new n({parent:this,visible:!1,text:"LOADING",textAlign:"center",verticalAlign:"middle",color:"rgb(255, 255, 255)",fontSize:~~(.75*l),height:l}).align("center","bottom",0,-l),this._uiDelayTimer=this.createTimer(500,"_onDelayElapsed"),this.on("inputStart",this,"_onInputStart")},show:function(e){this.set({opacity:0,visible:!0}),s.fadeIn(this,{duration:o.fadeDuration}),this.delayTween(o.displayDuration,function(){e&&e()}),this._uiDelayTimer.start()},hide:function(e){this.acceptInputEvents=!1,s.fadeOut(this,{duration:o.fadeDuration},bind(this,function(){this.visible=!1,e&&e()}))},_onDelayElapsed:function(){this._uiDelayTimer.stop(),this._loadingBar.progress<1&&(this._loadingText.visible=!0,this._loadingBar.visible=!0)},_onInputStart:function(e){this._onDelayElapsed(),this.completeTween()}})}),n("djinn/Collection",["require","exports","module","djinn/Emitter","djinn/utils/array"],function(e,t,i){var n=e("djinn/Emitter"),a=e("djinn/utils/array"),t=i.exports=n.extend({init:function(e){this._super(e),this.items=[],this._itemIDSeed=0,this._lookup={},this._length=0,this._indexPool=[]},add:function(e){if("undefined"==typeof e.id&&(e.id=++this._itemIDSeed),this.has(e.id))return console.warn("[Collection.add] Item ID conflict: "+e.id),null;if(this._indexPool.length>0){var t=this._indexPool.shift();this.items[t]=e}else{this._length=this.items.push(e);var t=this._length-1}return this._lookup[e.id]=t,this.fire("add",[e]),e.id},remove:function(e,t){var i=e.id||e,n=this._getIndex(i);if(!this._isValidIndex(n))return null;var e=this.items[n];return this.items[n]=null,delete this._lookup[i],this._indexPool.push(n),t&&e.removeListeners&&e.removeAllListeners(),this.fire("remove",[e]),e},has:function(e){return null!==this.get(e)},get:function(e){var t=this._getIndex(e);if(isNaN(t)||t>=this._length)return null;var i=this.items[t]||null;return i},forEach:function(e,t){for(var i=0;i<this._length;++i){var n=this.items[i];null!==n&&(t?e.call(t,n,this):e(n,this))}},sort:function(){this.items.sort(function(e,t){return e?t?t.id-e.id:-1:1}),this._rebuild()},pickRandom:function(){return a.pickRandom(this.items)},removeAll:function(e){this.forEach(function(t,i){t&&this.remove(t.id,e)},this),this.items=[],this._lookup={},this._indexPool=[],this._length=0},_getIndex:function(e){return this._lookup[e]},_isValidIndex:function(e){return e>=0&&e<this._length},_rebuild:function(){this._lookup={},this._indexPool=[];for(var e=0,t=this.items.length;t>e;++e){var i=this.items[e];i?this._lookup[i.id]=e:this._indexPool.push(e)}}});Object.defineProperty(t.prototype,"length",{get:function(){return this._length}})}),n("djinn/utils/log",["require","exports","module","../Emitter","./string"],function(e,t,i){var n=e("../Emitter"),a=(e("./string"),n.extend({init:function(e){this._super(e),this.messages=[]},info:function(e){this.messages.push(e),this.fire("message",[e]),console.info(e)},warn:function(e){this.messages.push(e),this.fire("message",[e]),console.warn(e)},error:function(e){this.messages.push(e),this.fire("message",[e]),console.error(e)}}));i.exports=new a}),function(){var e={},t=null,i=!0,a=!1;try{"undefined"!=typeof AudioContext?t=new AudioContext:"undefined"!=typeof webkitAudioContext?t=new webkitAudioContext:i=!1}catch(s){i=!1}if(!i)if("undefined"!=typeof Audio)try{new Audio}catch(s){a=!0}else a=!0;if(i){var r="undefined"==typeof t.createGain?t.createGainNode():t.createGain();r.gain.value=1,r.connect(t.destination)}var o=function(){this._volume=1,this._muted=!1,this.usingWebAudio=i,this.noAudio=a,this._howls=[]};o.prototype={volume:function(e){var t=this;if(e=parseFloat(e),e>=0&&1>=e){t._volume=e,i&&(r.gain.value=e);for(var n in t._howls)if(t._howls.hasOwnProperty(n)&&t._howls[n]._webAudio===!1)for(var a=0;a<t._howls[n]._audioNode.length;a++)t._howls[n]._audioNode[a].volume=t._howls[n]._volume*t._volume;return t}return i?r.gain.value:t._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(e){var t=this;t._muted=e,i&&(r.gain.value=e?0:t._volume);for(var n in t._howls)if(t._howls.hasOwnProperty(n)&&t._howls[n]._webAudio===!1)for(var a=0;a<t._howls[n]._audioNode.length;a++)t._howls[n]._audioNode[a].muted=e;
}};var l=new o,h=null;if(!a){h=new Audio;var u={mp3:!!h.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!h.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}var d=function(e){var t=this;t._autoplay=e.autoplay||!1,t._buffer=e.buffer||!1,t._duration=e.duration||0,t._format=e.format||null,t._loop=e.loop||!1,t._loaded=!1,t._sprite=e.sprite||{},t._src=e.src||"",t._pos3d=e.pos3d||[0,0,-.5],t._volume=void 0!==e.volume?e.volume:1,t._urls=e.urls||[],t._rate=e.rate||1,t._model=e.model||null,t._onload=[e.onload||function(){}],t._onloaderror=[e.onloaderror||function(){}],t._onend=[e.onend||function(){}],t._onpause=[e.onpause||function(){}],t._onplay=[e.onplay||function(){}],t._onendTimer=[],t._webAudio=i&&!t._buffer,t._audioNode=[],t._webAudio&&t._setupAudioNode(),l._howls.push(t),t.load()};if(d.prototype={load:function(){var t=this,i=null;if(a)return void t.on("loaderror");for(var n=0;n<t._urls.length;n++){var s,r;if(t._format)s=t._format;else{if(r=t._urls[n].toLowerCase().split("?")[0],s=r.match(/.+\.([^?]+)(\?|$)/),s=s&&s.length>=2?s:r.match(/data\:audio\/([^?]+);/),!s)return void t.on("loaderror");s=s[1]}if(u[s]){i=t._urls[n];break}}if(!i)return void t.on("loaderror");if(t._src=i,t._webAudio)c(t,i);else{var h=new Audio;h.addEventListener("error",function(){h.error&&4===h.error.code&&(o.noAudio=!0),t.on("loaderror",{type:h.error?h.error.code:0})},!1),t._audioNode.push(h),h.src=i,h._pos=0,h.preload="auto",h.volume=l._muted?0:t._volume*l.volume(),e[i]=t;var d=function(){t._duration=Math.ceil(10*h.duration)/10,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play(),h.removeEventListener("canplaythrough",d,!1)};h.addEventListener("canplaythrough",d,!1),h.load()}return t},urls:function(e){var t=this;return e?(t.stop(),t._urls="string"==typeof e?[e]:e,t._loaded=!1,t.load(),t):t._urls},play:function(e,i){var n=this;return"function"==typeof e&&(i=e),e&&"function"!=typeof e||(e="_default"),n._loaded?n._sprite[e]?(n._inactiveNode(function(a){a._sprite=e;var s=a._pos>0?a._pos:n._sprite[e][0]/1e3,r=0;n._webAudio?(r=n._sprite[e][1]/1e3-a._pos,a._pos>0&&(s=n._sprite[e][0]/1e3+s)):r=n._sprite[e][1]/1e3-(s-n._sprite[e][0]/1e3);var o,h=!(!n._loop&&!n._sprite[e][2]),u="string"==typeof i?i:Math.round(Date.now()*Math.random())+"";if(function(){var t={id:u,sprite:e,loop:h};o=setTimeout(function(){!n._webAudio&&h&&n.stop(t.id).play(e,t.id),n._webAudio&&!h&&(n._nodeById(t.id).paused=!0,n._nodeById(t.id)._pos=0),n._webAudio||h||n.stop(t.id),n.on("end",u)},1e3*r),n._onendTimer.push({timer:o,id:t.id})}(),n._webAudio){var d=n._sprite[e][0]/1e3,c=n._sprite[e][1]/1e3;a.id=u,a.paused=!1,g(n,[h,d,c],u),n._playStart=t.currentTime,a.gain.value=n._volume,"undefined"==typeof a.bufferSource.start?a.bufferSource.noteGrainOn(0,s,r):a.bufferSource.start(0,s,r)}else{if(4!==a.readyState&&(a.readyState||!navigator.isCocoonJS))return n._clearEndTimer(u),function(){var t=n,s=e,r=i,o=a,l=function(){t.play(s,r),o.removeEventListener("canplaythrough",l,!1)};o.addEventListener("canplaythrough",l,!1)}(),n;a.readyState=4,a.id=u,a.currentTime=s,a.muted=l._muted||a.muted,a.volume=n._volume*l.volume(),setTimeout(function(){a.play()},0)}return n.on("play"),"function"==typeof i&&i(u),n}),n):("function"==typeof i&&i(),n):(n.on("load",function(){n.play(e,i)}),n)},pause:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.pause(e)}),t;t._clearEndTimer(e);var i=e?t._nodeById(e):t._activeNode();if(i)if(i._pos=t.pos(null,e),t._webAudio){if(!i.bufferSource||i.paused)return t;i.paused=!0,"undefined"==typeof i.bufferSource.stop?i.bufferSource.noteOff(0):i.bufferSource.stop(0)}else i.pause();return t.on("pause"),t},stop:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.stop(e)}),t;t._clearEndTimer(e);var i=e?t._nodeById(e):t._activeNode();if(i)if(i._pos=0,t._webAudio){if(!i.bufferSource||i.paused)return t;i.paused=!0,"undefined"==typeof i.bufferSource.stop?i.bufferSource.noteOff(0):i.bufferSource.stop(0)}else isNaN(i.duration)||(i.pause(),i.currentTime=0);return t},mute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.mute(e)}),t;var i=e?t._nodeById(e):t._activeNode();return i&&(t._webAudio?i.gain.value=0:i.muted=!0),t},unmute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.unmute(e)}),t;var i=e?t._nodeById(e):t._activeNode();return i&&(t._webAudio?i.gain.value=t._volume:i.muted=!1),t},volume:function(e,t){var i=this;if(e=parseFloat(e),e>=0&&1>=e){if(i._volume=e,!i._loaded)return i.on("play",function(){i.volume(e,t)}),i;var n=t?i._nodeById(t):i._activeNode();return n&&(i._webAudio?n.gain.value=e:n.volume=e*l.volume()),i}return i._volume},loop:function(e){var t=this;return"boolean"==typeof e?(t._loop=e,t):t._loop},sprite:function(e){var t=this;return"object"==typeof e?(t._sprite=e,t):t._sprite},pos:function(e,i){var n=this;if(!n._loaded)return n.on("load",function(){n.pos(e)}),"number"==typeof e?n:n._pos||0;e=parseFloat(e);var a=i?n._nodeById(i):n._activeNode();if(a)return e>=0?(n.pause(i),a._pos=e,n.play(a._sprite,i),n):n._webAudio?a._pos+(t.currentTime-n._playStart):a.currentTime;if(e>=0)return n;for(var s=0;s<n._audioNode.length;s++)if(n._audioNode[s].paused&&4===n._audioNode[s].readyState)return n._webAudio?n._audioNode[s]._pos:n._audioNode[s].currentTime},pos3d:function(e,t,i,n){var a=this;if(t="undefined"!=typeof t&&t?t:0,i="undefined"!=typeof i&&i?i:-.5,!a._loaded)return a.on("play",function(){a.pos3d(e,t,i,n)}),a;if(!(e>=0||0>e))return a._pos3d;if(a._webAudio){var s=n?a._nodeById(n):a._activeNode();s&&(a._pos3d=[e,t,i],s.panner.setPosition(e,t,i),s.panner.panningModel=a._model||"HRTF")}return a},fade:function(e,t,i,n,a){var s=this,r=Math.abs(e-t),o=e>t?"down":"up",l=r/.01,h=i/l;if(!s._loaded)return s.on("load",function(){s.fade(e,t,i,n,a)}),s;s.volume(e,a);for(var u=1;l>=u;u++)!function(){var e=s._volume+("up"===o?.01:-.01)*u,i=Math.round(1e3*e)/1e3,r=t;setTimeout(function(){s.volume(i,a),i===r&&n&&n()},h*u)}()},fadeIn:function(e,t,i){return this.volume(0).play().fade(0,e,t,i)},fadeOut:function(e,t,i,n){var a=this;return a.fade(a._volume,e,t,function(){i&&i(),a.pause(n),a.on("end")},n)},_nodeById:function(e){for(var t=this,i=t._audioNode[0],n=0;n<t._audioNode.length;n++)if(t._audioNode[n].id===e){i=t._audioNode[n];break}return i},_activeNode:function(){for(var e=this,t=null,i=0;i<e._audioNode.length;i++)if(!e._audioNode[i].paused){t=e._audioNode[i];break}return e._drainPool(),t},_inactiveNode:function(e){for(var t=this,i=null,n=0;n<t._audioNode.length;n++)if(t._audioNode[n].paused&&4===t._audioNode[n].readyState){e(t._audioNode[n]),i=!0;break}if(t._drainPool(),!i){var a;if(t._webAudio)a=t._setupAudioNode(),e(a);else{t.load(),a=t._audioNode[t._audioNode.length-1];var s=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",r=function(){a.removeEventListener(s,r,!1),e(a)};a.addEventListener(s,r,!1)}}},_drainPool:function(){var e,t=this,i=0;for(e=0;e<t._audioNode.length;e++)t._audioNode[e].paused&&i++;for(e=t._audioNode.length-1;e>=0&&!(5>=i);e--)t._audioNode[e].paused&&(t._webAudio&&t._audioNode[e].disconnect(0),i--,t._audioNode.splice(e,1))},_clearEndTimer:function(e){for(var t=this,i=0,n=0;n<t._onendTimer.length;n++)if(t._onendTimer[n].id===e){i=n;break}var a=t._onendTimer[i];a&&(clearTimeout(a.timer),t._onendTimer.splice(i,1))},_setupAudioNode:function(){var e=this,i=e._audioNode,n=e._audioNode.length;return i[n]="undefined"==typeof t.createGain?t.createGainNode():t.createGain(),i[n].gain.value=e._volume,i[n].paused=!0,i[n]._pos=0,i[n].readyState=4,i[n].connect(r),i[n].panner=t.createPanner(),i[n].panner.panningModel=e._model||"equalpower",i[n].panner.setPosition(e._pos3d[0],e._pos3d[1],e._pos3d[2]),i[n].panner.connect(i[n]),i[n]},on:function(e,t){var i=this,n=i["_on"+e];if("function"==typeof t)n.push(t);else for(var a=0;a<n.length;a++)t?n[a].call(i,t):n[a].call(i);return i},off:function(e,t){for(var i=this,n=i["_on"+e],a=t.toString(),s=0;s<n.length;s++)if(a===n[s].toString()){n.splice(s,1);break}return i},unload:function(){for(var t=this,i=t._audioNode,n=0;n<t._audioNode.length;n++)i[n].paused||t.stop(i[n].id),t._webAudio?i[n].disconnect(0):i[n].src="";for(n=0;n<t._onendTimer.length;n++)clearTimeout(t._onendTimer[n].timer);var a=l._howls.indexOf(t);null!==a&&a>=0&&l._howls.splice(a,1),delete e[t._src],t=null}},i)var c=function(i,n){if(n in e)i._duration=e[n].duration,p(i);else{var a=new XMLHttpRequest;a.open("GET",n,!0),a.responseType="arraybuffer",a.onload=function(){t.decodeAudioData(a.response,function(t){t&&(e[n]=t,p(i,t))},function(e){i.on("loaderror")})},a.onerror=function(){i._webAudio&&(i._buffer=!0,i._webAudio=!1,i._audioNode=[],delete i._gainNode,i.load())};try{a.send()}catch(s){a.onerror()}}},p=function(e,t){e._duration=t?t.duration:e._duration,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play()},g=function(i,n,a){var s=i._nodeById(a);s.bufferSource=t.createBufferSource(),s.bufferSource.buffer=e[i._src],s.bufferSource.connect(s.panner),s.bufferSource.loop=n[0],n[0]&&(s.bufferSource.loopStart=n[1],s.bufferSource.loopEnd=n[1]+n[2]),s.bufferSource.playbackRate.value=i._rate};"function"==typeof n&&n.amd&&n("djinn/audio/Howler",[],function(){return{Howler:l,Howl:d}}),"undefined"!=typeof exports&&(exports.Howler=l,exports.Howl=d),"undefined"!=typeof window&&(window.Howler=l,window.Howl=d)}(),n("djinn/audio/jukebox",["require","exports","module","../Emitter","../client","../math/core","../utils/array","../utils/log","./Howler"],function(e,t,i){var n=e("../Emitter"),a=e("../client"),s=e("../math/core"),r=e("../utils/array"),o=e("../utils/log"),l=e("./Howler"),h=n.extend({init:function(e){this._super(e),this.audioData=null,this.multishotThreshold=100,this.sounds={},this._unmuteOnShow=!1,this._playTimes={},this.gain=1,this.volumeExponent=1,a.on("visibilityChange",this,"_onClientVisibilityChange")},configure:function(e){this.audioData=e},mute:function(){l.Howler.mute(),this.fire("mute")},unmute:function(){l.Howler.unmute(),this.fire("unmute")},toggleMute:function(){this.muted=!this.muted},preloadByType:function(e){var e=r.force(e),t=this.sounds;for(var i in t){var n=this._getAudioData(i),a=n.type||"sound";r.contains(e,a)&&this.load(i)}},load:function(e,t){var i=this.sounds;if(i[e])return i[e];var n=this._getAudioData(e);if(n){var a=this._getVolume(e),s=i[e]=new l.Howl({urls:n.paths,loop:n.loop,buffer:"music"===n.type,onload:function(){this.volume(a),t&&t()},onloaderror:function(){o.warn("[jukebox.load] Failed to load: "+e)}});return s}},play:function(e,t){var i=this._getSound(e,!0);if(i){var n=this._playTimes,a=n[e],s=Date.now();a&&s-a<this.multishotThreshold||(n[e]=s,void 0!==t&&i.pos(t),i.play(),i.volume(this._getVolume(e)))}},pause:function(e){var t=this._getSound(e);t&&t.pause()},stop:function(e){var t=this._getSound(e);t&&t.stop()},fadeIn:function(e,t){var i=this._getSound(e,!0);if(i){var n=this._getVolume(e);i.play().fade(0,n,t)}},fadeOut:function(e,t){var i=this._getSound(e);i&&i.fade(i.volume(),0,t,function(){i.stop()})},_getAudioData:function(e){var t=this.audioData;return t&&t.sounds&&t.sounds[e]?t.sounds[e]:(o.warn("[jukebox._getAudioData] No audio data: "+e),null)},_getSound:function(e,t){var i=this.sounds;if(i&&i[e])return i[e];if(t){var n=this.load(e);return n?n:(o.warn("[jukebox._getSound] Unable to load sound: "+e),null)}return null},_getVolume:function(e){var t=this._getAudioData(e);if(!t)return 1;switch(t.type){case"music":var i=this.musicVolume;break;default:var i=this.soundVolume}var n=this.volumeExponent;return 1!==n&&(i=(Math.pow(n,i)-1)/(n-1)*this.gain),void 0!==t.volume&&(i*=t.volume),i},_updateVolume:function(){var e=this.sounds;for(var t in e){var i=e[t],n=this._getVolume(t);i.volume()!==n&&i.volume(n)}},_onClientVisibilityChange:function(e){e?this.muted||(this.mute(),this._unmuteOnShow=!0):this._unmuteOnShow&&(this.unmute(),this._unmuteOnShow=!1)}}),u=h.prototype;Object.defineProperty(u,"muted",{get:function(){return l.Howler._muted},set:function(e){e?this.mute():this.unmute()}}),Object.defineProperty(u,"musicVolume",{get:function(){return this._musicVolume},set:function(e){this._musicVolume=s.clamp(e,0,1),this._updateVolume()}}),Object.defineProperty(u,"soundVolume",{get:function(){return this._soundVolume},set:function(e){this._soundVolume=s.clamp(e,0,1),this._updateVolume()}}),i.exports=new h}),n("djinn/Scene",["require","exports","module","./view/View","./audio/jukebox"],function(e,t,i){var n=e("./view/View"),a=e("./audio/jukebox"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.musicKey=e.musicKey,this.fadeDuration=e.fadeDuration,this._isSetup=!1},setup:function(){this.musicKey&&a.load(this.musicKey)},reset:function(){},activate:function(e,t){this.musicKey&&(t&&this.musicKey===t.musicKey||a.fadeIn(this.musicKey,this.fadeDuration)),this.captureInputEvents=!0,this.oldSceneId=e},deactivate:function(e,t){this.musicKey&&this.musicKey!==t.musicKey&&a.fadeOut(this.musicKey,this.fadeDuration),this.captureInputEvents=!1},cleanup:function(e,t){this.musicKey&&this.musicKey!==t.musicKey&&a.stop(this.musicKey)},fireSceneEvent:function(e){var t={id:this.id,eventName:e};this.fire(e,[t])}});t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,clip:!0,fadeDuration:500,musicKey:null,opacity:0,visible:!1,tag:"Scene"}}),n("djinn/view/effects/Spotlight",["djinn/view/View","djinn/stage"],function(e,t){var i=["width","height","spotlightX","spotlightY","spotlightRadius"];return e.extend({init:function(e){var e=merge(e,{backgroundColor:"rgb(0, 0, 0)",spotlightX:0,spotlightY:0,spotlightRadius:100});this._super(e),this._buffer=t.createBuffer(this.width,this.height),this._bufferDirty=!0,this.spotlightX=Number(e.spotlightX),this.spotlightY=Number(e.spotlightY),this.spotlightRadius=Number(e.spotlightRadius),this._cachedProps={},t.on("resize",this,function(){this._bufferDirty=!0})},render:function(e){var t=this._buffer;if((t.width!==this.width||t.height!==this.height)&&(t.width=this.width,t.height=this.height,this._bufferDirty=!0),!this._bufferDirty)for(var n=0,a=i.length;a>n;++n){var s=i[n];if(this._cachedProps[s]!=this[s]){this._bufferDirty=!0;break}}if(this._bufferDirty){var r=t.getContext("2d");r.save(),r.clearRect(0,0,this.width,this.height),r.fillStyle=this.backgroundColor,r.fillRect(0,0,this.width,this.height),r.globalCompositeOperation="destination-out",r.beginPath(),r.arc(this.spotlightX,this.spotlightY,this.spotlightRadius,0,2*Math.PI,!0),r.fill(),r.closePath(),r.restore();for(var n=0,a=i.length;a>n;++n){var s=i[n];this._cachedProps[s]=this[s]}this._bufferDirty=!1}e.drawImage(this._buffer,0,0,this.width,this.height)}})}),n("djinn/utils/sceneTransitions",["require","exports","module","djinn/utils/transitions","djinn/view/effects/Spotlight"],function(e,t,i){var n=e("djinn/utils/transitions"),a=e("djinn/view/effects/Spotlight"),s=function(e,t){e.completeTween(merge(t,{visible:!0,opacity:1,scale:1,rotation:0,x:0,y:0}))};t.none=function(e,t,i,n){s(t,{visible:!0}),e.visible=!1,n&&n()},t.crossFade=function(e,t,i,n){var i=merge(i,{duration:500});s(e),s(t,{opacity:0}),e.tween({opacity:0},i.duration,null,function(){e.visible=!1,n&&n()}),t.tween({opacity:1},i.duration)},t.fade=function(e,t,i,n){var i=merge(i,{duration:500});s(e),s(t,{opacity:0}),e.tween({opacity:0},i.duration,null,function(){e.visible=!1,t.tween({opacity:1},i.duration,null,n)})},t.rotateIn=function(e,t,i,n){var i=merge(i,{duration:1e3});s(t,{scale:0,rotation:Math.PI}),t.tween({scale:1,rotation:0},i.duration,null,function(){e.visible=!1,n&&n()})},t.slideUp=function(e,t,i,a){var i=merge(i,{duration:500});s(e),s(t,{y:t.parent.height}),e.tween({y:-e.height},i.duration,n.easeIn,function(){e.visible=!1,a&&a()}),t.tween({y:0},i.duration,n.easeIn)},t.slideDown=function(e,t,i,a){var i=merge(i,{duration:500});s(e),s(t,{bottom:0}),e.tween({y:e.height},i.duration,n.easeIn,function(){e.visible=!1,a&&a()}),t.tween({y:0},i.duration,n.easeIn)},t.slideLeft=function(e,t,i,a){var i=merge(i,{duration:500});s(e),s(t,{x:t.width}),e.tween({right:0},i.duration,n.easeIn,function(){e.visible=!1,a&&a()}),t.tween({x:0},i.duration,n.easeIn)},t.slideRight=function(e,t,i,a){var i=merge(i,{duration:500});s(e),s(t,{right:0}),e.tween({x:e.width},i.duration,n.easeIn,function(){e.visible=!1,a&&a()}),t.tween({x:0},i.duration,n.easeIn)};var r=new a({backgroundColor:"black",visible:!1});t.spotlight=function(e,t,i,a){var i=merge(i,{duration:2e3,delay:500});s(e),r.completeTween({width:e.width,height:e.height,visible:!0,spotlightX:e.width/2,spotlightY:e.height/2,spotlightRadius:e.width}),r.removeFromParent(),e.parent.addChild(r),r.tween({spotlightRadius:0},i.duration,n.easeIn,function(){e.visible=!1,s(t),r.delayTween(i.delay).tween({spotlightRadius:e.width},i.duration,n.easeIn,function(){r.visible=!1,r.removeFromParent(),a&&a()})})},t.zoomSpotlight=function(e,t,i,a){var i=merge(i,{duration:2e3,delay:500,scale:2});s(e),r.completeTween({width:e.width,height:e.height,visible:!0,z:Math.max(e.z,t.z)+1,opacity:0,spotlightX:e.width/2,spotlightY:e.height/2,spotlightRadius:0}),r.removeFromParent(),e.parent.addChild(r),e.tween({scale:i.scale},i.duration),r.tween({opacity:1},i.duration,n.easeIn,function(){e.visible=!1,s(t),r.delayTween(i.delay).tween({spotlightRadius:e.width},i.duration,n.easeIn,function(){r.visible=!1,r.removeFromParent(),a&&a()})})}}),n("djinn/SceneDirector",["require","exports","module","djinn/Emitter","djinn/Collection","djinn/Scene","djinn/utils/sceneTransitions"],function(e,t,i){var n=e("djinn/Emitter"),a=e("djinn/Collection"),s=e("djinn/Scene"),r=e("djinn/utils/sceneTransitions"),t=i.exports=n.extend({init:function(e){this._super(e),this.backgroundColor=e.backgroundColor||"black",this.view=e.view},setup:function(e){this._data=e},load:function(){this._activeSceneId=null,this.scenes=new a,this._defaultScene=new s({parent:this.view,backgroundColor:this.backgroundColor,visible:!1});var e=this._data;for(var t in e){var i=e[t],n=new i.ctor({parent:this.view,id:t});for(var r in i.events)n.on(r,this,"_onSceneEvent");this.scenes.add(n)}},ready:function(){},activateScene:function(e,t,i){var n=this.scenes,a=this._activeSceneId,s=n.get(this._activeSceneId)||this._defaultScene,o=n.get(e);this._activeSceneId=e,o.isSetup||(o.setup(),o.isSetup=!0),o.reset(a);var t=r[t||"fade"];this.view.backgroundColor=this.backgroundColor,s&&(s.captureInputEvents=!1,s.deactivate(this._activeSceneId,o)),o.captureInputEvents=!1,t(s,o,i,bind(this,function(){this.view.backgroundColor=null,s.cleanup(e,o),o.activate(a,s)}))},_onSceneEvent:function(e){var t=this._data[e.id].events[e.eventName];this.activateScene(t.id,t.transition,t.conf)}});Object.defineProperty(t.prototype,"activeSceneId",{get:function(){return this._activeSceneId}}),Object.defineProperty(t.prototype,"activeScene",{get:function(){return this.scenes.get(this._activeSceneId)}})}),n("djinn/platforms/steam",["require","exports","module","../utils/log"],function(e,t,i){var n=e("../utils/log");t.init=function(){var e=greenworks.initAPI();n.info("[steam.init] Success? "+e)},t.isCloudEnabled=function(){return greenworks.isCloudEnabledForUser()&&greenworks.isCloudEnabled()},t.getCloudQuota=function(e){greenworks.getCloudQuota(function(t,i){e&&e(t,i)},function(){n.warn("[steam.getCloudData] Failed to get cloud quota")})},t.writeCloudFile=function(e,t,i){greenworks.saveTextToFile(e,t,function(){i&&i()},function(){n.warn("[steam.writeCloudFile] Failed to write cloud file: "+e)})},t.readCloudFile=function(e,t){greenworks.readTextFromFile(e,function(e){t&&t(null,e)},function(){n.warn("[steam.readCloudFile] Failed to read cloud file: "+e),t&&t("Failed to read cloud file",null)})},t.activateAchievement=function(e,t){greenworks.activateAchievement(e,function(){t&&t()},function(){n.warn("[steam.activateAchievement] Failed to activate: "+e)})}}),n("djinn/Game",["require","exports","module","./core/time","./input/keyboard","./input/gamepad","./Emitter","./client","./stage","./helpers/LoadingScreen","./assets","./view/View","./SceneDirector","./platforms/steam"],function(e,t,i){var n=e("./core/time"),a=e("./input/keyboard"),s=e("./input/gamepad"),r=e("./Emitter"),o=e("./client"),l=e("./stage"),h=e("./helpers/LoadingScreen"),u=e("./assets"),d=e("./view/View"),c=e("./SceneDirector"),p=e("./platforms/steam"),t=i.exports=r.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),o.isSteam&&p.init(),this.showLoadingScreen=e.showLoadingScreen,this._splashFinished=!1,this._loadingProgress=0,this.view=new d({tag:"GameRootView",acceptInputEvents:!0,width:l.width,height:l.height}),this._loadingScreen=new h({parent:this.view,visible:!1}),this._sceneDirector=new c({view:this.view}),l.on("resize",this,"_onStageResize")},run:function(){n.start(this._update.bind(this)),this.showLoadingScreen&&(l.eraseBeforeRender=!0,this._loadingScreen.show(bind(this,"_onSplashFinish")))},stop:function(){n.stop()},setupScenes:function(e){this._sceneDirector.setup(e)},getSceneById:function(e){return this._sceneDirector.scenes.get(e)},getActiveSceneId:function(){return this._sceneDirector.activeSceneId},getActiveScene:function(){return this._sceneDirector.activeScene},activateScene:function(e,t,i){this._sceneDirector.activateScene(e,t,i)},preloadAssets:function(e){u.load(e,bind(this,"_onLoadComplete"),bind(this,"_onLoadProgress"))},_onLoadProgress:function(e,t,i,n,a){this._loadingProgress=a,this._loadingScreen.loadingProgress=this._loadingProgress,this._checkGameReady()},_onLoadComplete:function(){l.acceptInput=!0,this._sceneDirector.load(),this.fire("load")},_update:function(e){this._react(),this.update&&this.update(e),this.view.preTick(e),this._render(),a.endFrame(),s.endFrame()},_react:function(){for(var e=l.getInputEvents(),t=e.length,i=0;t>i;++i)this.view.react(e[i])},_render:function(){l.renderView(this.view)},_onStageResize:function(){this.view.width=l.width,this.view.height=l.height},_onSplashFinish:function(){this._splashFinished=!0,this._checkGameReady()},_checkGameReady:function(){this._splashFinished&&1===this._loadingProgress&&this._loadingScreen.hide(bind(this,function(){l.eraseBeforeRender=!1,this._sceneDirector.ready(),this.fire("ready")}))}});t.defaults={showLoadingScreen:!1}}),n("djinn/utils/storage",["require","exports","module","./log"],function(e,t,i){var n=e("./log");t.set=function(e,t){try{localStorage.setItem(e,t)}catch(i){n.warn("[storage.set] Failed to set localStorage! Quota exceeded?"),n.warn("[storage.set] "+i.message)}},t.get=function(e){var t=null;try{t=localStorage.getItem(e)}catch(i){n.warn("[storage.get] Failed to get: "+e),n.warn("[storage.get] "+i.message)}return t},t.remove=function(e){try{localStorage.removeItem(e)}catch(t){n.warn("[storage.remove] Failed to remove: "+e),n.warn("[storage.remove] "+t.message)}},t.setObject=function(e,i){var n=JSON.stringify(i);return t.set(e,n)},t.getObject=function(e){var i=t.get(e),a=null;try{a=JSON.parse(i)}catch(s){n.warn("[storage.getObject] Could not parse JSON: "+i),n.warn("[storage.getObject] "+s.message)}return a}}),n("js/competitors",["require","exports","module"],function(e,t,i){i.exports=[{name:"Bounce Bash",developer:"Genero",productId:"bouncer",backgroundColor:[89,125,206],clicks:null,darkness:.2,playerPrefab:"playerBoy",price:4.99,rating:null,sales:null,time:7e3,views:null,tiles:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,0],[0,0,0,0,0,0,0,0,0,"vTrap",0,9,0,9,0,0],[0,0,"bouncer",0,0,0,0,0,0,0,0,9,0,0,0,0],[8,8,8,0,0,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,0,0,"bouncer",0,0,0,9,0,"vTrap",0,0,0,0],[0,0,0,0,0,9,0,0,0,9,0,0,0,0,"gameGoal",0],[0,"gameStart",0,"bouncer",0,8,0,"bouncer",0,8,9,9,8,"spikes",8,"spikes"],[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8]],playtestData:{left:56,right:187,jump:6},surveyArea:.3,joyCount:16},{name:"Catch a Ride",developer:"Retroladies",productId:"hPlatform",playerPrefab:"playerGirl",backgroundColor:[89,125,206],clicks:null,darkness:.5,price:4.99,rating:null,sales:null,time:15e3,views:null,tiles:[[9,9,9,9,0,0,0,0,0,0,0,0,9,9,9,9],[9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,9],[9,9,0,0,0,0,0,0,0,"hPlatform",9,0,0,9,0,9],[9,0,0,0,0,0,8,0,0,0,9,9,8,9,0,9],[0,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8],[0,9,"gameStart",0,0,0,0,0,0,9,9,0,8,0,0,0],[0,9,9,9,0,"hPlatform",0,0,0,0,9,0,"vTrap",0,0,"gameGoal"],[0,0,8,0,0,0,0,0,0,0,8,0,0,"vTrap",0,8],[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8]],playtestData:{left:171,right:308,jump:17},surveyArea:.45,joyCount:22},{name:"Big Bad",boss:!0,productId:"sizeMedium",developer:"AD",playerPrefab:"playerJoey",backgroundColor:[128,128,128],clicks:null,darkness:.7,price:9.99,rating:null,sales:null,time:2e4,views:null,tiles:[[13,15,15,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,15,15,13],[15,15,15,0,0,0,0,0,0,0,0,"boss",0,0,0,0,0,0,0,0,0,15,15],[15,"vTrap",15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15],[15,0,0,0,0,0,0,0,0,0,0,0,12,12,12,12,12,0,0,0,0,0,15],[15,0,0,0,"gameStart",0,0,0,0,0,0,0,12,12,12,12,12,0,0,0,0,0,15],[15,0,0,0,9,9,0,0,0,0,0,0,12,12,"gameGoal",12,12,0,0,"bouncer",0,0,15],[15,0,0,9,9,0,0,0,0,0,0,0,12,12,12,12,12,0,0,9,0,0,15],[15,0,0,0,0,0,0,0,0,0,0,0,12,12,12,12,12,0,0,9,0,0,15],[15,0,"bouncer",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"bouncer",15],[15,"spikes",15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,15],[15,15,15,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15],[15,15,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,15,15],[13,15,15,15,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",15,15,15,15],[13,13,15,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",15,15,13],[13,13,13,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,13,13]],playtestData:null,surveyArea:.5,joyCount:100},{name:"Horizontas",developer:"Genero",productId:"hTrap",playerPrefab:"playerBoy",backgroundColor:[89,125,206],clicks:null,darkness:.2,price:4.99,rating:null,sales:null,time:25e3,views:null,tiles:[[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9],[9,9,0,11,11,11,11,11,11,11,11,11,11,11,11,11,0,0,0,0,0,0,9],[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,9],[9,"hTrap",0,0,0,0,0,0,0,0,0,0,0,0,11,11,11,11,11,11,0,0,9],[10,10,0,0,0,0,0,"hPlatform",0,0,0,0,0,0,11,"vTrap",11,0,0,0,0,0,9],[10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,"hTrap",9,9],[10,0,"gameGoal",0,0,0,0,0,0,0,0,0,"bouncer",0,0,0,11,0,0,0,0,0,9],[10,10,10,10,0,0,0,0,0,0,0,0,9,0,"hTrap",11,11,11,11,11,0,0,9],[10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,9],[9,0,"gameStart",0,0,0,0,0,0,0,0,0,9,9,9,9,11,11,11,11,11,0,9],[9,9,9,9,"hTrap",0,0,0,9,9,9,0,0,0,0,0,0,0,0,0,0,0,9],[9,9,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,"hPlatform",9,9,9],[8,9,9,9,9,9,9,9,9,8,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",9,8],[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8]],playtestData:{left:513,right:405,jump:17},surveyArea:.4,joyCount:52},{name:"Single Signal",developer:"Chronic",productId:"pulseBlock",playerPrefab:"playerBoy",backgroundColor:[89,179,206],clicks:null,darkness:.3,price:9.99,rating:null,sales:null,time:36500,views:null,tiles:[[9,9,0,0,0,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[9,0,0,0,0,"vTrap","vTrap","vTrap",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,"pulseBlock","pulseBlock","pulseBlock",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,"gameStart",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,"pulseBlock","pulseBlock","pulseBlock",0,0,0,0,0,0,0,0,"pulseBlock",0,0,0,0,0,0,0,0,0],[0,0,"pulseBlock",0,"pulseBlock",0,0,0,0,0,0,0,0,"pulseBlock",0,0,0,0,0,0,0,0,0],[0,0,"pulseBlock",0,"pulseBlock","pulseBlock","pulseBlock","pulseBlock",0,0,0,"pulseButton",0,"pulseBlock",0,0,0,0,0,0,0,0,0],[0,0,13,"gameGoal",13,"vTrap","vTrap","vTrap",0,0,9,9,9,9,9,"hPlatform",0,0,0,0,9,0,9],[0,13,13,13,13,9,9,9,9,0,"vTrap",0,0,0,9,"hTrap",0,0,0,0,9,0,9],[0,0,13,13,13,9,9,0,0,0,"pulseBlock",0,0,0,0,0,0,0,0,0,9,0,9],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,8,0,0,0,0,0,0,0,0,0,0,0,"pulseButton",0,0,0,0,0,0,0,0,0],[8,8,8,0,"bouncer",0,0,0,0,13,13,0,0,0,0,0,0,"hPlatform",0,0,13,13,13],[8,8,8,8,8,8,8,8,8,8,13,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",13,"spikes"]],playtestData:{left:391,right:411,jump:27},surveyArea:.4,joyCount:88},{name:"Onandoff",developer:"Genero",productId:"intervalRock",playerPrefab:"playerBoy",backgroundColor:[153,128,77],clicks:null,darkness:.3,price:4.99,rating:null,sales:null,time:6e4,views:null,tiles:[[13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13],[13,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,0,0,"gameStart",0,0,0,0,0,0,0,9,9,9,"intervalRock","intervalRock","intervalRock","intervalRock",9,9,9,0,13],[13,0,9,9,9,0,0,"intervalRock","intervalRock",0,0,0,9,0,0,0,0,0,0,9,0,0,13],[13,0,0,9,0,0,0,0,0,0,0,0,9,"spikes","spikes","spikes","spikes","spikes","spikes",9,0,0,13],[13,13,9,9,9,13,13,13,13,13,13,9,9,9,9,9,9,9,9,9,9,0,13],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,0,10,"gameGoal",0,0,0,"intervalRock","intervalRock","pulseBlock","pulseBlock","intervalRock","intervalRock","pulseBlock","pulseBlock","intervalRock","intervalRock","pulseBlock","pulseBlock","intervalRock","intervalRock",0,13],[13,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[8,8,9,"pulseButton","hPlatform",9,9,0,0,"intervalRock","intervalRock",0,0,8,8,0,0,"intervalRock","intervalRock",0,0,8,8],[8,9,9,9,9,9,"spikes","spikes","spikes","spikes","spikes","spikes",8,8,8,8,"spikes","spikes","spikes","spikes","spikes","spikes",8]],playtestData:{left:770,right:787,jump:55},surveyArea:.5,joyCount:80,joyNormal:.96,surveyNormal:.98},{name:"Dank Dungeon",boss:!0,developer:"Rook",productId:"darkness",playerPrefab:"playerGoblin",backgroundColor:[77,77,77],clicks:null,darkness:1,price:9.99,rating:null,sales:null,time:25e3,views:null,tiles:[[8,8,0,0,0,0,0,0,0,0,0,8,0,0,0,12,12,12,12,12,12,12,12],[8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,9,9,9,9,9],[8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,12],[8,0,"gameStart",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,12],[8,10,10,10,8,0,8,8,8,8,0,0,11,11,0,0,0,0,0,0,0,0,12],[8,8,8,8,8,"spikes",8,8,8,8,"spikes","spikes",11,0,0,0,12,12,12,12,12,0,12],[8,8,8,8,8,8,8,0,0,8,8,11,11,0,0,0,0,12,12,12,9,0,12],[8,8,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,12,0,9,0,12],[8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,8],[8,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,"hTrap",9,"spikes",9,0,8],[9,"gameGoal",9,0,0,0,0,0,0,9,0,"hPlatform",0,0,0,0,0,0,9,9,9,0,8],[9,9,9,0,"intervalRock","intervalRock",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8],[9,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8],[8,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,8],[8,"spikes","spikes","spikes",8,8,8,8,8,8,8,8,8,"spikes","spikes",8,8,8,"spikes",8,8,8,8]],playtestData:{left:420,right:431,jump:38},surveyArea:.5,joyCount:50},{name:"Tortcher",developer:"Chronic",productId:"torch",playerPrefab:"playerBoy",backgroundColor:[179,77,153],clicks:null,darkness:1,price:4.99,rating:null,sales:null,time:15e3,views:null,tiles:[[11,10,10,10,10,10,10,10,10,10,9,10,9,9,9,11],[10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9],[10,"gameStart",0,0,0,0,0,0,0,0,0,0,0,"torch",0,9],[10,"torch",10,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",10,9,9,9,9],[10,10,10,0,10,"spikes","spikes","spikes","spikes","spikes","spikes",10,10,10,10,10],[10,0,10,0,10,10,10,10,10,10,10,10,0,0,0,10],[10,0,0,0,0,0,0,0,0,0,0,0,0,"gameGoal",0,9],[10,0,0,0,0,0,0,0,0,0,0,0,0,9,0,9],[11,12,12,"spikes",12,12,12,12,12,12,9,12,9,9,9,11]],
playtestData:{left:116,right:232,jump:18},surveyArea:.4,joyCount:40},{name:"Fragility",developer:"Retroladies",productId:"fragileRock",playerPrefab:"playerGirl",backgroundColor:[77,77,77],clicks:null,darkness:.7,price:9.99,rating:null,sales:null,time:25e3,views:null,tiles:[[10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[10,10,"torch","fragileRock","torch",0,0,0,0,"torch",0,0,0,0,0,0,0,0,0,"torch",13,0,0],[10,10,10,"fragileRock",10,10,10,10,10,10,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",13,0,0,0],[10,10,10,"fragileRock",10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13],[10,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",0,0,13,0,0,0,0,0,0,0,0,0,"hTrap",11,0,0,0],[10,10,"fragileRock","fragileRock","fragileRock",0,0,0,13,0,0,0,0,0,0,0,0,0,"hTrap","torch","bouncer",0,0],[10,10,0,"fragileRock",0,0,0,13,13,13,0,0,0,0,0,0,0,0,"hPlatform",11,11,0,0],[10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13],[0,9,0,"gameGoal",0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,0,0],[0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[8,9,0,"gameStart",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[8,9,8,"torch",8,"fragileRock","fragileRock","fragileRock","torch","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",13,"torch",13,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",13],[8,9,8,8,8,8,8,8,8,"spikes","spikes","spikes","spikes","spikes","spikes",13,"spikes","spikes","spikes","spikes","spikes","spikes",8]],playtestData:null,surveyArea:.5,joyCount:72,joyNormal:1,surveyNormal:1},{name:"Gravity Kills",developer:"Benzerware Ltd",productId:"gravityRock",playerPrefab:"playerBenzer",backgroundColor:[179,179,204],clicks:null,darkness:.3,price:9.99,rating:null,sales:null,time:4e4,views:null,tiles:[[9,9,9,9,9,9,9,9,9,9,9,13,"gravityRock",13,9,9,9,9,9,9,9,9,9],[9,0,0,9,0,0,0,0,0,0,0,13,0,13,0,0,0,0,0,0,0,0,9],[13,0,0,"gravityRock",0,0,0,0,0,0,13,13,0,13,13,0,0,0,0,0,0,13,13],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"gravityRock",9],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9],[8,0,0,"gameStart",0,0,"gravityRock",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9],[8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,8,8,0,0,9],[8,8,8,8,8,8,8,8,"spikes","spikes","spikes","spikes",0,"spikes","spikes","spikes","spikes","spikes",8,0,0,0,9],[8,8,8,8,8,8,8,8,8,8,8,8,0,8,8,8,8,8,8,0,0,8,8],[13,13,13,13,13,0,0,"gravityRock",0,"vTrap",0,0,0,0,0,0,0,8,"hTrap",0,0,0,8],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8],[13,13,13,0,"gameGoal",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8],[8,8,13,13,13,13,0,0,0,0,"spikes","spikes",0,"spikes","spikes",0,"gravityRock",0,0,0,8,8,13],[8,8,8,8,13,8,8,8,8,8,8,8,"fragileRock",8,8,8,8,8,8,8,8,13,13]],playtestData:{left:589,right:603,jump:36},surveyArea:.5,joyCount:70},{name:"Sky's the Limit",developer:"Retroladies",productId:"vPlatform",playerPrefab:"playerGirl",backgroundColor:[102,102,102],clicks:null,darkness:.3,price:9.99,rating:null,sales:null,time:55e3,views:null,tiles:[[13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13],[13,0,0,0,13,0,0,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,13],[13,0,"gameStart",0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,0,0,0,13,0,"gameGoal",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,"fragileRock","fragileRock","fragileRock",13,13,13,13,13,0,"vPlatform",0,13,13,"intervalRock","intervalRock","intervalRock",13,13,0,"fragileRock",0,13],[13,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,13,"fragileRock",0,"fragileRock",13],[13,0,0,0,13,13,0,0,0,"hTrap",0,0,0,"hTrap",0,0,0,13,13,0,"fragileRock",0,13],[13,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,13,"fragileRock",0,"fragileRock",13],[13,0,0,0,13,13,0,0,0,"hTrap",0,0,0,"hTrap",0,0,0,13,13,0,"fragileRock",0,13],[13,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,13,"fragileRock",0,"fragileRock",13],[13,0,0,0,13,13,0,0,0,0,0,0,0,0,0,0,0,13,13,0,0,0,13],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13],[13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"vPlatform",0,13],[14,0,0,0,0,0,0,0,9,"hTrap",0,0,0,0,0,0,0,"hTrap",9,"bouncer","bouncer","bouncer",9],[14,14,14,14,14,14,14,9,9,9,11,14,14,14,14,14,14,9,9,9,9,9,9]],playtestData:{left:675,right:746,jump:56},surveyArea:.5,joyCount:100,joyNormal:2,surveyNormal:.65},{name:"Wings",developer:"Rook",productId:"chicken",playerPrefab:"playerGoblin",backgroundColor:[204,204,179],clicks:null,darkness:.2,price:4.99,rating:null,sales:null,time:45e3,views:null,tiles:[[11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11],[11,0,0,0,"hTrap",0,0,0,0,0,"hTrap",0,0,0,0,0,"hTrap",0,0,0,0,0,11],[11,"hTrap",0,0,0,0,0,"hTrap",0,0,0,0,0,"hTrap",0,0,0,0,0,"hTrap",0,0,11],[11,"fragileRock","fragileRock","fragileRock",9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,0,0,11],[11,0,0,0,"fragileRock","fragileRock",9,"fragileRock","fragileRock",0,0,0,0,0,0,0,9,0,0,11,0,0,11],[11,0,0,0,"fragileRock","fragileRock",9,"fragileRock",0,0,0,0,0,0,0,0,9,0,0,9,0,"bouncer",11],[11,0,0,0,"fragileRock","fragileRock",9,"fragileRock",9,9,0,0,0,0,0,"hPlatform",9,9,0,9,0,11,11],[9,0,0,0,9,"fragileRock","fragileRock","fragileRock",9,0,0,0,0,0,0,0,0,0,0,9,0,0,11],[9,0,"gameGoal",0,9,"fragileRock","fragileRock","fragileRock",9,0,0,0,0,"chicken",0,0,9,0,0,11,"bouncer",0,11],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,11,11,0,11],[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8],[8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,0,0,0,0,"bouncer",8],[8,0,"gameStart",0,0,0,0,0,13,0,13,0,0,0,0,0,13,0,"vPlatform",0,0,8,8],[8,8,8,8,0,"chicken",0,13,13,0,13,13,0,"chicken",0,0,8,8,0,8,8,8,8],[8,8,8,8,8,8,8,13,"spikes","spikes","spikes",13,8,8,8,8,8,8,8,8,8,8,8]],playtestData:{left:494,right:425,jump:44},surveyArea:.34,joyCount:50},{name:"BRT",developer:"Chronic",productId:"teleporter",playerPrefab:"playerBoy",backgroundColor:[77,153,153],clicks:null,darkness:.2,price:9.99,rating:null,sales:null,time:25e3,views:null,tiles:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"vTrap",0,0,0,0,0,0],[0,0,0,"teleporter",0,12,12,12,12,12,12,12,12,0,0,0,0,"vTrap",0,"teleporter",0,0,0],[0,10,0,0,0,0,0,0,0,0,0,0,12,12,0,"teleporter",0,0,"vTrap",0,0,0,0],[0,10,"gameGoal",0,0,0,0,0,0,0,0,0,0,12,"vTrap",0,0,0,0,0,11,0,0],[0,10,10,10,10,10,"intervalRock","intervalRock","intervalRock",12,12,0,0,12,"spikes","spikes","spikes","spikes","spikes","spikes",11,0,11],[0,0,10,0,0,0,0,0,0,0,12,0,12,12,12,12,12,12,12,12,11,"teleporter",0],[0,0,0,0,0,0,0,0,0,0,12,0,0,0,12,12,12,12,12,12,11,11,11],[0,0,12,12,12,12,12,13,13,0,12,"intervalRock",0,0,0,0,0,12,0,0,11,0,0],[0,12,12,0,0,0,13,0,0,0,12,0,0,0,0,0,0,0,0,0,0,"teleporter",0],[0,12,0,0,"teleporter",0,13,13,0,0,12,12,12,12,"intervalRock","intervalRock","intervalRock",12,"intervalRock","intervalRock",12,12,12],[0,12,"gameStart",0,0,0,13,13,0,0,0,"teleporter",0,12,"hTrap",0,0,12,0,0,12,0,0],[0,12,12,0,0,0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,12,12,12,12,12,13,13,0,0,0,0,0,0,0,0,0,0,0,0,"teleporter",0],[0,0,0,0,0,0,0,0,0,0,0,8,8,8,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock"],["spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",8,8,8,8,8,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes"]],playtestData:{left:322,right:252,jump:21},surveyArea:.25,joyCount:54},{name:"Where Are My Keys?",developer:"AD",productId:"gameKey",playerPrefab:"playerJoey",backgroundColor:[89,125,255],clicks:null,darkness:.6,price:9.99,rating:null,sales:null,time:35e3,views:null,tiles:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"teleporter",0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,13,0,13,0,"hTrap",0,0,0,0,0,0,0,0,0,0,0,0,0,13,0,0],[0,13,"torch","fragileRock","torch",13,0,0,0,0,0,0,0,0,0,0,0,0,"hPlatform",13,"torch",13,0],[0,0,13,"fragileRock",13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,0,0],[0,0,"fragileRock","fragileRock","fragileRock",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,"fragileRock","fragileRock","fragileRock",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"teleporter",0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,"torch",13,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"gameKey",0,0,0,9,0,0],[0,0,0,"gameStart",0,0,0,0,"gameGoal",0,0,0,0,0,0,11,"torch",13,0,0,9,0,0],[0,0,13,"torch",13,0,0,13,"torch",11,0,0,"fragileRock",0,0,0,9,0,0,0,9,0,0],[0,0,0,9,0,0,0,0,9,0,0,0,0,0,0,0,9,0,0,0,9,0,0],["spikes","spikes","spikes",9,"spikes","spikes","spikes","spikes",9,"spikes","spikes","spikes","spikes","spikes","spikes","spikes",9,"spikes","spikes","spikes",9,"spikes","spikes"]],playtestData:{left:290,right:429,jump:28},surveyArea:.3,joyCount:54},{name:"Jumpslime",developer:"Rook",productId:"jumper",playerPrefab:"playerGoblin",backgroundColor:[179,128,102],clicks:null,darkness:.5,price:9.99,rating:null,sales:null,time:4e4,views:null,tiles:[[11,11,"hTrap",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"hTrap",9,9,9,0],[11,0,0,0,0,0,0,11,0,0,0,0,11,0,0,0,0,11,0,0,9,0,0],[0,0,0,"gameGoal",0,0,11,11,0,"jumper",0,0,11,0,"jumper",0,0,11,11,0,0,0,0],[0,0,10,"torch",10,0,0,11,11,11,11,11,11,11,11,11,11,11,11,11,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[9,9,"hPlatform",0,0,0,0,0,0,9,"torch",0,0,0,0,0,9,0,0,0,0,0,0],[9,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",9,0,"jumper",0,0,0,9,9,9,9,0,0,0],[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0],[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"torch"],[8,0,0,"gameStart",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8],[8,0,8,8,8,0,0,0,0,0,0,0,0,0,"torch",0,0,0,0,0,"vPlatform",8,8],[8,8,8,8,0,0,0,0,0,0,0,"jumper",0,0,8,0,0,0,"jumper",0,0,8,8],[8,8,8,8,8,8,13,13,13,13,13,13,13,13,8,8,8,8,8,8,8,8,8]],playtestData:{left:466,right:520,jump:34},surveyArea:.4,joyCount:100},{name:"pewpewpew",developer:"AD",productId:"cannon",playerPrefab:"playerJoey",backgroundColor:[102,128,204],clicks:null,darkness:.2,price:9.99,rating:null,sales:null,time:6e4,views:null,tiles:[[9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9],[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9],[9,0,0,"gameGoal",0,0,0,0,0,0,0,"cannon",0,0,0,0,0,0,0,0,0,0,9],[0,0,10,10,10,0,0,0,0,0,0,11,0,0,0,0,13,"cannon",0,0,0,0,9],[0,0,0,0,0,0,0,0,"cannon",0,0,0,0,0,0,0,13,13,0,0,0,0,0],[0,13,13,13,13,13,13,11,11,11,13,13,13,13,13,13,13,13,0,13,13,13,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,0,13,"vPlatform"],[9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,"hPlatform",13,0,0,0],[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,9,9],[0,0,0,"gameStart",0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,9,0],[0,0,8,8,8,0,0,0,0,0,"cannon",0,0,0,0,9,"cannon",0,0,0,0,9,0],[0,8,8,8,8,8,0,0,0,0,8,0,0,0,0,9,9,0,0,0,0,9,0],[8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,"spikes","spikes","spikes","spikes",9,9]],playtestData:{left:1213,right:1106,jump:51},surveyArea:.6,joyCount:120},{name:"The Final Countdown",boss:!0,productId:"sizeLarge",developer:"Retroladies",playerPrefab:"playerGirl",backgroundColor:[89,102,102],clicks:null,darkness:.7,price:14.99,rating:null,sales:null,time:4e4,views:null,tiles:[[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[15,15,0,0,0,0,0,0,15,0,0,0,0,0,0,15,15,15,0,0,0,0,0,0,15,0,0,0,0,0,0,15,15],[15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15],[15,0,0,"gameStart",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15],[15,0,"bossBlock","bossBlock","bossBlock",0,0,0,0,0,0,0,0,0,0,0,0,0,0,"bouncer",0,0,0,0,0,0,0,0,"bouncer",0,0,0,15],[15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13,13,0,0,0,0,0,0,13,13,13,0,0,15],[15,0,0,0,0,0,0,0,0,0,0,"bouncer",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15],[15,0,0,0,0,0,0,0,0,0,13,13,13,0,0,0,0,0,0,0,0,0,0,"bouncer",0,0,0,0,0,0,0,0,15],[15,0,0,0,"bouncer",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,13,13,0,0,0,0,0,0,0,15],[15,15,0,13,13,13,0,0,0,0,0,0,0,0,0,0,"boss",0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,15],[15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,10,10,10,10,0,0,15],[15,0,0,0,0,0,0,"bouncer",0,0,0,0,0,0,0,0,0,0,"bouncer",0,0,0,0,0,0,10,0,0,0,10,0,0,15],[15,0,0,0,0,0,13,13,13,0,0,0,0,0,0,0,0,13,13,13,0,0,0,0,0,10,0,0,0,10,0,0,15],[15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,"gameGoal",0,10,0,0,15],[15,0,0,"bouncer",0,0,0,0,0,0,0,"bouncer",0,0,0,0,"vPlatform",0,0,0,0,0,0,0,0,10,10,10,10,10,0,0,15],[15,0,13,13,13,0,0,0,0,0,13,13,13,0,0,0,"hPlatform",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15],[15,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",9,"torch",9,"fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock","fragileRock",15],[15,15,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",9,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",15,15],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,9,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15]],playtestData:null,surveyArea:.4,joyCount:125},{name:"Chicken Wrangler",developer:"Genero",playerPrefab:"playerBoy",backgroundColor:[89,204,206],clicks:null,darkness:.4,price:9.99,rating:null,sales:null,time:75e3,views:null,tiles:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0],[0,9,9,0,0,0,0,9,0,0,0,0,0,9,0,0,0,0,0,9,0,0,0,0,0,9,0,0,0,0,9,9,0],[0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0],[0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0],[0,9,9,0,"gameStart",0,0,0,0,0,"pulseButton",0,0,0,0,0,0,0,0,0,0,0,"pulseButton",0,0,0,0,0,0,9,0,9,0],[0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,9,0],[0,13,0,"chicken",0,0,0,"pulseBlock",0,0,0,0,0,"pulseBlock",0,0,0,0,0,"pulseBlock",0,0,0,0,0,0,0,0,0,0,0,9,0],[0,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,"pulseBlock","pulseBlock","pulseBlock",13,13,13,0,9,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,"spikes","spikes","spikes",13,0,13,0,9,0],[0,0,"gameGoal",0,0,0,0,0,0,0,"pulseButton",0,0,0,0,0,0,0,0,0,0,0,0,13,13,13,13,13,0,0,0,9,0],[0,10,"torch",10,10,0,0,0,0,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,13,0,0,0,9,0],[0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,0,0,"pulseButton",0,0,0,0,0,0,9,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,0,0,0,0,0,9,0],[0,0,0,0,0,0,0,"bouncer",0,0,0,0,0,0,0,"pulseBlock",0,0,0,0,0,0,0,0,0,"pulseBlock",0,0,0,0,0,0,0],[0,0,0,13,13,13,13,13,"pulseBlock","pulseBlock","pulseBlock",13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,0,0],[0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,0,0,0,0,0,0,13,0,0,0,0,13,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],["spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes"]],playtestData:{left:901,right:873,jump:53},surveyArea:.4,joyCount:75},{name:"Cannon't Do It",developer:"Benzerware Ltd",playerPrefab:"playerBenzer",backgroundColor:[90,130,210],clicks:null,darkness:.1,price:9.99,rating:null,sales:null,time:1e4,views:null,tiles:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,"gameStart",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,"cannon",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,13,"cannon",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,13,13,"cannon",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,13,13,13,0,0,0,0,0,0,0,0,0,0,0,0,"gameGoal",0,0],[0,0,9,0,9,9,9,9,9,0,0,0,0,0,0,0,0,0,10,10,10,10,0],[0,0,9,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0],["spikes","spikes",9,"spikes","spikes","spikes","spikes",9,"spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes","spikes",10,"spikes","spikes"]],playtestData:null,surveyArea:.25,joyCount:50}]}),n("js/products",["require","exports","module"],function(e,t,i){t.dropper={name:"Dropper",description:"Right-click support",avatar:{image:"media/images/objects.png",imageX:112,imageY:80},price:0,flag:"dropper"},t.marketAnalysis={name:"Market Analysis",description:"Analyze your games for $",avatar:{image:"media/images/objects.png",imageX:112,imageY:64},price:1e3,flag:"marketAnalysis"},t.spikes={name:"Spikes",description:"Deadly",avatar:{image:"media/images/objects.png",imageX:80,imageY:0},price:2e3,editEntity:"spikes"},t.bouncer={name:"Bouncer",description:"Like a trampoline",avatar:{image:"media/images/objects.png",imageX:48,imageY:64},price:2500,editEntity:"bouncer"},t.hPlatform={name:"Horizontal Platform",description:"Moves left/right",avatar:{image:"media/images/objects.png",imageX:96,imageY:48},price:3e3,editEntity:"hPlatform"},t.sizeMedium={name:"Medium Games",description:"Make bigger games",avatar:{image:"media/images/objects.png",imageX:80,imageY:80},price:1e4,flag:"sizeMedium"},t.hTrap={name:"Horizontal Spikes",description:"Deadly, moves left/right",avatar:{image:"media/images/objects.png",imageX:64,imageY:16},price:4e3,editEntity:"hTrap"},t.pulseButton={name:"Beacon",description:"Signals other entities",avatar:{image:"media/images/objects.png",imageX:32,imageY:96},price:5e3,editEntity:"pulseButton"},t.pulseBlock={name:"Signal Block",description:"Toggles on signal",avatar:{image:"media/images/objects.png",imageX:96,imageY:96},price:6e3,editEntity:"pulseBlock"},t.intervalRock={name:"Interval Rock",description:"Toggles on/off",avatar:{image:"media/images/objects.png",imageX:96,imageY:32},price:7e3,editEntity:"intervalRock"},t.darkness={name:"Darkness",description:"Adds lighting effects",avatar:{image:"media/images/actors.png",imageX:0,imageY:32},price:15e3,flag:"darkness"},t.torch={name:"Torch",description:"Lights the way",avatar:{image:"media/images/objects.png",imageX:48,imageY:112},price:7500,editEntity:"torch"},t.fragileRock={name:"Fragile Rock",description:"Destroyed when touched",avatar:{image:"media/images/objects.png",imageX:16,imageY:32},price:8e3,editEntity:"fragileRock"},t.gravityRock={name:"Gravity Sphere",description:"Inverts gravvvvvvity",avatar:{image:"media/images/objects.png",imageX:96,imageY:16},price:9e3,editEntity:"gravityRock"},t.vPlatform={name:"Vertical Platform",description:"Moves up/down",avatar:{image:"media/images/objects.png",imageX:80,imageY:96},price:1e4,editEntity:"vPlatform"},t.chicken={name:"Chicken",description:"Moves. Stomp to kill",avatar:{image:"media/images/actors.png",imageX:0,imageY:160},price:2e4,editEntity:"chicken"},t.teleporter={name:"Teleporter",description:"Beam me up, Scotty",avatar:{image:"media/images/objects.png",imageX:48,imageY:96},price:11e3,editEntity:"teleporter"},t.gameKey={name:"Key",description:"Activates the goal",avatar:{image:"media/images/objects.png",imageX:48,imageY:80},price:12e3,editEntity:"gameKey"},t.jumper={name:"Jumper",description:"Jumps. Stomp to kill",avatar:{image:"media/images/actors.png",imageX:80,imageY:16},price:13e3,editEntity:"jumper"},t.cannon={name:"Cannon",description:"pew pew pew",avatar:{image:"media/images/objects.png",imageX:0,imageY:48},price:14e3,editEntity:"cannon"},t.bossBlock={name:"Boss Block",description:"Increases boss power",avatar:{image:"media/images/objects.png",imageX:96,imageY:112},price:15e3,editEntity:"bossBlock"},t.playerGirl={name:"Annie",description:"Just a girl",avatar:{image:"media/images/actors.png",imageX:0,imageY:16},price:5e3,flag:"playerGirl"},t.playerBoy={name:"Matt",description:"Just a boy",avatar:{image:"media/images/actors.png",imageX:0,imageY:0},price:5e3,flag:"playerBoy"},t.rockTile={name:"Rock Tile",description:"Solid as a rock",avatar:{image:"media/images/env.png",imageX:16,imageY:16},price:500,tileIndex:9},t.sandTile={name:"Sand Tile",description:"Goldish",avatar:{image:"media/images/env.png",imageX:32,imageY:16},price:1e3,tileIndex:10},t.brickTile={name:"Brick Tile",description:"Reddest",avatar:{image:"media/images/env.png",imageX:48,imageY:16},price:2e3,tileIndex:11},t.iceTile={name:"Blue Tile",description:"Only in color, Michael",avatar:{image:"media/images/env.png",imageX:64,imageY:16},price:4e3,tileIndex:12},t.woodTile={name:"Wooden Tile",description:"A boat is wooden",avatar:{image:"media/images/env.png",imageX:80,imageY:16},price:8e3,tileIndex:13},t.plantTile={name:"Overgrown Tile",description:"Foliage not foilage",avatar:{image:"media/images/env.png",imageX:96,imageY:16},price:16e3,tileIndex:14},t.scaryTile={name:"Scary Tile",description:"EEEEEEEEK!",avatar:{image:"media/images/env.png",imageX:112,imageY:16},price:32e3,tileIndex:15},t.backgroundColor={name:"Background Color",description:"Penultimate expression",avatar:{image:"media/images/objects.png",imageX:32,imageY:64},price:5e4,flag:"backgroundColor"},t.sizeLarge={name:"Large Games",description:"Make the BIGGEST games!",avatar:{image:"media/images/objects.png",imageX:96,imageY:80},price:1e5,flag:"sizeLarge"}}),n("js/reviewers",["require","exports","module","djinn/utils/array","djinn/math/random"],function(e,t,i){var n=e("djinn/utils/array"),a=e("djinn/math/random"),s=[],r=[],o=[],l=[],h=["Andrea Abney","BelieveInDragons","Benzer","Brazil Josh","Chombers","Desk","Dom2d","Elite","Geoff Blair","Greg Love","Josh","Joshua Morse","Koopa","LDG","Loki","Lunch Box","MadUnicorn","Matt Hackett","Melissa","Mojito","Palette Swap","ShinyFarret","TokyoDan","Vox","Warspawn","Whippering","andraconda","anonymous","gentlerabbit","nuclearpants","puppies","richtaur","salmonmoose","wickedpants"],u=["Exquisite! What a blast!","High-fives all around!","I want to go to there.","Made me cry it's so good.","My new favorite game!","Nothing quite like it!","Oh wow! So much fun!","Reminds me of elephants","SO GOOD","TAKE MY MONEY","THANKS FOR MAKING IT","Wouldn't change a thing!","Your face is nice.","blew my face RIGHT OFF","doesn't suck that much","had tons o fun","most fun since NES days","my hovercraft has eels","prettty gooodd","really enjoyed this"],d=["1337Gamer69","13loodReign","BetterThenYou","Bitch Hunter","Chromie","Darksol","Fancylad99","GameranxHD","Illidan","Isaac","Kefka","Newman","Olmec","Sephiroth","Shedu","Tracer","Wedge","baseballfan11","bowling","horsereviews","indiesuck","jarjar","spiderwalker"],c=["...","!@#% the devs","BOOOOORING","DO NOT BUY","I DEFAND REMUND","I want my money back, plz?","I'd rather eat glass","GARBAGE","Needs more explosions.","NO","Not much going on here..","On the same level as E.T.","Play any other game!","SUCKS","Waste of time DO NOT BUY.","What a RIPOFF!!","a disgusting disapointment","didn't really wow me","didn't run! GARBAGE!","got a refund","how are there any sales??","made me throw up","not even worth $1","obviously a clone","really stupid?","somebody shoot me","srsly?","ugh, i hate the dev","uninspired boring nonsense","uninstalled","what a waste of time","who was this even made for","whoever made this is dumb","why does this even exist","why?","worst game i ever played"];t.generate=function(e,i){if(1===e)var a=i,s=0;else var a=Math.round(i*e),s=i-a;for(var r=[],o=0;a>o;++o)r.push({name:t.getPositiveName(),reco:!0,text:t.getPositiveReview()});for(var o=0;s>o;++o)r.push({name:t.getNegativeName(),reco:!1,text:t.getNegativeReview()});return n.shuffle(r)},t.getPositiveName=function(){return 0===s.length&&(s=n.clone(h)),a.choice(s,!0)},t.getPositiveReview=function(){return 0===r.length&&(r=n.clone(u)),a.choice(r,!0)},t.getNegativeName=function(){return 0===o.length&&(o=n.clone(d)),a.choice(o,!0)},t.getNegativeReview=function(){return 0===l.length&&(l=n.clone(c)),a.choice(l,!0)}}),n("js/templates",["require","exports","module"],function(e,t,i){var n="gameStart",a="gameGoal";t.get=function(e){var i={small:t.getSmall(),medium:t.getMedium(),large:t.getLarge()};return i[e]},t.getKeyByHeight=function(e){var i={small:t.getSmall(),medium:t.getMedium(),large:t.getLarge()};for(var n in i){var a=i[n];if(e===a.length)return n}return null},t.getSmall=function(){return[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,n,0,0,0,0,0,0,0,0,a,0,0,0],[0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},t.getMedium=function(){return[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,n,0,0,0,0,0,0,0,0,a,0,0,0,0,0,0,0,0,0,0],[0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},t.getLarge=function(){return[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,n,0,0,0,0,0,0,0,0,0,0,0,0,a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}}),n("js/gameData",["require","exports","module","djinn/Emitter","djinn/manifest","djinn/utils/storage","djinn/utils/object","djinn/utils/string","djinn/math/core","djinn/math/random","./competitors","./products","./reviewers","./templates"],function(e,t,i){var n=e("djinn/Emitter"),a=e("djinn/manifest"),s=e("djinn/utils/storage"),r=e("djinn/utils/object"),o=(e("djinn/utils/string"),e("djinn/math/core")),l=e("djinn/math/random"),h=e("./competitors"),u=e("./products"),d=e("./reviewers"),c=e("./templates"),p=a.shortName,g=8,m=100,f={developer:null,developers:{},gameIndex:0,oauth:{},editGameIndex:0,editTileKey:8,editEntityKey:null},v=n.extend({init:function(e){this._super(e),this.data=r.clone(f)},load:function(){var e=s.getObject(p);e&&(this.data=merge(e,this.data))},save:function(){s.setObject(p,this.data)},restoreDefaults:function(){this.data=r.clone(f),this.save()},getGamesList:function(){return this.getDeveloper().gamesList},getEditGame:function(){var e=this.getGamesList();return e[this.data.editGameIndex]},getDeveloper:function(){var e=this.data;return e.developers[e.developer]},addDeveloperEditEntity:function(e){var t=this.getDeveloper().editEntities;-1===t.indexOf(e)&&(t.push(e),this.save())},getDevelopers:function(){return this.data.developers},getDeveloperCount:function(){return r.getLength(this.getDevelopers())},hasRolledCredits:function(){var e=this.getDevelopers();for(var t in e){var i=e[t];if(i.flags.credits)return!0}return!1},getDeveloperMoney:function(){var e=this.getDeveloper(),t=e.money;return o.round(t,2)},setDeveloper:function(e){this.data.developer=e,this.save()},addDeveloper:function(e){var t=this.data.developers;return e in t?!1:(t[e]={backgroundColor:"windowsBG",editTiles:[8],editEntities:["trashCan","gameStart","gameGoal","vTrap"],fanData:{Genero:25100,Retroladies:50500,Rook:250250,Chronic:10100,"Benzerware Ltd":1e6,AD:500500},flags:{},money:0,productsUnlocked:["rockTile","sandTile","brickTile","iceTile","woodTile","plantTile","scaryTile","spikes","pulseButton","bossBlock","playerBoy","playerGirl","dropper","backgroundColor","marketAnalysis"],productsOwned:[],competitorIndex:0,competitorFranchise:1,gamesList:[],sceneTime:{}},this.save(),!0)},removeDeveloper:function(e){var t=this.data.developers;delete t[e],this.save()},getDeveloperFlag:function(e,t){var i=this.getDeveloper(),n=i.flags;return e in n?n[e]:t},setDeveloperFlag:function(e,t){var i=this.data,n=i.developers[i.developer];n.flags[e]=t,this.save()},developerBuyProduct:function(e){var t=this.getDeveloper();if(!(t.productsOwned.indexOf(e)>-1)){t.productsOwned.push(e);var i=u[e];t.money-=i.price,i.editEntity?t.editEntities.push(i.editEntity):i.flag?this.setDeveloperFlag(i.flag,!0):i.tileIndex&&t.editTiles.push(i.tileIndex),this.save()}},developerShouldPlayGames:function(){var e=this.getPublishedGames(),t=!1;return e.forEach(bind(this,function(e){e.productId&&!this.developerUnlockedProduct(e.productId)&&(t=!0)})),t},hasDeveloperBoughtSomething:function(){var e=this.getDeveloper();return e.productsOwned.length>0},hasDeveloperBoughtEverything:function(){var e=this.getDeveloper();return e.productsOwned.length>=r.getLength(u)},developerUnlockProduct:function(e){var t=this.getDeveloper();t.productsUnlocked.indexOf(e)>-1||(t.productsUnlocked.push(e),this.save())},developerOwnsProduct:function(e){var t=this.getDeveloper();return t.productsOwned.indexOf(e)>-1},developerUnlockedProduct:function(e){var t=this.getDeveloper();return t.productsUnlocked.indexOf(e)>-1},developerCanBuySomeProduct:function(){var e=this.getDeveloper();for(var t in u){var i=u[t];if(this.developerUnlockedProduct(t)&&!this.developerOwnsProduct(t)&&e.money>=i.price)return!0}return!1},developerBoughtGame:function(e){var t=this.getGameByIndex(e);return t.bought},developerCanAffordGame:function(e){var t=this.getGameByIndex(e),i=this.getDeveloperMoney();return i>=t.price},developerBuyGame:function(e){var t=this.getDeveloper(),i=this.getGameByIndex(e);t.money-=i.price,i.bought=!0,this.save()},developerHasGameReadyToPublish:function(){var e=this.data.developer,t=this.getGames(function(t){return t.developer===e&&!t.published&&t.tested});return t.length>0},getGames:function(e){for(var t=this.getGamesList(),i=[],n=0,a=t.length;a>n;++n){var s=t[n];e(s)&&(s.gameIndex=n,i.push(s))}return i.reverse(),i},getGamesByDeveloper:function(e){return this.getGames(function(t){return t.developer===e})},getPublishedGames:function(){return this.getGames(function(e){return e.published})},getPublishedGamesByDeveloper:function(e){return this.getGames(function(t){return t.developer===e&&t.published})},getUnpublishedGamesByDeveloper:function(e){return this.getGames(function(t){return t.developer===e&&!t.published})},getTopGames:function(){var e=this.getPublishedGames();return e.sort(function(e,t){return t.gross-e.gross}),e.length>5&&(e.length=5),e},setGameValue:function(e,t,i){var n=this.getGamesList();n[e][t]=i,this.save()},setGameTestState:function(e,t){
this.setGameValue(e,"tested",t),t||this.setGamePlaytestData(e,null)},setGamePlaytestData:function(e,t){this.setGameValue(e,"playtestData",t)},setGameSurvey:function(e,t){var i=t.getEntitiesByType("survey"),n=t.width/16*(t.height/16),a=0;i.forEach(function(e){e.meta.joyCount&&(a+=e.meta.joyCount)});var s=i.length/n;this.setGameValue(e,"surveyArea",s),this.setGameValue(e,"joyCount",a)},setGameTime:function(e,t){this.setGameValue(e,"time",t)},canMakeNewGame:function(){var e=this.data.developer;return this.getGamesByDeveloper(e).length<m},canMakeNewDeveloper:function(){var e=this.data.developers;return r.getLength(e)<g},checkBestTime:function(e,t){var i=this.getGameByIndex(e);return i.bestTime||(i.bestTime=1/0),t<i.bestTime?(i.bestTime=t,this.save(),!0):!1},makeGame:function(e,t,i){var n=this.getGamesList();return n.push({name:t.name,developer:e,player:!0,playerPrefab:t.playerPrefab,backgroundColor:t.backgroundColor,clicks:null,darkness:t.darkness,price:null,rating:null,sales:null,time:null,views:null,tiles:c.get(i),bestTime:null}),this.save(),n.length-1},publishGame:function(e){var t=this.getGamesList(),i=t[e];i.published=!0,i.rating=this.getGameRating(i);var n=this.getFansByProfile(i.developer),a=25e3+n;this.simulateTraffic(i,a),this.addReviews(i),i.gross=i.price*i.sales,i.net=o.round(.7*i.gross,2);var s=this.getGameFanDelta(i);if(this.addFansByProfile(i.developer,s),i.newFans=s,i.player){var r=this.getDeveloper();r.money+=i.net}this.save()},getGameFanDelta:function(e){var t=o.lerp(-1,1,e.rating);return Math.floor(e.sales*t)},publishCompetitor:function(){var e=this.getDeveloper();e.competitorIndex>=h.length&&(e.competitorIndex=0,e.competitorFranchise++);var t=r.clone(h[e.competitorIndex]);e.competitorFranchise>1&&this.sequelizeGame(t,e.competitorFranchise);var i=this.getGamesList(),n=i.push(t);this.publishGame(n-1),e.competitorIndex++,this.save()},sequelizeGame:function(e,t){e.name+=" "+t;var i=e.backgroundColor;i[0]=o.clamp(i[0]+l.range(-25,25),0,255),i[1]=o.clamp(i[0]+l.range(-25,25),0,255),i[2]=o.clamp(i[0]+l.range(-25,25),0,255);var n=["playerBenzer","playerBoy","playerGirl","playerGoblin","playerJoey"];do var a=l.choice(n);while(a===e.playerPrefab);e.playerPrefab=a;for(var s=e.tiles,r=0;r<s.length;++r)for(var h=0;h<s[r].length;++h){var u=s[r][h];isNaN(u)||0===u||u>=13||(s[r][h]=u+1)}},publishAllCompetitors:function(){for(var e=this.getDeveloper();e.competitorIndex<h.length;)this.publishCompetitor()},moveGameToEnd:function(e){var t=this.getGamesList(),i=t[e];return t.splice(e,1),t.push(i)-1},isGameDevelopersTopEarner:function(e){var t=this.getPublishedGamesByDeveloper(this.data.developer);return t.length<2?!0:(t.sort(function(e,t){return e.net<t.net}),t[0].name===e.name)},isDefaultColor:function(e){return 89===e[0]&&125===e[1]&&206===e[2]},getGameContentCount:function(e){for(var t=e.tiles,i=0,n=0;n<t.length;++n)for(var a=0;a<t[n].length;++a)t[n][a]&&++i;return e.darkness>0&&++i,this.isDefaultColor(e.backgroundColor)||++i,"playerDog"!==e.playerPrefab&&++i,i},getGameUniqueContentCount:function(e){for(var t={},i=e.tiles,n=0;n<i.length;++n)for(var a=0;a<i[n].length;++a){var s=String(i[n][a]);s in t?t[s]++:t[s]=1}return e.darkness>0&&(t.darkness=1),this.isDefaultColor(e.backgroundColor)||(t.background=1),r.getLength(t)},getAverageGameUniqueContentCount:function(){for(var e=this.getPublishedGames(),t=e.length,i=0,n=0;t>n;++n){var a=e[n],s=this.getGameUniqueContentCount(a);i+=s}return i/t},getAverageGameSurveyArea:function(){for(var e=this.getPublishedGames(),t=e.length,i=0,n=0;t>n;++n){var a=e[n];i+=a.surveyArea}return i/t},getAverageGameJoyCount:function(){for(var e=this.getPublishedGames(),t=e.length,i=0,n=0;t>n;++n){var a=e[n];i+=a.joyCount}return i/t},getGameRating:function(e){var t=this.getAverageGameJoyCount(),i=o.clamp(e.joyCount/t,0,1);e.joyNormal=i;var n=this.getAverageGameSurveyArea(),a=o.clamp(e.surveyArea/n,0,1);e.surveyNormal=a;var s=this.getGameAverageContentCount(e),r=this.getGameContentCount(e),l=o.clamp(r/s,0,1);e.contentNormal=l;var h=this.getAverageGameUniqueContentCount(),u=this.getGameUniqueContentCount(e),d=o.clamp(u/h,0,1);e.uniqueNormal=d;var c=.25*a+.25*i+.25*l+.25*d;return o.clamp(c,0,1)},getGamePlaytestNormal:function(e){var t=e.playtestData;if(!t)return 0;var i=.6;return t.left>0&&(i+=.1),t.right>0&&(i+=.1),t.jump>0&&(i+=.1),t.jump>1&&(i+=.1),i},getGameAverageContentCount:function(e){for(var t=this.getPublishedGames(),i=t.length,n=0,a=0;i>a;++a){var e=t[a],s=this.getGameContentCount(e);n+=s}return n/i},simulateTraffic:function(e,t){for(var i=(e.rating,0),n=0,a=this.getGameClickChance(e),s=this.getGameBuyChance(e),r=0;t>r;++r)l.chance(a)&&(++i,l.chance(s)&&++n);e.views=t,e.clicks=i,e.sales=n},addReviews:function(e){var t=o.clamp(Math.floor(e.sales/100),10,50),i=d.generate(e.rating,t);e.reviews=i},getGameClickChance:function(e){return.35*e.uniqueNormal},getGameBuyChance:function(e){var t=10,i=(Math.pow(t,e.rating)-1)/(t-1),n=c.getKeyByHeight(e.tiles.length),a={small:4.99,medium:9.99,large:14.99},s=a[n],r=o.lerp(.1,.35,s/e.price);return i*r},getGameByIndex:function(e){var t=this.getGamesList();return t[e]},getGameAnalysisCost:function(e){var t=c.getKeyByHeight(e.tiles.length);return{small:100,medium:500,large:1e3}[t]},getFansByProfile:function(e){var t=this.getDeveloper().fanData;return void 0===t[e]&&(t[e]=0),t[e]},addFansByProfile:function(e,t){var i=this.getFansByProfile(e),n=this.getDeveloper().fanData;n[e]=i+t,n[e]<0&&(n[e]=0),this.save()},removeGame:function(e){var t=this.getGamesList();t.splice(e,1),this.save()},buyAllProducts:function(){var e=this.getDeveloper();for(var t in u){var i=u[t];e.money+=i.price,this.developerBuyProduct(t)}},unlockAllProducts:function(){this.getDeveloper();for(var e in u){u[e];this.developerUnlockProduct(e)}},updateGameMap:function(e,t,i,n){var a=this.getGamesList(),s=a[e].tiles;s[i][t]=n,this.save()},updateGamePrice:function(e,t){var i=this.getGamesList();i[e].price=t,this.save()},updateEditGameName:function(e){var t=this.getGamesList(),i=t[this.data.editGameIndex];i.name=e,this.save()},updateEditGamePlayer:function(e){var t=this.getGamesList(),i=t[this.data.editGameIndex];i.playerPrefab=e,this.save()},getSceneTime:function(e){var t=this.getDeveloper(),i=t.sceneTime;return i[e]||0},updateSceneTime:function(e,t){var i=this.getDeveloper(),n=i.sceneTime;e in n?n[e]+=t:n[e]=t,this.save()}});i.exports=new v}),n("js/view/Mouse",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults))},reset:function(){this.visible=!1}}),t.defaults={image:"media/images/ui.png",imageX:64,width:16,height:16}}),n("js/view/style",["require","exports","module","djinn/math/core","djinn/utils/string"],function(e,t,i){var n=e("djinn/math/core"),a=e("djinn/utils/string"),s={black:"rgba(20, 12, 28, %s)",blue:"rgba(89, 125, 206, %s)",brown:"rgba(128, 96, 65, %s)",darkBlue:"rgba(48, 52, 109, %s)",darkGreen:"rgba(52, 101, 36, %s)",gold:"rgba(216, 186, 79, %s)",green:"rgba(109, 170, 44, %s)",gray:"rgba(78, 74, 78, %s)",maroon:"rgba(68, 36, 62, %s)",orange:"rgba(210, 125, 44, %s)",pink:"rgba(210, 170, 153, %s)",purple:"rgba(159, 76, 208, %s)",qbBlue:"rgba(0, 0, 170, %s)",red:"rgba(133, 19, 20, %s)",silver:"rgba(133, 149, 161, %s)",teal:"rgba(109, 194, 202, %s)",white:"rgba(222, 238, 214, %s)",yellow:"rgba(241, 237, 121, %s)",marketBG:"rgba(27, 40, 56, %s)",windowsBG:"rgba(0, 128, 129, %s)"},r={8:"brown",9:"silver",10:"gold",11:"red",12:"teal",13:"brown",bouncer:"red",chicken:"white",fragileRock:"gray",gameGoal:"gold",gameKey:"gold",gameStart:"white",gravityRock:"blue",hPlatform:"white",hTrap:"silver",intervalRock:"silver",jumper:"green",pulseBlock:"blue",pulseButton:"brown",spikes:"silver",teleporter:"teal",torch:"yellow",vPlatform:"white",vTrap:"silver"},o={a:"green",b:"red",x:"blue",y:"gold"},l=function(e){return a.sprintf("rgb(%s, %s, %s)",e[0],e[1],e[2])},h=function(e,t){return t=void 0===t?1:n.clamp(t,0,1),s[e]?a.sprintf(s[e],t):null},u=function(e){return.6>e?"red":.8>e?"gold":"green"},d=function(e,t){return e>.5?h("green",t):e>.25?h("orange",t):h("red",t)},c=function(e){return a.sprintf(e?"white":"gray")},p=function(e){return h(o[e]||"gray")};i.exports={fromRGBArray:l,getColor:h,getColorFromNormal:u,getProgressColor:d,getTextColor:c,getGamepadButtonColor:p,rectangleUIDefaults:{fillColor:h("black",.8),strokeColor:h("white"),strokeWidth:4,borderRadius:4},screenshotColors:r}}),n("js/textData",{0:{x:0,y:0},1:{x:16,y:0},2:{x:32,y:0},3:{x:48,y:0},4:{x:64,y:0},5:{x:80,y:0},6:{x:96,y:0},7:{x:112,y:0},8:{x:128,y:0},9:{x:144,y:0},A:{x:0,y:16},B:{x:16,y:16},C:{x:32,y:16},D:{x:48,y:16},E:{x:64,y:16},F:{x:80,y:16},G:{x:96,y:16},H:{x:112,y:16},I:{x:128,y:16},J:{x:144,y:16},K:{x:0,y:32},L:{x:16,y:32},M:{x:32,y:32},N:{x:48,y:32},O:{x:64,y:32},P:{x:80,y:32},Q:{x:96,y:32},R:{x:112,y:32},S:{x:128,y:32},T:{x:144,y:32},U:{x:0,y:48},V:{x:16,y:48},W:{x:32,y:48},X:{x:48,y:48},Y:{x:64,y:48},Z:{x:80,y:48},$:{x:96,y:48},"@":{x:112,y:48},"(":{x:128,y:48},")":{x:144,y:48},a:{x:0,y:64},b:{x:16,y:64},c:{x:32,y:64},d:{x:48,y:64},e:{x:64,y:64},f:{x:80,y:64},g:{x:96,y:64},h:{x:112,y:64},i:{x:128,y:64},j:{x:144,y:64},k:{x:0,y:80},l:{x:16,y:80},m:{x:32,y:80},n:{x:48,y:80},o:{x:64,y:80},p:{x:80,y:80},q:{x:96,y:80},r:{x:112,y:80},s:{x:128,y:80},t:{x:144,y:80},u:{x:0,y:96},v:{x:16,y:96},w:{x:32,y:96},x:{x:48,y:96},y:{x:64,y:96},z:{x:80,y:96},"?":{x:96,y:96},"!":{x:112,y:96},".":{x:128,y:96},",":{x:144,y:96},"#":{x:0,y:112},"%":{x:16,y:112},"&":{x:32,y:112},"'":{x:48,y:112},":":{x:64,y:112},";":{x:80,y:112},"/":{x:96,y:112},"+":{x:112,y:112},"-":{x:128,y:112},_:{x:144,y:112}}),n("js/view/Typer",["require","exports","module","djinn/view/View","djinn/utils/string","./style","../textData"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/string"),s=e("./style"),r=e("../textData"),o=8,t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.color=e.color,this.text=e.text},render:function(e){for(var t=this.text,i=t.split(" "),n=0,a=0,s=0,r=i.length;r>s;++s){var l=i[s];(n+l.length)*o>this.width&&(n=0,++a);for(var h=0,u=l.length;u>h;++h){var d=l[h];this._drawLetter(e,d,n,a),++n}++n}},shrinkwrap:function(){return this.width=this.text.length*o,this},underline:function(e){this._underline&&this._underline.dispose(),e!==!1&&(this._underline=new n({parent:this,backgroundColor:s.getColor(this.color),height:1}).align(null,"bottom"))},_drawLetter:function(e,t,i,n){var a=r[t];a&&e.drawImage(this._image,a.x,a.y,8,8,8*i,8*n,8,8)}});Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this.image=a.sprintf("media/images/text/%s.png",e),this.redrawBuffer()}}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){void 0===e?this._text="":this._text=String(e),this.redrawBuffer()}}),t.defaults={buffer:!0,color:"white",height:o}}),n("js/view/scenes/Scene",["require","exports","module","djinn/stage","djinn/Scene","djinn/view/View","djinn/input/keyboard","djinn/input/gamepad","../Mouse","../Typer","../../gameData"],function(e,t,i){var n=e("djinn/stage"),a=e("djinn/Scene"),s=e("djinn/view/View"),r=e("djinn/input/keyboard"),o=e("djinn/input/gamepad"),l=e("../Mouse"),h=e("../Typer"),u=e("../../gameData"),d=o.buttons,c=r.keys,p=c.left,g=c.right,m=c.up,f=c.down,t=i.exports=a.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),n.on("wheel",this,"_onWheel"),this.mouse=new l({parent:this,visible:!1,z:1e3}),this.on("inputMove",this,"_onInputMove")},reset:function(){this._y=0,this.mouse.reset()},activate:function(e,t){this._super(e,t),this._elapsed=Date.now()},deactivate:function(e,t){if(this._super(e,t),this.timeTrackId){var i=Date.now()-this._elapsed;u.updateSceneTime(this.timeTrackId,i)}},addQuitX:function(e){var t=new h({parent:this,text:"X",color:e,acceptInputEvents:!0});return t.shrinkwrap(),t.align("right","top",-4,4),t.on("inputPress",this,"_onQuit"),t},addSettingsGear:function(){var e=new s({parent:this,acceptInputEvents:!0,image:"media/images/objects.png",imageY:32,width:16,height:16});return e.align("right","bottom",-4,-4),e},getInput:function(e,t){switch(e){case"negate":return r.test("negate",t)||o.test("negate",t);case"action":return r.test("action",t)||o.test("action",t);case"left":return r.test("moveLeft",t)||r.isDown(p,t)||o.isButtonDown(d.dPadLeft,t)||o.isDirectionDown("left");case"right":return r.test("moveRight",t)||r.isDown(g,t)||o.isButtonDown(d.dPadRight,t)||o.isDirectionDown("right");case"down":return r.test("moveDown",t)||r.isDown(f,t)||o.isButtonDown(d.dPadDown,t)||o.isDirectionDown("down");case"up":return r.test("moveUp",t)||r.isDown(m,t)||o.isButtonDown(d.dPadUp,t)||o.isDirectionDown("up")}},_addLine:function(e,t){var i=this._container;if(e){var n=new h({parent:i,text:e,acceptInputEvents:!0,color:t,width:this.width-32,y:this._y});n.shrinkwrap()}return void 0===this._y&&(this._y=0),this._y+=8,i.shrinkwrap(),n},_onInputMove:function(e){var t=this.mouse,i=e.point;t.x=i.x-1,t.y=i.y-1,t.visible=!0},_onWheel:function(e,t){var i=this._scrollbar;i&&this.captureInputEvents&&this.visible&&(0>t?i.scroll(-1,160):i.scroll(1,160))}});t.defaults={fadeDuration:250}}),n("js/view/BackButton",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)}});t.defaults={acceptInputEvents:!0,image:"media/images/ui.png",imageX:48,imageY:16,width:16,height:16}}),n("js/view/Screenshot",["require","exports","module","djinn/view/View","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./style"),s=a.screenshotColors;i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},render:function(e){var t=this.tiles;if(t){e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.width,this.height);for(var i=t[0].length,n=t.length,r=Math.floor(this.width/i)||1,o=Math.floor(this.height/n)||1,l=0;n>l;++l)for(var h=0;i>h;++h){var u=String(t[l][h]),d=s[u];d&&(e.fillStyle=a.getColor(d),e.fillRect(h*r,l*o,r,o))}}},setGame:function(e){this.tiles=e.tiles,e.backgroundColor&&(this.backgroundColor=a.fromRGBArray(e.backgroundColor)),this.redrawBuffer()}}),t.defaults={backgroundColor:a.getColor("black"),buffer:!0}}),n("js/view/Slider",["require","exports","module","djinn/view/View","djinn/math/core","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/core"),s=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=this.width-2,a=this.height-2,s=this._background=new n({parent:this,acceptInputEvents:!0,backgroundColor:e.barColor,width:i,height:a}).align("center","center"),r=a>i?i:a;this.cursor=new n({parent:s,backgroundColor:e.cursorColor,width:r,height:r}),this._input=!1,this._value=null,this.on("inputStart",this,"_onInputStart"),this.on("inputMove",this,"_onInputMove"),this.on("inputEnd",this,"_onInputEnd")},setValue:function(e){var t=this._background,i=this.cursor;if(this.width>this.height){var n=t.width-i.width;i.x=a.lerp(0,n,e)}else{var n=t.height-i.height;i.y=a.lerp(0,n,e)}var s=this._value;return this._value=e,s},stopInput:function(){this._input=!1},_onInputStart:function(){this._input=!0},_onInputMove:function(e){if(this._input){if(this.width>this.height)var t=e.point.x/this.width;else var t=e.point.y/this.height;t=Math.round(10*t)/10;var i=this.setValue(t);this.fire("change",[t,i])}},_onInputEnd:function(){this.stopInput()}});Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this.setValue(e)}}),t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:s.getColor("silver"),barColor:s.getColor("black"),cursorColor:s.getColor("white")}}),n("js/view/Scrollbar",["require","exports","module","djinn/math/core","./Slider"],function(e,t,i){var n=e("djinn/math/core"),a=e("./Slider"),t=i.exports=a.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.scrollSpeed=e.scrollSpeed},attach:function(e){this._container=e},setValue:function(e){this._super(e);var t=this._container;if(t)if(this.width>this.height){var i=t.parent.width-t.width;t.x=n.lerp(0,i,e)}else{var i=t.parent.height-t.height;t.y=n.lerp(0,i,e)}},reset:function(){this._input=!1,this.setValue(0),this.width>this.height?this._container.width>this.parent.width?this.show():this.hide():this._container.height>this.parent.height?this.show():this.hide()},scroll:function(e,t){if(this.visible){var i=t/1e3,n=100/this._container.height;this.value+=e*i*n*this.scrollSpeed,this.value<0?this.value=0:this.value>1&&(this.value=1)}}});t.defaults={scrollSpeed:1.5}}),n("js/view/scenes/AnalyticsScene",["require","exports","module","djinn/view/View","djinn/utils/string","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../BackButton","../Screenshot","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/string"),s=e("djinn/audio/jukebox"),r=e("./Scene"),o=e("../../gameData"),l=e("../Typer"),h=e("../BackButton"),u=e("../Screenshot"),d=e("../Scrollbar"),c=e("../style"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new h({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit");var t=8;new l({parent:this,text:"Vaultworks Game Analytics",x:24,y:t}),t+=8,this._developerName=new l({parent:this,color:"silver",x:24,y:t}),t+=8,this._br=new l({parent:this,text:"------------------------------",x:8,y:t}),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:96});var i=(this._container=new n({parent:this._window,acceptInputEvents:!0}),this._scrollbar=new d({parent:this._window,barColor:c.getColor("marketBG"),cursorColor:c.getColor("white"),width:8}).align("right"));i.attach(this._container),this.sortChildren()},reset:function(){this._super();var e=o.data.analyticsIndex,t=o.getGamesList(),i=this.game=t[e];this._developerName.text=i.developer;var n=this._container;n.disposeChildren(),this._y=0,o.isGameDevelopersTopEarner(i)&&(this._addLine("YOUR TOP EARNER!","gold"),this._addLine()),this._addLine("--- DETAILS ----------------","silver"),this._addLine();var s=new u({parent:n,y:this._y,width:3*i.tiles[0].length,height:3*i.tiles.length});s.setGame(i);var r=s.right+8,h=8,d=new l({parent:n,text:i.name,x:r,y:s.y});new l({parent:n,text:a.sprintf("$%s",i.price),x:r,y:d.y+16}),h=s.bottom+12,new l({parent:n,text:"--- PERFORMANCE ------------",color:"silver",y:h}),h+=16;var p=new l({parent:n,text:"Views:",color:"silver",y:h}).shrinkwrap();new l({parent:n,text:a.formatNumber(i.views),x:p.right+8,y:h}),h+=16;var p=new l({parent:n,text:"Clicks:",color:"silver",y:h}).shrinkwrap(),g=new l({parent:n,text:a.formatNumber(i.clicks),x:p.right+8,y:h}).shrinkwrap(),m=Math.round(i.clicks/i.views*100);new l({parent:n,text:a.sprintf("(%s%)",m),color:"silver",x:g.right+8,y:h}),h+=16;var p=new l({parent:n,text:"Sales:",color:"silver",y:h}).shrinkwrap(),g=new l({parent:n,text:a.formatNumber(i.sales),x:p.right+8,y:h}).shrinkwrap(),m=Math.round(i.sales/i.clicks*100);new l({parent:n,text:a.sprintf("(%s%)",m),color:"silver",x:g.right+8,y:h}),h+=16;var p=new l({parent:n,text:"Net:",color:"silver",y:h}).shrinkwrap();new l({parent:n,text:"$"+a.formatMoney(i.net),color:"green",x:p.right+8,y:h}),h+=16,new l({parent:n,text:"--- RATING -----------------",color:"silver",y:h}),h+=16;var p=new l({parent:n,text:"Rating:",color:"silver",y:h}).shrinkwrap();new l({parent:n,text:Math.round(100*i.rating)+"%",color:c.getColorFromNormal(i.rating),x:p.right+8,y:h}),h+=16;var p=new l({parent:n,text:"Fun:",color:"silver",y:h}).shrinkwrap();new l({parent:n,text:Math.round(100*i.joyNormal)+"%",color:c.getColorFromNormal(i.joyNormal),x:p.right+8,y:h}),h+=16;var p=new l({parent:n,text:"Gameplay:",color:"silver",y:h}).shrinkwrap();new l({parent:n,text:Math.round(100*i.surveyNormal)+"%",color:c.getColorFromNormal(i.surveyNormal),x:p.right+8,y:h}),h+=16;var p=new l({parent:n,text:"Content:",color:"silver",y:h}).shrinkwrap();new l({parent:n,text:Math.round(100*i.contentNormal)+"%",color:c.getColorFromNormal(i.contentNormal),x:p.right+8,y:h}),h+=16;var p=new l({parent:n,text:"Originality:",color:"silver",y:h}).shrinkwrap();new l({parent:n,text:Math.round(100*i.uniqueNormal)+"%",color:c.getColorFromNormal(i.uniqueNormal),x:p.right+8,y:h}),h+=16,new l({parent:n,text:"--- FEEDBACK ---------------",color:"silver",y:h}),h+=16;var f=i.newFans;if(f>0)var v="New fans:",y="green";else var v="Lost fans:",y="red";var p=new l({parent:n,text:v,color:"silver",y:h}).shrinkwrap();new l({parent:n,text:a.formatNumber(i.newFans),color:y,x:p.right+8,y:h}),h+=16;var w=new l({parent:n,text:"Read reviews ...",acceptInputEvents:!0,y:h});w.on("inputStart",this,"_onReviews"),h+=8,this._container.shrinkwrap(),this._scrollbar.reset()},activate:function(e,t){var i=this.oldSceneId;this._super(e,t),"reviews"===e&&(this.oldSceneId=i),o.animateAnalytics&&(this.game.newFans>0?s.play("increase",0):s.play("dud",0),o.animateAnalytics=!1)},tick:function(e){this.captureInputEvents&&(this.getInput("action",!0)&&this._onReviews(),this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onReviews:function(){s.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("reviews")},_onQuit:function(){s.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId||"marketGame")}});t.defaults={backgroundColor:c.getColor("marketBG"),musicKey:"streets"}}),n("js/view/TextBox",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/input/keyboard","./Typer","./style"],function(e,t,i){for(var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("djinn/input/keyboard"),r=e("./Typer"),o=e("./style"),l=s.keys,h=1,u=[],d=65;90>=d;++d)u.push(d);for(var d=97;122>=d;++d)u.push(d);for(var d=48;57>=d;++d)u.push(d);u.push(l.space),i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.maxLength=e.maxLength,new n({parent:this,backgroundColor:o.getColor("black"),width:this.width-2,height:this.height-2}).align("center","center");this._header=new r({parent:this,anchorX:.5});this.setHeaderText("Game Name");var i=new r({parent:this,acceptInputEvents:!0,text:"X",width:8}).align("right","top",-4,4);i.on("inputPress",this,"_onClose"),this._value=new r({parent:this,width:8*this.maxLength}).align("center","center");var a=this._done=new r({parent:this,text:"Save",acceptInputEvents:!0,anchorX:.5,y:48,width:32});a.align("center"),a.on("inputPress",this,"_onDone"),this._cursor=new r({parent:this,text:"_",y:this._value.y,width:8}),this._cursorTimer=this.createTimer(500,"_onCursorTimer").start()},reset:function(e){this._value.text=e||"",this._updateCursor(),this._updateButton()},setHeaderText:function(e){var t=this._header;t.text=e,t.shrinkwrap(),t.align("center","top",0,4)},tick:function(e){for(var t=this.maxLength,i=0,n=u.length;n>i;++i){var r=u[i];if(s.isDown(r,!0)){var o=this._value.text;o.length<t?(a.play("type"+h,0),h=1===h?2:1,o+=String.fromCharCode(r),this._value.text=o,this._updateCursor(),this._updateButton()):a.play("negate",0)}}if(s.isDown(l.enter,!0)&&this._onDone(),s.isDown(l.backspace,!0)){h=1===h?2:1;var o=this._value.text;o.length>0?(a.play("backspace"+h,0),this._value.text=o.slice(0,-1),this._updateCursor(),this._updateButton()):a.play("negate",0)}},_onDone:function(){var e=this._value.text.trim();e?this.fire("done",[e]):a.play("negate",0)},_onClose:function(){this.fire("close")},_onCursorTimer:function(){var e=this._cursor;e.visible=!e.visible},_updateCursor:function(){var e=this._value;this._cursor.x=e.x+8*e.text.length},_updateButton:function(){var e=this._value.text.trim();this._done.color=e?"white":"gray"}}),t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:o.getColor("white"),maxLength:8,width:192,height:64}}),n("js/view/scenes/AuthScene",["require","exports","module","djinn/view/View","djinn/utils/string","djinn/utils/request","djinn/math/random","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../TextBox","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/string"),s=e("djinn/utils/request"),r=e("djinn/math/random"),o=e("djinn/audio/jukebox"),l=e("./Scene"),h=e("../../gameData"),u=(e("../Typer"),e("../TextBox")),d=e("../style"),c=["twert","twip","twimage","tweetle","twiggle","twatch"],t=i.exports=l.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),this._overlay=new n({parent:this,backgroundColor:d.getColor("black",.75)}),this.addQuitX(),this._container=new n({parent:this,acceptInputEvents:!0,x:8});var e=this._tweetText=new u({parent:this,maxLength:22}).align("center","center");e.on("done",this,"_onTweetTextDone"),e.on("close",this,"_onTweetTextClose"),e.setHeaderText("Tweet"),this.sortChildren()},reset:function(){this._super(),this._tweetText.hide();var e=new Image;e.src=h.data.previewData,e.ready=!0,this._image=e,this._container.disposeChildren(),this._addLine(),this._addLine("Authentication"),this._addLine("--------------","silver"),this._addLine()},activate:function(e,t){if(this._super(e,t),!window.nw)return void this._addLine("nw not found","red");var i=nw.process.mainModule.exports,n=h.data.oauth;if(s.params.oauth_verifier)return this._addLine("Fetching access token ...","silver"),void i.getOAuthAccessToken(n.requestToken,n.requestTokenSecret,s.params.oauth_verifier,bind(this,function(e){e.error?this._onError(e.error,"getOAuthAccessToken"):(n.accessToken=e.oauthAccessToken,n.accessTokenSecret=e.oauthAccessTokenSecret,h.save(),this._done(e))}));var a=n.accessToken,r=n.accessTokenSecret;this._addLine("Verifying credentials ...","silver"),i.verifyCredentials(a,r,bind(this,function(e){if(e.error){console.error("[error] verifyCredentials",e.error),this._addLine("Not logged in","silver");var t=this._addLine("Click to login");t.on("inputStart",this,"_getRequestToken")}else this._done(e)}))},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&(this._tweetText.visible?this._onTweetTextClose():this._onQuit())},_getRequestToken:function(){o.play("start",0);var e=nw.process.mainModule.exports;this._addLine("Fetching request token ...","silver"),e.getOAuthRequestToken(bind(this,function(e){if(e.error)this._onError(e.error,"getOAuthRequestToken");else{var t=h.data.oauth;t.requestToken=e.oauthToken,t.requestTokenSecret=e.oauthTokenSecret,h.save(),this._addLine("Redirecting ... bye!"),location.href=e.redirect}}))},_done:function(e){if(this._addLine("Authenticated!","silver"),e.data){var t=JSON.parse(e.data);this._addLine("Welcome, "+t.screen_name,"silver")}this._addLine();var i=this._addLine("Tweet this screenshot");i.on("inputStart",this,"_showTextBox")},_showTextBox:function(){o.play("select",0),this._tweetText.reset(),this._tweetText.show()},_tweet:function(e){o.play("select",0),this._addLine("Tweeting ...","silver");var t=h.data.tweetData;t=t.replace(/^data:image\/(png|jpg);base64,/,"");var i=nw.process.mainModule.exports,n=h.data.oauth;i.tweetImage(e,t,n,bind(this,function(e){e.error&&this._onError(e.error,"tweetImage")}),bind(this,function(e){if(e.error)this._onError(e.error,"tweetImage (post)");else{o.play("start",0),h.data.tweetData=null,h.data.previewData=null;var t=r.choice(c);this._addLine("Twitter success!","silver"),this._addLine(a.sprintf("Thanks for the %s.",t),"silver");var i=h.getDeveloperFlag("tweets",0)+1;if(h.setDeveloperFlag("tweets",i),this._addLine(a.sprintf("You've tweeted %s times.",i),"silver"),1===i)this._addLine("You got a bird character!","gold"),h.setDeveloperFlag("playerBird",!0);else{var n=500+10*i;this._addLine(a.sprintf("You got $%s!",n),"gold");var s=h.getDeveloper();s.money+=n}h.save(),this._addLine();var l=this._addLine("Back to game");l.on("inputStart",this,"_onQuit")}}))},_onError:function(e,t){o.play("negate",0),console.error("[error] "+t,e),this._addLine("Error, sorry!","red")},_onTweetTextDone:function(e){o.play("create",0),this._tweetText.hide(),this._tweet(e)},_onTweetTextClose:function(){o.play("negate",0),this._tweetText.hide()},_onQuit:function(){o.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("edit")}});t.defaults={backgroundColor:d.getColor("black"),musicKey:"holdPlease"}}),n("djinn/view/shapes/Pinwheel",["require","exports","module","../View","../utils/canvas"],function(e,t,i){var n=e("../View"),a=e("../utils/canvas"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.rays=e.rays,this.rayOffset=0,this.rayAngle=e.rayAngle,this.rayRotationSpeed=e.rayRotationSpeed,this.rayColor=e.rayColor,this.fillColor=e.fillColor},tick:function(e){0!==this.rayRotationSpeed&&(this.rayOffset+=e*this.rayRotationSpeed,this.redrawBuffer())},render:function(e){this.fillColor&&a.drawRect(e,0,0,this.width,this.height,this.fillColor);for(var t=this.rays,i=2*Math.PI/t*2,n=Math.round(this.width/2),s=Math.round(this.height/2),r=this.rayAngle/2,o=this.width/2+this.height/2,l=0;l<this.rays;++l){var h=this.rayOffset+l*i,u=Math.sin(h-r)*o,d=-Math.cos(h-r)*o,c=Math.sin(h+r)*o,p=-Math.cos(h+r)*o;a.drawPolygon(e,[n,s,n+u,s+d,n+c,s+p],this.rayColor)}}});t.defaults={clip:!0,buffer:!0,rays:20,rayOffset:0,rayRotationSpeed:0,rayAngle:Math.PI/10,rayColor:"black",fillColor:"white"}}),n("js/view/Star",["require","exports","module","djinn/view/View","djinn/math/random"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/random"),t=i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults))},tick:function(e){var t=e/1e3;if(this.x-=t*this.speed,this.x<-1){var i=this.parent;this.x=i.width+1,this.y=a.range(0,i.height)}}});t.defaults={width:1,height:1}}),n("js/view/Starfield",["require","exports","module","djinn/view/View","djinn/math/random","./Star","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/random"),s=e("./Star"),r=e("./style");i.exports=n.extend({init:function(e){this._super(e);for(var t=0;100>t;++t){var i=new s({parent:this});switch(a.range(1,3)){case 1:i.speed=a.range(5,10),i.backgroundColor=r.getColor("darkBlue");break;case 2:i.speed=a.range(20,30),i.backgroundColor=r.getColor("silver");break;case 3:i.speed=a.range(50,100),i.backgroundColor=r.getColor("white")}i.x=a.range(0,this.width-1),i.y=a.range(0,this.height-1)}}})}),n("js/view/Dialog",["require","exports","module","djinn/audio/jukebox","djinn/math/random","./Typer"],function(e,t,i){var n=e("djinn/audio/jukebox"),a=e("djinn/math/random"),s=e("./Typer");i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults)),this._animateTimer=this.createTimer(25,"_onAnimateTimer")},animate:function(e){this._dialogText=e,this.text="",this._typeIndex=0,this._animateTimer.start()},_onAnimateTimer:function(){n.play("doubt"+a.range(1,4),0);var e=this._dialogText;this.text=e.substr(0,this._typeIndex),++this._typeIndex,this._typeIndex>e.length&&(this.fire("done"),this._animateTimer.stop())}}),t.defaults={}}),n("js/view/scenes/BillboardScene",["require","exports","module","djinn/view/View","djinn/math/random","djinn/view/shapes/Pinwheel","djinn/manifest","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../Starfield","../Dialog","../style"],function(e,t,i){var n=(e("djinn/view/View"),e("djinn/math/random"),e("djinn/view/shapes/Pinwheel"),e("djinn/manifest"),e("djinn/audio/jukebox"),e("./Scene")),a=(e("../../gameData"),e("../Typer"),e("../Starfield")),s=e("../Dialog"),r=e("../style"),t=i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),this.starfield=new a({parent:this}),this._header1=new s({parent:this,x:50,y:50,width:256,height:8}),this._header2=new s({parent:this,x:50,y:70,width:256,height:8}),this.sortChildren()},activate:function(e,t){this._super(e,t),this.completeTween().delayTween(1e3,bind(this,function(){this._header1.animate("Shop in the store")})).delayTween(1,bind(this,function(){this._header2.animate("to unlock new tools");
})).delayTween(3e3,bind(this,function(){}))},tick:function(e){!this.captureInputEvents}});t.defaults={backgroundColor:r.getColor("black")}}),n("js/view/Alert",["require","exports","module","djinn/view/View","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Typer"),s=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),new a({parent:this,text:"!",width:8,height:8}).align("center","center"),this._pulseTimer=this.createTimer(1e3,"_onPulseTimer")},pulse:function(){this._onPulseTimer(),this._pulseTimer.start()},_onPulseTimer:function(){this.completeTween().tween({opacity:.5},500).tween({opacity:1},500)}});t.defaults={backgroundColor:s.getColor("orange"),width:12,height:12}}),n("js/view/Shortcut",["require","exports","module","djinn/view/View","./Alert","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Alert"),s=e("./Typer"),r=(e("./style"),{dev:{text:"Editor",imageX:7,imageY:1},market:{text:"Vault",imageX:1,imageY:0},news:{text:"News",imageX:4,imageY:0},settings:{text:"Settings",imageX:0,imageY:2},stats:{text:"Stats",imageX:5,imageY:2},quit:{text:"Sign out",imageX:3,imageY:2},store:{text:"Store",imageX:7,imageY:0}}),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=r[e.key];this._icon=new n({parent:this,image:"media/images/objects.png",imageX:16*i.imageX,imageY:16*i.imageY,width:16,height:16}).align("center"),this._typer=new s({parent:this,text:i.text}).shrinkwrap().align("center","bottom")},polish:function(e){this.opacity=0,this.delayTween(1e3,e).tween({opacity:1},1e3,n.transitions.bounceOut)},showAlert:function(){this._alert||(this._alert=new a({parent:this}).align("right",null,-6),this._alert.pulse())}});t.defaults={acceptInputEvents:!0,width:64,height:32}}),n("djinn/view/Sprite",["require","exports","module","./View","../math/core"],function(e,t,i){var n=e("./View"),a=e("../math/core"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this._animations=e.animations,this._animating=!1,this._currentAnimation=null,this._frameElapsed=0,this._frameIndex=0,this.frameOffsetX=e.frameOffsetX,this.frameOffsetY=e.frameOffsetY;for(var i in this._animations)this._animations[i]=merge(this._animations[i],{frames:[],frameRate:12,flipX:!1,flipY:!1,loop:!0})},tick:function(e){if(this._animating&&this._currentAnimation){var t=this._animations[this._currentAnimation];if(t&&(this._frameElapsed+=e,this._frameElapsed>=1e3/t.frameRate)){this._frameElapsed=0,++this._frameIndex;var i=t.frames.length-1;this._frameIndex>i&&(0==t.loop?(this._frameIndex=i,this._animating=!1,this.fire("animationEnd")):this._frameIndex=0),this._showFrame()}}},playAnimation:function(e,t){return(this._currentAnimation!=e||t!==!1)&&(this._animating=!0,this._currentAnimation=e,this._frameIndex=0,this._frameElapsed=0,this._showFrame()),this._animating=!0,this},resumeAnimation:function(e){this._animating=!0,this._currentAnimation=e,this._showFrame()},stopAnimation:function(){return this._animating=!1,this},_showFrame:function(){var e=this._animations[this._currentAnimation];if(void 0===e)return void console.warn("Animation not defined: ",this._currentAnimation);var t=e.frames[this._frameIndex];this.imageX=this.frameOffsetX+t[0],this.imageY=this.frameOffsetY+t[1]}}),s=t.prototype;Object.defineProperty(s,"currentAnimation",{get:function(){return this._currentAnimation}}),Object.defineProperty(s,"frame",{get:function(){return this._frameIndex},set:function(e){this._frameIndex=a.clamp(e,0,this.frameCount-1)}}),Object.defineProperty(s,"frameCount",{get:function(){var e=this._animations[this._currentAnimation];return e&&e.frames&&e.frames.length||0}}),t.defaults={animations:{},frameOffsetX:0,frameOffsetY:0}}),n("js/view/Titan",["require","exports","module","djinn/audio/jukebox","djinn/view/Sprite","djinn/view/View"],function(e,t,i){var n=e("djinn/audio/jukebox"),a=e("djinn/view/Sprite"),s=e("djinn/view/View"),t=i.exports=s.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.on("inputStart",this,"_onInputStart"),this.darkness=new s({parent:this,image:"media/images/darkness.png",opacity:.25}),this.titan=new a({parent:this,animations:{idle:{frameRate:2,frames:[[0,32],[16,32]]}},image:"media/images/actors.png",imageSmoothingEnabled:!1,width:16,height:16}).align("center","center"),this.titan.playAnimation("idle")},advance:function(){n.play("doubt",0),this.titan.scale+=1,this.darkness.opacity+=.1,this.titan.scale>=7&&this.fire("done")},_onInputStart:function(){this.advance()}});t.defaults={acceptInputEvents:!0,captureInputEvents:!0,cancelInputEvents:!0}}),n("js/view/StartMenu",["require","exports","module","djinn/view/View","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Typer"),s=e("./style");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),new n({parent:this,backgroundColor:"rgb(192, 192, 192)",width:this.width-2,height:this.height-2}).align("center","center"),new a({parent:this,color:"gray",anchorX:.5}).align("center","top",0,4);var i=new a({parent:this,acceptInputEvents:!0,text:"Sign out",color:"black",x:4,y:4});i.on("inputPress",this,"_onQuit")},_onQuit:function(){this.fire("quit")}}),t.defaults={acceptInputEvents:!0,backgroundColor:s.getColor("black"),width:80,height:16}}),n("js/view/scenes/ComputerScene",["require","exports","module","djinn/manifest","djinn/view/View","djinn/audio/jukebox","djinn/utils/string","./Scene","../../gameData","../Typer","../Shortcut","../Titan","../StartMenu","../style"],function(e,t,i){var n=(e("djinn/manifest"),e("djinn/view/View")),a=e("djinn/audio/jukebox"),s=e("djinn/utils/string"),r=e("./Scene"),o=e("../../gameData"),l=e("../Typer"),h=e("../Shortcut"),u=e("../Titan"),d=e("../StartMenu"),c=e("../style"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new n({parent:this,backgroundColor:"rgb(192, 192, 192)",height:15}).align(null,"bottom");new n({parent:e,backgroundColor:"rgb(246, 246, 246)",height:1});var t=this._footerText=new l({parent:this,acceptInputEvents:!0,color:"black"});t.align("left","bottom",8,-3),t.on("inputStart",this,"_toggleStartMenu"),this._container=new n({parent:this,acceptInputEvents:!0});var i=this.addSettingsGear();i.align("right","bottom",-4,-19),i.on("inputStart",this,"_onSettings");var a=this.startMenu=new d({parent:this});a.align("left","bottom",1,-12),a.on("quit",this,"_onQuit")},reset:function(){this._super(),this._footerText.text=o.data.developer,this._titan&&this._titan.dispose(),this._titan=null,this.backgroundColor=c.getColor(o.data.developers[o.data.developer].backgroundColor),this.startMenu.hide();var e=this._container;e.disposeChildren();var t=[];t.push("news"),o.getDeveloperFlag("dev")&&t.push("dev"),o.getDeveloperFlag("store")&&t.push("store"),o.getDeveloperFlag("market")&&t.push("market"),o.getDeveloperFlag("stats")&&t.push("stats");for(var i=16,n=8,r=i,l=0,u=t.length;u>l;++l){var d=t[l],p=new h({parent:e,key:d,x:n,y:r}),g="_on"+s.ucfirst(d);p.on("inputStart",this,g);var m=o.data.developer,f=o.getGamesByDeveloper(m),v=f.length>0,y=o.getPublishedGamesByDeveloper(m),w=o.hasDeveloperBoughtSomething(),_=o.hasDeveloperBoughtEverything();"news"===d&&(o.getDeveloperFlag("dev")?v&&!o.getDeveloperFlag("store")?p.showAlert():w&&!o.getDeveloperFlag("market")?p.showAlert():_&&!o.getDeveloperFlag("credits")?p.showAlert():o.getDeveloperFlag("credits")&&!o.getDeveloperFlag("stats")&&p.showAlert():p.showAlert());var x=o.developerHasGameReadyToPublish();"dev"===d&&(v?x||p.showAlert():p.showAlert()),"store"===d&&(w?o.developerCanBuySomeProduct()&&p.showAlert():p.showAlert()),"market"===d&&(y.length<1?p.showAlert():x?p.showAlert():o.developerShouldPlayGames()&&p.showAlert()),d===o.newApp&&(p.showAlert(),p.polish(function(){a.play("add",0)}),delete o.newApp),n+=p.width+i,n>=this.width-p.width+i&&(n=8,r+=p.height+i)}this.sortChildren()},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&this._toggleStartMenu()},_onDev:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("dev")},_onMarket:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("market")},_onNews:function(){if(o.hasDeveloperBoughtEverything()&&!o.getDeveloperFlag("playerShipYellow")&&!o.getDeveloperFlag("playerShip")){var e=o.getPublishedGamesByDeveloper(o.data.developer);if(e.length>0)return a.play("doubt",0),o.setDeveloperFlag("doubtKey","ending"),void(this._titan?this._titan.advance():this._titan=new u({parent:this}).on("done",this,"_onDoubt"))}a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("news")},_onStore:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("store")},_onStats:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("stats")},_onSettings:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("settings")},_onDoubt:function(){this.captureInputEvents=!1,this.fireSceneEvent("doubt")},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")},_toggleStartMenu:function(){this.startMenu.visible?(a.play("close",0),this.startMenu.hide()):(a.play("open",0),this.startMenu.show())}});t.defaults={backgroundColor:c.getColor("windowsBG"),musicKey:"streets"}}),n("djinn/view/shapes/Circle",["require","exports","module","../View","../utils/canvas"],function(e,t,i){var n=e("../View"),a=e("../utils/canvas"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.radius=e.radius,this.fillColor=e.fillColor,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth},render:function(e){var t=this._radius;a.drawCircle(e,t,t,t,this.fillColor,this.strokeColor,this.strokeWidth)}}),s=t.prototype;Object.defineProperty(s,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this.width=this.height=2*e,this.redrawBuffer()}}),t.defaults={buffer:!0,bufferPadding:10,radius:100,fillColor:"white",strokeColor:null,strokeWidth:1}}),n("js/view/SunsetShip",["require","exports","module","djinn/view/View","djinn/math/random"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/random"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},reset:function(){var e=this.parent;this.x=a.range(0,e.width-this.width),this.y=a.range(e.height/2,e.height)-this.height,this.speed=a.range(8,16),this.imageX=32*a.range(0,1)},tick:function(e){this.x+=this.speed*e/1e3,this.x>this.parent.width&&(this.reset(),this.right=0)}});t.defaults={image:"media/images/ui.png",imageY:96,width:32,height:32}}),n("js/view/SunsetSparkles",["require","exports","module","djinn/view/View","djinn/math/random","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/random"),s=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);for(var i=0;10>i;++i)this.makeSparkle();var n=this.createTimer(100,"_onSparkleTimer");n.start()},makeSparkle:function(){var e=new n({parent:this,backgroundColor:s.getColor("yellow"),x:a.range(0,this.width-1),y:a.range(0,this.height-1),width:1,height:1}),t=e.x;e.tween({x:t+3},1e3,null,function(){e.dispose()})},_onSparkleTimer:function(){this.makeSparkle()}});t.defaults={}}),n("js/view/scenes/CreditsScene",["require","exports","module","djinn/view/View","djinn/math/core","djinn/manifest","djinn/audio/jukebox","djinn/view/shapes/Pinwheel","djinn/view/shapes/Circle","./Scene","../../gameData","../Typer","../BackButton","../SunsetShip","../SunsetSparkles","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/core"),s=e("djinn/manifest"),r=e("djinn/audio/jukebox"),o=e("djinn/view/shapes/Pinwheel"),l=e("djinn/view/shapes/Circle"),h=e("./Scene"),u=(e("../../gameData"),e("../Typer"),e("../BackButton")),d=e("../SunsetShip"),c=e("../SunsetSparkles"),p=e("../style"),t=i.exports=h.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),this.pinwheel=new o({parent:this,fillColor:p.getColor("red"),rayColor:"rgb(167, 65, 31)",rayRotationSpeed:1e-4}).align("center","center"),new l({parent:this,radius:18,fillColor:p.getColor("yellow")}).align("center","center"),new n({parent:this,backgroundColor:p.getColor("red"),height:this.height/2}).align(null,"bottom");for(var e=1,t=this.height/2,i=0;10>i;++i)new n({parent:this,backgroundColor:"rgb(167, 65, 31)",height:e+1,y:t}),e+=1,t+=2*e;new c({parent:this,width:48,height:32}).align("center","center",0,16),new c({parent:this,width:16,height:16}).align("center","center",0,8);for(var i=0;3>i;++i)new d({parent:this}).reset();new n({parent:this,image:"media/images/credits.png",opacity:.75});var a=this._backButton=new u({parent:this});a.align("left","top",4,4),a.on("inputPress",this,"_onQuit");var r=this._container=new n({parent:this,acceptInputEvents:!0});this._addLine(s.title),this._addLine(),this._addLine(),this._addLine(),this._addLine(),this._addLine("PROGRAM","silver"),this._addLine("Matt Hackett"),this._addLine(),this._addLine(),this._addLine("MUSIC","silver"),this._addLine("Joshua Morse"),this._addLine(),this._addLine(),this._addLine("SPECIAL THANKS","silver");var h=this._addLine("Andrea Abney");this._addLine("Geoff Blair"),this._addLine("Greg Love"),this._addLine(),this._addLine(),this._addLine(),this._addLine(),h.acceptInputEvents=!0,h.on("inputStart",this,function(){new n({parent:this._container,image:"media/images/ui.png",imageX:64,imageY:16,x:h.x-16,y:h.y-6,width:16,height:16})}),this._addLine("THANKS FOR PLAYING"),this._addLine(),this._addLine("Now make your own games!","silver"),this._addLine("matt@lostdecadegames.com","silver"),r.children.forEach(function(e){e.align("center")}),r.align("center"),this.on("inputStart",this,"_onInputStart"),this.on("inputEnd",this,"_onInputEnd"),this.sortChildren()},reset:function(){this._backButton.completeTween({opacity:0}),this._container.completeTween({y:this.height})},activate:function(e,t){this._super(e,t);var i=this._container;i.tween({bottom:-8},17e3,null,bind(this,function(){this._backButton.completeTween().tween({opacity:1})}))},tick:function(e){this.captureInputEvents&&(this._input||(this.getInput("negate")||this.getInput("action")?this._container.tickSpeed=5:this._container.tickSpeed=1))},_onInputMove:function(e){this._super(e);var t=this.center,i=e.point,n=a.distance(i.x,i.y,t.x,t.y),s=a.distance(t.x,t.y,this.width,this.height),r=n/s;this.pinwheel.rayRotationSpeed=a.lerp(5e-4,1e-4,r)},_onInputStart:function(e){this._input=!0,this._container.tickSpeed=5},_onInputEnd:function(e){this._input=!1,this._container.tickSpeed=1},_onQuit:function(){r.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId||"computer")}});t.defaults={backgroundColor:p.getColor("orange"),musicKey:"alligators"}}),n("js/view/scenes/CTAScene",["require","exports","module","djinn/view/View","djinn/math/random","djinn/view/shapes/Pinwheel","djinn/manifest","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../Starfield","../style"],function(e,t,i){var n=e("djinn/view/View"),a=(e("djinn/math/random"),e("djinn/view/shapes/Pinwheel"),e("djinn/manifest"),e("djinn/audio/jukebox"),e("./Scene")),s=(e("../../gameData"),e("../Typer")),r=e("../Starfield"),o=e("../style"),t=i.exports=a.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),this.starfield=new r({parent:this}),this._header1=new n({parent:this,image:"media/images/ctaTitle.png",width:224,height:16}),this._header1.align("center","center",0,-40),this._header3=new s({parent:this,text:"Vote on Steam Greenlight",color:"silver"}),this._header3.shrinkwrap(),this._header3.align("center","center"),new s({parent:this._header3,text:"Steam",x:64}),new s({parent:this._header3,text:"Greenlight",color:"green",x:112}),this._header4=new n({parent:this,image:"media/images/cta.png",width:32,height:32}).align("center","bottom",0,-8),this._header4y=this._header4.y,new s({parent:this._header4,text:"Thank you!",color:"silver",x:32,y:8,width:64,height:16}),this.sortChildren()},reset:function(){this._super(),this._header3.opacity=0,this._header4.y=this.height},activate:function(e,t){this._super(e,t),this.completeTween().delayTween(500,bind(this,function(){this._header3.tween({opacity:1},500)})).delayTween(1e3,bind(this,function(){this._header4.tween({y:this._header4y},500,n.transitions.easeOut)}))},tick:function(e){!this.captureInputEvents}});t.defaults={backgroundColor:o.getColor("black")}}),n("js/view/scenes/DeleteDataScene",["require","exports","module","djinn/view/View","djinn/view/Sprite","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../style"],function(e,t,i){var n=(e("djinn/view/View"),e("djinn/view/Sprite")),a=e("djinn/audio/jukebox"),s=e("./Scene"),r=e("../../gameData"),o=e("../Typer"),l=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new o({parent:this,text:"DELETE ALL DATA?",color:"black",y:8});e.shrinkwrap(),e.align("center");var t=new o({parent:this,acceptInputEvents:!0,text:"Yes, DELETE!"});t.shrinkwrap(),t.align("center","center",0,-8),t.on("inputPress",this,"_onDeleteData");var i=new o({parent:this,text:"No, nevermind",acceptInputEvents:!0,color:"silver"});i.shrinkwrap(),i.align("center","center",0,16),i.on("inputPress",this,"_onQuit");var a=this._titan=new n({parent:this,acceptInputEvents:!0,cancelInputEvents:!0,animations:{idle:{frameRate:2,frames:[[0,32],[16,32]]}},image:"media/images/actors.png",imageSmoothingEnabled:!1,width:16,height:16});a.align("right","bottom",-4,-4),a.playAnimation("idle"),a.on("inputStart",this,"_onTitan"),this.sortChildren()},reset:function(){this._super(),this._titan.completeTween()},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&this._onQuit()},_onDeleteData:function(){a.play("clear",0),r.restoreDefaults(),this.captureInputEvents=!1,this.fireSceneEvent("deleteData")},_onTitan:function(){a.play("doubt",0);var e=this._titan;e.completeTween({scale:8}).align("center","center").delayTween(1e3,function(){e.scale=1,e.align("right","bottom",-4,-4)})},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)}});t.defaults={backgroundColor:l.getColor("red")}}),n("djinn/sim/shared/position",["require","exports","module","djinn/math/Vector2","../../math/collision"],function(e,t,i){var n=e("djinn/math/Vector2"),a=e("../../math/collision");t.centerOnPoint=function(e,t,i){var n=e.position,a=e.size;n.x=t-a.width/2,n.y=i-a.height/2},t.centerOnEntity=function(e,i){var n=t.getCenter(i);t.centerOnPoint(e,n.x,n.y)},t.centerOnTile=function(e,i,n,a){t.centerOnPoint(e,n*i.tileWidth+i.tileWidth/2,a*i.tileHeight+i.tileHeight/2)},t.getAimVector=function(e,i){var a=t.getCenter(e),s=t.getCenter(i);return new n(s).subtract(a).normalize()},t.getBounds=function(e){var t=e.position,i=e.size;return t&&i?{x:t.x,y:t.y,width:i.width,height:i.height}:null},t.getCenter=function(e){var t=e.position,i=e.size;return t&&i?{x:t.x+i.width/2,y:t.y+i.height/2}:null},t.getDistance=function(e,i){var a=t.getCenter(e),s=t.getCenter(i);return n.distance(a,s)},t.getTile=function(e,i){var n=t.getCenter(e);return{x:Math.floor(n.x/i.tileWidth),y:Math.floor(n.y/i.tileHeight)}},t.withinRadius=function(e,i,n){var s=t.getCenter(e),r=t.getCenter(i);return a.testPointCircle(r.x,r.y,s.x,s.y,n)}}),n("djinn/core/Collection",["require","exports","module","../Class"],function(e,t,i){var n=e("../Class"),t=i.exports=n.extend({init:function(){this.items=[],this._indexPool=[]},dispose:function(){this.disposeItems(),this._super()},disposeItems:function(){this.forEach(function(e){this.remove(e),e&&e.dispose&&e.dispose()},this),this.items=[],this._indexPool=[]},add:function(e){var t=this._indexPool;if(t.length>0){var i=t.shift();this.items[i]=e}else this.items.push(e)},remove:function(e){var t=this.items.indexOf(e);-1!==t&&(this.items[t]=void 0,this._indexPool.push(t))},removeAll:function(){this.forEach(function(e){this.remove(e)},this)},get:function(e,t,i){for(var n=[],a=this.items,s=0,r=a.length;r>s;++s){var o=a[s];if(void 0!==o){if(t)var l=e.call(t,o,s);else var l=e(o,s);l&&n.push(o)}}return i?n.length>0?n[0]:null:n},forEach:function(e,t){for(var i=this.items,n=0,a=i.length;a>n;++n){var s=i[n];void 0!==s&&(t?e.call(t,s,n):e(s,n))}}}),a=t.prototype;Object.defineProperty(a,"length",{get:function(){return this.items.length}})}),n("djinn/sim/Entity",["require","exports","module","djinn/Emitter","djinn/sim/shared/position"],function(e,t,i){var n=e("djinn/Emitter"),a=e("djinn/sim/shared/position");i.exports=n.extend({init:function(e){this._super(e);for(var t in e)this[t]=e[t]},spawn:function(e,t){var i=this.world,n=i.createEntity(e,t);return i.spawnEntity(n),a.centerOnEntity(n,this),n}})}),n("djinn/sim/TileMap",["require","exports","module","../Class","../math/random"],function(e,t,i){var n=e("../Class"),a=e("../math/random"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this.width=e.width,this.height=e.height,this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.values=[]},resize:function(e,t){this.width=e,this.height=t},get:function(e,t){return 0>e||0>t||e>this.width-1||t>this.height-1?void 0:this.getByIndex(this.xyToIndex(e,t))},getByIndex:function(e){return this.values[e]},getSegmentsByRect:function(e,t,i,n){for(var a=[],s=this.getTilesByRect(e,t,i,n),r=this.tileWidth,o=this.tileHeight,l=0,h=s.length;h>l;++l){var u=s[l],d=u.x*r,c=d+r,p=u.y*o,g=p+o;0===this.get(u.x,u.y-1)&&a.push([d,p,c,p]),0===this.get(u.x+1,u.y)&&a.push([c,p,c,g]),0===this.get(u.x,u.y+1)&&a.push([d,g,c,g]),0===this.get(u.x-1,u.y)&&a.push([d,p,d,g])}return a},getTilesByRect:function(e,t,i,n){for(var a=~~(e/this.tileWidth),s=~~(t/this.tileHeight),r=Math.ceil((e+i)/this.tileWidth),o=Math.ceil((t+n)/this.tileHeight),l=[],t=s;o>=t;++t)for(var e=a;r>=e;++e){var h=this.get(e,t);0!==h&&l.push({x:e,y:t})}return l},set:function(e,t,i){this.setByIndex(this.xyToIndex(e,t),i)},setByIndex:function(e,t){this.values[e]=t},setRect:function(e,t,i,n,a){for(var s=t;t+n>s;++s)for(var r=e;e+i>r;++r)this.set(r,s,a)},fill:function(e){for(var t=this.values,i=0,n=this.size;n>i;++i)t[i]=e},forEach:function(e,t){for(var i=this.values,n=0,a=i.length;a>n;++n){var s=this.indexToX(n),r=this.indexToY(n);t?e.call(t,i[n],s,r,this):e(i[n],s,r,this)}},indexToX:function(e){return e%this.width},indexToY:function(e){return Math.floor(e/this.width)},xyToIndex:function(e,t){return t*this.width+e},unitToTile:function(e,t){return{x:~~(e/this.tileWidth),y:~~(t/this.tileHeight)}},tileToUnit:function(e,t){return{x:e*this.tileWidth,y:t*this.tileHeight}},getGrid:function(){for(var e=[],t=this.width,i=this.height,n=0;i>n;++n)e[n]=[];for(var a=0,n=0,s=this.values,r=0,o=s.length;o>r;++r)e[n][a]=s[r],++a,a>=t&&(a=0,++n);return e},autoMap:function(e,t){this.resize(e.width,e.height),e.forEach(function(i,n,s){var r=t.invalid,o=t[i];if(o.edge){var l=e.getBitmask(n,s),h=o.values[String(l.value)];h?r=a.choice(h):(console.warn("No edge value for:",i,l.value),void 0!==o.fallback&&(r=o.fallback))}else r=a.choice(o.values);this.set(n,s,r)},this)}}),s=t.prototype;Object.defineProperty(s,"size",{get:function(){return this.width*this.height}}),Object.defineProperty(s,"unitWidth",{get:function(){return this.width*this.tileWidth}}),Object.defineProperty(s,"unitHeight",{get:function(){return this.height*this.tileHeight}}),t.defaults={width:0,height:0,tileWidth:100,tileHeight:100}}),n("djinn/sim/World",["require","exports","module","../Emitter","../math/core","../core/Collection","../utils/log","./Entity","./TileMap","./shared/position"],function(e,t,i){var n=e("../Emitter"),a=e("../math/core"),s=e("../core/Collection"),r=e("../utils/log"),o=e("./Entity"),l=e("./TileMap"),h=e("./shared/position"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.running=!1,this.elapsed=0,this.deltaPool=0,this.deltaStep=e.deltaStep,this.width=e.width,this.height=e.height,this.systems=[],this.entities=s.create(),this._entityIdSeed=0,this._prefabs={},this.camera={x:0,y:0},this._cameraTarget=null,this.map=new l},resizeToMap:function(){this.width=this.map.unitWidth,this.height=this.map.unitHeight},reset:function(){this.stop(),this.elapsed=0,this.deltaPool=0,this.triggerSystems("reset");for(var e=this.entities.items,t=0,i=e.length;i>t;++t){var n=e[t];void 0!==n&&this.triggerSystems("entityReset",[e[t]])}},start:function(){this.running=!0,this.triggerSystems("start")},stop:function(){this.running=!1,this.triggerSystems("stop")},addSystem:function(e){this.systems.push(e)},triggerSystems:function(e,t){for(var i=this.systems,n=0,a=i.length;a>n;++n)this._triggerSystem(i[n],e,t)},definePrefabs:function(e){for(var t in e)this._prefabs[t]=e[t]},createEntity:function(e,t){if(!this._prefabs[e])return r.warn("[World.createEntity] Invalid prefab type: %s",e),null;var i=merge(t,this._prefabs[e]),n=new o(i);return n.type=e,n.world=this,n},clean:function(){for(var e=this.entities.items,t=0,i=e.length;i>t;++t){var n=e[t];n&&this.despawnEntity(n)}this._entityIdSeed=0},spawnEntity:function(e){e.id=++this._entityIdSeed,this.entities.add(e),this.triggerSystems("entitySpawn",[e]),this.fire("entitySpawn",[e])},despawnEntity:function(e,t){this.triggerSystems("entityDespawn",[e,t]),this.fire("entityDespawn",[e,t]),e.fire("despawn",[t]),this.entities.remove(e),e.dispose()},getEntities:function(e){for(var t=[],i=this.entities.items,n=0,a=i.length;a>n;++n){var s=i[n];s&&e(s)&&t.push(s)}return t},getEntityById:function(e){for(var t=this.entities.items,i=0,n=t.length;n>i;++i){var a=t[i];if(a&&a.id===e)return a}return null},getEntitiesByType:function(e){for(var t=[],i=this.entities.items,n=0,a=i.length;a>n;++n){var s=i[n];s&&s.type===e&&t.push(s)}return t},getEntitiesByRect:function(e){for(var t=[],i=this.entities.items,n=0,s=i.length;s>n;++n){var r=i[n];r&&a.intersects(e,h.getBounds(r))&&t.push(r)}return t},getEntitiesByRadius:function(e,t){for(var i=h.getCenter(e),n=[],s=this.entities.items,r=0,o=s.length;o>r;++r){var l=s[r];if(l){var u=h.getCenter(l);a.distance(i.x,i.y,u.x,u.y)<=t&&n.push(l)}}return n},getEntitiesByTile:function(e,t){var i=this.map;return this.getEntities(function(n){var a=h.getTile(n,i);return a.x===e&&a.y===t})},update:function(e){if(this.running){this.deltaPool+=e;for(var t=this.deltaStep;this.deltaPool>=t;)this.deltaPool-=t,this._update(t),this.elapsed+=t}},updateCamera:function(){var e=this._cameraTarget;if(e){var t=h.getCenter(e);this.camera.x=t.x,this.camera.y=t.y}},setCameraTarget:function(e){this._cameraTarget=e,this.updateCamera()},_triggerSystem:function(e,t,i){return e[t]?e[t].apply(this,i):void 0},_update:function(e){this.triggerSystems("update",[e]);for(var t=this.entities.items,i=0,n=t.length;n>i;++i){var a=t[i];void 0!==a&&this.triggerSystems("entityUpdate",[a,e])}this.triggerSystems("postUpdate"),this.updateCamera()}});t.defaults={deltaStep:16,width:1e3,height:1e3}}),n("djinn/sim/systems/state",["require","exports","module","djinn/utils/string"],function(e,t,i){var n=e("djinn/utils/string"),a={};t.define=function(e){for(var t in e)a[t]=e[t]},t.triggerHook=function(e,t,i,n){a[e]&&a[e][t]&&a[e][t].apply(n,i)},t.entitySpawn=function(e){var t=e.state;t&&(void 0===t.active&&(t.active={}),void 0===t.queue&&(t.queue=[]))},t.entityUpdate=function(e,i){var s=e.state;if(s){for(var r=0,o=s.queue.length;o>r;++r){var l=merge({},s.queue[r]),h=l.key;a[h]&&a[h].conf&&(l.conf=merge(l.conf,a[h].conf)),l.elapsed=0,l.intervalElapsed=0,s.active[h]=l,t.triggerHook(h,"add",[e,l],this);var u="stateAdd"+n.ucfirst(h);e.fire(u,[l])}s.queue.length=0;for(var h in s.active){var l=s.active[h];if(l.elapsed+=i,l.duration&&l.elapsed>l.duration&&(l.elapsed=l.duration),l.intervalElapsed+=i,t.triggerHook(h,"update",[e,l,i],this),l.interval&&l.intervalElapsed>=l.interval&&(t.triggerHook(h,"interval",[e,l],this),l.intervalElapsed-=l.interval),l.duration&&l.elapsed>=l.duration){delete s.active[h],t.triggerHook(h,"expire",[e,l],this);var u="stateExpire"+n.ucfirst(h);e.fire(u,[l])}}}}}),n("djinn/sim/systems/physics",["require","exports","module","../../math/core"],function(e,t,i){var n=e("../../math/core"),a=function(e,t){var i=e.bounce,a=e.position,s=e.velocity;if(s){var r=t.normal;0!==r.x?(a.x+=r.x*t.penetration,r.x===-n.sign(s.x)&&(s.x=i?-s.x*i.x:0)):(a.y+=r.y*t.penetration,r.y===-n.sign(s.y)&&(s.y=i?-s.y*i.y:0))}};t.entityUpdate=function(e,t){var i=e.acceleration,n=e.drag,a=e.gravity,s=e.position,r=e.velocity;if(r&&s&&!s.immovable){if(a){var o=a.value*t/2;r.y+=o}n&&(r.x-=n.x*r.x,r.y-=n.y*r.y),i&&(r.x+=i.x,r.y+=i.y),s.x+=r.x*t,s.y+=r.y*t,a&&(r.y+=o)}},t.entityCollide=function(e,t,i){!e.position.immovable&&t.collision.solid&&(void 0!==e.physics&&void 0!==t.physics&&e.physics.mass>t.physics.mass||a(e,i))},t.entityMapCollide=function(e,t,i,n){a(e,n)},t.entityWorldCollide=function(e,t,i){var a=e.velocity,s=e.bounce;n.sign(a.x)===t&&(a.x=s?-a.x*s.x:0),n.sign(a.y)===i&&(a.y=s?-a.y*s.y:0)}}),n("djinn/math/QuadTree",["require","exports","module","djinn/Class","djinn/math/core","djinn/utils/array"],function(e,t,i){var n=e("djinn/Class"),a=(e("djinn/math/core"),e("djinn/utils/array")),s=[],r={parent:-1,topLeft:0,topRight:1,bottomLeft:2,bottomRight:3},o=function(e){if(s.length>0){var t=s.pop();return t.set(e),t}return new l(e)},l=n.extend({init:function(e){var e=merge(e,{x:0,y:0,width:0,height:0,depth:0,maxChildren:2,maxDepth:4});this._nodes=[],this._children=[],this.set(e)},set:function(e){for(var t in e)this[t]=e[t]},insert:function(e){var t=this._nodes,i=this._children;if(t.length>0){var n=this._findInsertNode(e);n===r.parent?i.push(e):t[n].insert(e)}else i.push(e),i.length>this.maxChildren&&this.depth<this.maxDepth&&this.divide()},retrieve:function(e){for(var t=[],i=this._children,n=0,a=i.length;a>n;++n)t.push(i[n]);if(this._nodes.length>0)for(var s=this._findIntersectNodes(e),n=0,a=s.length;a>n;++n)t=t.concat(s[n].retrieve(e));return t},divide:function(){var e=~~(this.width/2),t=~~(this.height/2),i=this._children;this._addNode(this.x,this.y,e,t),this._addNode(this.x+e,this.y,e,t),this._addNode(this.x,this.y+t,e,t),this._addNode(this.x+e,this.y+t,e,t),this._children=[];for(var n=0,a=i.length;a>n;++n)this.insert(i[n])},clear:function(){for(var e=this._nodes;e.length>0;){var t=e.pop();t.clear(),s.push(t)}this._children=[],this._nodes=[]},_addNode:function(e,t,i,n){this._nodes.push(o({x:e,y:t,width:i,height:n,depth:this.depth+1,maxChildren:this.maxChildren,maxDepth:this.maxDepth}))},_findInsertNode:function(e){var t=this.x+this.width/2,i=this.y+this.height/2;return e.x+e.width<t?e.y+e.height<i?r.topLeft:e.y>=i?r.bottomLeft:r.parent:e.x>=t?e.y+e.height<i?r.topRight:e.y>=i?r.bottomRight:r.parent:r.parent},_findIntersectNodes:function(e){var t=[],i=this._nodes,n=this.x+this.width/2,a=this.y+this.height/2;return e.x<n&&(e.y<a&&t.push(i[r.topLeft]),e.y+e.height>=a&&t.push(i[r.bottomLeft])),e.x+e.width>=n&&(e.y<a&&t.push(i[r.topRight]),e.y+e.height>=a&&t.push(i[r.bottomRight])),t}}),h=i.exports=n.extend({init:function(e){this.rootNode=o(e)},insert:function(e){var t=this.rootNode;if(a.isArray(e))for(var i=0,n=e.length;n>i;++i)t.insert(e[i]);else t.insert(e)},retrieve:function(e){return this.rootNode.retrieve(e)},clear:function(){this.rootNode.clear()},resize:function(e,t){this.width=e,this.height=t}});Object.defineProperty(h.prototype,"width",{get:function(){return this.rootNode.width},set:function(e){this.clear(),this.rootNode.width=e}}),Object.defineProperty(h.prototype,"height",{get:function(){return this.rootNode.height},set:function(e){this.clear(),this.rootNode.height=e}})}),n("djinn/sim/systems/collision",["require","exports","module","../../math/QuadTree","../../math/collision","../../utils/array","../shared/position"],function(e,t,i){var n=e("../../math/QuadTree"),a=e("../../math/collision"),s=e("../../utils/array"),r=e("../shared/position"),o=new n,l=[],h={},u=[];t.quadTree=o,t.penetrationThreshold=0,t.defineGroupTargets=function(e,t){h[e]=t},t.defineWalkableTile=function(e){
u.push(e)},t.reset=function(){o.resize(this.width,this.height)},t.update=function(){o.clear()},t.entityUpdate=function(e,i){var n=e.collision;if(n){t.checkMapCollision(this,e),t.checkWorldCollision(this,e);var a=r.getBounds(e);a.id=e.id,o.insert(a),l.push(e)}},t.postUpdate=function(){for(var e=0,i=l.length;i>e;++e)for(var n=l[e],u=r.getBounds(n),d=o.retrieve(u),c=0,p=d.length;p>c;++c){var g=d[c];if(g.id!==n.id){var m=h[n.collision.group];if(m){var f=this.getEntityById(g.id);if(f&&f.collision&&s.contains(m,f.collision.group)){var v=a.testAABB(u,g);v.penetration>t.penetrationThreshold&&this.triggerSystems("entityCollide",[n,f,v])}}}}l.length=0},t.checkMapCollision=function(e,i){var n=i.collision,o=i.position,l=i.size;if(n.map)for(var h=e.map,o=i.position,l=i.size,d={x:0,y:0,width:h.tileWidth,height:h.tileHeight},c=h.getTilesByRect(o.x,o.y,l.width,l.height),p=0,g=c.length;g>p;++p){var m=c[p],f=h.get(m.x,m.y);if(!s.contains(u,f)){var v=r.getBounds(i);d.x=m.x*h.tileWidth,d.y=m.y*h.tileHeight;var y=a.testAABB(v,d);y.penetration>t.penetrationThreshold&&e.triggerSystems("entityMapCollide",[i,m.x,m.y,y])}}},t.checkWorldCollision=function(e,t){var i=t.collision,n=t.position,a=t.size;if(i.world){var s=0,r=0;n.x<0?(n.x=0,s=-1):n.x+a.width>e.width&&(n.x=e.width-a.width,s=1),n.y<0?(n.y=0,r=-1):n.y+a.height>e.height&&(n.y=e.height-a.height,r=1),(0!==s||0!==r)&&e.triggerSystems("entityWorldCollide",[t,s,r,t.velocity.x,t.velocity.y])}}}),n("djinn/sim/systems/control",["require","exports","module","../../math/Vector2"],function(e,t,i){var n=e("../../math/Vector2"),a=new n;t.entityUpdate=function(e,t){var i=e.control,n=e.velocity;n&&i&&i.active&&(a.x=i.x,a.y=i.y,a.normalize(),e.facing&&a.magnitude()>0&&(e.facing.angle=a.heading),n.x=a.x*i.power,e.gravity||(n.y=a.y*i.power))}}),n("djinn/sim/systems/jump",["require","exports","module","djinn/math/core"],function(e,t,i){var n=e("djinn/math/core");t.fallThreshold=.05,t.entityUpdate=function(e,i){var a=e.jump,s=e.velocity;if(s&&a){var r=n.sign(e.gravity.value);if(r>0)var o=s.y>t.fallThreshold;else var o=s.y<-t.fallThreshold;return o?(a.grounded=!1,void(a.request=!1)):a.grounded?void(a.request&&(a.grounded=!1,a.request=!1,s.y=a.power*r,e.fire("jump"))):void(a.request=!1)}},t.entityCollide=function(e,t,i){if(e.jump&&t.collision.solid){var a=n.sign(e.gravity.value);e.jump&&i.normal.y===-a&&(e.jump.grounded=!0)}},t.entityMapCollide=function(e,t,i,a){if(e.jump){var s=n.sign(e.gravity.value);e.jump&&a.normal.y===-s&&(e.jump.grounded=!0)}},t.entityWorldCollide=function(e,t,i){if(e.jump){var a=n.sign(e.gravity.value);e.jump&&i===a&&(e.jump.grounded=!0)}}}),n("djinn/sim/shared/state",["require","exports","module"],function(e,t,i){t.add=function(e,t,i,n,a){var s=e.state;return s?void s.queue.push({key:t,duration:i,interval:n,conf:a}):!1},t.remove=function(e,t){var i=e.state;delete i.active[t];for(var n=i.queue,a=0,s=n.length;s>a;++a)if(n[a].key===t){n.splice(a,1);break}},t.addBatch=function(e,i,n){var a=e.state;if(!a)return!1;for(var s=0,r=i.length;r>s;++s){var a=i[s];t.add(e,a.key,a.duration,a.interval,merge(a.conf,n))}},t.exists=function(e,t){var i=e.state;if(!i)return!1;if(t in i.active)return!0;for(var n=i.queue,a=0,s=n.length;s>a;++a)if(n[a].key===t)return!0;return!1},t.getDuration=function(e,t){var i=e.state.active;return t in i?i[t].duration:0},t.getElapsed=function(e,t){var i=e.state.active;return t in i?i[t].elapsed:0}}),n("djinn/sim/systems/hazard",["require","exports","module","../shared/state","../shared/position"],function(e,t,i){var n=e("../shared/state"),a=e("../shared/position");t.entityCollide=function(e,t,i){var s=e.hazard,r=t.mortal;if(s&&r&&s.owner!==t){var o=s.groups;if(!(o&&o.indexOf(t.collision.group)<0||n.exists(t,"grace"))){n.add(t,"grace",s.graceDuration||r.graceDuration);var l=s.damage;r.health-=l,s.states&&n.addBatch(t,s.states,{normal:a.getAimVector(e,t)}),this.triggerSystems("entityDamage",[t,l,e]),this.fire("entityDamage",[t,l,e]),e.fire("harm",[l,t]),t.fire("damage",[l,e]),e.mortal&&s.killOnDealDamage&&(e.mortal.health=0)}}},t.entityDie=function(e){e.hazard&&delete e.hazard}}),n("djinn/sim/systems/mortal",["require","exports","module","../shared/position","../shared/state"],function(e,t,i){var n=e("../shared/position");e("../shared/state");t.entityCollide=function(e,t){var i=e.mortal;i&&e.owner!==t&&(i.killOnEntityCollide&&(i.health=0),i.killOnSolidEntityCollide&&t.collision.solid&&(i.health=0))},t.entityWorldCollide=function(e){var t=e.mortal;t&&t.killOnWorldCollide&&(t.health=0)},t.entityMapCollide=function(e){var t=e.mortal;t&&t.killOnMapCollide&&(t.health=0)},t.entityDamage=function(e,t,i){var n=e.mortal;n&&n.killOnDealDamage&&(n.health=0)},t.postUpdate=function(){this.entities.forEach(function(e){var t=e.mortal;if(t&&t.alive&&t.health<=0){if(t.alive=!1,t.soul){var i=this.createEntity(t.soul);n.centerOnEntity(i,e),this.spawnEntity(i)}this.triggerSystems("entityDie",[e]),this.fire("entityDie",[e]),t.despawnOnDeath&&this.despawnEntity(e)}},this)}}),n("djinn/sim/systems/behavior",["require","exports","module","djinn/utils/array"],function(e,t,i){var n=e("djinn/utils/array"),a={};t.define=function(e){for(var t in e)a[t]=e[t]},t.entitySpawn=function(e){var i=e.behavior;i&&(void 0===i.states&&(i.states=[]),void 0===i.stateData&&(i.stateData=[]),i.initState&&(t.pushState(e,i.initState,i.initData),delete i.initState,delete i.initData),t.triggerState(e,"entitySpawn"))},t.entityReset=function(e){var i=e.behavior;i&&t.triggerState(e,"entityReset")},t.entityUpdate=function(e,i){var n=e.behavior;n&&(e.behavior.elapsed+=i,e.behavior.enter?t.triggerState(e,"entityUpdate",[i]):(e.behavior.enter=!0,t.triggerState(e,"enter")),e.behavior.popAfterUpdate&&(t.popState(e),e.behavior.popAfterUpdate=!1))},t.entityCollide=function(e,i,n){var a=e.behavior;a&&t.triggerState(e,"entityCollide",[i,n])},t.entityMapCollide=function(e,i,n,a){var s=e.behavior;s&&t.triggerState(e,"entityMapCollide",[i,n,a])},t.entityWorldCollide=function(e,i,n){var a=e.behavior;a&&t.triggerState(e,"entityWorldCollide",[i,n])},t.entityDespawn=function(e,i){var n=e.behavior;n&&t.triggerState(e,"entityDespawn",[e,i])},t.getStateData=function(e,t,i){var a=e.behavior;if(i)return a.data[t];var s=n.last(a.stateData);return s[t]},t.setStateData=function(e,t,i,a){var s=e.behavior;if(a)s.data[t]=i;else{var r=n.last(s.stateData);r[t]=i}},t.pushState=function(e,i,n,a){var s=e.behavior;if(s){var r=s.states;a?t.popState(e):(s.elapsed=0,s.enter=!1),r.push(i),s.stateData.push(n||{}),t.triggerState(e,"push")}},t.popState=function(e){var i=e.behavior,n=i.states,a=n.pop();return i.stateData.pop(),t.triggerStateByKey(e,a,"pop"),i.elapsed=0,i.enter=!1,a},t.triggerState=function(e,i,a){var s=e.behavior.states;if(!(s.length<1)){var r=n.last(s);t.triggerStateByKey(e,r,i,a)}},t.triggerStateByKey=function(e,t,i,n){var s=a[t];s&&s[i]&&s[i].apply(e,n)},t.entityDie=function(e){var i=e.behavior;i&&t.triggerState(e,"entityDie")}}),n("djinn/sim/states/common",["require","exports","module"],function(e,t,i){t.ttl={expire:function(e,t){this.despawnEntity(e,"ttl")}}}),n("djinn/sim/shared/physics",["require","exports","module"],function(e,t,i){t.stop=function(e){var t=e.velocity;t&&(t.x=0,t.y=0)}}),n("djinn/sim/states/effects",["require","exports","module","../shared/physics"],function(e,t,i){var n=e("../shared/physics");t.stun={add:function(e){n.stop(e),e.control&&(e.control.active=!1)},expire:function(e){e.control&&(e.control.active=!0)}},t.knockback={add:function(e,t){var i=e.velocity;if(i){var n=t.conf,a=n.normal,s=.1;i.x=a.x*s,i.y=a.y*s}},expire:function(e){n.stop(e)}}}),n("js/gravity",{value:75e-5}),n("js/sim/prefabs/playerBenzer",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerBird",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.075,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerBoy",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerChicken",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerDog",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.075,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerFranklin",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerGirl",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerRaga",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerShip",["require","exports","module"],function(e,t,i){i.exports={meta:{action:"shooter",role:"player",center:!0},state:{},control:{active:!0,power:.1,x:-1,y:0},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:14,height:8},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{action:"shot",damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerShipYellow",["require","exports","module"],function(e,t,i){i.exports={meta:{action:"shooter",role:"player",center:!0},state:{},control:{active:!0,power:.1,x:-1,y:0},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{action:"shot",damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerTiger",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerXam",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerZombie",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerGoblin",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/playerJoey",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{action:"jump",role:"player"},state:{},control:{active:!0,power:.1,x:-1,y:0},jump:{power:-.225},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"players",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:40},sounds:{damage:"damage",despawn:"death",jump:"jump"}}}),n("js/sim/prefabs/banner",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{queue:[{key:"ttl",duration:1e3}]},position:{x:0,y:0,z:4,immovable:!0},size:{width:16,height:16}}}),n("js/sim/prefabs/boss",["require","exports","module"],function(e,t,i){i.exports={meta:{goalBlocker:!0,trail:!0},state:{},position:{x:0,y:0,z:2},facing:{angle:0},size:{width:14,height:14},velocity:{x:0,y:0},drag:{x:.1,y:.1},collision:{group:"objects",world:!0,map:!0},hazard:{groups:["players"],damage:1,states:[{key:"stun",duration:500}]},mortal:{alive:!0,health:1,soul:"explosionSpawner"},behavior:{initState:"boss"},light:{intensity:1,radius:32},sounds:{attack:"beam",damage:"damage",move:"woosh"}}}),n("js/sim/prefabs/bossBlock",["require","exports","module","../../gravity"],function(e,t,i){e("../../gravity");i.exports={meta:{},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:16,height:16},physics:{mass:2},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!0},light:{intensity:1,radius:32}}}),n("js/sim/prefabs/bouncer",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{},state:{},position:{x:0,y:0,z:1},facing:{angle:-1},size:{width:10,height:6},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!1},gravity:n,behavior:{initState:"launcher",initData:{velocity:{x:0,y:-.275}}},sounds:{launch:"bounce"}}}),n("js/sim/prefabs/buster",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0,trail:!0},state:{},position:{x:0,y:0,z:4},facing:{angle:0},size:{width:6,height:6},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0},hazard:{groups:["objects","players"],damage:1,states:[{key:"stun",duration:500},{key:"knockback",duration:500,conf:{speed:.25}}]},mortal:{alive:!0,killOnDealDamage:!0,killOnSolidEntityCollide:!0,killOnWorldCollide:!0,killOnMapCollide:!0,soul:"explosion",despawnOnDeath:!0},behavior:{initState:"digger"},light:{intensity:1,radius:16}}}),n("js/sim/prefabs/cannon",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{},state:{},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:14,height:14},physics:{mass:2},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!0},gravity:n,behavior:{initState:"turret",initData:{axisThreshold:32,cooldown:1e3,horizontal:!0,offsetY:2,range:128,spawnType:"shell",speed:.1,targetGroup:"players",vertical:!1}},sounds:{attack:"cannon"}}}),n("js/sim/prefabs/chicken",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{},state:{},position:{x:0,y:0,z:2},facing:{angle:1},size:{width:10,height:10},velocity:{x:0,y:0},bounce:{x:1,y:0},collision:{group:"objects",world:!0,map:!0},gravity:n,mortal:{alive:!0,health:1},light:{intensity:1,radius:32},behavior:{initState:"walker",initData:{speed:.05}},sounds:{damage:"damage"}}}),n("js/sim/prefabs/explosion",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},state:{queue:[{key:"ttl",duration:1e3}]},position:{x:0,y:0,z:3,immovable:!0},size:{width:16,height:16},light:{intensity:1,radius:32},behavior:{initState:"flash"}}}),n("js/sim/prefabs/explosionSpawner",["require","exports","module"],function(e,t,i){i.exports={meta:{},position:{x:0,y:0,z:0,immovable:!0},size:{width:16,height:16},behavior:{initState:"intervalSpawner",initData:{interval:100,queue:["explosion","explosion","explosion","explosion","explosion","explosion","explosion","explosion"],rangeX:8,rangeY:8}}}}),n("js/sim/prefabs/flash",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},state:{queue:[{key:"ttl",duration:250}]},position:{x:0,y:0,z:3,immovable:!0},size:{width:16,height:16},light:{intensity:1,radius:32},behavior:{initState:"flash"}}}),n("js/sim/prefabs/fragileRock",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:16,height:16},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!0},behavior:{initState:"fragileRock",initData:{ttl:500}},sounds:{warn:"fragileWarn"}}}),n("js/sim/prefabs/fragileRockCorpse",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:16,height:16}}}),n("js/sim/prefabs/funWatcher",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:0,immovable:!0},size:{width:16,height:16},behavior:{initState:"funWatcher"}}}),n("js/sim/prefabs/gameGoal",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{},position:{x:0,y:0,z:1},size:{width:12,height:12},physics:{mass:2},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!0},gravity:n,behavior:{initState:"gameGoal"},light:{intensity:1,radius:16}}}),n("js/sim/prefabs/gameKey",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{goalBlocker:!0},position:{x:0,y:0,z:1},size:{width:16,height:16},velocity:{x:0,y:0},bounce:{x:0,y:0},collision:{group:"objects",world:!0,map:!0},gravity:n,behavior:{initState:"collect"},light:{intensity:1,radius:16}}}),n("js/sim/prefabs/gameStart",["require","exports","module"],function(e,t,i){i.exports={meta:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:16,height:16},light:{intensity:1,radius:16}}}),n("js/sim/prefabs/glitter",["require","exports","module","../../gravity"],function(e,t,i){e("../../gravity");i.exports={meta:{},state:{queue:[{key:"ttl",duration:1e3}]},position:{x:0,y:0,z:3},size:{width:16,height:16},light:{intensity:1,radius:16}}}),n("js/sim/prefabs/gravityRock",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:12,height:12},velocity:{x:0,y:0},drag:{x:.1,y:.1},bounce:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!1},behavior:{initState:"gravityRock",initData:{ttl:500}}}}),n("js/sim/prefabs/hPlatform",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:3},size:{width:14,height:14},physics:{mass:1},velocity:{x:0,y:0},drag:{x:0,y:.1},bounce:{x:1,y:1},collision:{group:"objects",world:!0,map:!0,solid:!0},behavior:{initState:"hPlatform"}}}),n("js/sim/prefabs/hTrap",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},position:{x:0,y:0,z:1},size:{width:8,height:8},velocity:{x:0,y:0},drag:{x:0,y:.1},collision:{group:"objects",world:!0,map:!0,solid:!1},hazard:{groups:["objects","players"],damage:1,states:[{key:"stun",duration:500}]},bounce:{x:1,y:1},behavior:{initState:"trap",initData:{horizontal:!0}}}}),n("js/sim/prefabs/intervalRock",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:16,height:16},drag:{x:.1,y:.1},bounce:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!0},behavior:{initState:"intervalRock",initData:{interval:1e3}},sounds:{appear:"appear",disappear:"disappear"}}}),n("js/sim/prefabs/jumper",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{},state:{},position:{x:0,y:0,z:1},facing:{angle:-1},size:{width:8,height:8},velocity:{x:0,y:0},bounce:{x:1,y:0},collision:{group:"objects",world:!0,map:!0},gravity:n,hazard:{groups:["players"],damage:1,states:[{key:"stun",duration:500}]},mortal:{alive:!0,health:1},behavior:{initState:"jumper",initData:{warning:500,cooldown:1500,velocity:{x:.12,y:.2}}},light:{intensity:1,radius:32},sounds:{damage:"damage",warning:"warning",jump:"jump2"}}}),n("js/sim/prefabs/puff",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},state:{queue:[{key:"ttl",duration:250}]},position:{x:0,y:0,z:3,immovable:!0},size:{width:16,height:16}}}),n("js/sim/prefabs/pulseBlock",["require","exports","module","../../gravity"],function(e,t,i){e("../../gravity");i.exports={meta:{},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:16,height:16},physics:{mass:2},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!0},behavior:{initState:"pulseBlock"},light:{intensity:1,radius:32},sounds:{pulseBlock:"pulseBlock",pulseBlockSolid:"pulseBlockSolid"}}}),n("js/sim/prefabs/pulseButton",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:12,height:12},velocity:{x:0,y:0},drag:{x:.1,y:.1},bounce:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!1},behavior:{initState:"pulser"},light:{intensity:1,radius:16},sounds:{pulse:"pulse"}}}),n("js/sim/prefabs/shell",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:2},facing:{angle:-1},size:{width:10,height:10},velocity:{x:0,y:0},drag:{x:0,y:.1},collision:{group:"objects",world:!0,map:!0},hazard:{groups:["objects","players"],damage:1,killOnDealDamage:!0,states:[{key:"stun",duration:500},{key:"knockback",duration:250}]},mortal:{alive:!0,health:1,killOnSolidEntityCollide:!0,killOnMapCollide:!0,killOnWorldCollide:!0,despawnOnDeath:!0,soul:"explosion"},behavior:{initState:"stompee"}}}),n("js/sim/prefabs/shellLights",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:2},facing:{angle:-1},size:{width:10,height:10},velocity:{x:0,y:0},drag:{x:0,y:.1},collision:{group:"objects",world:!0,map:!0},hazard:{groups:["objects","players"],damage:1,killOnDealDamage:!0,states:[{key:"stun",duration:500},{key:"knockback",duration:500}]},mortal:{alive:!0,health:1,killOnSolidEntityCollide:!0,killOnMapCollide:!0,killOnWorldCollide:!0,despawnOnDeath:!0,soul:"explosion"},behavior:{initState:"stompee"},light:{intensity:1,radius:32}}}),n("js/sim/prefabs/smoke",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},state:{queue:[{key:"ttl",duration:500}]},position:{x:0,y:0,z:3},velocity:{x:0,y:0},gravity:{value:-1e-4},size:{width:16,height:16}}}),n("js/sim/prefabs/spikes",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{},position:{x:0,y:0,z:2},size:{width:8,height:8},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!1},gravity:n,hazard:{groups:["objects","players"],damage:1,states:[{key:"stun",duration:500}]}}}),n("js/sim/prefabs/survey",["require","exports","module"],function(e,t,i){i.exports={meta:{},position:{x:0,y:0,z:0,immovable:!0},size:{width:16,height:16}}}),n("js/sim/prefabs/teleporter",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},state:{},position:{x:0,y:0,z:1,immovable:!0},size:{width:12,height:12},velocity:{x:0,y:0},drag:{x:.1,y:.1},bounce:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!1},behavior:{initState:"teleporter"}}}),n("js/sim/prefabs/torch",["require","exports","module","../../gravity"],function(e,t,i){var n=e("../../gravity");i.exports={meta:{},state:{},position:{x:0,y:0,z:1},size:{width:16,height:16},physics:{mass:3},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!0},gravity:n,behavior:{initState:"torch"},light:{intensity:1,radius:32}}}),n("js/sim/prefabs/vPlatform",["require","exports","module"],function(e,t,i){i.exports={meta:{},state:{},position:{x:0,y:0,z:3},size:{width:16,height:16},velocity:{x:0,y:0},bounce:{x:1,y:1},collision:{group:"objects",world:!0,map:!0,solid:!0},behavior:{initState:"vPlatform"}}}),n("js/sim/prefabs/vTrap",["require","exports","module"],function(e,t,i){i.exports={meta:{center:!0},position:{x:0,y:0,z:1},size:{width:8,height:8},physics:{mass:2},velocity:{x:0,y:0},collision:{group:"objects",world:!0,map:!0,solid:!1},hazard:{groups:["objects","players"],damage:1,states:[{key:"stun",duration:500}]},bounce:{x:1,y:1},behavior:{initState:"trap",initData:{vertical:!0}}}}),n("js/sim/prefabs/index",["require","exports","module","./playerBenzer","./playerBird","./playerBoy","./playerChicken","./playerDog","./playerFranklin","./playerGirl","./playerRaga","./playerShip","./playerShipYellow","./playerTiger","./playerXam","./playerZombie","./playerGoblin","./playerJoey","./banner","./boss","./bossBlock","./bouncer","./buster","./cannon","./chicken","./explosion","./explosionSpawner","./flash","./fragileRock","./fragileRockCorpse","./funWatcher","./gameGoal","./gameKey","./gameStart","./glitter","./gravityRock","./hPlatform","./hTrap","./intervalRock","./jumper","./puff","./pulseBlock","./pulseButton","./shell","./shellLights","./smoke","./spikes","./survey","./teleporter","./torch","./vPlatform","./vTrap"],function(e,t){t.playerBenzer=e("./playerBenzer"),t.playerBird=e("./playerBird"),t.playerBoy=e("./playerBoy"),t.playerChicken=e("./playerChicken"),t.playerDog=e("./playerDog"),t.playerFranklin=e("./playerFranklin"),t.playerGirl=e("./playerGirl"),t.playerRaga=e("./playerRaga"),t.playerShip=e("./playerShip"),t.playerShipYellow=e("./playerShipYellow"),t.playerTiger=e("./playerTiger"),t.playerXam=e("./playerXam"),t.playerZombie=e("./playerZombie"),t.playerGoblin=e("./playerGoblin"),t.playerJoey=e("./playerJoey"),t.banner=e("./banner"),t.boss=e("./boss"),t.bossBlock=e("./bossBlock"),t.bouncer=e("./bouncer"),t.buster=e("./buster"),t.cannon=e("./cannon"),t.chicken=e("./chicken"),t.explosion=e("./explosion"),t.explosionSpawner=e("./explosionSpawner"),t.flash=e("./flash"),t.fragileRock=e("./fragileRock"),t.fragileRockCorpse=e("./fragileRockCorpse"),t.funWatcher=e("./funWatcher"),t.gameGoal=e("./gameGoal"),t.gameKey=e("./gameKey"),t.gameStart=e("./gameStart"),t.glitter=e("./glitter"),t.gravityRock=e("./gravityRock"),t.hPlatform=e("./hPlatform"),t.hTrap=e("./hTrap"),t.intervalRock=e("./intervalRock"),t.jumper=e("./jumper"),t.puff=e("./puff"),t.pulseBlock=e("./pulseBlock"),t.pulseButton=e("./pulseButton"),t.shell=e("./shell"),t.shellLights=e("./shellLights"),t.smoke=e("./smoke"),t.spikes=e("./spikes"),t.survey=e("./survey"),t.teleporter=e("./teleporter"),t.torch=e("./torch"),t.vPlatform=e("./vPlatform"),t.vTrap=e("./vTrap")}),n("js/sim/joy",["require","exports","module","djinn/utils/intl","djinn/sim/shared/position","djinn/sim/shared/state","../gameData"],function(e,t,i){var n=e("djinn/utils/intl"),a=e("djinn/sim/shared/position"),s=e("djinn/sim/shared/state"),r=e("../gameData");t.addState=function(e,t,i){if("player"===e.meta.role&&!s.exists(e,t)&&(s.add(e,t,i),r.playtest)){var o=e.world,l=o.createEntity("banner",{meta:{text:n.get(t),color:"white"}});a.centerOnEntity(l,e),o.spawnEntity(l)}}}),n("js/sim/stomp",["require","exports","module","djinn/math/core","djinn/sim/systems/behavior","djinn/sim/shared/position","./joy"],function(e,t,i){var n=e("djinn/math/core"),a=(e("djinn/sim/systems/behavior"),e("djinn/sim/shared/position")),s=e("./joy");t.entityCollide=function(e,t,i){if(e.mortal&&!e.mortal.alive)return!1;if(!t.velocity)return!1;if("player"!==t.meta.role)return!1;var r=a.getCenter(t),o=a.getCenter(e);if(e.gravity){if(e.gravity.value>0){if(r.y>o.y)return!1}else if(r.y<o.y)return!1}else if(r.y>o.y)return!1;s.addState(t,"zoom",1e3),t.velocity.y=.275*-n.sign(t.gravity.value),e.velocity.x=0;var l=1;e.mortal.health-=l;var h=e.world;h.triggerSystems("entityDamage",[e,l,t]),h.fire("entityDamage",[e,l,t]),t.fire("harm",[l,e]),e.fire("damage",[l,t]);var u=e.spawn("puff"),d=i.contacts[0];return a.centerOnPoint(u,d.x,d.y),!0}}),n("js/sim/behaviors/boss",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/state","../stomp","../../gravity"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/state"),a=e("../stomp"),s=e("../../gravity");t.entityCollide=function(e,t){a.entityCollide(this,e,t)&&delete this.hazard},t.entityUpdate=function(){if(!n.exists(this,"cooldown")){n.add(this,"cooldown",1e3);for(var e=this.world.getEntitiesByType("bossBlock"),t=e.length||1,a=0;t>a;++a)i.pushState(this,"bossAttack");for(var a=0;t>a;++a)i.pushState(this,"bossMove")}},t.entityDie=function(){this.gravity=s,delete this.behavior}}),n("js/sim/behaviors/bossAttack",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/position","djinn/sim/shared/state","../stomp","../../gravity"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/position"),a=e("djinn/sim/shared/state"),s=e("../stomp"),r=e("../../gravity");t.enter=function(){var e=this.world.player;if(e){var t=n.getAimVector(this,e),i=this.spawn("buster");i.hazard.owner=this,i.position.x+=t.x*i.size.width,i.position.y+=t.y*i.size.height,i.velocity.x=.1*t.x,i.velocity.y=.1*t.y;var s=this.spawn("puff");n.centerOnEntity(s,i),i.facing.angle=t.heading,a.add(this,"cooldown",1e3),this.fire("attack")}},t.entityCollide=function(e,t){s.entityCollide(this,e,t)&&delete this.hazard},t.entityUpdate=function(){a.exists(this,"cooldown")||i.popState(this)},t.entityDie=function(){this.gravity=r,delete this.behavior}}),n("js/sim/behaviors/bossMove",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/position","djinn/sim/shared/state","../stomp","../../gravity"],function(e,t){
var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/position"),a=e("djinn/sim/shared/state"),s=e("../stomp"),r=e("../../gravity");t.enter=function(){var e=this.world.player;if(e){var t=n.getAimVector(this,e);this.velocity.x=.2*t.x,this.velocity.y=.2*t.y,a.add(this,"cooldown",1e3),this.fire("move")}},t.entityCollide=function(e,t){s.entityCollide(this,e,t)&&delete this.hazard},t.entityUpdate=function(){a.exists(this,"cooldown")||i.popState(this)},t.entityDie=function(){this.gravity=r,delete this.behavior}}),n("js/sim/behaviors/chase",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/position","djinn/sim/shared/state"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/position"),a=e("djinn/sim/shared/state");t.entityUpdate=function(){if(!a.exists(this,"cooldown")){a.add(this,"cooldown",i.getStateData(this,"cooldown"));var e=this.control,t=this.world,s=t.player,r=n.getCenter(this),o=n.getCenter(s);r.x<o.x?e.x=1:r.x>o.x&&(e.x=-1),r.y<o.y?e.y=1:r.y>o.y&&(e.y=-1)}}}),n("js/sim/behaviors/collect",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/state","../joy"],function(e,t){var i=(e("djinn/sim/systems/behavior"),e("djinn/sim/shared/state"),e("../joy"));t.entityCollide=function(e,t){if("player"===e.meta.role){i.addState(e,"bling",1e3);var n=this.world;this.spawn("glitter"),n.despawnEntity(this),n.fire("entityCollect",[this])}}}),n("js/sim/behaviors/collideEvent",["require","exports","module","djinn/sim/systems/behavior"],function(e,t){var i=e("djinn/sim/systems/behavior");t.entityCollide=function(e,t){if("player"===e.meta.role){var n=this.world;n.fire(i.getStateData(this,"eventName"))}}}),n("js/sim/behaviors/digger",["require","exports","module"],function(e,t){t.entityMapCollide=function(e,t,i){this.world.map.set(e,t,0)},t.entityDie=function(){delete this.behavior}}),n("js/sim/behaviors/flash",["require","exports","module","djinn/sim/shared/state"],function(e,t){var i=e("djinn/sim/shared/state");t.entityUpdate=function(){var e=i.getDuration(this,"ttl");if(e){var t=i.getElapsed(this,"ttl"),n=t/e,a=this.light;a.intensity=1-n}}}),n("js/sim/behaviors/fragileRock",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/state","../joy"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/state"),a=e("../joy");t.entityCollide=function(e,t){if(!n.exists(this,"ttl")){a.addState(e,"cool",1e3);var s=i.getStateData(this,"ttl");n.add(this,"ttl",s)}},t.entityDespawn=function(e,t){if("ttl"===t){var i=this.spawn("fragileRockCorpse");n.add(i,"ttl",500)}}}),n("js/sim/behaviors/funWatcher",["require","exports","module","djinn/utils/intl","djinn/sim/shared/position","djinn/sim/shared/state","../joy"],function(e,t){var i=e("djinn/utils/intl"),n=e("djinn/sim/shared/position"),a=e("djinn/sim/shared/state"),s=e("../joy"),r=["bling","cool","danger","ride","zoom"],o=function(){for(var e=this.world,t=(e.map,e.player),i=e.getEntitiesByRadius(t,32),n=0,a=i.length;a>n;++n){var r=i[n];if(r.hazard&&r.owner!==t)return void s.addState(t,"danger",1e3)}},l=function(){var e=this.world,t=e.map,s=e.player,o=n.getTile(s,t),l=o.x,h=o.y,u=e.getEntities(function(e){var i=n.getTile(e,t);return"survey"===e.type&&i.x===l&&i.y===h});if(!(u.length>0)){for(var d=0,c=0,p=r.length;p>c;++c){var g=r[c];a.exists(s,g)&&(d+=1)}var m=e.createEntity("survey",{meta:{joyCount:d}});if(n.centerOnTile(m,t,l,h),e.spawnEntity(m),d>1){var f=e.createEntity("banner",{meta:{text:i.get("FUN",d),color:"gold"}});n.centerOnEntity(f,s),e.spawnEntity(f)}}};t.entityUpdate=function(){a.exists(this,"cooldown")||(a.add(this,"cooldown",50),o.call(this),l.call(this))}}),n("js/sim/behaviors/gameGoal",["require","exports","module","djinn/sim/systems/behavior"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=function(){var e=this.world.getEntities(function(e){return e.meta&&e.meta.goalBlocker?e.mortal?e.mortal.alive:!0:void 0});e.length>0?i.setStateData(this,"active",!1):i.setStateData(this,"active",!0),this.fire("activeStateChange",[i.getStateData(this,"active")])},a=function(e){if(e.meta&&e.meta.goalBlocker){var t=i.getStateData(this,"active");n.call(this);var a=i.getStateData(this,"active");a&&!t&&this.world.fire("goalOpen")}};t.entitySpawn=function(){this.world.on("entityCollect",this,a),this.world.on("entityDie",this,a)},t.entityReset=function(){n.call(this)},t.entityCollide=function(e,t){if("player"===e.meta.role&&i.getStateData(this,"active")){var n=this.world;n.fire("goal")}}}),n("js/sim/behaviors/gravityRock",["require","exports","module","djinn/sim/shared/state","../joy"],function(e,t){var i=e("djinn/sim/shared/state"),n=e("../joy");t.entityCollide=function(e,t){e.gravity&&(i.exists(this,"cooldown")||(i.add(this,"cooldown",1e3),i.exists(e,"gravityCooldown")||(i.add(e,"gravityCooldown",250),n.addState(e,"cool",1e3),e.gravity.value=-e.gravity.value,e.fire("gravityChange",[e.gravity.value]),this.fire("gravityEffect"))))}}),n("js/sim/behaviors/hPlatform",["require","exports","module","djinn/sim/shared/position","djinn/sim/shared/state","../joy"],function(e,t){var i=e("djinn/sim/shared/position"),n=e("djinn/sim/shared/state"),a=e("../joy"),s=.05;t.entityReset=function(){this.velocity.x=-s},t.entityUpdate=function(e){var t=i.getBounds(this);t.width-=4,t.height=1,t.x+=2,t.y-=1;var s=this.world.getEntitiesByRect(t);if(s.length)for(var r=0,o=s.length;o>r;++r){var l=s[r],h=l.position;if(h&&!h.immovable){var u=l.gravity;u&&u.value>0&&(n.exists(l,"platforming")||(n.add(l,"platforming",1),h.x+=this.velocity.x*e,a.addState(l,"ride",1e3)))}}var t=i.getBounds(this);t.width-=4,t.height=1,t.x+=2,t.y+=this.size.height;var s=this.world.getEntitiesByRect(t);if(s.length)for(var r=0,o=s.length;o>r;++r){var l=s[r],h=l.position;if(h&&!h.immovable){var u=l.gravity;u&&u.value<0&&(n.exists(l,"platforming")||(n.add(l,"platforming",1),h.x+=this.velocity.x*e,n.add(l,"ride",100)))}}}}),n("js/sim/behaviors/intervalRock",["require","exports","module","djinn/sim/systems/behavior","../joy"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("../joy");t.entityCollide=function(e){"player"===e.meta.role&&n.addState(e,"cool",1e3)},t.entityUpdate=function(){var e=i.getStateData(this,"interval");this.behavior.elapsed<e||(this.behavior.elapsed=0,this.collision.solid=!this.collision.solid,this.fire("toggle",[this.collision.solid]))}}),n("js/sim/behaviors/intervalSpawner",["require","exports","module","djinn/math/random","djinn/sim/systems/behavior"],function(e,t){var i=e("djinn/math/random"),n=e("djinn/sim/systems/behavior");t.entityUpdate=function(){var e=n.getStateData(this,"interval");if(!(this.behavior.elapsed<e)){this.behavior.elapsed=0;var t=n.getStateData(this,"queue"),a=t.shift(),s=this.spawn(a),r=n.getStateData(this,"rangeX");r&&(s.position.x+=i.range(-r,r));var o=n.getStateData(this,"rangeY");o&&(s.position.y+=i.range(-o,o)),0===t.length&&this.world.despawnEntity(this)}}}),n("js/sim/behaviors/jumper",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/position","djinn/sim/shared/state","../stomp"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/position"),a=e("djinn/sim/shared/state"),s=e("../stomp");t.enter=function(){a.add(this,"cooldown",i.getStateData(this,"cooldown"))},t.entityCollide=function(e,t){s.entityCollide(this,e,t)&&delete this.hazard},t.entityMapCollide=function(e,t,i){this.velocity.x*=.5,this.fire("land")},t.entityWorldCollide=function(e,t){this.velocity.x*=.5,this.fire("land")},t.entityUpdate=function(){if(!a.exists(this,"cooldown")){a.add(this,"cooldown",i.getStateData(this,"cooldown"));var e=this.world.player;if(e){var t=n.getCenter(this),s=n.getCenter(e);t.x<s.x?this.facing.angle=-1:this.facing.angle=1,i.pushState(this,"jumperWarning",{velocity:i.getStateData(this,"velocity"),warning:i.getStateData(this,"warning")}),this.fire("warning")}}},t.entityDie=function(){delete this.behavior}}),n("js/sim/behaviors/jumperWarning",["require","exports","module","djinn/math/core","djinn/sim/systems/behavior","djinn/sim/shared/state","../stomp"],function(e,t){var i=e("djinn/math/core"),n=e("djinn/sim/systems/behavior"),a=e("djinn/sim/shared/state"),s=e("../stomp");t.enter=function(){a.add(this,"warning",n.getStateData(this,"warning"))},t.entityCollide=function(e,t){s.entityCollide(this,e,t)&&delete this.hazard},t.entityUpdate=function(){if(!a.exists(this,"warning")){var e=n.getStateData(this,"velocity");-1===this.facing.angle?this.velocity.x=e.x:this.velocity.x=-e.x,this.velocity.y=e.y*-i.sign(this.gravity.value),this.fire("jump"),n.popState(this)}},t.entityDie=function(){delete this.behavior}}),n("js/sim/behaviors/launcher",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/position","../joy"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/position"),a=e("../joy"),s=function(){var e=i.getStateData(this,"velocity");e.y=-e.y,i.setStateData(this,e)};t.entitySpawn=function(){this.on("gravityChange",this,s)},t.entityUpdate=function(e){var t=n.getBounds(this);t.height=1,t.y-=1;var s=this.world.getEntitiesByRect(t);if(s.length)for(var r=i.getStateData(this,"velocity"),o=0,l=s.length;l>o;++o){var h=s[o],u=h.position;u&&!u.immovable&&(a.addState(h,"zoom",1e3),0!==r.x&&(h.velocity.x=r.x),0!==r.y&&(h.velocity.y=r.y),r.y<0&&h.jump&&(h.jump.grounded=!1),this.fire("launch"))}}}),n("js/sim/behaviors/oob",["require","exports","module"],function(e,t){t.entityUpdate=function(){this.position.x<=-16&&this.world.despawnEntity(this)}}),n("js/sim/behaviors/pickup",["require","exports","module","djinn/sim/systems/behavior"],function(e,t){var i=e("djinn/sim/systems/behavior");t.entityCollide=function(e,t){if("player"===e.meta.role){e.meta.action=i.getStateData(this,"action");var n=this.world;n.despawnEntity(this)}}}),n("js/sim/behaviors/pulseBlock",["require","exports","module"],function(e,t){t.entitySpawn=function(){this.world.on("pulse",this,function(){this.collision.solid=!this.collision.solid,this.fire("toggle",[this.collision.solid])})}}),n("js/sim/behaviors/pulser",["require","exports","module","../joy","djinn/sim/shared/state"],function(e,t){var i=e("../joy"),n=e("djinn/sim/shared/state");t.entityCollide=function(e,t){n.exists(this,"cooldown")||(n.add(this,"cooldown",1e3),i.addState(e,"cool",1e3),this.fire("pulse"),this.world.fire("pulse"))}}),n("js/sim/behaviors/stompee",["require","exports","module","../stomp"],function(e,t){var i=e("../stomp");t.entityCollide=function(e,t){i.entityCollide(this,e,t)&&delete this.hazard}}),n("js/sim/behaviors/teleporter",["require","exports","module","djinn/math/core","djinn/sim/shared/position","djinn/sim/shared/state","../joy"],function(e,t){var i=e("djinn/math/core"),n=e("djinn/sim/shared/position"),a=e("djinn/sim/shared/state"),s=e("../joy"),r=function(){var e=this.id;return this.world.getEntities(function(t){return"teleporter"===t.type&&t.id!==e})};t.entityReset=function(){r.call(this).length<1&&this.fire("deactivate")},t.entityCollide=function(e,t){if(!a.exists(this,"cooldown")&&!e.position.immovable){var o=r.call(this);if(!(o.length<1)){s.addState(e,"ride",1e3),a.add(this,"cooldown",1e3);var l=n.getCenter(this);o.sort(function(e,t){var a=n.getCenter(e),s=n.getCenter(t);return i.distance(l.x,l.y,a.x,a.y)>i.distance(l.x,l.y,s.x,s.y)});var h=o[0];n.centerOnEntity(e,h),a.add(h,"cooldown",1e3),this.fire("teleport"),h.fire("teleport"),e.fire("teleported")}}}}),n("js/sim/behaviors/torch",["require","exports","module"],function(e,t){t.entitySpawn=function(){var e=this.light;this.world.on("pulse",this,function(){e.intensity=e.intensity?0:1,this.fire("lightChange",[e.intensity])})}}),n("js/sim/behaviors/trap",["require","exports","module","djinn/sim/systems/behavior","djinn/sim/shared/position"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("djinn/sim/shared/position");t.entityReset=function(){var e=this.world,t=e.map,a=n.getTile(this,t),s=(t.getTilesByRect(a.x,a.y),[]);i.getStateData(this,"horizontal")&&(s.push({x:-1,y:0}),s.push({x:1,y:0})),i.getStateData(this,"vertical")&&(s.push({x:0,y:-1}),s.push({x:0,y:1}));for(var r=[],o=0,l=s.length;l>o;++o){var h=s[o];0===t.get(a.x+h.x,a.y+h.y)&&r.push(h)}if(r.length>0){r.sort(function(e,t){return Math.abs(e.y)<Math.abs(t.y)});var u=r[0],d=.075;this.velocity.x=u.x*d,this.velocity.y=u.y*d}}}),n("js/sim/behaviors/turret",["require","exports","module","djinn/math/core","djinn/sim/shared/position","djinn/sim/shared/state","djinn/sim/systems/behavior"],function(e,t){var i=e("djinn/math/core"),n=e("djinn/sim/shared/position"),a=e("djinn/sim/shared/state"),s=e("djinn/sim/systems/behavior");t.entityUpdate=function(){if(!a.exists(this,"cooldown")){var e=s.getStateData(this,"horizontal"),t=s.getStateData(this,"vertical"),r=this.world,o=this,l=r.getEntities(function(i){if(o.id!==i.id){var a=s.getStateData(o,"targetGroup");if(i.collision&&i.collision.group===a){var r=s.getStateData(o,"range");if(!(n.getDistance(o,i)>r)){var l=s.getStateData(o,"axisThreshold"),h=n.getCenter(o),u=n.getCenter(i),d=h.x-u.x,c=h.y-u.y;return t&&Math.abs(d)<=l||e&&Math.abs(c)<=l}}}});if(!(l.length<1)){var h=l[0],u=n.getAimVector(this,h);if(u.snap(Math.PI/2),(i.approximately(u.x,0)||e)&&(i.approximately(u.y,0)||t)){this.facing.angle=u.x;var d=s.getStateData(this,"spawnType"),c=n.getTile(this,r.map),p=(r.getEntities(function(e){if(e.light&&e.light.intensity>0){var t=n.getTile(e,r.map);c.x===t.x&&c.y+1===t.y&&(d="shellLights")}}),this.size),g=this.spawn(d);g.position.x+=u.x*p.width,g.position.y+=u.y*p.height;var m=this.spawn("smoke");m.position.x+=u.x*m.size.width/2,m.position.y+=u.y*m.size.height/2,m.velocity.x=.01*u.x;var f=this.spawn("flash");f.position.x+=u.x*f.size.width/2,f.position.y+=u.y*f.size.height/2;var v=s.getStateData(this,"offsetX");v&&(g.position.x+=v);var y=s.getStateData(this,"offsetY");y&&(g.position.y+=y);var w=s.getStateData(this,"speed");g.facing.angle=u.heading,g.velocity.x=u.x*w,g.velocity.y=u.y*w,a.add(this,"cooldown",s.getStateData(this,"cooldown")),this.fire("attack")}}}}}),n("js/sim/behaviors/vPlatform",["require","exports","module","djinn/math/core","djinn/sim/shared/state","../joy"],function(e,t){var i=e("djinn/math/core"),n=e("djinn/sim/shared/state"),a=e("../joy"),s=.05;t.entityReset=function(){this.velocity.y=-s},t.entityCollide=function(e){"player"===e.meta.role&&a.addState(e,"ride",1e3)},t.entityUpdate=function(e){if(!n.exists(this,"cooldown")){n.add(this,"cooldown",100);var t=this.velocity,a=i.sign(t.y),s=this.world,r=s.map,o=this.position,l=o.y+(a>0?14:0),h={x:Math.floor(o.x/r.tileWidth),y:Math.floor(l/r.tileHeight)+a},u=!1;if(0>a&&o.y<16||a>0&&o.y>s.height-16)u=!0;else if(r.get(h.x,h.y)>0)u=!0;else for(var d=s.getEntitiesByTile(h.x,h.y),c=0,p=d.length;p>c;++c){var g=d[c];if(g.collision&&g.collision.solid){u=!0;break}}if(u){var m=this.bounce;t.y=-t.y*m.y}}}}),n("js/sim/behaviors/walker",["require","exports","module","djinn/sim/systems/behavior","../stomp"],function(e,t){var i=e("djinn/sim/systems/behavior"),n=e("../stomp");t.entitySpawn=function(){this.velocity.x=i.getStateData(this,"speed")},t.entityCollide=function(e,t){n.entityCollide(this,e,t)},t.entityUpdate=function(){this.velocity.x<0?this.facing.angle=-Math.PI/2:this.facing.angle=Math.PI/2}}),n("js/sim/behaviors/index",["require","exports","module","./boss","./bossAttack","./bossMove","./chase","./collect","./collideEvent","./digger","./flash","./fragileRock","./funWatcher","./gameGoal","./gravityRock","./hPlatform","./intervalRock","./intervalSpawner","./jumper","./jumperWarning","./launcher","./oob","./pickup","./pulseBlock","./pulser","./stompee","./teleporter","./torch","./trap","./turret","./vPlatform","./walker"],function(e,t){t.boss=e("./boss"),t.bossAttack=e("./bossAttack"),t.bossMove=e("./bossMove"),t.chase=e("./chase"),t.collect=e("./collect"),t.collideEvent=e("./collideEvent"),t.digger=e("./digger"),t.flash=e("./flash"),t.fragileRock=e("./fragileRock"),t.funWatcher=e("./funWatcher"),t.gameGoal=e("./gameGoal"),t.gravityRock=e("./gravityRock"),t.hPlatform=e("./hPlatform"),t.intervalRock=e("./intervalRock"),t.intervalSpawner=e("./intervalSpawner"),t.jumper=e("./jumper"),t.jumperWarning=e("./jumperWarning"),t.launcher=e("./launcher"),t.oob=e("./oob"),t.pickup=e("./pickup"),t.pulseBlock=e("./pulseBlock"),t.pulser=e("./pulser"),t.stompee=e("./stompee"),t.teleporter=e("./teleporter"),t.torch=e("./torch"),t.trap=e("./trap"),t.turret=e("./turret"),t.vPlatform=e("./vPlatform"),t.walker=e("./walker")}),n("js/sim/actions",["require","exports","module","djinn/math/Vector2","djinn/math/core","djinn/sim/shared/position","djinn/sim/shared/state"],function(e,t,i){var n=e("djinn/math/Vector2"),a=e("djinn/math/core"),s=e("djinn/sim/shared/position"),r=e("djinn/sim/shared/state");t.jump=function(e){return e.jump.request=!0,!0},t.shooter=function(e){if(r.exists(e,"cooldown"))return!1;r.add(e,"cooldown",200);var t=this.createEntity("buster"),i=e.facing.angle,o=n.makeFromHeading(i);return a.approximately(o.x,0)&&(o.x=-1),t.facing.angle=i,s.centerOnEntity(t,e),t.position.x+=o.x*e.size.width,t.velocity.x=.3*o.x,e.position.x-=2*o.x,t.owner=e,this.spawnEntity(t),!0}}),n("js/sim/Level",["require","exports","module","djinn/sim/World","djinn/sim/shared/position","djinn/sim/systems/state","djinn/sim/systems/physics","djinn/sim/systems/collision","djinn/sim/systems/control","djinn/sim/systems/jump","djinn/sim/systems/hazard","djinn/sim/systems/mortal","djinn/sim/systems/behavior","djinn/sim/states/common","djinn/sim/states/effects","./prefabs/index","./behaviors/index","../gameData","./actions"],function(e,t,i){var n=e("djinn/sim/World"),a=e("djinn/sim/shared/position"),s=e("djinn/sim/systems/state"),r=e("djinn/sim/systems/physics"),o=e("djinn/sim/systems/collision"),l=e("djinn/sim/systems/control"),h=e("djinn/sim/systems/jump"),u=e("djinn/sim/systems/hazard"),d=e("djinn/sim/systems/mortal"),c=e("djinn/sim/systems/behavior"),p=e("djinn/sim/states/common"),g=e("djinn/sim/states/effects"),m=e("./prefabs/index"),f=e("./behaviors/index"),v=e("../gameData"),y=e("./actions");o.penetrationThreshold=.85,h.fallThreshold=.125,i.exports=n.extend({init:function(e){this._super(e),this.width=256,this.height=144,this.addSystem(s),this.addSystem(r),this.addSystem(o),this.addSystem(l),this.addSystem(h),this.addSystem(c),this.addSystem(u),this.addSystem(d),this.definePrefabs(m),s.define(p),s.define(g),c.define(f),o.defineGroupTargets("players",["objects"]),o.defineGroupTargets("objects",["players","objects"]),o.defineWalkableTile(0)},addEntityAtTile:function(e,t,i){var n=this.createEntity(e),s=this.map;if(n.meta.center)a.centerOnTile(n,s,t,i);else{var r=n.size;n.position.x=t*s.tileWidth+s.tileWidth/2-r.width/2,n.position.y=i*s.tileHeight+s.tileHeight-r.height}return this.spawnEntity(n),n},loadMap:function(e,t,i){var n=this.map;n.tileWidth=16,n.tileHeight=16;var s=e.tiles,r=s[0].length,o=s.length;this.width=r*n.tileWidth,this.height=o*n.tileHeight,n.resize(r,o),n.fill(e.floorIndex||0);for(var l=0;o>l;++l)for(var h=0;r>h;++h){var u=s[l][h];if(isNaN(u)){var d=this.addEntityAtTile(u,h,l);if("gameStart"===u){var c=a.getTile(d,n);t=c.x,i=c.y}}else n.set(h,l,u)}if(v.playtest||!v.editing){var p=e.playerPrefab;this.player=this.addEntityAtTile(p,t,i),this.setCameraTarget(this.player)}return e},playerAction:function(){var e=this.player;if(!e.meta.action)return!1;if(!e.mortal.alive)return!1;if(y[e.meta.action]){var t=y[e.meta.action].call(this,e);return t&&e.fire("action"),t}}})}),n("js/view/GameListItem",["require","exports","module","djinn/view/View","./Screenshot","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Screenshot"),s=e("./Typer"),t=(e("./style"),i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},setGame:function(e){this.disposeChildren(),this.developer=e.developer;var t=new a({parent:this,acceptInputEvents:!0,y:4,width:16,height:9});t.on("inputStart",this,"_onSelectGame"),t.setGame(e),this._name=new s({parent:this,text:e.name,acceptInputEvents:!0,x:24,y:0}).on("inputStart",this,"_onSelectGame"),this._details=new s({parent:this,text:"by "+e.developer,color:"silver",acceptInputEvents:!0,captureInputEvents:!0,x:24,y:8}).on("inputStart",this,"_onSelectProfile")},addDeleteButton:function(){this._deleteButton&&this._deleteButton.dispose();var e=this._deleteButton=new s({parent:this,text:"X",color:"white",acceptInputEvents:!0,cancelInputEvents:!0,captureInputEvents:!0});e.shrinkwrap(),e.align("right","top"),e.on("inputStart",this,"_onDeleteGame")},addLabel:function(e,t){this._details.text=e,t&&(this._details.color=t)},setNameColor:function(e){this._name.color=e},markAsUnplayed:function(){var e=this._name;new s({parent:this,text:"NEW!",color:"gold",x:e.x,y:e.y}),e.x+=40},_onSelectGame:function(){this.fire("selectGame",[this.gameIndex])},_onSelectProfile:function(){this.fire("selectProfile",[this.developer])},_onDeleteGame:function(){this.fire("deleteGame",[this.gameIndex])}}));t.defaults={acceptInputEvents:!0,height:16,width:224}}),n("js/view/Menu",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/utils/string","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=(e("djinn/audio/jukebox"),e("djinn/utils/string"),e("./Typer")),s=e("./style");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),new n({parent:this,backgroundColor:s.getColor("black"),width:this.width-2,height:this.height-2}).align("center","center");var i=new a({parent:this,text:"PAUSED",color:"silver",anchorX:.5,imageSmoothingEnabled:!1,scale:2});i.shrinkwrap(),i.align("center","top",0,8);var r=new a({parent:this,text:"Continue",acceptInputEvents:!0,color:"green"});r.shrinkwrap(),r.align("left","bottom",16,-8),r.on("inputPress",this,"_onClose");var o=new a({parent:this,text:"Quit",acceptInputEvents:!0,color:"red"});o.shrinkwrap(),o.align("right","bottom",-16,-8),o.on("inputPress",this,"_onQuit")},reset:function(){},_onQuit:function(){this.fire("quit")},_onClose:function(){this.fire("close")}}),t.defaults={acceptInputEvents:!0,backgroundColor:s.getColor("white"),width:192,height:64}}),n("js/view/Color",["require","exports","module","djinn/view/View","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=this.width-2,a=this.height-2;this._background=new n({parent:this,width:i,height:a}).align("center","center")},setColor:function(e){this._background.backgroundColor=a.fromRGBArray(e)}});t.defaults={acceptInputEvents:!0,backgroundColor:a.getColor("white")}}),n("djinn/utils/Factory",["require","exports","module","../Class"],function(e,t,i){var n=e("../Class");i.exports=n.extend({init:function(e,t){this._fallback=e,this._extensions=t},create:function(e,t){var i=this._extensions,t=merge(t,{type:e});return e in i?i[e].create(t):this._fallback.create(t)}})}),n("js/view/avatars/Default",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),a=16,s={bossBlock:{image:"media/images/objects.png",imageX:96,imageY:112},cannon:{image:"media/images/objects.png",imageX:0,imageY:48},shell:{image:"media/images/objects.png",imageX:1*a,imageY:3*a},shellLights:{image:"media/images/objects.png",imageX:1*a,imageY:4*a},gameKey:{image:"media/images/objects.png",imageX:3*a,imageY:5*a},hPlatform:{image:"media/images/objects.png",imageX:6*a,imageY:3*a},spikes:{image:"media/images/objects.png",imageX:5*a,imageY:0*a},pushBlock:{image:"media/images/objects.png",imageX:7*a,imageY:4*a},actionPickup:{image:"media/images/objects.png",imageX:1*a,imageY:1*a},gameStart:{image:"media/images/objects.png",imageX:5*a,imageY:3*a},computer:{image:"media/images/objects.png",imageX:7*a,imageY:1*a},bed:{image:"media/images/objects.png",imageX:3*a,imageY:1*a},axe:{image:"media/images/objects.png",imageX:2*a,imageY:1*a},playerShip:{image:"media/images/actors.png",imageY:6*a},mom:{image:"media/images/actors.png",imageX:1*a,imageY:10*a},grass:{image:"media/images/objects.png",imageX:6*a,imageY:2*a},home:{image:"media/images/objects.png",imageX:2*a,imageY:2*a},doug:{image:"media/images/actors.png",imageX:0*a,imageY:10*a},hTrap:{image:"media/images/objects.png",imageX:4*a,imageY:1*a},vTrap:{image:"media/images/objects.png",imageX:3*a,imageY:1*a},trashCan:{image:"media/images/objects.png",imageX:3*a,imageY:2*a},pressurePlate:{image:"media/images/objects.png",imageX:4*a,imageY:2*a}},t=i.exports=n.extend({init:function(e){var e=merge(e,s[e.type],t.defaults);this._super(e)}});t.defaults={width:a,height:a}}),n("js/view/avatars/Banner",["require","exports","module","../Typer"],function(e,t,i){var n=e("../Typer"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},setText:function(e){this.text=e,this.shrinkwrap(),this.align("center","center")},setColor:function(e){this.color=e}});t.defaults={width:16,height:16}}),n("js/view/avatars/Boss",["require","exports","module","djinn/view/Sprite","djinn/view/View"],function(e,t,i){var n=e("djinn/view/Sprite"),a=(e("djinn/view/View"),64),s=48,t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},attach:function(){this.playAnimation("idle")},attack:function(){this.stopAnimation(),this.imageX=96,this.delayTween(500,bind(this,function(){this.playAnimation("idle")}))},select:function(){this.completeTween({imageX:96}).delayTween(250,bind(this,function(){this.imageX=a}))},showDamage:function(){this.stopAnimation(),this.imageX=112}});t.defaults={animations:{idle:{frameRate:2,frames:[[a,s],[a+16,s]]}},image:"media/images/actors.png",imageX:a,imageY:s,width:16,height:16}}),n("js/view/avatars/Bouncer",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},launch:function(){this.completeTween({imageY:64}).delayTween(250,bind(this,function(){this.imageY=t.defaults.imageY}))}});t.defaults={image:"media/images/objects.png",imageX:48,imageY:48,width:16,height:16}}),n("js/view/avatars/Buster",["require","exports","module","djinn/view/Sprite"],function(e,t,i){var n=e("djinn/view/Sprite"),a=64,s=72,t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},attach:function(){this.playAnimation("blink")}});t.defaults={image:"media/images/actors.png",animations:{blink:{frameRate:24,frames:[[a,s],[a+8,s]]}},imageX:a,imageY:s,width:8,height:8}}),n("js/view/avatars/Explosion",["require","exports","module","djinn/view/shapes/Circle","djinn/math/random","../style"],function(e,t,i){var n=e("djinn/view/shapes/Circle"),a=e("djinn/math/random"),s=e("../style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.radius=a.range(12,18)},attach:function(){new n({parent:this,fillColor:s.getColor("white"),radius:a.range(this.radius/2,this.radius/2+4)}).align("center","center")}});t.defaults={fillColor:s.getColor("yellow")}}),n("js/view/avatars/FragileRock",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),a=[-1,0,1,0],t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this._warnTimer=this.createTimer(25,"_onWarnTimer")},warn:function(e){this._index=0,this._xStart=this.x,this.imageX+=16,this._warnTimer.start(),this._onWarnTimer()},_onWarnTimer:function(){var e=a[this._index];this.x=this._xStart+e,this._index++,this._index>=a.length&&(this._index=0)}});t.defaults={image:"media/images/objects.png",imageX:16,imageY:32,width:16,height:16}}),n("js/view/avatars/FragileRockCorpse",["require","exports","module","djinn/view/View","djinn/math/random"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/random"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},attach:function(){var e=32,t=32;new n({parent:this,image:"media/images/objects.png",imageX:e,imageY:t,width:9,height:9}).tween({x:a.range(-10,-2),y:a.range(16,24)},500),new n({parent:this,image:"media/images/objects.png",imageX:e+8,imageY:t,x:8,width:8,height:9}).tween({x:a.range(12,18),y:a.range(16,24)},500),new n({parent:this,image:"media/images/objects.png",imageX:e,imageY:t+8,y:8,width:8,height:8}).tween({x:a.range(-10,-2),y:a.range(24,32)},500),new n({parent:this,image:"media/images/objects.png",imageX:e+7,imageY:t+8,x:8,y:8,width:9,height:8}).tween({x:a.range(12,18),y:a.range(24,32)},500)}});t.defaults={width:16,height:16}}),n("js/view/avatars/GameGoal",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},activate:function(){this.imageY=48},deactivate:function(){this.imageY=80},goal:function(){this.imageY=64}});t.defaults={image:"media/images/objects.png",imageX:64,imageY:48,width:16,height:16}}),n("js/view/avatars/Glitter",["require","exports","module","djinn/view/View","djinn/math/random"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/random"),s=[[0,0],[1,0],[0,1],[1,1]],t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},attach:function(){for(var e=80,t=16,i=0;5>i;++i){var r=a.choice(s),o=new n({parent:this,image:"media/images/ui.png",imageX:8*r[0]+e,imageY:8*r[1]+t,x:a.range(0,16),y:a.range(0,16),width:8,height:8});o.tween({y:o.y-8},1e3)}}});t.defaults={width:16,height:16}}),n("js/view/avatars/GravityRock",["require","exports","module","djinn/view/View","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("../style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.overlay=new n(merge({parent:this,opacity:0,overlayColor:a.getColor("white")},t.defaults))},changeGravity:function(){this.overlay.completeTween({opacity:1}).tween({opacity:0},1e3)}});t.defaults={image:"media/images/objects.png",imageX:96,imageY:16,width:16,height:16}}),n("js/view/avatars/IntervalRock",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},toggle:function(e){this.imageX=16*(e?6:7)}});t.defaults={image:"media/images/objects.png",imageX:96,imageY:32,width:16,height:16}}),n("js/view/avatars/Jumper",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},attach:function(){this.imageX=80},warning:function(e){this.imageX=80,this.flipX=e},jump:function(){this.imageX=96},land:function(){this.imageX=64},select:function(){this.completeTween({imageX:96}).delayTween(250,bind(this,function(){this.imageX=80}))},showDamage:function(){this.imageX=112},showGrid:function(){this.imageX=80}});t.defaults={image:"media/images/actors.png",imageX:64,imageY:16,width:16,height:16}}),n("js/view/avatars/Player",["require","exports","module","djinn/view/Sprite"],function(e,t,i){var n=e("djinn/view/Sprite"),a={playerBoy:0,playerGirl:1,playerDog:3,playerXam:4,playerGoblin:5,playerFranklin:6,playerJoey:7,playerBenzer:8,playerBird:9,playerChicken:10,chicken:10,playerShip:11,playerShipYellow:12,playerZombie:13,playerRaga:14,playerTiger:15},t=i.exports=n.extend({init:function(e){var i=a[e.type],n=e.imageY=16*i;e.animations={walk:{frameRate:3,frames:[[0,n],[16,n]]}};var e=merge(e,t.defaults);this._super(e)},attach:function(){this.playAnimation("walk")},select:function(){this.completeTween({imageX:32}).delayTween(250,bind(this,function(){this.imageX=0}))}});t.defaults={image:"media/images/actors.png",width:16,height:16}}),n("djinn/view/shapes/Star",["require","exports","module","../View","../utils/canvas"],function(e,t,i){var n=e("../View"),a=e("../utils/canvas"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.points=e.points,this.radius=e.radius,this.offset=e.offset,this.fillColor=e.fillColor,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth},render:function(e){for(var t=this.width/2,i=this.height/2,n=[],s=Math.PI/this.points,r=0,o=2*this.points;o>r;++r){
var l=s*(this.offset+r),h=Math.sin(l),u=-Math.cos(l),d=r%2===0?1:this.radius;n.push(t+h*d*t),n.push(i+u*d*i)}a.drawPolygon(e,n,this.fillColor,this.strokeColor,this.strokeWidth)}});t.defaults={buffer:!0,bufferPadding:10,width:100,height:100,points:5,radius:.5,offset:0,fillColor:"white",strokeColor:null,strokeWidth:1}}),n("js/view/avatars/Puff",["require","exports","module","djinn/view/shapes/Star","../style"],function(e,t,i){var n=e("djinn/view/shapes/Star"),a=e("../style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)}});t.defaults={fillColor:a.getColor("yellow"),radius:4,width:6,height:6}}),n("js/view/avatars/PulseBlock",["require","exports","module","djinn/view/View","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("../style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.clone=new n(merge({parent:this,opacity:0},t.defaults))},toggle:function(e){this.imageX=16*(e?6:7),e?this.clone.completeTween({opacity:1,overlayColor:a.getColor("white"),scale:1}).tween({opacity:0},500):this.clone.completeTween({opacity:1,overlayColor:null,scale:1}).tween({opacity:0,scale:0},100)}});t.defaults={image:"media/images/objects.png",imageX:96,imageY:96,width:16,height:16}}),n("js/view/avatars/PulseButton",["require","exports","module","djinn/view/View","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("../style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.overlay=new n(merge({parent:this,opacity:0,overlayColor:a.getColor("white")},t.defaults))},pulse:function(){this.overlay.completeTween({opacity:1}).tween({opacity:0},1e3)}});t.defaults={image:"media/images/objects.png",imageX:32,imageY:96,width:16,height:16}}),n("js/view/avatars/Smoke",["require","exports","module","djinn/view/shapes/Circle","../style"],function(e,t,i){var n=e("djinn/view/shapes/Circle"),a=e("../style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)}});t.defaults={compositeOperation:"overlay",fillColor:a.getColor("black"),radius:8}}),n("js/view/avatars/Survey",["require","exports","module","djinn/view/View","../style"],function(e,t,i){var n=e("djinn/view/View"),t=(e("../style"),i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},setJoy:function(e){this.completeTween({opacity:0,imageY:16*e,scale:1.75}).tween({opacity:1,scale:1},250)}}));t.defaults={image:"media/images/ui.png",imageX:112,width:16,height:16}}),n("js/view/avatars/Teleporter",["require","exports","module","djinn/view/View","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("../style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.overlay=new n(merge({parent:this,opacity:0,overlayColor:a.getColor("white")},t.defaults))},deactivate:function(){this.imageX=64},teleport:function(){this.overlay.completeTween({opacity:1}).tween({opacity:0},1e3)}});t.defaults={image:"media/images/objects.png",imageX:48,imageY:96,width:16,height:16}}),n("js/view/avatars/Torch",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},lightChange:function(e){this.imageX=16*(e?3:4)}});t.defaults={image:"media/images/objects.png",imageX:48,imageY:112,width:16,height:16}}),n("js/view/avatars/VPlatform",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},up:function(){this.imageY=96},down:function(){this.imageY=112}});t.defaults={image:"media/images/objects.png",imageX:80,imageY:96,width:16,height:16}}),n("js/view/avatarFactory",["require","exports","module","djinn/utils/Factory","./avatars/Default","./avatars/Banner","./avatars/Boss","./avatars/Bouncer","./avatars/Buster","./avatars/Explosion","./avatars/FragileRock","./avatars/FragileRockCorpse","./avatars/GameGoal","./avatars/Glitter","./avatars/GravityRock","./avatars/IntervalRock","./avatars/Jumper","./avatars/Player","./avatars/Puff","./avatars/PulseBlock","./avatars/PulseButton","./avatars/Smoke","./avatars/Survey","./avatars/Teleporter","./avatars/Torch","./avatars/VPlatform"],function(e,t,i){var n=e("djinn/utils/Factory"),a=e("./avatars/Default"),s=e("./avatars/Banner"),r=e("./avatars/Boss"),o=e("./avatars/Bouncer"),l=e("./avatars/Buster"),h=e("./avatars/Explosion"),u=e("./avatars/FragileRock"),d=e("./avatars/FragileRockCorpse"),c=e("./avatars/GameGoal"),p=e("./avatars/Glitter"),g=e("./avatars/GravityRock"),m=e("./avatars/IntervalRock"),f=e("./avatars/Jumper"),v=e("./avatars/Player"),y=e("./avatars/Puff"),w=e("./avatars/PulseBlock"),_=e("./avatars/PulseButton"),x=e("./avatars/Smoke"),b=e("./avatars/Survey"),k=e("./avatars/Teleporter"),j=e("./avatars/Torch"),S=e("./avatars/VPlatform");i.exports=new n(a,{playerBenzer:v,playerBird:v,playerBoy:v,playerChicken:v,playerDog:v,playerFranklin:v,playerGirl:v,playerRaga:v,playerShip:v,playerShipYellow:v,playerTiger:v,playerXam:v,playerZombie:v,chicken:v,playerGoblin:v,playerJoey:v,banner:s,boss:r,bouncer:o,buster:l,explosion:h,fragileRock:u,fragileRockCorpse:d,gameGoal:c,glitter:p,gravityRock:g,intervalRock:m,jumper:f,puff:y,pulseBlock:w,pulseButton:_,smoke:x,survey:b,teleporter:k,torch:j,vPlatform:S})}),n("js/view/GameSettings",["require","exports","module","djinn/view/View","./Typer","./Slider","./Color","./style","./avatarFactory","../gameData","../templates"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Typer"),s=e("./Slider"),r=e("./Color"),o=e("./style"),l=e("./avatarFactory"),h=e("../gameData"),u=e("../templates");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults));var i=new n({parent:this,acceptInputEvents:!0,backgroundColor:o.getColor("black"),width:this.width-2,height:this.height-2}).align("center","center"),l=new a({parent:i,acceptInputEvents:!0,text:"X",width:8}).align("right","top",-4,4);l.on("inputPress",this,"_onClose");var h=this._header=new a({parent:i,text:"Options",anchorX:.5});h.shrinkwrap(),h.align("center");var u=new a({parent:i,text:"-------------",color:"silver",anchorX:.5,y:h.bottom});u.shrinkwrap(),u.align("center");var d=new a({parent:this,text:"Name",color:"silver",x:8,y:24}).shrinkwrap();this._name=new a({parent:this,acceptInputEvents:!0,x:d.right+8,y:d.y}).on("inputStart",this,"_onName");var c=this._playerBox=new n({parent:this,acceptInputEvents:!0,cancelInputEvents:!0,width:48,height:32});c.align("right","top",-16,24),c.on("inputStart",this,"_onPlayerBox"),this._playerBoxText=new a({parent:c,text:"Change",color:"gray"}).shrinkwrap().align("center","bottom",0,-4),this._darknessHeader=new a({parent:i,text:"Lights",x:8,y:40});var p=this._darknessSlider=new s({parent:i,x:64,y:40,width:64,height:8});p.on("change",this,"_onDarknessChange"),this._colorHeader=new a({parent:i,text:"Background",x:8,y:56}),this._color=new r({parent:i,x:96,y:56,width:8,height:8}).on("inputStart",this,"_onOpenColorPicker");var g=this._sizeHeader=new a({parent:this,text:"Size",x:8,y:72}).shrinkwrap();this._small=new a({parent:this,text:"(S)",acceptInputEvents:!0,x:g.right+8,y:g.y}).shrinkwrap().on("inputStart",this,"_onSize"),this._small.size="small",this._medium=new a({parent:this,text:"(M)",acceptInputEvents:!0,x:this._small.right+8,y:g.y}).shrinkwrap().on("inputStart",this,"_onSize"),this._medium.size="medium",this._large=new a({parent:this,text:"(L)",acceptInputEvents:!0,x:this._medium.right+8,y:g.y}).shrinkwrap().on("inputStart",this,"_onSize"),this._large.size="large";var m=this._analyze=new a({parent:i,text:"Analyze",acceptInputEvents:!0,x:8,y:88});m.shrinkwrap(),m.on("inputStart",this,"_onAnalyze");var f=new a({parent:i,text:"-",color:"gray",x:m.right+8,y:m.y}).shrinkwrap(),v=this._share=new a({parent:i,text:"Share",acceptInputEvents:!0,x:f.right+8,y:m.y});v.shrinkwrap(),v.on("inputStart",this,"_onShare");var y=this._save=new a({parent:i,text:"Save",acceptInputEvents:!0,y:104});y.shrinkwrap(),y.align("center"),y.on("inputStart",this,"_onSave"),this._tweet=new a({parent:i,text:"Tweet a screenshot",acceptInputEvents:!0,color:"blue",x:8,y:104}).on("inputStart",this,"_onTweet")},reset:function(e,t){if(e)var i=this.game={name:t.name,developer:h.data.developer,player:!0,playerPrefab:t.playerPrefab,backgroundColor:[89,125,206],clicks:null,darkness:0,price:null,rating:null,sales:null,time:null,views:null,tiles:u.getSmall()};else var i=this.game=h.getEditGame();this.updateGameName(i.name),this.updateGamePlayer(i.playerPrefab),h.getDeveloperFlag("backgroundColor")?(this._colorHeader.color="silver",this._color.visible=!0,this._color.setColor(i.backgroundColor)):(this._colorHeader.color="gray",this._color.visible=!1),h.getDeveloperFlag("darkness")?(this._darknessHeader.color="silver",this._darknessSlider.visible=!0,this._darknessSlider.value=i.darkness):(this._darknessHeader.color="gray",this._darknessSlider.visible=!1);var n=i.tiles.length,a=u.getKeyByHeight(n);this.updateSize(e,a),e?(this._analyze.color="gray",this._share.color="gray"):(this._analyze.color=h.getDeveloperFlag("marketAnalysis")?"white":"gray",this._share.color=Boolean(window.nw)?"white":"gray"),this._save.visible=e,this._tweet.visible=!e&&Boolean(window.nw)},updateGamePlayer:function(e){this._avatar&&this._avatar.dispose();var t=this._avatar=l.create(e,{parent:this._playerBox,flipX:!0});t.align("center"),t.attach()},updateGameName:function(e){this._name.text=e,e?this._save.color="white":this._save.color="gray"},updateBackgroundColor:function(e){this._color.setColor(e)},updateSize:function(e,t){e?(this._sizeHeader.color="silver",this._small.color="silver",this._medium.color=h.getDeveloperFlag("sizeMedium")?"silver":"gray",this._large.color=h.getDeveloperFlag("sizeLarge")?"silver":"gray",this["_"+t].color="white"):(this._sizeHeader.color="gray",this._small.color="gray",this._medium.color="gray",this._large.color="gray",this["_"+t].color="silver")},_onClose:function(){this.fire("close")},_onName:function(){this.fire("openName")},_onPlayerBox:function(){this.fire("openPlayer")},_onDarknessChange:function(e,t){this.fire("darkness",[e,t])},_onOpenColorPicker:function(){this.fire("openColorPicker")},_onSize:function(e){this.fire("size",[e.target.size])},_onSave:function(){this.fire("save")},_onAnalyze:function(){this.fire("openAnalyze")},_onShare:function(){this.fire("share")},_onTweet:function(){this.fire("tweet")}}),t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:o.getColor("silver"),width:210,height:122}}),n("js/view/ColorPicker",["require","exports","module","djinn/view/View","djinn/utils/string","./Typer","./Slider","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/string"),s=e("./Typer"),r=e("./Slider"),o=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=new n({parent:this,backgroundColor:o.getColor("black"),acceptInputEvents:!0,width:this.width-4,height:this.height-4}).align("center","center");new s({parent:i,text:"Color Picker",color:"silver",y:2}).shrinkwrap().align("center");var l=new s({parent:i,text:"X",acceptInputEvents:!0,color:"white"}).shrinkwrap().align("right","top",-2,2);l.on("inputPress",this,"_onClose");for(var h=["red","green","blue"],u=2,d=0,c=h.length;c>d;++d){var p=h[d],g=a.ucfirst(p);new s({parent:i,text:g,color:p,x:8,y:8*u});var p=this["_"+p]=new r({parent:i,x:56,y:8*u+1,width:64,height:8});p.on("change",this,"_onChange"+g),u+=2}},setColor:function(e){this._rgb=e,this.backgroundColor=o.fromRGBArray(e),this._red.value=e[0]/255,this._green.value=e[1]/255,this._blue.value=e[2]/255},_setRGB:function(e,t,i){if(t!==i){var n=this._rgb;n[e]=Math.round(255*t),this.setColor(n),this.fire("change",[n])}},_onChangeRed:function(e,t){this._setRGB(0,e,t)},_onChangeGreen:function(e,t){this._setRGB(1,e,t)},_onChangeBlue:function(e,t){this._setRGB(2,e,t)},_onClose:function(){this.fire("close")}});t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,width:132,height:68}}),n("js/view/Confirmation",["require","exports","module","djinn/view/View","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Typer"),s=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=this.width-2,r=this.height-2,o=this._background=new n({parent:this,acceptInputEvents:!0,backgroundColor:s.getColor("red"),width:i,height:r}).align("center","center"),l=this._header=new a({parent:o,color:"white",anchorX:.5});l.align("center","top",0,4);var h=this._confirmButton=new a({parent:o,text:"Yes",acceptInputEvents:!0,color:"white"});h.on("inputStart",this,"_onConfirm"),this.setConfirmButton("Yes");var u=new a({parent:o,text:"Cancel",acceptInputEvents:!0,color:"white"});u.shrinkwrap(),u.align("right","bottom",-8,-4),u.on("inputStart",this,"_onCancel")},setBackgroundColor:function(e){this._background.backgroundColor=s.getColor(e)},setHeader:function(e){this._header.text=e,this._header.shrinkwrap()},setContentConf:function(e){this._content&&this._content.dispose(),e&&(this._content=new n(merge({parent:this._background,width:16,height:16},e)).align("center","center"))},setContentText:function(e){this._content&&this._content.dispose(),e&&(this._content=new a({parent:this._background,text:e,color:"white"}).shrinkwrap().align("center","center"))},setConfirmButton:function(e){var t=this._confirmButton;t.text=e,t.shrinkwrap(),t.align("left","bottom",8,-4)},_onConfirm:function(){this.fire("confirm")},_onCancel:function(){this.fire("cancel")}});t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:s.getColor("white"),width:160,height:64}}),n("js/view/Tile",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults));var i=e.tile;if(0!==i){var n=8,a=i%n,s=Math.floor(i/n);this.imageX=16*a,this.imageY=16*s}}}),t.defaults={width:16,height:16}}),n("js/view/Grid",["require","exports","module","djinn/view/View","./Tile","./avatarFactory","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Tile"),s=e("./avatarFactory"),r=e("./style");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),this.type=e.type,this.cursor=new n({parent:this,image:"media/images/ui.png",width:16,height:16,z:10})},reset:function(){for(var e in this.grid)this.grid[e].dispose();this.grid={}},setCursor:function(e){var t=this.cursor,i=this.grid,n=i[e];n?(t.centerOn(n),t.visible=!0):t.visible=!1;var i=this.grid;for(var a in i)n=i[a],a==e?(n.opacity=1,n.select&&n.select()):n.opacity=.4},setObjects:function(e){for(var t=0,i=0,n=0,r=e.length;r>n;++n){var o=e[n];if("entity"===this.type)var l=s.create(o,{parent:this,x:t,y:i});else if("tile"===this.type)var l=new a({parent:this,image:"media/images/env.png",tile:o,x:t,y:i});l.acceptInputEvents=!0,l.key=o,l.on("inputPress",this,"_onAvatarPress"),l.showGrid&&l.showGrid(),this.grid[o]=l,t+=16,t+16>this.width&&(t=0,i+=16)}this.sortChildren()},_onAvatarPress:function(e){var t=e.target.key;this.setCursor(t),this.fire("select",[t])}}),t.defaults={acceptInputEvents:!0,backgroundColor:r.getColor("black")}}),n("js/view/PlayerPicker",["require","exports","module","djinn/view/View","../gameData","./Typer","./Grid","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("../gameData"),s=e("./Typer"),r=e("./Grid"),o=e("./style");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults));var i=new n({parent:this,backgroundColor:o.getColor("black"),acceptInputEvents:!0,width:this.width-2,height:this.height-2}).align("center","center"),a=this._playerGrid=new r({parent:i,type:"entity",backgroundColor:null,width:48,height:48});a.align("center","center"),a.on("select",this,"_onPlayerGridSelect");var l=new s({parent:i,acceptInputEvents:!0,text:"X",width:8}).align("right","top",-1,1);l.on("inputPress",this,"_onClose")},reset:function(e){var t=this._playerGrid;t.reset();var i=["playerDog"];a.getDeveloperFlag("playerBoy")&&i.push("playerBoy"),a.getDeveloperFlag("playerGirl")&&i.push("playerGirl"),a.getDeveloperFlag("playerChicken")&&i.push("playerChicken"),a.getDeveloperFlag("playerXam")&&i.push("playerXam"),a.getDeveloperFlag("playerBird")&&i.push("playerBird"),a.getDeveloperFlag("playerZombie")&&i.push("playerZombie"),a.getDeveloperFlag("playerRaga")&&i.push("playerRaga"),a.getDeveloperFlag("playerFranklin")&&i.push("playerFranklin"),a.getDeveloperFlag("playerTiger")&&i.push("playerTiger"),a.getDeveloperFlag("playerShip")&&i.push("playerShip"),a.getDeveloperFlag("playerShipYellow")&&i.push("playerShipYellow"),t.setObjects(i),t.setCursor(e)},_onPlayerGridSelect:function(e){this.fire("select",[e])},_onClose:function(){this.fire("close")}}),t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:o.getColor("white"),width:68,height:68}}),n("js/view/scenes/DevScene",["require","exports","module","djinn/view/View","djinn/view/Sprite","djinn/audio/jukebox","djinn/input/keyboard","djinn/sim/shared/position","./Scene","../../sim/Level","../../gameData","../GameListItem","../Menu","../Dialog","../Typer","../TextBox","../GameSettings","../ColorPicker","../Scrollbar","../Confirmation","../PlayerPicker","../Titan","../style"],function(e,t,i){var n=e("djinn/view/View"),a=(e("djinn/view/Sprite"),e("djinn/audio/jukebox")),s=(e("djinn/input/keyboard"),e("djinn/sim/shared/position"),e("./Scene")),r=(e("../../sim/Level"),e("../../gameData")),o=e("../GameListItem"),l=(e("../Menu"),e("../Dialog"),e("../Typer")),h=e("../TextBox"),u=e("../GameSettings"),d=e("../ColorPicker"),c=e("../Scrollbar"),p=e("../Confirmation"),g=e("../PlayerPicker"),m=e("../Titan"),f=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),this.addQuitX();var e=0;e+=8,new l({parent:this,text:"Djinn Game Editor",x:8,y:e}),e+=8,new l({parent:this,text:"--------------------------------",y:e}),e+=16;var t=this._newGameButton=new n({parent:this,acceptInputEvents:!0,image:"media/images/ui.png",imageY:48,x:8,y:e-6,width:54,height:14});t.on("inputStart",this,"_onNew"),this._newGameText=new l({parent:t,text:"New",acceptInputEvents:!0}).shrinkwrap().align("center","center"),e+=16,this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:48,width:240,height:88}),this._container=new n({parent:this._window,acceptInputEvents:!0});var i=this._scrollbar=new c({parent:this._window,barColor:f.getColor("qbBlue"),width:8}).align("right");i.attach(this._container);var a=this._gameSettings=new u({parent:this}).align("center","center");a.on("close",this,"_onGameSettingsClose"),a.on("darkness",this,"_onGameSettingsDarkness"),a.on("openColorPicker",this,"_onOpenColorPicker"),a.on("openName",this,"_onOpenName"),a.on("openPlayer",this,"_onOpenPlayer"),a.on("size",this,"_onGameSettingsSize"),a.on("save",this,"_onGameSettingsSave");var s=this._gameName=new h({parent:this,maxLength:12}).align("center","center");s.on("done",this,"_onGameNameDone"),s.on("close",this,"_onGameNameClose");var r=this._gamePlayer=new g({parent:this}).align("center","center");r.on("select",this,"_onGamePlayerSelect"),r.on("close",this,"_onGamePlayerClose");var o=this._colorPicker=new d({parent:this}).align("center","center");o.on("change",this,"_onColorChange"),o.on("close",this,"_onColorPickerClose");var m=this._confirmation=new p({parent:this}).align("center","center");m.on("confirm",this,"_onConfirmDelete"),m.on("cancel",this,"_onConfirmCancel"),m.setHeader("Really delete?"),m.setConfirmButton("DELETE!"),this.sortChildren()},reset:function(){this._super(),this._titan&&this._titan.dispose(),this._titan=null,this._gameSettings.hide(),this._gameName.hide(),this._gamePlayer.hide(),this._colorPicker.hide(),this._confirmation.hide(),this._updateMakeNewGame();var e=this._container;e.disposeChildren();for(var t=r.getGamesByDeveloper(r.data.developer),i=0,n=0,a=t.length;a>n;++n){var s=new o({parent:e,y:i});s.on("selectGame",this,"_onSelectGame");var l=t[n];s.setGame(l),l.published?s.addLabel("Published"):l.tested?s.addLabel("Ready to publish","green"):s.addLabel("Untested","red"),s.addDeleteButton(),s.on("deleteGame",this,"_onDeleteGame"),s.gameIndex=l.gameIndex,i+=s.height+8}e.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&(this._confirmation.visible?this._onConfirmCancel():this._colorPicker.visible?this._onColorPickerClose():this._gameName.visible?this._onGameNameClose():this._gamePlayer.visible?this._onGamePlayerClose():this._gameSettings.visible?this._onGameSettingsClose():this._onQuit()),this._gameName.visible||(this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e)))},_onNew:function(){if(!r.getDeveloperFlag("doubtKey")){var e=r.getPublishedGamesByDeveloper(r.data.developer);if(e.length>0)return a.play("doubt",0),void(this._titan?this._titan.advance():this._titan=new m({parent:this}).on("done",this,"_onDoubt"))}r.canMakeNewGame()?(a.play("open",0),this._name="",this._playerPrefab="playerDog",this._backgroundColor=[89,125,206],this._darkness=0,this._size="small",this._gameSettings.reset(!0,{name:this._name,playerPrefab:this._playerPrefab}),this._gameSettings.show(),this._gameName.reset(this._name),this._gameName.show()):a.play("negate",0)},_onDoubt:function(){this.captureInputEvents=!1,this.fireSceneEvent("doubt")},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")},_onGameSettingsClose:function(){a.play("close",0),this._gameSettings.hide(),this._gameName.hide()},_onGameSettingsDarkness:function(e,t){if(e>t)a.play("backspace1",0);else{if(!(t>e))return;a.play("type1",0)}this._darkness=e},_onOpenName:function(){a.play("open",0),this._gameName.reset(this._name),this._gameName.show()},_onOpenPlayer:function(){a.play("open",0),this._gamePlayer.reset(this._playerPrefab),this._gamePlayer.show()},_onOpenColorPicker:function(){a.play("open",0),this._colorPicker.setColor(this._backgroundColor),this._colorPicker.show()},_onGameSettingsSize:function(e){return("medium"!==e||r.getDeveloperFlag("sizeMedium"))&&("large"!==e||r.getDeveloperFlag("sizeLarge"))?(a.play("select",0),this._size=e,void this._gameSettings.updateSize(!0,e)):void a.play("negate",0)},_onGameSettingsSave:function(){if(!this._name)return void a.play("negate",0);a.play("create",0);var e=r.data.developer,t=r.makeGame(e,{name:this._name,playerPrefab:this._playerPrefab,backgroundColor:this._backgroundColor,darkness:this._darkness},this._size);r.data.editGameIndex=t,this.captureInputEvents=!1,this.fireSceneEvent("edit")},_onGameNameDone:function(e){a.play("create",0),this._name=e,this._gameSettings.updateGameName(e),this._gameName.hide()},_onGameNameClose:function(){a.play("close",0),this._gameName.hide(),""===this._name&&this._gameSettings.hide()},_onGamePlayerSelect:function(e){a.play("select",0),this._playerPrefab=e,this._gameSettings.updateGamePlayer(e)},_onGamePlayerClose:function(){a.play("close",0),this._gamePlayer.hide()},_onColorChange:function(e){a.play("select",0),this._backgroundColor=e,this._gameSettings.updateBackgroundColor(e)},_onSelectGame:function(e){a.play("select",0),r.data.editGameIndex=e,this.captureInputEvents=!1,this.fireSceneEvent("edit")},_onDeleteGame:function(e){a.play("negate",0),this._removeGameIndex=e,this._confirmation.show()},_onConfirmDelete:function(){a.play("remove",0),r.removeGame(this._removeGameIndex),this._confirmation.hide(),this.reset()},_onConfirmCancel:function(){a.play("close",0),this._confirmation.hide()},_onColorPickerClose:function(){a.play("close",0),this._colorPicker.hide()},_updateMakeNewGame:function(){r.canMakeNewGame()?r.developerHasGameReadyToPublish()?(this._newGameButton.imageX=0,this._newGameButton.imageY=48,this._newGameText.color="white"):(this._newGameButton.imageX=0,this._newGameButton.imageY=62,this._newGameText.color="white"):(this._newGameButton.imageX=54,this._newGameButton.imageY=34,this._newGameText.color="black")}});t.defaults={backgroundColor:f.getColor("qbBlue"),musicKey:"holdPlease"}}),n("js/view/scenes/DevelopersScene",["require","exports","module","djinn/view/View","djinn/math/core","djinn/utils/string","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../BackButton","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/core"),s=e("djinn/utils/string"),r=e("djinn/audio/jukebox"),o=e("./Scene"),l=e("../../gameData"),h=e("../Typer"),u=e("../BackButton"),d=e("../style"),t=i.exports=o.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new u({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),new h({parent:this,text:"Welcome to Vaultworks",x:24,y:8}),new h({parent:this,text:"Game publishing tools",color:"silver",x:24,y:16}),new h({parent:this,text:"---------------------------",x:8,y:24}),this._container=new n({parent:this,acceptInputEvents:!0,y:16}),this.sortChildren()},reset:function(){this._super();var e=this._container;e.disposeChildren();var t=a.round(l.data.developers[l.data.developer].money,2);new h({parent:e,text:"Money: $"+s.formatMoney(t),color:"silver",x:8,y:24});new h({parent:e,text:"- Analytics",acceptInputEvents:!0,x:8,y:40}).on("inputPress",this,"_onPublishedGames");if(l.developerHasGameReadyToPublish())var i="gold";else var i="silver";new h({parent:e,text:"- Publish new game",acceptInputEvents:!0,color:i,x:8,y:56}).on("inputPress",this,"_onPublish")},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&this._onQuit()},_onPublishedGames:function(){r.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("publishedGames")},_onPublish:function(){r.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("unpublishedGames")},_onQuit:function(){r.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")}});t.defaults={backgroundColor:d.getColor("marketBG"),musicKey:"streets"}}),n("djinn/utils/Pattern",["require","exports","module","djinn/view/View","djinn/stage"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/stage"),t=i.exports=n.extend({init:function(e){this._super(e),this._bufferDirty=!0,this._width=this.width,this._height=this.height,this._tileView=new n(merge({parent:this},e.tileConf)),this._buffer=a.createBuffer(this.width,this.height)},render:function(e){this._bufferDirty&&this._renderBuffer(),e.drawImage(this._buffer,this.imageX,this.imageY,this.width,this.height,0,0,this.width,this.height)},_renderBuffer:function(){(this.width!=this._buffer.width||this.height!=this._buffer.height)&&(this._buffer.width=this.width,this._buffer.height=this.height);var e=this._tileView;if(e._image&&e._image.ready){for(var t=this._buffer.getContext("2d"),i=Math.ceil(this._buffer.width/e.width),n=Math.ceil(this._buffer.height/e.height),a=0;n>a;++a)for(var s=0;i>s;++s)t.drawImage(e._image,e.imageX,e.imageY,e.width,e.height,s*e.width,a*e.height,e.width,e.height);this._bufferDirty=!1}}});Object.defineProperty(t.prototype,"width",{set:function(e){this._width=Number(e),this._bufferDirty=!0},get:function(){return this._width}}),Object.defineProperty(t.prototype,"height",{set:function(e){this._height=Number(e),this._bufferDirty=!0},get:function(){return this._height}})}),n("js/view/Field",["require","exports","module","djinn/view/View","djinn/utils/Pattern","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/Pattern"),s=e("./style"),t=i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),this.roll1=new a({parent:this,tileConf:{image:"media/images/doubt.png",width:16,height:16},width:2*this.width,height:16}),this.roll1.right=this.width,this.roll2=new a({parent:this,tileConf:{image:"media/images/doubt.png",imageY:16,width:16,height:16},width:2*this.width,height:16,y:16}),this.roll2.right=this.width,this.roll3=new a({parent:this,tileConf:{image:"media/images/doubt.png",imageY:32,width:16,height:16},width:2*this.width,height:16,y:32}),this.roll3.right=this.width,new n({parent:this,backgroundColor:"rgb(34, 32, 68)",y:48}),this.roll4=new a({parent:this,tileConf:{image:"media/images/doubt.png",imageY:48,width:16,height:16},width:2*this.width,height:16,y:32}).align("right","bottom")},tick:function(e){var t=e/1e3;this.roll1.x+=20*t,this.roll1.x>0&&(this.roll1.right=this.width),this.roll2.x+=40*t,this.roll2.x>0&&(this.roll2.right=this.width),this.roll3.x+=80*t,this.roll3.x>0&&(this.roll3.right=this.width),this.roll4.x+=160*t,this.roll4.x>0&&(this.roll4.right=this.width)}});t.defaults={backgroundColor:s.getColor("teal")}}),n("djinn/utils/Color",["require","exports","module","../Class","../math/random","./string"],function(e,t,i){var n=e("../Class"),a=e("../math/random"),s=e("./string"),r=/rgba\(([0-9]+),\s?([0-9]+),\s?([0-9]+),\s?([0-9\.]+)\)/,t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a},clone:function(){return t.create(this.r,this.g,this.b,this.a)},toRGB:function(){return s.sprintf("rgb(%s, %s, %s)",this.r,this.g,this.b)},toRGBA:function(e){var e=void 0!==e?e:this.a;return s.sprintf("rgba(%s, %s, %s, %s)",this.r,this.g,this.b,e)},darken:function(e){var e=1-e;return this.r=Math.floor(this.r*e),this.g=Math.floor(this.g*e),this.b=Math.floor(this.b*e),this},lighten:function(e){return this.r+=Math.floor((255-this.r)*e),this.g+=Math.floor((255-this.g)*e),this.b+=Math.floor((255-this.b)*e),this}});t.create=function(e,i,n,a){return new t({r:e,g:i,b:n,a:void 0===a?1:a})},t.fromRGBA=function(e){var i=e.match(r);return i&&5===i.length?t.create(Number(i[1]),Number(i[2]),Number(i[3]),Number(i[4])):(console.warn("[Color] Failed to parse RGBA string: "+e),null)},t.random=function(e){return t.create(a.integer(255),a.integer(255),a.integer(255),e)},t.defaults={r:0,g:0,b:0,a:1}}),n("djinn/utils/gradient",["djinn/stage","djinn/utils/Color"],function(e,t){var i={},n=function(n,a,s,r){var o=2*a,l=e.createBuffer(o,o),h=l.getContext("2d");i[n]=l;var u=t.fromRGBA(s),d=h.createRadialGradient(a,a,r,a,a,a);return d.addColorStop(0,u.toRGBA()),d.addColorStop(1,u.toRGBA(0)),h.fillStyle=d,h.fillRect(0,0,o,o),l},a=function(e,t,a){var a=a||0,s=[e,t,a].join("-");return i[s]?i[s]:n(s,e,t,a)};return{drawRadial:function(e,t,i,n,s,r){var o=a(n,s,r);e.drawImage(o,0,0,o.width,o.height,t-n,i-n,o.width,o.height)}}}),n("js/view/Darkness",["require","exports","module","djinn/view/View","djinn/math/core","djinn/utils/gradient","djinn/stage","djinn/sim/shared/position","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/core"),s=e("djinn/utils/gradient"),r=e("djinn/stage"),o=e("djinn/sim/shared/position"),l=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this._buffer=r.createBuffer(this.width,this.height)},render:function(e){var t=this._buffer,i=t.getContext("2d"),n=this.width,r=this.height;i.globalCompositeOperation="source-over",i.clearRect(0,0,t.width,t.height),i.drawImage(this._image,0,this.imageY,n,r,0,0,n,r);var h=this.level;h&&(i.globalCompositeOperation="destination-out",h.entities.forEach(bind(this,function(e){var t=e.light;if(t){var u=h.camera,d=a.clamp(u.x-this.width/2,0,h.width-this.width),c=a.clamp(u.y-this.height/2,0,h.height-this.height),p=o.getCenter(e),g=t.radius,m=p.x-d,f=p.y-c;t.intensity<=0||-g>m||m>n+g||-g>f||f>r+g||s.drawRadial(i,m,f,g,l.getColor("black",t.intensity),~~(t.radius/10))}}))),e.globalAlpha=this.opacity,e.drawImage(t,0,0,t.width,t.height,0,0,n,r)}});t.defaults={compositeOperation:"darken",image:"media/images/darkness.png",width:256,height:144}}),n("js/view/Reward",["require","exports","module","djinn/view/View","./Typer","./avatarFactory","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Typer"),s=e("./avatarFactory"),r=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=this.width-2,s=this.height-2,o=this._background=new n({parent:this,acceptInputEvents:!0,backgroundColor:r.getColor("gold"),width:i,height:s}).align("center","center"),l=this._header=new a({
parent:o,color:"black",anchorX:.5});l.align("center","top",0,4);var h=new a({parent:o,text:"OK",color:"black"});h.shrinkwrap(),h.align("center","bottom",0,-4),this.on("inputStart",this,"_onOK")},setHeader:function(e){this._header.text=e,this._header.shrinkwrap()},setContentAvatar:function(e){this._content&&this._content.dispose(),e&&(this._content=s.create(e,{parent:this._background}).align("center","center"))},setContentText:function(e){this._content&&this._content.dispose(),e&&(this._content=new a({parent:this._background,text:e,color:"black"}).shrinkwrap().align("center","center"))},setContentConf:function(e){this._content&&this._content.dispose(),e&&(this._content=new n(merge({parent:this._background,width:16,height:16},e)).align("center","center"))},_onOK:function(){this.fire("ok")}});t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:r.getColor("white"),width:144,height:64}}),n("js/doubt",["require","exports","module"],function(e,t,i){t.hello={text:["Hello.","Do you know who I am?"],choices:[{text:"No ...",key:"hello1"},{text:"I think so.",key:"hello2"}]},t.hello1={text:["You will. You're just one","person out of billions, but","you think you're special ..."],choices:[{text:"No I don't.",key:"intro"},{text:"I am. We all are.",key:"intro"}]},t.hello2={text:["YOU KNOW NOTHING!","You think you're so smart, but","you're in for a rude awakening"],choices:[{text:"Leave me alone.",key:"intro"},{text:"I'm ready!",key:"intro"}]},t.intro={text:["So, want to make your own","games, huh? Aren't you afraid","you'll fail?"],choices:[{text:"Kind of ...",key:"intro1"},{text:"I can do it.",key:"intro2"}]},t.intro1={text:["You should be. The odds are","against you making anything","anyone would want to play."],choices:[{text:"You're scaring me ...",key:"intro1A"},{text:"I don't care.",key:"intro2"}]},t.intro1A={text:["You scare easily. I have a","gift for you that I feel is","appropriate. Good luck. Ha!"],unlock:{flag:"playerChicken"}},t.intro2={text:["Your naivety is noble, like a","gladiator sent to die in","battle. Enjoy your gift, fool."],unlock:{flag:"playerXam"}},t.medium={text:["At it again, are we? Pathetic.","Your last game was terrible.","Why make another?"],choices:[{text:"Fine, I won't.",key:"medium1"},{text:"Because I want to.",key:"medium2"}]},t.medium1={text:["Good. The world is filled with","enough mediocrity as it is.","Stop creating and be a zombie."],unlock:{flag:"playerZombie"}},t.medium2={text:["That's not a good reason. Stop","being selfish and get back to","real work. Benefit society FFS"],unlock:{flag:"playerRaga"}},t.large={text:["So now you can make large","games. I'm looking forward to","your LARGE disaster. Hah!"],choices:[{text:"It'll be OK ...",key:"large1"},{text:"I'm going to rock it!",key:"large2"}]},t.large1={text:["Heh, sure it will ... I have","for you an old, pixelated","loser. You two should relate."],unlock:{flag:"playerFranklin"}},t.large2={text:["While you're kidding yourself,","here's a tiger, because you","don't know what you're doing."],unlock:{flag:"playerTiger"}},t.ending={text:["Well ...","You've done it.","Congratulations."],choices:[{text:"Thanks.",key:"ending2"},{text:"Shut up.",key:"ending2"}]},t.ending2={text:["Do you know who I am now?"],choices:[{text:"Yeah ...",key:"ending3"},{text:"I always knew.",key:"ending3"}]},t.ending3={text:["It doesn't matter anyway;","you've beaten me. But you've","won the battle, not the war."],choices:[{text:"Leave me alone!",key:"ending3A"},{text:"I'll be ready.",key:"ending3B"}]},t.ending3A={text:["You are weak.","Enjoy your temporary victory,","and this, my final gift."],unlock:{editEntity:"boss"}},t.ending3B={text:["Damn you. Does nothing weaken","your resolve?? You might just","make it ... Good luck, fool."],unlock:{editEntity:"boss"}}}),n("js/view/scenes/DoubtScene",["require","exports","module","djinn/view/View","djinn/view/Sprite","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../Field","../Darkness","../Dialog","../Reward","../style","../../doubt"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/view/Sprite"),s=e("djinn/audio/jukebox"),r=e("./Scene"),o=e("../../gameData"),l=e("../Typer"),h=e("../Field"),u=e("../Darkness"),d=e("../Dialog"),c=e("../Reward"),p=e("../style"),g=e("../../doubt"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new h({parent:this}),new u({parent:this,opacity:.5});var e=this._titan=new a({parent:this,animations:{idle:{frameRate:2,frames:[[0,32],[16,32]]}},image:"media/images/actors.png",imageSmoothingEnabled:!1,scale:4,width:16,height:16});e.align("center","center",0,-40),e.playAnimation("idle"),this._container=new n({parent:this,acceptInputEvents:!0,x:8,y:64,width:240,height:72}),this._reward=new c({parent:this,backgroundColor:p.getColor("black")}).align("center","center"),this._reward.on("ok",this,"_onRewardOK"),this.on("inputStart",this,"_onInputStart"),this.sortChildren()},reset:function(){var e=this._container;e.disposeChildren(),this.doubtKey=o.getDeveloperFlag("doubtKey","hello"),this._reward.hide(),this.mouse.hide(),this.doubtIndex=0,this._y=0},advanceDialog:function(){var e=g[this.doubtKey],t=e.text;if(this.doubtIndex>=t.length)return void this.finishText();var i=this._container,n=new d({parent:i,y:this._y});n.animate(t[this.doubtIndex]),n.on("done",this,"advanceDialog"),this._y+=8,this.doubtIndex+=1},finishText:function(){var e=g[this.doubtKey];e.choices?this.showChoices():e.unlock&&this.delayTween(250,bind(this,function(){this.captureInputEvents=!0,this.mouse.show()}))},showChoices:function(){var e=this._container,t=g[this.doubtKey];this.delayTween(1e3,bind(this,function(){s.play("error",0),this._y+=8;var i=t.choices[0],n=new l({parent:e,acceptInputEvents:!0,text:"- "+i.text,y:this._y});n.sound="choice1",n.key=i.key,n.on("inputStart",this,"_onChoiceSelect"),this._y+=16;var a=t.choices[1],r=new l({parent:e,acceptInputEvents:!0,text:"- "+a.text,y:this._y});r.sound="choice2",r.key=a.key,r.on("inputStart",this,"_onChoiceSelect"),this.captureInputEvents=!0,this.mouse.show()}))},showReward:function(){s.play("increase",0);var e=g[this.doubtKey],t=this._reward,i=e.unlock;i.flag?(t.setHeader("New Player"),t.setContentAvatar(e.unlock.flag)):(t.setHeader("BOSS UNLOCK!"),t.setContentAvatar(e.unlock.editEntity),o.addDeveloperEditEntity(e.unlock.editEntity)),t.show(),o.setDeveloperFlag(e.unlock.flag,!0)},activate:function(e,t){this.oldSceneId;this._super(e,t),this.captureInputEvents=!1,this.delayTween(500,bind(this,function(){this.advanceDialog()}))},tick:function(e){this.captureInputEvents&&(this.getInput("action",!0)||this.getInput("negate",!0))&&this._onInputStart()},_onChoiceSelect:function(e){var t=e.target;s.play(t.sound,0),this.captureInputEvents=!1,o.setDeveloperFlag("doubtKey",t.key),this.reset(),this.advanceDialog()},_onInputStart:function(){if(this.captureInputEvents){var e=g[this.doubtKey];e.unlock&&!this._reward.visible&&this.showReward()}},_onRewardOK:function(){s.play("done",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)},_onQuit:function(){s.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)}});t.defaults={backgroundColor:p.getColor("maroon")}}),n("djinn/view/Pawn",["require","exports","module","./View"],function(e,t,i){var n=e("./View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},attachEntity:function(e){this.entity=e,this.sync()},detachEntity:function(){this.entity=null},attachAvatar:function(e){this.avatar=e,this.addChild(e),this.alignAvatar()},alignAvatar:function(){this.avatar.align("center","center")},despawn:function(){this.dispose()},sync:function(){var e=this.entity;if(e){var t=e.size,i=e.position,n=this.avatar;this.x=Math.round(i.x),this.y=Math.round(i.y),void 0===i.z?(this.z=this.y,n?this.z+=n.y+n.height:this.z+=this.height):this.z+=i.z,this.width=t.width,this.height=t.height}},tick:function(e){this.sync()}});t.defaults={tag:"Pawn",width:32,height:32}}),n("djinn/view/TileMapRenderer",["require","exports","module","./View","../math/core","./utils/canvas","../utils/array","../assets"],function(e,t,i){var n=e("./View"),a=e("../math/core"),s=e("./utils/canvas"),r=e("../utils/array"),o=e("../assets"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this._tileMap=null,this.tileImage=e.tileImage,this._highlights=[],this._highlightRadians=0,this.highlightColor=e.highlightColor,this.highlightPulseSpeed=e.highlightPulseSpeed},attach:function(e){this._tileMap=e},detach:function(){this._tileMap=null},setOffset:function(e,t){var i=this._tileMap;if(i){var n=Math.max(i.unitWidth-this.width,0),s=Math.max(i.unitHeight-this.height,0);this.offsetX=a.clamp(e,0,n),this.offsetY=a.clamp(t,0,s)}},scroll:function(e,t){this.setOffset(this.offsetX+e,this.offsetY+t)},addHighlight:function(e,t){var i=this._tileMap.xyToIndex(e,t);this._highlights.push(i)},clearHighlights:function(){this._highlights=[]},tick:function(e){this._highlightRadians+=e*this.highlightPulseSpeed,this._highlightRadians=a.wrapRadians(this._highlightRadians);var t=.1*Math.sin(this._highlightRadians);this._highlightAlpha=.25+t},render:function(e){var t=this._tileMap,i=this._tileImage;if(t&&i){var n=o.get(i);if(n.ready)for(var a=~~this.offsetX,l=~~this.offsetY,h=t.tileWidth,u=t.tileHeight,d=~~(n.width/h),c=this._highlights,p=t.unitToTile(a,l),g={x:Math.ceil((a+this.width)/h),y:Math.ceil((l+this.height)/u)},m={x:a%h,y:l%u},f=p.y;f<=g.y;++f)for(var v=p.x;v<=g.x;++v){var y=t.get(v,f);if(void 0!==y){var w=y%d*h,_=~~(y/d)*u,x={x:(v-p.x)*h-m.x,y:(f-p.y)*u-m.y};e.drawImage(n,w,_,h,u,x.x,x.y,h,u);var b=t.xyToIndex(v,f);c.length>0&&r.contains(c,b)&&(e.globalAlpha=this._highlightAlpha,s.drawRect(e,x.x,x.y,h,u,this.highlightColor),e.globalAlpha=1)}}}}});t.defaults={offsetX:0,offsetY:0,tileImage:null,highlightColor:"white",highlightPulseSpeed:2*Math.PI/1e3};var l=t.prototype;Object.defineProperty(l,"tileImage",{set:function(e){this._tileImage=e,o.load(e)}})}),n("djinn/view/WorldRenderer",["require","exports","module","./View","./Pawn","./TileMapRenderer","../math/core"],function(e,t,i){var n=e("./View"),a=(e("./Pawn"),e("./TileMapRenderer")),s=e("../math/core"),t=i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),this.world=null,this.pawns={},this._pawnFactory=null,this._avatarFactory=null,this.mapRenderer=new a({parent:this,visible:!1}),this._pawnContainer=new n({parent:this,autoSortChildren:!0,tag:this.tag+".PawnContainer"})},attach:function(e){for(var t=e.entities.items,i=0,n=t.length;n>i;++i){var a=t[i];a&&this._onWorldEntitySpawn(a)}e.on("reset",this,"_onWorldReset"),e.on("entitySpawn",this,"_onWorldEntitySpawn"),e.on("entityDespawn",this,"_onWorldEntityDespawn"),e.map&&e.map.size>0&&(this.mapRenderer.attach(e.map),this.mapRenderer.visible=!0),this.world=e},detach:function(){var e=this.world;this.world=null,e&&e.removeListenersByContext(this),this.mapRenderer.detach(),this.clean()},clean:function(){this._pawnContainer.disposeChildren()},setPawnFactory:function(e){this._pawnFactory=e},setAvatarFactory:function(e){this._avatarFactory=e},render:function(e){this.updateCamera(),this._super(e)},updateCamera:function(){var e=this.world,t=e.camera,i=s.clamp(t.x-this.width/2,0,e.width-this.width),n=s.clamp(t.y-this.height/2,0,e.height-this.height);i=Math.round(i),n=Math.round(n),this._pawnContainer.x=-i,this._pawnContainer.y=-n,this.mapRenderer.setOffset(i,n)},_onWorldReset:function(){this.clean()},_onWorldEntitySpawn:function(e){if(!this._pawnFactory||!this._avatarFactory)return void log.warn("[WorldRenderer._onWorldEntitySpawn] Missing pawn or avatar factory");var t=this._pawnFactory.create(e.type);t.attachEntity(e);var i=this._avatarFactory.create(e.type);return t.attachAvatar(i),this._pawnContainer.addChild(t),this.pawns[e.id]=t,t.spawn&&t.spawn(e),t},_onWorldEntityDespawn:function(e){var t=this.pawns,i=t[e.id];i&&i.despawn&&i.despawn(),delete t[e.id]}});t.defaults={tag:"WorldRenderer"}}),n("js/view/pawns/Pawn",["require","exports","module","djinn/view/Pawn","djinn/audio/jukebox","../avatarFactory","../style"],function(e,t,i){var n=e("djinn/view/Pawn"),a=e("djinn/audio/jukebox"),s=e("../avatarFactory"),r=e("../style");i.exports=n.extend({alignAvatar:function(){var e=this.entity;e?e.meta.center?this._super():e.gravity&&e.gravity.value<0?this.avatar.align("center","top"):this.avatar.align("center","bottom"):this._super()},attachAvatar:function(e){this._super(e),e.attach&&e.attach();var t=this.entity;t.on("damage",this,"_onDamage"),t.on("harm",this,"_onHarm"),t.on("despawn",this,"_onDespawn"),t.on("gravityChange",this,"_onGravityChange"),t.on("stateAddTtl",this,"_onStateAddTtl"),t.on("teleported",this,"_onTeleported"),t.meta&&t.meta.trail&&this.startTail()},startTail:function(){this._trailTimer||(this._trailTimer=this.createTimer(100,"_onTrailTimer")),this._trailTimer.start()},_onTrailTimer:function(){var e=this.entity,t=e.velocity;if(!(Math.abs(t.x)<.01&&Math.abs(t.y)<.01)&&(!e.mortal||e.mortal.alive)){var i=s.create(e.type,{parent:this.parent,opacity:.5});i.centerOn(this),i.tween({opacity:0},250,null,function(){i.dispose()})}},_playSound:function(e){var t=this.entity.sounds;t&&t[e]&&a.play(t[e],0)},_onDamage:function(e,t){e>0&&(this._playSound("damage"),this._showDamage&&this._showDamage())},_onHarm:function(e,t){this._playSound("harm")},_onDespawn:function(){this._playSound("despawn")},_onGravityChange:function(e){a.play(0>e?"gravity1":"gravity2",0);var t=this.avatar;t.completeTween({flipY:0>e,overlayColor:r.getColor("white",.75)}).delayTween(500,function(){t.overlayColor=null}),this.alignAvatar()},_onTeleported:function(e){a.play("teleport",0);var t=this.avatar;t.completeTween({overlayColor:r.getColor("white",.75)}).delayTween(500,function(){t.overlayColor=null})},_onStateAddTtl:function(e){this.avatar.completeTween().tween({opacity:0},e.duration)}})}),n("js/view/pawns/Banner",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e),this.avatar.setText(this.entity.meta.text),this.avatar.setColor(this.entity.meta.color)},_onStateAddTtl:function(e){var t=this.avatar;t.completeTween().tween({opacity:0,y:t.y-4},e.duration)}})}),n("js/view/pawns/Boss",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("attack",this,"_onAttack"),t.on("move",this,"_onMove")},_onAttack:function(){this._playSound("attack"),this.avatar.attack()},_onMove:function(e){this._playSound("move")},_showDamage:function(){this.avatar.showDamage()}})}),n("js/view/pawns/Bouncer",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("launch",this,"_onLaunch")},_onLaunch:function(){this._playSound("launch"),this.avatar.launch()}})}),n("js/view/pawns/SideFacer",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({tick:function(e){this._super(e);var t=this.entity;t.facing?this.avatar.flipX=t.facing.angle<1:t.velocity&&(this.avatar.flipX=t.velocity.x>0)}})}),n("js/view/pawns/Cannon",["require","exports","module","./SideFacer"],function(e,t,i){var n=e("./SideFacer");i.exports=n.extend({attachAvatar:function(e){this._super(e),this.entity.on("attack",this,"_onAttack")},_onAttack:function(){this._playSound("attack")}})}),n("js/view/pawns/FragileRock",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({_onStateAddTtl:function(e){this._playSound("warn"),this.avatar.warn(e.duration)}})}),n("js/view/pawns/GameGoal",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e),this.entity.world.on("goal",this,"_onGoal"),this.entity.on("activeStateChange",this,"_onActiveStateChange")},_onGoal:function(){this.avatar.goal()},_onActiveStateChange:function(e){e?this.avatar.activate():this.avatar.deactivate()}})}),n("js/view/pawns/GravityRock",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("gravityEffect",this,"_onGravityEffect")},_onGravityEffect:function(){this.avatar.changeGravity()}})}),n("js/view/pawns/IntervalRock",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e),this.entity.on("toggle",this,"_onToggle")},_onToggle:function(){var e=this.entity.collision.solid;this._playSound(e?"appear":"disappear"),this.avatar.toggle(e)}})}),n("js/view/pawns/Jumper",["require","exports","module","./SideFacer"],function(e,t,i){var n=e("./SideFacer");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("warning",this,"_onWarning"),t.on("jump",this,"_onJump"),t.on("land",this,"_onLand")},_onWarning:function(){this._playSound("warning"),this.avatar.warning(this.entity.facing.angle)},_onJump:function(){this._playSound("jump"),this.avatar.jump()},_onLand:function(){this.avatar.land()},_showDamage:function(){this.avatar.showDamage()}})}),n("js/view/pawns/Player",["require","exports","module","./SideFacer"],function(e,t,i){var n=e("./SideFacer");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("action",this,"_onAction"),t.world.on("goal",this,"_onGoal"),t.on("jump",this,"_onJump")},_onAction:function(){this._playSound("action")},_onGoal:function(){this.entity.mortal.alive&&(this.avatar.stopAnimation(),this.avatar.imageX=32)},_onJump:function(){this._playSound("jump")},_showDamage:function(){this.avatar.stopAnimation(),this.avatar.imageX=48}})}),n("js/view/pawns/Pointer",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({tick:function(e){this._super(e),this.avatar.rotation=this.entity.facing.angle}})}),n("js/view/pawns/PulseBlock",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("toggle",this,"_onToggle")},_onToggle:function(){var e=this.entity.collision.solid;this._playSound(e?"pulseBlockSolid":"pulseBlock"),this.avatar.toggle(e)}})}),n("js/view/pawns/PulseButton",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("pulse",this,"_onPulse")},_onPulse:function(){this._playSound("pulse"),this.avatar.pulse()}})}),n("js/view/pawns/Survey",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;this.avatar.setJoy(t.meta.joyCount)}})}),n("js/view/pawns/Teleporter",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e);var t=this.entity;t.on("deactivate",this,"_onDeactivate"),t.on("teleport",this,"_onTeleport")},_onDeactivate:function(){this.avatar.deactivate()},_onTeleport:function(){this.avatar.teleport()}})}),n("js/view/pawns/Torch",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({attachAvatar:function(e){this._super(e),this.entity.on("lightChange",this,"_onLightChange")},_onLightChange:function(e){this.avatar.lightChange(e)}})}),n("js/view/pawns/VPlatform",["require","exports","module","./Pawn"],function(e,t,i){var n=e("./Pawn");i.exports=n.extend({tick:function(e){this._super(e);var t=this.entity;t.velocity.y>0?this.avatar.down():this.avatar.up()}})}),n("js/view/pawnFactory",["require","exports","module","djinn/utils/Factory","./pawns/Pawn","./pawns/Banner","./pawns/Boss","./pawns/Bouncer","./pawns/Cannon","./pawns/FragileRock","./pawns/GameGoal","./pawns/GravityRock","./pawns/IntervalRock","./pawns/Jumper","./pawns/Player","./pawns/Pointer","./pawns/PulseBlock","./pawns/PulseButton","./pawns/SideFacer","./pawns/Survey","./pawns/Teleporter","./pawns/Torch","./pawns/VPlatform"],function(e,t,i){var n=e("djinn/utils/Factory"),a=e("./pawns/Pawn"),s=e("./pawns/Banner"),r=e("./pawns/Boss"),o=e("./pawns/Bouncer"),l=e("./pawns/Cannon"),h=e("./pawns/FragileRock"),u=e("./pawns/GameGoal"),d=e("./pawns/GravityRock"),c=e("./pawns/IntervalRock"),p=e("./pawns/Jumper"),g=e("./pawns/Player"),m=(e("./pawns/Pointer"),e("./pawns/PulseBlock")),f=e("./pawns/PulseButton"),v=e("./pawns/SideFacer"),y=e("./pawns/Survey"),w=e("./pawns/Teleporter"),_=e("./pawns/Torch"),x=e("./pawns/VPlatform");i.exports=new n(a,{playerBenzer:g,playerBird:g,playerBoy:g,playerChicken:g,playerDog:g,playerFranklin:g,playerGirl:g,playerRaga:g,playerShip:g,playerShipYellow:g,playerTiger:g,playerXam:g,playerZombie:g,chicken:g,playerJoey:g,playerGoblin:g,banner:s,boss:r,bouncer:o,cannon:l,fragileRock:h,gameGoal:u,gravityRock:d,hPlatform:v,intervalRock:c,jumper:p,pulseBlock:m,pulseButton:f,shell:v,shellLights:v,survey:y,teleporter:w,torch:_,vPlatform:x})}),n("js/view/LevelRenderer",["require","exports","module","djinn/view/WorldRenderer","./pawnFactory","./avatarFactory"],function(e,t,i){var n=e("djinn/view/WorldRenderer"),a=e("./pawnFactory"),s=e("./avatarFactory");i.exports=n.extend({init:function(e){this._super(e),this.setPawnFactory(a),this.setAvatarFactory(s)}})}),n("js/view/EditMenu",["require","exports","module","djinn/stage","djinn/view/View","djinn/audio/jukebox","../gameData","./Typer","./Grid","./Scrollbar","./style"],function(e,t,i){var n=e("djinn/stage"),a=e("djinn/view/View"),s=e("djinn/audio/jukebox"),r=e("../gameData"),o=e("./Typer"),l=e("./Grid"),h=e("./Scrollbar"),u=e("./style");i.exports=a.extend({init:function(e){this._super(merge(e,t.defaults)),n.on("wheel",this,"_onWheel"),this._gameName=new o({parent:this,color:"silver",width:64,x:2,y:2});var i=new o({parent:this,acceptInputEvents:!0,text:"X",width:8}).align("right","top");i.on("inputPress",this,"_onHide");var s=this._tileGrid=new l({parent:this,type:"tile",x:8,y:16,width:64,height:32});s.on("select",this,"_onTileGridSelect");var r=this._entityContainer=new a({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:s.bottom+4,width:64,height:48}),d=this._entityGrid=new l({parent:r,type:"entity",width:64,height:48});d.on("select",this,"_onEntityGridSelect");var c=this._scrollbar=new h({parent:this,barColor:u.getColor("black"),x:r.x,y:r.bottom,width:r.width,height:8});c.attach(d),this._play=new o({parent:this,text:"Playtest",acceptInputEvents:!0,x:8,y:116,width:64}).on("inputPress",this,"_onPlay");var p=new o({parent:this,text:"Options",acceptInputEvents:!0,x:8,y:this._play.bottom,width:64}).on("inputPress",this,"_onSettings");new o({parent:this,text:"Quit",acceptInputEvents:!0,x:8,y:p.bottom,width:32}).on("inputPress",this,"_onQuit")},reset:function(){var e=r.getGamesList(),t=e[r.data.editGameIndex];this.updateGameName(t.name);var i=this._tileGrid;i.reset();var n=r.getDeveloper().editTiles,a=r.getDeveloper().editEntities,s=r.data;(s.editTileKey&&n.indexOf(s.editTileKey)<0||s.editEntityKey&&a.indexOf(s.editEntityKey)<0)&&(s.editTileKey=null,s.editEntityKey="gameGoal"),i.setObjects(n),i.setCursor(s.editTileKey);var o=this._entityGrid;o.reset();var l=this._entityContainer,h=l.height/16,u=Math.ceil(a.length/h);o.width=Math.max(64,16*u),o.setObjects(a),o.setCursor(s.editEntityKey),this._scrollbar.reset(),this.updateTestedState()},setTile:function(e){this._onTileGridSelect(e),this._tileGrid.setCursor(e)},setEntity:function(e){this._onEntityGridSelect(e),this._entityGrid.setCursor(e)},stopInput:function(){this._scrollbar.stopInput()},updateGameName:function(e){e.length>8?this._gameName.text=e.substr(0,3)+".."+e.substr(-3):this._gameName.text=e},updateTestedState:function(){var e=r.getGamesList(),t=e[r.data.editGameIndex];t.tested?this._play.opacity=.5:this._play.opacity=1},_onTileGridSelect:function(e){s.play("select",0),r.data.editTileKey=e,r.data.editEntityKey=null,r.save(),this._entityGrid.setCursor(null),this.stopInput(),this.fire("selectTile",[e])},_onEntityGridSelect:function(e){s.play("select",0),r.data.editTileKey=null,r.data.editEntityKey=e,r.save(),this._tileGrid.setCursor(null),this._scrollbar.stopInput(),this.fire("selectEntity",[e])},_onWheel:function(e,t){this.captureInputEvents&&this.visible&&(0>t?this._scrollbar.scroll(-1,160):this._scrollbar.scroll(1,160))},_onPlay:function(){s.play("play",0),this.fire("playtest")},_onQuit:function(){s.play("negate",0),this.fire("quit")},_onHide:function(){s.play("select",0),this.hide()},_onSettings:function(){s.play("select",0),this.stopInput(),this.fire("settings")}}),t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:u.getColor("black",.75),width:80,height:144}}),n("js/view/Minimap",["require","exports","module","djinn/view/View","djinn/math/core","../templates"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/core"),s=e("../templates"),r={medium:{imageX:64,imageY:64,width:23,height:15},large:{imageX:64,imageY:80,width:33,height:19}},t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.viewport=new n({parent:this,image:"media/images/ui.png",imageX:64,imageY:48,width:16,height:9})},setSizeByHeight:function(e){var t=s.getKeyByHeight(e);t&&this.set(r[t])},reset:function(){this.completeTween({opacity:0})},ping:function(e,t){var i=this.parent,n=t.x-i.width/2,s=t.y-i.height/2,r=this.viewport;r.x=a.clamp(Math.floor(n/16),0,this.width-r.width),r.y=a.clamp(Math.floor(s/16),0,this.height-r.height),this.completeTween({opacity:1}).tween({opacity:0},500)}});t.defaults={image:"media/images/ui.png",overlayColor:"silver"}}),n("js/view/ConfirmAnalysis",["require","exports","module","djinn/view/View","djinn/math/core","djinn/utils/string","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/core"),s=e("djinn/utils/string"),r=e("./Typer"),o=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=this.width-2,a=this.height-2,s=this._background=new n({parent:this,acceptInputEvents:!0,backgroundColor:o.getColor("black"),width:i,height:a}).align("center","center"),l=this._header=new r({parent:s,text:"Market Analysis",color:"silver",anchorX:.5});l.shrinkwrap(),l.align("center","top",0,4),this._developerMoney=new r({parent:s,color:"white",x:8,y:24}),this._cost=new r({parent:s,color:"white",x:8,y:32});var h=this._confirmButton=new r({parent:s,text:"Purchase",acceptInputEvents:!0});h.on("inputStart",this,"_onConfirm"),h.shrinkwrap(),h.align("center","bottom",0,-4);var u=new r({parent:s,acceptInputEvents:!0,text:"X",width:8});u.align("right","top",-4,4),u.on("inputPress",this,"_onClose")},setCost:function(e,t){var i=this._cost,n=t>=e;i.text="Cost:  $"+s.formatMoney(e),n?i.color="white":i.color="red",this._developerMoney.text="Funds: $"+s.formatMoney(a.round(t,2)),this._confirmButton.color=n?"white":"gray"},_onConfirm:function(){this.fire("confirm")},_onClose:function(){this.fire("cancel")}});t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:o.getColor("white"),width:176,height:64}}),n("js/view/Parallax",["require","exports","module","djinn/view/View"],function(e,t,i){var n=e("djinn/view/View"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},update:function(e,t){if(256===e.width)return void this.align("center","center");var i=t._pawnContainer,n=.5;this.x=~~(i.x*n),this.y=~~(i.y*n)}});t.defaults={image:"media/images/parallax.png",opacity:.1,width:512,height:288}}),n("js/view/Reticle",["require","exports","module","djinn/view/View","./Tile","./avatarFactory"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Tile"),s=e("./avatarFactory"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.cursor=new n({parent:this,image:"media/images/ui.png",z:99})},setEntity:function(e){this._content&&this._content.dispose(),this._content=s.create(e,{parent:this,opacity:.5}),this.sortChildren()},setTile:function(e){this._content&&this._content.dispose(),this._content=new a({parent:this,image:"media/images/env.png",opacity:.5,tile:e}),this.sortChildren()}});t.defaults={width:16,height:16}}),n("js/view/scenes/EditScene",["require","exports","module","djinn/view/View","djinn/utils/Pattern","djinn/stage","djinn/math/core","djinn/math/random","djinn/client","djinn/input/keyboard","djinn/audio/jukebox","djinn/utils/object","djinn/sim/shared/position","./Scene","../../sim/Level","../../gameData","../LevelRenderer","../Typer","../EditMenu","../TextBox","../GameSettings","../ColorPicker","../Darkness","../Minimap","../PlayerPicker","../ConfirmAnalysis","../Parallax","../Reticle","../Reward","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/Pattern"),s=e("djinn/stage"),r=e("djinn/math/core"),o=(e("djinn/math/random"),e("djinn/client"),e("djinn/input/keyboard")),l=e("djinn/audio/jukebox"),h=(e("djinn/utils/object"),e("djinn/sim/shared/position")),u=e("./Scene"),d=e("../../sim/Level"),c=e("../../gameData"),p=e("../LevelRenderer"),g=(e("../Typer"),e("../EditMenu")),m=e("../TextBox"),f=e("../GameSettings"),v=e("../ColorPicker"),y=e("../Darkness"),w=e("../Minimap"),_=e("../PlayerPicker"),x=e("../ConfirmAnalysis"),b=e("../Parallax"),k=e("../Reticle"),j=e("../Reward"),S=e("../style"),C=o.keys,I={gameStart:"Med",gameGoal:"Med",cannon:"Neg",hTrap:"Neg",jumper:"Neg",spikes:"Neg",vTrap:"Neg"},T=S.screenshotColors,D=1,t=i.exports=u.extend({init:function(e){this._super(merge(e,t.defaults)),this.timeTrackId="edit"},setup:function(){this._super(),s.on("inputEnd",this,"_onMapEnd"),this._tweetBuffer=s.createBuffer(this.width,this.height),this.parallax=new b({parent:this});var e=this.levelRenderer=new p({parent:this,acceptInputEvents:!0});e.on("inputStart",this,"_onMapStart"),e.on("inputMove",this,"_onMapMove"),e.on("inputEnd",this,"_onMapEnd"),this.darkness=new y({parent:this});var t=(this.minimap=new w({parent:this}),this.menu=new g({parent:this}));t.on("playtest",this,"_onMenuPlaytest"),t.on("settings",this,"_onMenuSettings"),t.on("inputMove",this,"_onMenuInputMove"),t.on("selectEntity",this,"_onMenuSelectEntity"),t.on("selectTile",this,"_onMenuSelectTile"),t.on("quit",this,"_onMenuQuit");var i=this._gameSettings=new f({parent:this}).align("center","center");i.on("close",this,"_onGameSettingsClose"),i.on("darkness",this,"_onGameSettingsDarkness"),i.on("openColorPicker",this,"_onOpenColorPicker"),i.on("openName",this,"_onOpenName"),i.on("openPlayer",this,"_onOpenPlayer"),i.on("openAnalyze",this,"_onOpenAnalyze"),i.on("tweet",this,"_onTweet"),i.on("share",this,"_onShare");var n=this._colorPicker=new v({parent:this}).align("center","center");n.on("change",this,"_onColorChange"),n.on("close",this,"_onColorPickerClose");var a=this._gameName=new m({parent:this,maxLength:12}).align("center","center");a.on("done",this,"_onGameNameDone"),a.on("close",this,"_onGameNameClose");var r=this._gamePlayer=new _({parent:this}).align("center","center");r.on("select",this,"_onGamePlayerSelect"),r.on("close",this,"_onGamePlayerClose");var o=this._confirmAnalysis=new x({parent:this,backgroundColor:S.getColor("white")}).align("center","center");o.on("confirm",this,"_onConfirmPurchase"),o.on("cancel",this,"_onConfirmCancel");var l=this._reward=new j({parent:this}).align("center","center");l.setHeader("Copy buffer!"),l.setContentConf({image:"media/images/actors.png",imageX:0,imageY:32}),l.on("ok",this,"_onRewardOK"),this.sortChildren()},reset:function(){this._super(),this._inputActive=!1,c.editing=!0,c.playtest=!1,this.loadGame(c.data.editGameIndex),this.menu.reset(),this._reticle.hide(),this._reward.hide(),this._gameName.hide(),this._gamePlayer.hide(),this._confirmAnalysis.hide(),this._gameSettings.hide(),this._colorPicker.hide(),this.updateCamera(),this.parallax.update(this.level,this.levelRenderer),this.grid&&this.grid.dispose(),this.grid=new a({parent:this.levelRenderer._pawnContainer,
tileConf:{image:"media/images/ui.png",imageY:80,width:16,height:16},width:this.level.width,height:this.level.height}),this.minimap.reset(),c.data.editEntityKey?this._reticle.setEntity(c.data.editEntityKey):this._reticle.setTile(c.data.editTileKey)},activate:function(e,t){this._super(e,t);var i=this.level;this.minimap.ping(i,i.camera)},loadGame:function(e,t,i){this.level&&this.level.dispose(),this._reticle&&this._reticle.dispose();var n=this.levelRenderer;n.detach();var a=this.level=new d,s=c.getGamesList(),r=s[e];a.loadMap(r,t,i);n.attach(a),n.mapRenderer.tileImage="media/images/env.png",r.backgroundColor&&(this.backgroundColor=S.fromRGBArray(r.backgroundColor)),this.darkness.level=a,r.darkness?(this.darkness.opacity=r.darkness,this.darkness.visible=!0):this.darkness.visible=!1,this._reticle=new k({parent:n._pawnContainer,z:99999});var o=this.minimap;o.setSizeByHeight(r.tiles.length),o.align("right","top",-4,4),o.visible=a.width>this.width||a.height>this.height},tick:function(e){if(this.captureInputEvents&&(this.getInput("negate",!0)&&(this._gameName.visible?this._onGameNameClose():this._gamePlayer.visible?this._onGamePlayerClose():this._confirmAnalysis.visible?this._onConfirmCancel():this._colorPicker.visible?this._onColorPickerClose():this._gameSettings.visible?this._onGameSettingsClose():this.menu.visible?(l.play("close",0),this.menu.hide()):(l.play("open",0),this.menu.reset(),this.menu.show())),!this._gameSettings.visible)){this.getInput("action",!0)&&(l.play("play",0),this._onMenuPlaytest());this._input;this.getInput("left")?this._scroll(-1,0,e):this.getInput("right")&&this._scroll(1,0,e),this.getInput("up")?this._scroll(0,-1,e):this.getInput("down")&&this._scroll(0,1,e);var t=this.level,i=t.camera,n=this.width/2,a=this.height/2;if(i.x=r.clamp(i.x,n,t.width-n),i.y=r.clamp(i.y,a,t.height-a),o.isDown(C.p,!0)){var s=c.getGamesList(),h=s[c.data.editGameIndex];h.clicks=null,h.rating=null,h.sales=null,h.time=Math.round(h.time),h.views=null,delete h.bestTime,delete h.bought,delete h.player,delete h.published,delete h.contentNormal,delete h.gameIndex,delete h.newFans,delete h.uniqueNormal,delete h.reviews,delete h.gross,delete h.net,delete h.tested;var u=JSON.stringify(h)+",";if(window.nw){l.play("increase",0);var d=nw.Clipboard.get();d.set(u,"text")}else l.play("negate",0),console.log(u);this._onMenuQuit()}}},cleanup:function(e,t){this._super(e,t),this.levelRenderer.detach()},_draw:function(e){var t=this.getTileByPoint(e.point),i=this._removeEntitiesByTile(t.x,t.y);if(c.data.editTileKey)var n=this._drawTile(t.x,t.y);else var n=this._drawEntity(t.x,t.y);if(n&&"trashCan"===c.data.editEntityKey&&(n=!1,i=!0),i===c.data.editEntityKey&&(n=!1,i=!1),n){var a=String(c.data.editTileKey||c.data.editEntityKey),s=I[a]||"Pos";l.play("place"+s+D,0),D=1===D?2:1,this._polishDraw()}else i&&(l.play("trash"+D,0),D=1===D?2:1,this._polishDraw());(n||i)&&(c.setGameTestState(c.data.editGameIndex,!1),this.menu.updateTestedState(),this.menu.stopInput())},getTileByPoint:function(e){var t=this.level,i=t.camera,n=r.clamp(i.x-this.width/2,0,t.width-this.width),a=r.clamp(i.y-this.height/2,0,t.height-this.height);return{x:Math.floor((e.x+n)/16),y:Math.floor((e.y+a)/16)}},updateCamera:function(){var e=this.level;e.updateCamera(),c.camera&&(e.camera.x=c.camera.x,e.camera.y=c.camera.y,delete c.camera);var t=this.levelRenderer;t.updateCamera()},_drawTile:function(e,t){var i=c.data.editTileKey,n=this.level.map,a=n.get(e,t)!==i;return n.set(e,t,i),c.updateGameMap(c.data.editGameIndex,e,t,i),a},_drawEntity:function(e,t){var i=this.level,n=c.data.editEntityKey,a=c.data.editGameIndex,s=i.map,r=0!==s.get(e,t);if(s.set(e,t,0),c.updateGameMap(a,e,t,0),"gameStart"===n||"gameGoal"===n)for(var o=i.getEntities(function(e){return e.type===n}),l=0,u=o.length;u>l;++l){var d=o[l];i.despawnEntity(d);var p=h.getTile(d,s);c.updateGameMap(a,p.x,p.y,0),r=!0}if("trashCan"!==n){var d=i.addEntityAtTile(n,e,t);s.set(e,t,0),c.updateGameMap(a,e,t,n),r=!0}return r},_dropper:function(e){var t=this.level,i=t.map,n=this.getTileByPoint(e.point),a=t.getEntitiesByTile(n.x,n.y);if(a.length){var s=a[0].type;this.menu.setEntity(s),this._reticle.setEntity(s)}else{var r=i.get(n.x,n.y);0===r?(this.menu.setEntity("trashCan"),this._reticle.setEntity("trashCan")):(this.menu.setTile(r),this._reticle.setTile(r))}},_onMapStart:function(e){e.rightClick?c.getDeveloperFlag("dropper")?this._dropper(e):l.play("negate",0):(this._inputActive=!0,this._draw(e))},_onMapMove:function(e){this._inputActive&&this._draw(e)},_onMapEnd:function(e){this._inputActive=!1},_onMenuPlaytest:function(){c.playtest=!0,this.captureInputEvents=!1,this.fireSceneEvent("playtest")},_onMenuSettings:function(){this._gameSettings.reset(!1),this._gameSettings.show()},_onMenuInputMove:function(){this._onMapEnd(),this._reticle.hide(),this._hideReticle=!0},_onMenuSelectEntity:function(e){this._reticle.setEntity(e)},_onMenuSelectTile:function(e){this._reticle.setTile(e)},_onMenuQuit:function(){c.editing=!1,c.playtest=!1,this.captureInputEvents=!1,this.fireSceneEvent("quit")},_onGameNameDone:function(e){l.play("create",0),c.updateEditGameName(e),this.menu.updateGameName(e),this._gameSettings.updateGameName(e),this._gameName.hide()},_onGameNameClose:function(){l.play("close",0),this._gameName.hide()},_onGamePlayerSelect:function(e){l.play("select",0),c.updateEditGamePlayer(e),this._gameSettings.updateGamePlayer(e);var t=c.data.editGameIndex;c.setGameTestState(t,!1),c.save(),this.menu.updateTestedState()},_onGamePlayerClose:function(){l.play("close",0),this._gamePlayer.hide()},_onConfirmPurchase:function(){var e=c.getEditGame(),t=c.getGameAnalysisCost(e),i=c.getDeveloper();if(i.money<t)return void l.play("negate",0);l.play("increase",0),i.money-=t,c.save();var n=c.getDeveloperFlag("marketAnalysisCount",0);c.setDeveloperFlag("marketAnalysisCount",n+1),this.fireSceneEvent("marketAnalysis")},_onConfirmCancel:function(){l.play("negate",0),this._confirmAnalysis.hide()},_onGameSettingsClose:function(){l.play("close",0),this._gameSettings.hide()},_onGameSettingsDarkness:function(e,t){if(e>t)l.play("backspace"+D,0),D=1===D?2:1;else{if(!(t>e))return;l.play("type"+D,0),D=1===D?2:1}var i=c.data.editGameIndex,n=c.getGamesList(),a=n[i];a.darkness=e,c.setGameTestState(i,!1),c.save(),this.menu.updateTestedState(),this.darkness.opacity=e,e>0?this.darkness.visible=!0:this.darkness.visible=!1},_onColorChange:function(e){l.play("select",0);var t=c.data.editGameIndex,i=c.getGamesList(),n=i[t];n.backgroundColor=e,c.setGameTestState(t,!1),c.save(),this.backgroundColor=S.fromRGBArray(e),this.menu.updateTestedState(),this._gameSettings.reset(!1)},_onColorPickerClose:function(){l.play("close",0),this._colorPicker.hide()},_onInputMove:function(e){if(this._super(e),this._hideReticle)return void(this._hideReticle=!1);var t=this.getTileByPoint(e.point),i=this._reticle;i.x=16*t.x,i.y=16*t.y,i.show()},_onOpenColorPicker:function(){l.play("open",0);var e=c.getEditGame();this._colorPicker.setColor(e.backgroundColor),this._colorPicker.show()},_onOpenName:function(){l.play("open",0);var e=c.getEditGame();this._gameName.reset(e.name),this._gameName.show()},_onOpenPlayer:function(){l.play("open",0);var e=c.getEditGame();this._gamePlayer.reset(e.playerPrefab),this._gamePlayer.show()},_onOpenAnalyze:function(){if(!c.getDeveloperFlag("marketAnalysis"))return void l.play("negate",0);l.play("open",0);var e=c.getEditGame(),t=c.getGameAnalysisCost(e),i=c.getDeveloper(),n=this._confirmAnalysis;n.setCost(t,i.money),n.show()},_onTweet:function(){l.play("select",0),this._reticle.hide(),this._gameName.hide(),this._gameSettings.hide(),this._colorPicker.hide(),this.menu.hide(),this.mouse.hide(),this.grid.hide(),this.captureInputEvents=!1,this.completeTween().delayTween(250,bind(this,function(){var e=3,t=this._tweetBuffer;t.width=this.width*e,t.height=this.height*e;var i=t.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(s.canvas,0,0,this.width,this.height,0,0,this.width*e,this.height*e),c.data.tweetData=t.toDataURL("image/png"),c.data.previewData=s.canvas.toDataURL("image/png"),c.save(),this.fireSceneEvent("auth")}))},_onShare:function(){var e=c.getGamesList(),t=e[c.data.editGameIndex],i={game:t,developer:c.data.developer},n=btoa(JSON.stringify(i)),a="?code="+n;if(window.nw){l.play("select",0);var s=nw.Clipboard.get();s.set(a,"text"),this._reward.show()}else l.play("negate",0),console.log(a)},_polishDraw:function(){if(c.data.editTileKey)var e=c.data.editTileKey;else var e=c.data.editEntityKey;var t=T[e],i=this.levelRenderer._pawnContainer,a=this._reticle,s=new n({parent:i,compositeOperation:"screen",image:"media/images/ui.png",overlayColor:S.getColor(t||"red"),width:16,height:16,z:999999});s.centerOn(a),s.tween({opacity:0,scale:2},250,null,function(){s.dispose()})},_removeEntitiesByTile:function(e,t){for(var i=!1,n=this.level,a=(n.map,n.getEntitiesByTile(e,t)),s=0,r=a.length;r>s;++s){var o=a[s];i=o.type,n.despawnEntity(o)}return i},_scroll:function(e,t,i){this._inputActive=!1;var n=this.level,a=n.camera,s=128*(i/1e3);a.x+=e*s,a.y+=t*s,this.minimap.ping(n,a),this._reticle.hide(),this.parallax.update(n,this.levelRenderer)},_onRewardOK:function(){l.play("done",0),this._reward.hide()}});t.defaults={backgroundColor:S.getColor("black"),musicKey:"holdPlease"}}),n("djinn/utils/DataStore",["require","exports","module","../Emitter","./storage","./object"],function(e,t,i){var n=e("../Emitter"),a=e("./storage"),s=e("./object"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.key=e.key,this.saveDelay=e.saveDelay,this._saveTimeout=null,this.load(),e.defaults&&(this.defaults=e.defaults,this.data=merge(this.data,e.defaults))},load:function(){if(this.key){var e=a.getObject(this.key);this.data=e||{}}else this.data={}},save:function(){this.key&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(bind(this,"_save"),this.saveDelay))},set:function(e,t){this.data[e]=t,this.save(),this.fire("set:"+e,[t])},get:function(e,t){var i=this.data[e];return void 0!==i?i:t},toggle:function(e){this.set(e,!this.get(e))},increment:function(e,t){var t=t||1,i=this.get(e,0);this.set(e,i+t)},restoreDefaults:function(e){if(this.defaults){var t=s.clone(this.defaults);for(var i in t)e&&i!==e||this.set(i,t[i])}},_save:function(){a.setObject(this.key,this.data)}});t.defaults={key:null,saveDelay:1e3}}),n("js/settings",["require","exports","module","djinn/client","djinn/manifest","djinn/utils/DataStore"],function(e,t,i){var n=e("djinn/client"),a=e("djinn/manifest"),s=e("djinn/utils/DataStore"),t=i.exports=new s({key:a.shortName+"_settings",defaults:{fullscreen:!0,soundVolume:.5,musicVolume:.5,keyBinds:{moveUp:["w"],moveDown:["s"],moveLeft:["a"],moveRight:["d"],action:["space"],negate:["escape"]},analogDeadZoneLeft:.2,gamepadBinds:{action:"face1",negate:"start"}}});n.on("fullscreenChange",function(e){t.set("fullscreen",e)})}),n("js/view/scenes/GamepadScene",["require","exports","module","djinn/utils/intl","djinn/view/View","djinn/audio/jukebox","djinn/input/gamepad","./Scene","../../gameData","../../settings","../Typer","../Starfield","../BackButton","../Scrollbar","../Slider","../avatarFactory","../style"],function(e,t,i){var n=e("djinn/utils/intl"),a=e("djinn/view/View"),s=e("djinn/audio/jukebox"),r=e("djinn/input/gamepad"),o=e("./Scene"),l=(e("../../gameData"),e("../../settings")),h=e("../Typer"),u=e("../Starfield"),d=e("../BackButton"),c=e("../Scrollbar"),p=e("../Slider"),g=e("../avatarFactory"),m=e("../style"),f=r.buttons,v=["start","select","face1","face2","face3","face4"],t=i.exports=o.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new u({parent:this});var e=new d({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),new h({parent:this,text:"Gamepad",color:"silver",x:24,y:8}),new h({parent:this,text:"-------",x:24,y:16}),this._window=new a({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:32,width:240,height:104}),this._container=new a({parent:this._window,acceptInputEvents:!0});var t=this._scrollbar=new c({parent:this._window,barColor:m.getColor("black"),width:8}).align("right");t.attach(this._container);var i=this.avatar=g.create("playerBenzer",{parent:this});i.playAnimation("walk"),this.sortChildren()},reset:function(){this.avatar.align("center","bottom",0,-8),this._targetKey=null,this._populate()},tick:function(e){if(this.captureInputEvents){if(this._targetKey){for(var t=null,i=0,n=v.length;n>i;++i){var a=v[i],o=f[a];if(r.isButtonDown(o,!0)){var t=a;break}}if(!t)return;s.play("set",0);var h=l.get("gamepadBinds");return h[this._targetKey]=t,r.bind(h),l.set("gamepadBinds",h),l.save(),this._targetKey=null,this._populate(),void r.clearButtons(t)}this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e);var u=this.avatar;this.getInput("left")?(u.x-=64*e/1e3,u.flipX||s.play("trash1",0),u.flipX=!0):this.getInput("right")&&(u.x+=64*e/1e3,u.flipX&&s.play("trash2",0),u.flipX=!1)}},_populate:function(){var e=this._container;e.disposeChildren();var t=l.get("gamepadBinds"),i=0;for(var s in t){var r=t[s],o=new a({parent:e,acceptInputEvents:!0,y:i,height:8});o.key=s,o.on("inputStart",this,"_onKeySelect");new h({parent:o,text:n.get(s),color:"silver"}),new h({parent:o,text:s===this._targetKey?"press any button":r,x:128});i+=16}var u=new h({parent:e,text:"Dead zone",color:"silver",y:i}),d=new p({parent:e,x:128,y:i,width:64,height:8});d.setValue(l.get("analogDeadZoneLeft")),d.on("change",this,"_onDeadZoneChange"),i+=16;var u=new h({parent:e,text:"Reset",acceptInputEvents:!0,y:i});u.on("inputStart",this,"_onReset"),e.shrinkwrap(),this._scrollbar.reset()},_onKeySelect:function(e){s.play("open",!0),this._targetKey=e.target.key,this._populate()},_onDeadZoneChange:function(e,t){if(e>t)s.play("backspace1",0);else{if(!(t>e))return;s.play("type1",0)}l.set("analogDeadZoneLeft",e),r.analogDeadZoneLeft=l.get("analogDeadZoneLeft"),l.save()},_onReset:function(){s.play("remove",0),l.restoreDefaults("gamepadBinds"),r.bind(l.get("gamepadBinds")),l.restoreDefaults("analogDeadZoneLeft"),r.analogDeadZoneLeft=l.get("analogDeadZoneLeft"),this._populate()},_onQuit:function(){s.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)}});t.defaults={backgroundColor:m.getColor("black"),musicKey:"streets"}}),n("js/view/SuperTyper",["require","exports","module","djinn/view/View","./Typer"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Typer"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e);var i=e.text,n=new a({parent:this,text:i,color:"black",x:1,y:1});n.shrinkwrap();var s=new a({parent:this,text:i,color:e.color});s.shrinkwrap(),this.width=8*i.length,n.align("center","center",1,1),s.align("center","center")},reset:function(){this.completeTween()},flash:function(){this.completeTween({opacity:1,visible:!0});for(var e=0;4>e;++e)this.delayTween(250,bind(this,function(){this.opacity=this.opacity?0:1}));this.tween({opacity:0},1e3,n.transitions.easeIn,bind(this,function(){this.visible=!1}))}});t.defaults={imageSmoothingEnabled:!1,height:8,scale:2}}),n("js/view/scenes/ImpactScene",["require","exports","module","djinn/view/View","djinn/math/random","djinn/view/shapes/Pinwheel","djinn/manifest","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../Starfield","../SuperTyper","../style"],function(e,t,i){var n=(e("djinn/view/View"),e("djinn/math/random"),e("djinn/view/shapes/Pinwheel"),e("djinn/manifest"),e("djinn/audio/jukebox"),e("./Scene")),a=(e("../../gameData"),e("../Typer"),e("../Starfield"),e("../SuperTyper")),s=e("../style"),r=["red","green","blue","orange","purple"],o="UNLOCK",l="NEW TOOLS",t=i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),this.elapsed=0,this._index=0},setup:function(){this._super(),new a({parent:this,text:o,z:2}).align("center","center",0,-16),new a({parent:this,text:l,z:2}).align("center","center",0,16),this.sortChildren()},activate:function(e,t){this._super(e,t),this.bgText(o,"black",0,-16,6,6),this.bgText(l,"black",0,16,6,6),this.bgText(o,"black",0,-16,4,4),this.bgText(l,"black",0,16,4,4),this.bgText(o,"black",0,-16,2,2),this.bgText(l,"black",0,16,2,2),this.sortChildren()},bgText:function(e,t,i,n,s,r){var o=500,l=new a({parent:this,text:e,color:t}).align("center","center",i,n),h=l.x,u=l.y;l.x=h+s,l.y=u+r;for(var d=0;2>d;++d)l.tween({x:h-s},o).tween({y:u-r},o).tween({x:h+s},o).tween({y:u+r},o)},tick:function(e){this.elapsed+=e,this.elapsed>250&&(this.elapsed=0,console.log(r[this._index]),this.backgroundColor=s.getColor(r[this._index]),this._index++,this._index>=r.length&&(this._index=0))}});t.defaults={backgroundColor:s.getColor("red")}}),n("js/view/scenes/KeyboardScene",["require","exports","module","djinn/utils/intl","djinn/view/View","djinn/audio/jukebox","djinn/input/keyboard","./Scene","../../gameData","../../settings","../Typer","../Starfield","../BackButton","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/utils/intl"),a=e("djinn/view/View"),s=e("djinn/audio/jukebox"),r=e("djinn/input/keyboard"),o=e("./Scene"),l=(e("../../gameData"),e("../../settings")),h=e("../Typer"),u=e("../Starfield"),d=e("../BackButton"),c=e("../Scrollbar"),p=e("../style"),t=i.exports=o.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new u({parent:this});var e=new d({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),new h({parent:this,text:"Keyboard",color:"silver",x:24,y:8}),new h({parent:this,text:"--------",x:24,y:16}),this._window=new a({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:32,width:240,height:104}),this._container=new a({parent:this._window,acceptInputEvents:!0});var t=this._scrollbar=new c({parent:this._window,barColor:p.getColor("black"),width:8}).align("right");t.attach(this._container),r.on("keyDown",this,"_onKeyDown"),this.sortChildren()},reset:function(){this._targetKey=null,this._populate()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_populate:function(){var e=this._container;e.disposeChildren();var t=l.get("keyBinds"),i=0;for(var s in t){var r=t[s][0],o=new a({parent:e,acceptInputEvents:!0,y:i,height:8});o.key=s,o.on("inputStart",this,"_onKeySelect");new h({parent:o,text:n.get(s),color:"silver"}),new h({parent:o,text:s===this._targetKey?"press any key":r,x:128});i+=16}var u=new h({parent:e,text:"Reset",acceptInputEvents:!0,y:i});u.on("inputStart",this,"_onReset"),e.shrinkwrap(),this._scrollbar.reset()},_onKeySelect:function(e){s.play("open",!0),this._targetKey=e.target.key,this._populate()},_onKeyDown:function(e){if(this._targetKey){s.play("set",0);var t=l.get("keyBinds"),i=r.getKeyAliasByCode(e);t[this._targetKey]=[i],r.bind(t),l.set("keyBinds",t),l.save(),this._targetKey=null,this._populate(),r.clearKeys(e)}},_onReset:function(){s.play("remove",0),l.restoreDefaults("keyBinds"),r.bind(l.get("keyBinds")),this._populate()},_onQuit:function(){s.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)}});t.defaults={backgroundColor:p.getColor("black"),musicKey:"streets"}}),n("js/view/Query",["require","exports","module","djinn/view/View","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./Typer");e("./style");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults))},navigate:function(e,t){this._selectedIndex},setOptions:function(e){this.disposeChildren(),this._optionX=0,this._optionY=0,this._options=[];for(var t=0,i=e.length;i>t;++t)this._addOption(e[t].text,t);this._selectedIndex=0,this.cursor=new n({parent:this,image:"media/images/ui.png",imageX:32,width:16,height:16}),this._updateCursor()},select:function(){this.fire(this._options[this._selectedIndex].index)},_addOption:function(e,t){var i=new a({parent:this,text:e,acceptInputEvents:!0,width:~~(this.width/2),x:this._optionX,y:this._optionY}).on("inputPress",this,function(){this.fire("select",[t])});i.index=t,this._optionY+=8,this._optionY>=this.height&&(this._optionX+=~~(this.width/2),this._optionY=0),this._options.push(i)},_updateCursor:function(){this.cursor.x=this._options[this._selectedIndex].x+4,this.cursor.y=this._options[this._selectedIndex].y-4}}),t.defaults={acceptInputEvents:!0,width:192,height:16}}),n("js/view/Transition",["require","exports","module","djinn/view/View","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("./style");i.exports=n.extend({init:function(e){this._super(e),this._left=new n({parent:this,backgroundColor:a.getColor("black")}),this._right=new n({parent:this,backgroundColor:a.getColor("black")})},animate:function(e,t){this.show(),this._left.completeTween({width:0}).tween({width:this.width/2},250,null,e).tween({width:0},250,null,t),this._right.completeTween({x:this.width}).tween({x:this.width/2},250).tween({x:this.width},250)}})}),n("js/view/scenes/LevelScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/utils/string","djinn/sim/shared/position","./Scene","../../sim/Level","../../gameData","../../products","../LevelRenderer","../Menu","../Dialog","../Query","../Typer","../SuperTyper","../Transition","../Starfield","../Darkness","../Reward","../Parallax","../style"],function(e,t,i){var n=(e("djinn/view/View"),e("djinn/audio/jukebox")),a=e("djinn/utils/string"),s=(e("djinn/sim/shared/position"),e("./Scene")),r=e("../../sim/Level"),o=e("../../gameData"),l=e("../../products"),h=e("../LevelRenderer"),u=e("../Menu"),d=e("../Dialog"),c=e("../Query"),p=e("../Typer"),g=e("../SuperTyper"),m=e("../Transition"),f=(e("../Starfield"),e("../Darkness")),v=e("../Reward"),y=e("../Parallax"),w=e("../style"),_=1,t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults)),this._input={},this.musicId=null,this.timeTrackId=null},setup:function(){this._super(),this.parallax=new y({parent:this}),this.levelRenderer=new h({parent:this}),this.darkness=new f({parent:this}),this.menu=new u({parent:this}).align("center","center"),this.menu.on("close",this,"_onMenuClose"),this.menu.on("quit",this,"_onMenuQuit");var e=this.dialog=new d({parent:this,acceptInputEvents:!0}).align("center","bottom",0,-8);e.on("done",this,"_onDialogDone");var t=this.query=new c({parent:e}).align(null,"bottom",0,-8);t.on("select",this,"_onQuerySelect"),this.time=new p({parent:this,anchorX:.5,width:40}).align("center","top",0,4);var i=this._reward=new v({parent:this}).align("center","center");i.on("ok",this,"_onRewardOK"),this.trans=new m({parent:this});var n=this._bossText=new g({parent:this,text:"BOSS GAME!"});n.align("center","center",0,-32),this.sortChildren()},reset:function(){if(this._super(),o.codeData)var e=o.codeData.game;else{var t=o.getGamesList(),i=o.data;if(o.playtest)var e=t[i.editGameIndex];else var e=t[i.gameIndex]}if(this.loadMap(e),o.playtest){var n=this.level,a=n.createEntity("funWatcher");n.spawnEntity(a)}this.menu.hide(),this.dialog.hide(),this.query.hide(),this._reward.hide(),this.trans.hide(),this._bossText.reset(),this._bossText.hide(),this.dialogData=null,this.dialogIndex=null,this.mouse.opacity=0,this.mouse.visible=!1,this.playtestData={left:0,right:0,jump:0},this.elapsed=0,this._updateTime(),this.sortChildren()},activate:function(e,t){var i=this.game.boss;i?this.musicKey="flux":this.musicKey="corridor",this._super(e,t),i&&o.showBossText&&(this._bossText.flash(),o.showBossText=!1),this.levelRenderer.paused=!1,this.level.start(),this.level.fire("activate")},deactivate:function(e,t){this.game.player?this.timeTrackId="playtest":this.timeTrackId="research",this._super(e,t)},loadMap:function(e,t,i){this.game=e,this.level&&this.level.dispose();var n=this.levelRenderer;n.detach();var a=this.level=new r;a.on("entityDie",this,"_onEntityDie"),a.on("goal",this,"_onGoal"),a.on("entityCollect",this,"_onEntityCollect"),a.on("entitySpawn",this,"_onEntitySpawn"),a.on("goalOpen",this,"_onGoalOpen"),a.on("dialog",this,"_onDialog"),(void 0===t||void 0===i)&&(t=8,i=4);a.loadMap(e,t,i);n.attach(a),n.mapRenderer.tileImage="media/images/env.png",a.reset(),e.backgroundColor&&(this.backgroundColor=w.fromRGBArray(e.backgroundColor));var s=this.darkness;s.level=a,e.darkness?(s.opacity=e.darkness,s.visible=!0):s.visible=!1,a.updateCamera(),n.updateCamera(),this.parallax.update(a,n);var o=e.musicId;o?this.playMusic(o):o===!1&&this.stopMusic()},playMusic:function(e){if(this.musicId){if(e===this.musicId)return;n.stop(this.musicId)}this.musicId=e,n.play(e,0)},stopMusic:function(){this.musicId&&n.stop(this.musicId)},tick:function(e){if(this.captureInputEvents){var t=this.level;t.running&&(this.elapsed+=e,this._updateTime()),this.query.visible?this._handleQuery():this.dialog.visible?this._handleDialog():this._reward.visible?this._handleReward():this.menu.visible?this._handleMenu():this._handleInput(),t.update(e),this.parallax.update(t,this.levelRenderer)}},cleanup:function(e,t){this._super(e,t),this.musicId&&(n.stop(this.musicId),this.musicId=null),this.levelRenderer.detach()},_fail:function(){var e=this.level;e.running&&(e.stop(),this.levelRenderer.paused=!0,this.completeTween().delayTween(500,bind(this,function(){o.playtest&&(o.playtest=!1,o.setGameTestState(o.data.editGameIndex,!1),o.camera={x:e.camera.x,y:e.camera.y}),this.fireSceneEvent(this.oldSceneId)})))},_handleQuery:function(){var e=this.query;this.getInput("left",!0)?e.navigate(-1,0):this.getInput("right",!0)&&e.navigate(1,0),this.getInput("up",!0)?e.navigate(0,-1):this.getInput("down",!0)&&e.navigate(0,1),this.getInput("action",!0)&&e.select()},_handleDialog:function(){this.getInput("action",!0)&&(this.dialog.advance()||this._advanceDialog())},_handleReward:function(){this.getInput("negate",!0)&&this._onRewardOK()},_handleMenu:function(){this.getInput("negate",!0)&&this._hideMenu()},_handleInput:function(){var e=this.level;this.getInput("negate",!0)&&(n.play("select",0),e.stop(),this.menu.reset(),this.menu.show(),this.levelRenderer.paused=!0,this.mouse.opacity=1);var t=e.player,i=t.control;i.x=0,i.y=0;var a=this.playtestData;this._input;this.getInput("left")?(i.x=-1,a.left++):this.getInput("right")&&(i.x=1,a.right++),t.gravity||(this.getInput("up")?i.y=-1:this.getInput("down")&&(i.y=1)),this.getInput("action",!0)&&(a.jump++,e.playerAction())},_hideMenu:function(){n.play("play",0),this.menu.hide(),this.levelRenderer.paused=!1,this.level.start(),this.mouse.opacity=0,this.mouse.visible=!1},_onDialog:function(e){this.dialogData=e,this.dialogIndex=0,this.level.stop(),this._parseDialog()},_onEntityDie:function(e){"player"===e.meta.role&&this._fail()},_onEntityCollect:function(){n.play("collect"+_,0),_=1===_?2:1},_onEntitySpawn:function(e){"explosion"===e.type?(n.play("explosion"+_,0),_=1===_?2:1):"survey"===e.type?(n.play("survey"+_,0),_=1===_?2:1):"banner"===e.type&&(n.play("banner"+_,0),_=1===_?2:1)},_onGoalOpen:function(){n.play("unlock",0)},_onDialogDone:function(){this.dialog.hide(),this.query.hide(),this.level.start(),this.mouse.opacity=0,this.mouse.visible=!1},_onGoal:function(e){var t=this.level;if(t.running){if(t.stop(),n.play("success",0),this.levelRenderer.paused=!0,o.playtest){var i=o.data.editGameIndex;o.playtest=!1,o.setGameTime(i,this.elapsed),o.setGameTestState(i,!0),o.setGamePlaytestData(i,this.playtestData),o.setGameSurvey(i,this.level),o.camera={x:t.camera.x,y:t.camera.y}}else if(o.codeData)var a=!1;else var s=o.data.gameIndex,a=o.checkBestTime(s,this.elapsed);this.completeTween().delayTween(500,bind(this,function(){this._finish(a)}))}},_onQuerySelect:function(e){this.query.hide();var t=this.dialogData[this.dialogIndex],i=t.query[e].select;i?i():this._onDialogDone()},_onMenuClose:function(){this._hideMenu()},_onMenuQuit:function(){n.play("remove",0),o.playtest&&(o.editing=!0,o.camera={x:this.level.camera.x,y:this.level.camera.y}),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)},_onRewardOK:function(){n.play("done",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)},_advanceDialog:function(){++this.dialogIndex,this.dialogData[this.dialogIndex]?this._parseDialog():(this.dialog.hide(),this.level.start(),this.mouse.opacity=0,this.mouse.visible=!1)},_parseDialog:function(){var e=this.dialogData[this.dialogIndex];e.text?(this.dialog.animate(e.text),this.dialog.show()):e.query&&(this.mouse.opacity=1,this.query.setOptions(e.query),this.query.show())},_finish:function(e){var t=this.game.productId,i=l[t];i&&!o.developerUnlockedProduct(t)?(n.play("unlock",0),o.developerUnlockProduct(t),this._reward.setHeader("Now in store"),this._reward.setContentConf(i.avatar),this._reward.show(),this.mouse.opacity=1):e?(n.play("increase",0),this._reward.setHeader("New Best Time"),this._reward.setContentText(a.formatTime(this.elapsed,2)),this._reward.show(),this.mouse.opacity=1):this.fireSceneEvent(this.oldSceneId)},_updateTime:function(){var e=this.time;e.text=a.formatTime(this.elapsed,2),e.shrinkwrap(),e.align("center")}});t.defaults={backgroundColor:w.getColor("blue")}}),n("js/view/DeveloperWindow",["require","exports","module","djinn/view/View","djinn/math/core","djinn/utils/string","djinn/utils/object","./Typer","../gameData","./style"],function(e,t,i){var n=e("djinn/view/View"),a=(e("djinn/math/core"),e("djinn/utils/string")),s=e("djinn/utils/object"),r=e("./Typer"),o=e("../gameData"),l=e("./style");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),new n({parent:this,backgroundColor:l.getColor("black"),width:this.width-2,height:this.height-2}).align("center","center"),this._header=new r({parent:this,color:"silver",x:8,y:8});var i=new r({parent:this,acceptInputEvents:!0,text:"X",width:8}).align("right","top",-8,8);i.on("inputPress",this,"_onClose"),this._container=new n({parent:this,acceptInputEvents:!0})},reset:function(){var e=this._container;e.disposeChildren();var t=o.getDevelopers(),i=s.getLength(t);this._header.text=a.sprintf("Developers (%s)",i);var n=0;for(var l in t){var h=24+8*n++,u=t[l].gamesList,d=0;u.forEach(function(e){e.player&&d++});var c=new r({parent:e,text:a.sprintf("%s (%s)",l,d),acceptInputEvents:!0,x:16,y:h,width:144});c.developer=l,c.on("inputPress",this,"_onItemSelect");var p=new r({parent:e,text:"X",acceptInputEvents:!0,x:this.width-24,y:h,width:8});p.developer=l,p.on("inputPress",this,"_onItemRemove")}},_onClose:function(){this.fire("close")},_onItemSelect:function(e){this.fire("select",[e.target.developer])},_onItemRemove:function(e){this.fire("remove",[e.target.developer])}}),t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:l.getColor("white"),width:192,height:96}}),n("js/view/scenes/LoginScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/sim/shared/position","./Scene","../../sim/Level","../../gameData","../Menu","../Dialog","../Typer","../DeveloperWindow","../TextBox","../Confirmation","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=(e("djinn/sim/shared/position"),e("./Scene")),r=(e("../../sim/Level"),e("../../gameData")),o=(e("../Menu"),e("../Dialog"),e("../Typer")),l=e("../DeveloperWindow"),h=e("../TextBox"),u=e("../Confirmation"),t=(e("../style"),i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new n({parent:this,acceptInputEvents:!0,image:"media/images/window.png",width:240,height:112}).align("center","center"),t=this.addQuitX();e.addChild(t),t.align("right","top",-3,5),new o({parent:e,text:"Welcome",x:4,y:4}),new o({parent:e,text:"- Login as ...",acceptInputEvents:!0,color:"black",x:8,y:26}).on("inputPress",this,"_onList"),this._newDeveloper=new o({parent:e,text:"- Create new developer",acceptInputEvents:!0,x:8,y:42}).on("inputPress",this,"_onNew");var i=this._developerWindow=new l({parent:this}).align("center","center");i.on("close",this,"_onDeveloperWindowClose"),i.on("select",this,"_onDeveloperWindowSelect"),i.on("remove",this,"_onDeveloperWindowRemove");var a=this._developerName=new h({parent:this
}).align("center","center");a.setHeaderText("Developer Name"),a.on("done",this,"_onDeveloperNameDone"),a.on("close",this,"_onDeveloperNameClose");var s=this._confirmation=new u({parent:this}).align("center","center");s.on("confirm",this,"_onConfirmDelete"),s.on("cancel",this,"_onConfirmCancel"),s.setHeader("Really delete?"),s.setConfirmButton("DELETE!");var r=this.addSettingsGear();r.on("inputStart",this,"_onSettings"),this.sortChildren()},reset:function(){this._super(),this._developerWindow.hide(),this._developerName.hide(),this._confirmation.hide(),this._updateMakeNewDeveloper()},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&(this._confirmation.visible?this._onConfirmCancel():this._developerWindow.visible?this._onDeveloperWindowClose():this._developerName.visible?this._onDeveloperNameClose():this._onQuit())},_onNew:function(){r.canMakeNewDeveloper()?(a.play("open",0),this._developerName.reset(),this._developerName.show()):a.play("negate",0)},_onList:function(){a.play("open",0),this._developerWindow.reset(),this._developerWindow.show()},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")},_onDeveloperWindowClose:function(){a.play("close",0),this._developerWindow.hide()},_onDeveloperWindowSelect:function(e){a.play("select",0),r.setDeveloper(e),this.captureInputEvents=!1,this.fireSceneEvent("play")},_onDeveloperWindowRemove:function(e){a.play("negate",0),this._removeDeveloper=e,this._confirmation.show()},_onConfirmDelete:function(){a.play("remove",0),r.removeDeveloper(this._removeDeveloper),this._confirmation.hide(),this._developerWindow.reset(),this._updateMakeNewDeveloper()},_onConfirmCancel:function(){a.play("negate",0),this._confirmation.hide()},_onDeveloperNameDone:function(e){r.addDeveloper(e)?(a.play("create",0),r.setDeveloper(e),r.publishCompetitor(),this.captureInputEvents=!1,this.fireSceneEvent("play")):a.play("negate",0)},_onDeveloperNameClose:function(){a.play("close",0),this._developerName.hide()},_onSettings:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("settings")},_updateMakeNewDeveloper:function(){r.canMakeNewDeveloper()?this._newDeveloper.color="black":this._newDeveloper.color="gray"}}));t.defaults={backgroundColor:"rgb(0, 128, 129)",musicKey:"funkBump"}}),n("js/view/scenes/MarketAllScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","./Scene","../../gameData","../GameListItem","../Typer","../BackButton","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("./Scene"),r=e("../../gameData"),o=e("../GameListItem"),l=e("../Typer"),h=e("../BackButton"),u=e("../Scrollbar"),d=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new h({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),new l({parent:this,text:"Browsing New Releases",x:24,y:8}),new l({parent:this,text:"on Vault",color:"silver",x:24,y:16}),new l({parent:this,text:"------------------------------",x:8,y:24});var t=new l({parent:this,text:"X",acceptInputEvents:!0,width:8,height:8});t.align("right","top",-4,4),t.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:96}),this._container=new n({parent:this._window,acceptInputEvents:!0});var i=this._scrollbar=new u({parent:this._window,barColor:d.getColor("marketBG"),width:8}).align("right");i.attach(this._container)},reset:function(){this._super();var e=this._container;e.disposeChildren();for(var t=r.getPublishedGames(),i=0,n=0,a=t.length;a>n;++n){var s=new o({parent:e,y:i});s.on("selectGame",this,"_onSelectGame"),s.on("selectProfile",this,"_onSelectProfile");var l=t[n];s.setGame(l),s.gameIndex=l.gameIndex,i+=s.height+8,(!l.bestTime||l.productId&&!r.developerUnlockedProduct(l.productId))&&s.markAsUnplayed()}e.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onSelectGame:function(e){a.play("select",0),r.data.gameIndex=e,r.save(),this.captureInputEvents=!1,this.fireSceneEvent("game")},_onSelectProfile:function(e){a.play("select",0),r.data.profile=e,r.save(),this.captureInputEvents=!1,this.fireSceneEvent("profile")},_onQuit:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")}});t.defaults={backgroundColor:d.getColor("marketBG"),musicKey:"streets"}}),n("js/view/scenes/MarketTopScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","./Scene","../../gameData","../GameListItem","../Typer","../BackButton","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("./Scene"),r=e("../../gameData"),o=e("../GameListItem"),l=e("../Typer"),h=e("../BackButton"),u=e("../Scrollbar"),d=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new h({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),new l({parent:this,text:"Browsing Best Sellers",color:"gold",x:24,y:8}),new l({parent:this,text:"on Vault!",color:"silver",x:24,y:16}),new l({parent:this,text:"------------------------------",x:8,y:24});var t=new l({parent:this,text:"X",acceptInputEvents:!0,width:8,height:8});t.align("right","top",-4,4),t.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:96}),this._container=new n({parent:this._window,acceptInputEvents:!0});var i=this._scrollbar=new u({parent:this._window,barColor:d.getColor("marketBG"),width:8}).align("right");i.attach(this._container)},reset:function(){this._super();var e=this._container;e.disposeChildren();for(var t=r.getTopGames(),i=0,n=0,a=t.length;a>n;++n){var s=new o({parent:e,y:i});s.on("selectGame",this,"_onSelectGame"),s.on("selectProfile",this,"_onSelectProfile");var l=t[n];s.setGame(l),s.gameIndex=l.gameIndex,i+=s.height+8,(!l.bestTime||l.productId&&!r.developerUnlockedProduct(l.productId))&&s.markAsUnplayed()}e.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onSelectGame:function(e){a.play("select",0),r.data.gameIndex=e,r.save(),this.captureInputEvents=!1,this.fireSceneEvent("game")},_onSelectProfile:function(e){a.play("select",0),r.data.profile=e,r.save(),this.captureInputEvents=!1,this.fireSceneEvent("profile")},_onQuit:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")}});t.defaults={backgroundColor:d.getColor("marketBG"),musicKey:"streets"}}),n("js/view/scenes/MarketGameScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/math/core","djinn/utils/string","./Scene","../../gameData","../GameListItem","../Typer","../BackButton","../Screenshot","../avatarFactory","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("djinn/math/core"),r=e("djinn/utils/string"),o=e("./Scene"),l=e("../../gameData"),h=e("../GameListItem"),u=e("../Typer"),d=e("../BackButton"),c=e("../Screenshot"),p=(e("../avatarFactory"),e("../style")),t=i.exports=o.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=new d({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),this._container=new n({parent:this,acceptInputEvents:!0}),this.sortChildren()},reset:function(){this._super(),this._button=null;var e=this._container;e.disposeChildren();var t=new h({parent:e,x:24,y:8});new u({parent:e,text:"------------------------------",x:8,y:24});var i=l.data.gameIndex,a=l.getGameByIndex(i);t.setGame(a);var o=new u({parent:e,text:"Rating:",color:"silver",x:8,y:40}).shrinkwrap();new u({parent:e,text:s.round(100*a.rating,2)+"%",x:o.right+8,y:o.y});var o=new u({parent:e,text:"Owners:",color:"silver",x:8,y:48}).shrinkwrap();new u({parent:e,text:r.formatNumber(a.sales),x:o.right+8,y:o.y});var d=new c({parent:e,x:8,y:64,width:2*a.tiles[0].length,height:2*a.tiles.length});d.setGame(a);var p=d.bottom+8,g=new u({parent:e,text:"Read reviews",acceptInputEvents:!0,x:8,y:p});if(g.shrinkwrap(),g.underline(),g.on("inputStart",this,"_onReviews"),a.player){p+=16;var m=new u({parent:e,text:"View analytics",acceptInputEvents:!0,x:8,y:p});m.shrinkwrap(),m.underline(),m.on("inputStart",this,"_onAnalytics")}var f=this._button=new n({parent:e,acceptInputEvents:!0,image:"media/images/ui.png",imageY:34,x:160,y:40,width:54,height:14});f.on("inputStart",this,"_onButton"),this._buttonText=new u({parent:e});var o=new u({parent:e,text:"Your Best Time",color:"silver"});o.shrinkwrap(),o.centerOn(f,0,24);var v=a.bestTime,y=new u({parent:e,text:v?r.formatTime(v,2):"N/A"});y.shrinkwrap(),y.centerOn(o,0,16),this._updateButton()},activate:function(e,t){var i=this.oldSceneId;this._super(e,t),("level"===e||"reviews"===e||"analytics"===e)&&(this.oldSceneId=i),"level"!==e&&(l.showBossText=!0)},tick:function(e){this.captureInputEvents&&(this.getInput("negate")&&this._onQuit(),this.getInput("action",!0)&&this._onButton())},_onButton:function(){var e=l.data.gameIndex,t=l.getGameByIndex(e);t.player||l.developerBoughtGame(e)?(a.play("play",0),this.captureInputEvents=!1,this.fireSceneEvent("play")):l.developerCanAffordGame(e)?(a.play("increase",0),l.developerBuyGame(e),this._updateButton()):a.play("negate",0)},_onReviews:function(){a.play("select",0),l.data.analyticsIndex=l.data.gameIndex,l.save(),this.captureInputEvents=!1,this.fireSceneEvent("reviews")},_onAnalytics:function(){a.play("select",0),l.data.analyticsIndex=l.data.gameIndex,l.save(),this.captureInputEvents=!1,this.fireSceneEvent("analytics")},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId||"market")},_updateButton:function(){var e=l.data.gameIndex,t=l.developerBoughtGame(e),i=l.getGameByIndex(e);this._button.imageX=0,i.player||t||l.developerCanAffordGame(e)||(this._button.imageX=this._button.width);var n=this._buttonText;if(i.player||t)n.text="Play";else{var i=l.getGameByIndex(e);n.text="$"+i.price}n.shrinkwrap(),n.centerOn(this._button)}});t.defaults={backgroundColor:p.getColor("marketBG"),musicKey:"streets"}}),n("js/view/scenes/MarketScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/utils/string","./Scene","../../gameData","../GameListItem","../Typer","../Scrollbar","../Screenshot","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("djinn/utils/string"),r=e("./Scene"),o=e("../../gameData"),l=(e("../GameListItem"),e("../Typer")),h=e("../Scrollbar"),u=e("../Screenshot"),d=e("../style"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new n({parent:this,image:"media/images/objects.png",imageX:16,imageY:0,x:4,y:8,width:16,height:16}),new l({parent:this,text:"Welcome to Vault",x:24,y:8}),new l({parent:this,text:"The #1 online game store",color:"silver",x:24,y:16}),new l({parent:this,text:"--------------------------",x:8,y:24});var e=new l({parent:this,text:"X",acceptInputEvents:!0,width:8,height:8});e.align("right","top",-4,4),e.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:80}),this._container=new n({parent:this._window,acceptInputEvents:!0});var t=this._scrollbar=new h({parent:this._window,barColor:d.getColor("marketBG"),width:8}).align("right");t.attach(this._container);var i=this._developers=new l({parent:this,text:"Developer Account",acceptInputEvents:!0,x:8,y:128});i.shrinkwrap(),i.on("inputStart",this,"_onDevelopers")},reset:function(){this._super();var e=this._developers;o.developerHasGameReadyToPublish()?e.color="gold":e.color="silver",e.underline();var t=this._container;t.disposeChildren();var i=o.getTopGames();new l({parent:t,text:s.sprintf("Best Sellers (%s)",i.length),acceptInputEvents:!0}).on("inputStart",this,"_onTop").shrinkwrap();var a=o.getPublishedGames();if(o.developerShouldPlayGames())var r="gold",h="NEW! Releases (%s)";else var r="white",h="New Releases (%s)";new l({parent:t,text:s.sprintf(h,a.length),color:r,acceptInputEvents:!0,y:16}).on("inputStart",this,"_onAll").shrinkwrap();var c=new n({parent:t,acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:d.getColor("silver"),x:152,y:0,width:80,height:72});new n({parent:t,backgroundColor:d.getColor("marketBG"),x:c.x+1,y:c.y+1,width:c.width-2,height:c.height-2}),new l({parent:t,text:"Featured",color:"gold",x:160,y:8});var p=new u({parent:t,x:160,y:24,width:64,height:36}),g=i[0];p.setGame(g),c.gameIndex=g.gameIndex,c.on("inputStart",this,"_onSelectGame"),t.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onSelectGame:function(e){a.play("select",0),o.data.gameIndex=e.target.gameIndex,o.save(),this.captureInputEvents=!1,this.fireSceneEvent("game")},_onSelectProfile:function(e){a.play("select",0),o.data.profile=e,o.save(),this.captureInputEvents=!1,this.fireSceneEvent("profile")},_onTop:function(e){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("top")},_onAll:function(e){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("all")},_onDevelopers:function(e){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("developers")},_onQuit:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")}});t.defaults={backgroundColor:d.getColor("marketBG"),musicKey:"streets"}}),n("js/view/scenes/MarketAnalysisScene",["require","exports","module","djinn/view/View","djinn/math/core","djinn/utils/string","djinn/audio/jukebox","djinn/input/keyboard","djinn/sim/shared/position","./Scene","../../sim/Level","../../gameData","../GameListItem","../Menu","../Dialog","../Typer","../TextBox","../Screenshot","../GameSettings","../ColorPicker","../Scrollbar","../Confirmation","../PlayerPicker","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/math/core"),s=e("djinn/utils/string"),r=e("djinn/audio/jukebox"),o=(e("djinn/input/keyboard"),e("djinn/sim/shared/position"),e("./Scene")),l=(e("../../sim/Level"),e("../../gameData")),h=(e("../GameListItem"),e("../Menu"),e("../Dialog"),e("../Typer")),u=(e("../TextBox"),e("../Screenshot")),d=(e("../GameSettings"),e("../ColorPicker"),e("../Scrollbar")),c=(e("../Confirmation"),e("../PlayerPicker"),e("../style")),t=i.exports=o.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),this.addQuitX("black");var e=0;e+=8,this._header=new h({parent:this,color:"black",x:8,y:e}),e+=8,new h({parent:this,text:"------------------------------",color:"silver",x:8,y:e}),e+=16,this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:32,width:240,height:104}),this._container=new n({parent:this._window,acceptInputEvents:!0});var t=this._scrollbar=new d({parent:this._window,barColor:c.getColor("white"),cursorColor:c.getColor("gray"),width:8}).align("right");t.attach(this._container),this.sortChildren()},reset:function(){this._super();var e=this._container;e.disposeChildren();var t=l.data.editGameIndex,i=l.getGamesList(),r=i[t];this._header.text=r.name+" Market Analysis",this._addLine("Screenshot","black"),this._addLine();var o=new u({parent:e,x:0,y:this._y,width:2*r.tiles[0].length,height:2*r.tiles.length});o.setGame(r),this._y=o.bottom+8;var h=l.getGameAverageContentCount(r),d=l.getGameContentCount(r);if(this._addLine(s.sprintf("Content count: %s",d),"black"),this._addLine(),h>d){var c=Math.round(h-d);this._addLine(s.sprintf("- Consider adding %s objects",c),"red")}else this._addLine(s.sprintf("+ Good amount of content"),"green");this._addLine(),r.darkness>0?this._addLine(s.sprintf("+ Good lighting effects"),"green"):(this._addLine(s.sprintf("- Consider adding lighting"),"red"),this._addLine(s.sprintf("  effects (it looks cool)"),"red")),this._addLine(),l.isDefaultColor(r.backgroundColor)?(this._addLine(s.sprintf("- Consider changing the"),"red"),this._addLine(s.sprintf("  background color"),"red")):this._addLine(s.sprintf("+ Good background coloring"),"green"),this._addLine(),"playerDog"===r.playerPrefab?(this._addLine(s.sprintf("- Consider changing dog,"),"red"),this._addLine(s.sprintf("  it is OVERPLAYED!"),"red")):this._addLine(s.sprintf("+ Good player for market"),"green"),this._addLine();var p=l.getAverageGameUniqueContentCount(),g=l.getGameUniqueContentCount(r),m=a.clamp(g/p,0,1),f=Math.round(100*m);if(p>g?(this._addLine(s.sprintf("- %s% unique to this market.",f),"red"),this._addLine(s.sprintf("  Consider investing in more"),"red"),this._addLine(s.sprintf("  game dev tools."),"red")):(this._addLine(s.sprintf("+ %s% unique to this market.",f),"green"),this._addLine(s.sprintf("  Very unique!"),"green")),this._addLine(),this._addLine("Playtesting","black"),this._addLine(),r.playtestData){var v=l.getAverageGameJoyCount(),y=a.clamp(r.joyCount/v,0,1);Math.round(100*y);r.joyCount<v?(this._addLine(s.sprintf("- Fun factor: %s",r.joyCount),"red"),this._addLine(s.sprintf("  Market average: %s",Math.round(v)),"red"),this._addLine(s.sprintf("  Consider more excitement!"),"red")):(this._addLine(s.sprintf("+ Fun factor: %s",r.joyCount),"green"),this._addLine(s.sprintf("  Market average: %s",Math.round(v)),"green"),this._addLine(s.sprintf("  Great job!"),"green")),this._addLine();var w=l.getAverageGameSurveyArea(),_=(a.clamp(r.surveyArea/w,0,1),a.round(100*r.surveyArea,0)),x=Math.round(100*w);if(r.surveyArea<w){r.surveyArea/w;this._addLine(s.sprintf("- Only exploring %s% of game",_),"red"),this._addLine(s.sprintf("  Market average: %s%",x),"red"),this._addLine(s.sprintf("  Offer more gameplay."),"red")}else this._addLine(s.sprintf("+ Exploring %s% of game",_),"green"),this._addLine(s.sprintf("  Market average: %s%",x),"green"),this._addLine(s.sprintf("  Excellent gameplay!"),"green");this._addLine(),this._addLine("Summary","black"),this._addLine();var b=l.getGameRating(r),k=a.round(100*b,0);this._addLine(s.sprintf("We estimate a %s% rating.",k),"gray")}else this._addLine("- Game has not been tested,","red"),this._addLine("  consider testing!","red");this._addLine(),this._addLine("----------------------------","gray"),this._addLine();var j=this._addLine("   Thank you for patronizing","gray"),S=l.getDeveloperFlag("marketAnalysisCount",1);this._addLine(s.sprintf("   Tiger Hat Marketing (%s)",S),"black"),new n({parent:e,image:"media/images/objects.png",imageX:16,imageY:96,x:j.x,y:j.y,width:16,height:16}),e.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onQuit:function(){r.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("edit")}});t.defaults={backgroundColor:c.getColor("white"),musicKey:"holdPlease"}}),n("js/view/scenes/NewsScene",["require","exports","module","djinn/view/View","djinn/manifest","djinn/utils/string","djinn/math/random","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/manifest"),s=e("djinn/utils/string"),r=e("djinn/math/random"),o=e("djinn/audio/jukebox"),l=e("./Scene"),h=e("../../gameData"),u=e("../Typer"),d=e("../Scrollbar"),c=e("../style"),p="----------------------------",g=["Things you'll like","No real-world news","Reading is good","Insert slogan here"],t=i.exports=l.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new n({parent:this,image:"media/images/objects.png",imageX:64,x:4,y:8,width:16,height:16}),new u({parent:this,text:"News Reader",color:"black",x:24,y:8}),this._slogin=new u({parent:this,color:"gray",x:24,y:16}),new u({parent:this,text:p,color:"black",x:8,y:24});var e=new u({parent:this,text:"X",acceptInputEvents:!0,color:"black",width:8,height:8});e.align("right","top",-4,4),e.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:80}),this._container=new n({parent:this._window,acceptInputEvents:!0});var t=this._scrollbar=new d({parent:this._window,barColor:c.getColor("white"),cursorColor:c.getColor("silver"),width:8}).align("right");t.attach(this._container)},reset:function(){this._super(),this._slogin.text=r.choice(g);var e=this._container;e.disposeChildren();var t=h.data.developer;h.getDeveloperFlag("credits")&&(this._addStats(),this._addLine(),this._addLine(p,"black"),this._addLine());var i=h.hasDeveloperBoughtEverything();(i||h.getDeveloperFlag("credits"))&&(this._addCredits(),this._addLine(),this._addLine(p,"black"),this._addLine());var n=h.hasDeveloperBoughtSomething();(n||h.getDeveloperFlag("market"))&&(this._addMarket(),this._addLine(),this._addLine(p,"black"),this._addLine());var a=h.getGamesByDeveloper(t);(a.length>0||h.getDeveloperFlag("store"))&&(this._addStore(),this._addLine(),this._addLine(p,"black"),this._addLine()),this._addDev(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){if(this.captureInputEvents){this.getInput("negate",!0)&&this._onQuit();var t=this._scrollbar;this.getInput("down")?t.scroll(1,e):this.getInput("up")&&t.scroll(-1,e)}},_addDev:function(){var e=h.getDeveloperFlag("dev"),t=e?"silver":"black";this._addLine("Make Your Own Games",t),this._addLine();var t=e?"silver":"gray";this._addLine("Anyone can now make their",t),this._addLine("very own games using the",t),this._addLine("new Djinn Game Editor.",t),this._addLine("Get started, developer!",t),this._addLine();var t=e?"silver":"green",i=this._addLine("Install Game Editor",t);i.underline(),i.on("inputStart",this,bind(this,function(){e?o.play("error",0):this._install("dev")}))},_addStore:function(){var e=h.getDeveloperFlag("store"),t=e?"silver":"black";this._addLine("Game Editor Store Now Open",t),this._addLine();var t=e?"silver":"gray";this._addLine("You can now purchase game",t),this._addLine("editor upgrades in the",t),this._addLine("online store. Buy tiles,",t),this._addLine("prefabs, and new features.",t),this._addLine();var t=e?"silver":"green",i=this._addLine("Install Store App",t);i.underline(),i.on("inputStart",this,bind(this,function(){e?o.play("error",0):this._install("store")}))},_addMarket:function(){var e=h.getDeveloperFlag("market"),t=e?"silver":"black";this._addLine("Sell Your Games on Vault",t),this._addLine();var t=e?"silver":"gray";this._addLine("Developers can now upload",t),this._addLine("their finished, tested",t),this._addLine("games to the Vault market.",t),this._addLine("Install and get started!",t),this._addLine();var t=e?"silver":"green",i=this._addLine("Install Vault",t);i.underline(),i.on("inputStart",this,bind(this,function(){e?o.play("negate",0):this._install("market")}))},_addCredits:function(){var e=h.getDeveloperFlag("credits"),t=e?"silver":"black";this._addLine("YOU WON!",t),this._addLine();var t=e?"silver":"gray";this._addLine("Congratulations, you have",t),this._addLine("purchased everything, and",t),this._addLine("now have full access to",t),this._addLine(s.sprintf("all of %s.",a.title),t),this._addLine("You are a true game dev.",t),this._addLine("Now ROLL THOSE CREDITS!",t),this._addLine();var t=e?"silver":"green",i=this._addLine("Roll Credits",t);i.underline(),i.on("inputStart",this,bind(this,function(){o.play("create",0),h.setDeveloperFlag("credits",!0),this.captureInputEvents=!1,this.fireSceneEvent("credits")}))},_addStats:function(){var e=h.getDeveloperFlag("stats"),t=e?"silver":"black";this._addLine("Anything Worth Improving",t),this._addLine("Is Worth Tracking",t),this._addLine();var t=e?"silver":"gray";this._addLine("The Stats app is now",t),this._addLine("available, made especially",t),this._addLine("for speedrunners.",t),this._addLine("Good luck and happy running!",t),this._addLine();var t=e?"silver":"green",i=this._addLine("Install Stats",t);i.underline(),i.on("inputStart",this,bind(this,function(){e?o.play("negate",0):this._install("stats")}))},_install:function(e){o.play("create",0),h.newApp=e,h.setDeveloperFlag(e,!0),this.captureInputEvents=!1,this.fireSceneEvent("computer")},_onQuit:function(){o.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("computer")}});t.defaults={backgroundColor:c.getColor("white"),musicKey:"streets"}}),n("js/view/scenes/ProfileScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/utils/string","./Scene","../../gameData","../GameListItem","../Typer","../BackButton","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("djinn/utils/string"),r=e("./Scene"),o=e("../../gameData"),l=e("../GameListItem"),h=e("../Typer"),u=e("../BackButton"),d=e("../Scrollbar"),c=e("../style"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),this._header=new h({parent:this,x:24,y:8}),new h({parent:this,text:"Developer Profile",color:"silver",x:24,y:16}),new h({parent:this,text:"------------------------",x:8,y:24}),this._fans=new h({parent:this,color:"silver",x:24,y:32});var e=new u({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:48,width:240,height:88}),this._container=new n({parent:this._window,acceptInputEvents:!0});var t=this._scrollbar=new d({parent:this._window,barColor:c.getColor("marketBG"),width:8}).align("right");t.attach(this._container)},reset:function(){this._super();var e=o.data.profile,t=o.getFansByProfile(e);this._fans.text="Fans: "+s.formatNumber(t),this._header.text=e;var i=this._container;i.disposeChildren();for(var n=o.getPublishedGamesByDeveloper(e),a=0,r=0,h=n.length;h>r;++r){var u=new l({parent:i,y:a});u.on("selectGame",this,"_onSelectGame");var d=n[r];u.setGame(d),u.gameIndex=d.gameIndex,a+=u.height+8}i.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},activate:function(e,t){var i=this.oldSceneId;this._super(e,t),"marketGame"===e&&(this.oldSceneId=i)},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onSelectGame:function(e){a.play("select",0),o.data.gameIndex=e,this.captureInputEvents=!1,this.fireSceneEvent("marketGame")},_onQuit:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId||"market")}});t.defaults={backgroundColor:c.getColor("marketBG"),musicKey:"streets"}}),n("djinn/view/shapes/Rectangle",["require","exports","module","../View","../utils/canvas"],function(e,t,i){var n=e("../View"),a=e("../utils/canvas"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),this.fillColor=e.fillColor,this.strokeColor=e.strokeColor,this.strokeWidth=e.strokeWidth,this.borderRadius=e.borderRadius},render:function(e){a.drawRect(e,0,0,this.width,this.height,this.fillColor,this.strokeColor,this.strokeWidth,this.borderRadius)}});t.defaults={buffer:!0,bufferPadding:10,width:100,height:100,fillColor:"white",strokeColor:null,strokeWidth:1,borderRadius:0}}),n("js/view/scenes/PromoScene",["require","exports","module","djinn/view/View","djinn/view/Sprite","djinn/view/shapes/Rectangle","djinn/math/random","djinn/view/shapes/Pinwheel","djinn/manifest","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../Starfield","../Dialog","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/view/Sprite"),s=e("djinn/view/shapes/Rectangle"),r=(e("djinn/math/random"),e("djinn/view/shapes/Pinwheel"),e("djinn/manifest"),e("djinn/audio/jukebox"),e("./Scene")),o=(e("../../gameData"),e("../Typer"),e("../Starfield"),e("../Dialog"),e("../style")),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new n({parent:this,image:"media/images/promo/bg.png"}),this._title=new n({parent:this,image:"media/images/promo/title.png",width:112,height:9,bottom:-1}).align("center"),this._titan=new a({parent:this,animations:{idle:{frameRate:2,frames:[[0,32],[16,32]]}},image:"media/images/actors.png",opacity:0,y:33,width:16,height:16}).align("center").playAnimation("idle"),this._reticle=new s({parent:this,buffer:!1,fillColor:null,opacity:0,strokeColor:o.getColor("yellow"),strokeWidth:2,width:28,height:28}).centerOn(this._titan),this.sortChildren()},activate:function(e,t){this._super(e,t);var i=this._titan.center,n={x:this._reticle.x,y:this._reticle.y,width:28,height:28};this.completeTween().delayTween(500,bind(this,function(){this._title.tween({y:6},500,null,bind(this,function(){this.mouse.completeTween({x:i.x+16,y:i.y+32,visible:!0}).tween({x:n.x,y:n.y},500,null,bind(this,function(){this._reticle.completeTween({opacity:1,width:1,height:1}).tween({width:28,height:28},750).delayTween(500).tween({opacity:0},250)})).tween({x:n.x+n.width,y:n.y+n.height},750,null,bind(this,function(){this._titan.tween({opacity:1},250)})).delayTween(250).tween({x:this.width},250)}))}))},tick:function(e){!this.captureInputEvents}});t.defaults={backgroundColor:o.getColor("black")}}),n("js/view/scenes/PublishedGamesScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","djinn/math/core","djinn/utils/string","./Scene","../../gameData","../GameListItem","../Typer","../BackButton","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=(e("djinn/math/core"),e("djinn/utils/string")),r=e("./Scene"),o=e("../../gameData"),l=e("../GameListItem"),h=e("../Typer"),u=e("../BackButton"),d=e("../Scrollbar"),c=e("../style"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new h({parent:this,text:"Vaultworks Sales Analytics",x:24,y:8}),new h({parent:this,text:"Your games, your money",color:"silver",x:24,y:16}),new h({parent:this,text:"---------------------------",x:8,y:24});var e=new u({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:96}),this._container=new n({parent:this._window,acceptInputEvents:!0,y:40});var t=this._scrollbar=new d({parent:this._window,barColor:c.getColor("marketBG"),width:8}).align("right");t.attach(this._container),this.sortChildren()},reset:function(){this._super();var e=this._container;e.disposeChildren();var t=o.getPublishedGamesByDeveloper(o.data.developer);if(t.length)for(var i=0,n=0,a=t.length;a>n;++n){var r=new l({parent:e,y:i});r.on("selectGame",this,"_onSelectGame");var u=t[n];r.setGame(u),r.gameIndex=u.gameIndex,i+=r.height+8,r.addLabel("$"+s.formatMoney(u.net))}else new h({parent:e,text:"No published games found",color:"silver",x:8,y:0});e.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onSelectGame:function(e){a.play("select",0),o.data.analyticsIndex=e,o.save(),this.captureInputEvents=!1,this.fireSceneEvent("analytics")},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")}});t.defaults={backgroundColor:c.getColor("marketBG"),musicKey:"streets"}}),n("js/view/SelectBox",["require","exports","module","djinn/view/View","djinn/audio/jukebox","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("./Typer"),r=e("./style");i.exports=n.extend({init:function(e){this._super(merge(e,t.defaults)),this.prefix=e.prefix,
new n({parent:this,backgroundColor:r.getColor("black"),width:this.width-2,height:this.height-2}).align("center","center");var i=this._header=new s({parent:this,text:"Set the price",color:"silver",anchorX:.5});i.shrinkwrap(),i.align("center","top",0,4);var a=new s({parent:this,acceptInputEvents:!0,text:"X",width:8}).align("right","top",-4,4);a.on("inputPress",this,"_onClose"),this._container=new n({parent:this,acceptInputEvents:!0,y:22});var o=this._done=new s({parent:this,text:"Save",acceptInputEvents:!0,anchorX:.5,width:32});o.align("center","bottom",0,-8),o.on("inputPress",this,"_onDone")},reset:function(e){this.value=e,this._done.color="gray";var t=this._container;t.disposeChildren();for(var i=this.options,n=12,a=0,r=i.length;r>a;++a){var o=i[a],l=new s({parent:t,text:this.prefix+o.value,acceptInputEvents:!0,anchorX:.5,y:n});l.optionIndex=a,l.shrinkwrap(),l.align("center"),l.on("inputStart",this,"_onValueSelect"),o.value===e?(l.color="white",this._done.color="white"):o.enabled?l.color="silver":l.color="gray",l.value=o.value,n+=2*l.height}},setOptions:function(e){this.options=e,this.reset()},_onValueSelect:function(e){var t=e.target;if(this.options[t.optionIndex].enabled){a.play("select",0);var i=this.value=t.value;this.reset(i),this._done.color="white"}else a.play("negate",0)},_onDone:function(){return null===this.value?void a.play("negate",0):void this.fire("done",[this.value])},_onClose:function(){this.fire("close")}}),t.defaults={acceptInputEvents:!0,cancelInputEvents:!0,backgroundColor:r.getColor("white"),prefix:"",width:192,height:112}}),n("js/view/scenes/PublishGameScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../BackButton","../Screenshot","../SelectBox","../Confirmation","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("./Scene"),r=e("../../gameData"),o=e("../Typer"),l=e("../BackButton"),h=e("../Screenshot"),u=e("../SelectBox"),d=e("../Confirmation"),c=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new o({parent:this,text:"Vaultworks Publishing Tools",x:24,y:8});var e=new l({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),this._container=new n({parent:this,acceptInputEvents:!0,y:16});var t=this._priceBox=new u({parent:this,prefix:"$"}).align("center","center");t.on("done",this,"_onPriceBoxDone"),t.on("close",this,"_onPriceBoxClose");var i=this._confirmation=new d({parent:this}).align("center","center");i.on("confirm",this,"_onConfirmPublish"),i.on("cancel",this,"_onCancelPublish"),i.setHeader("Ready to publish?"),i.setConfirmButton("Publish"),this.sortChildren()},reset:function(){this._super(),this.price=null,this._confirmation.hide();var e=[{enabled:!0,value:4.99}];e.push({enabled:r.getDeveloperFlag("sizeMedium"),value:9.99}),e.push({enabled:r.getDeveloperFlag("sizeLarge"),value:14.99});var t=this._priceBox;t.hide(),t.setOptions(e);var i=this._container;i.disposeChildren();var n=r.data.publishGameIndex,a=r.getGamesList(),s=a[n],l=0;new o({parent:i,text:"Publish "+s.name,color:"silver",x:24,y:0}),l+=8,new o({parent:i,text:"---------------------------",x:8,y:8}),l+=16;var u=new h({parent:i,x:8,y:l,width:3*s.tiles[0].length,height:3*s.tiles.length});u.setGame(s),l+=u.height+8;var d=this._priceTyper=new o({parent:i,text:"Price: click to set",acceptInputEvents:!0,x:8,y:l});d.on("inputStart",this,"_onPrice"),l+=16;var c=this._publishButton=new o({parent:i,text:"Publish",acceptInputEvents:!0,color:"silver",x:8,y:l});c.on("inputStart",this,"_onPublish")},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&(this._confirmation.visible?this._onCancelPublish():this._priceBox.visible?this._onPriceBoxClose():this._onQuit())},_onPriceBoxDone:function(e){a.play("start",0),this.price=e,this._priceTyper.text="Price: $"+e,this._publishButton.color="gold";var t=r.data.publishGameIndex;r.updateGamePrice(t,e),this._priceBox.hide()},_onPrice:function(){a.play("open",0),this._priceBox.reset(this.price),this._priceBox.show()},_onPriceBoxClose:function(){a.play("close",0),this._priceBox.hide()},_onPublish:function(){null===this.price?a.play("negate",0):(a.play("open",0),this._confirmation.show())},_onConfirmPublish:function(){a.play("start",0),r.publishCompetitor();var e=r.data.publishGameIndex;r.publishGame(e);var t=r.moveGameToEnd(e);r.data.analyticsIndex=t,r.animateAnalytics=!0,r.save(),this.captureInputEvents=!1,this.fireSceneEvent("analytics")},_onCancelPublish:function(){a.play("negate",0),this._confirmation.hide()},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")}});t.defaults={backgroundColor:c.getColor("marketBG"),musicKey:"streets"}}),n("js/view/scenes/ReviewsScene",["require","exports","module","djinn/view/View","djinn/math/core","djinn/utils/string","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../BackButton","../Screenshot","../Scrollbar","../style"],function(e,t,i){var n=e("djinn/view/View"),a=(e("djinn/math/core"),e("djinn/utils/string"),e("djinn/audio/jukebox")),s=e("./Scene"),r=e("../../gameData"),o=e("../Typer"),l=e("../BackButton"),h=(e("../Screenshot"),e("../Scrollbar")),u=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=8;this._gameName=new o({parent:this,x:24,y:e}),e+=8,new o({parent:this,text:"Reviews",color:"silver",x:24,y:e}),e+=8,this._br=new o({parent:this,text:"------------------------------",x:8,y:e}),e+=16;var t=new l({parent:this});t.align("left","top",4,8),t.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:96}),this._container=new n({parent:this._window,acceptInputEvents:!0});var i=this._scrollbar=new h({parent:this._window,barColor:u.getColor("marketBG"),cursorColor:u.getColor("white"),width:8}).align("right");i.attach(this._container),this.sortChildren()},reset:function(){this._super();var e=r.data.analyticsIndex,t=r.getGamesList(),i=this.game=t[e],a=i.reviews;this._gameName.text=i.name;var s=this._container;s.disposeChildren();for(var o=0,l=a.length;l>o;++o){var h=a[o],u=this._addLine("   "+h.name,"silver");this._addLine("   "+h.text),this._addLine(),new n({parent:s,image:"media/images/ui.png",imageX:16*(h.reco?5:6),x:u.x,y:u.y,width:16,height:16})}this._scrollbar.reset()},tick:function(e){if(this.captureInputEvents){this.getInput("negate",!0)&&this._onQuit();var t=this._scrollbar;this.getInput("down")?t.scroll(1,e):this.getInput("up")&&t.scroll(-1,e)}},_onReviews:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("reviews")},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId||"marketGame")}});t.defaults={backgroundColor:u.getColor("marketBG"),musicKey:"streets"}}),n("js/view/scenes/SettingsScene",["require","exports","module","djinn/view/View","djinn/client","djinn/audio/jukebox","./Scene","../../gameData","../../settings","../Slider","../Typer","../Starfield","../style"],function(e,t,i){var n=(e("djinn/view/View"),e("djinn/client")),a=e("djinn/audio/jukebox"),s=e("./Scene"),r=(e("../../gameData"),e("../../settings")),o=e("../Slider"),l=e("../Typer"),h=e("../Starfield"),u=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new h({parent:this}),new l({parent:this,text:"Settings v0.13",color:"silver",x:8,y:8}),new l({parent:this,text:"--------------",x:8,y:16}),this.addQuitX(),new l({parent:this,text:"Sound",color:"silver",x:8,y:32});var e=this._sounds=new o({parent:this,x:64,y:32,width:64,height:8});e.on("change",this,"_onSoundChange"),new l({parent:this,text:"Music",color:"silver",x:8,y:48});var t=this._music=new o({parent:this,x:64,y:48,width:64,height:8});t.on("change",this,"_onMusicChange"),new l({parent:this,text:"Keyboard ...",acceptInputEvents:!0,x:8,y:64}).on("inputStart",this,"_onKeyboard"),new l({parent:this,text:"Gamepad...",acceptInputEvents:!0,x:8,y:80}).on("inputStart",this,"_onGamepad"),new l({parent:this,text:"Delete data ...",acceptInputEvents:!0,x:8,y:96}).on("inputStart",this,"_onDeleteData"),this._fullscreen=new l({parent:this,acceptInputEvents:!0,x:8,y:112}).on("inputStart",this,"_onToggleFullscreen"),this.sortChildren()},reset:function(){this._sounds.value=r.get("soundVolume"),this._music.value=r.get("musicVolume"),this._fullscreen.visible=n["native"],this._updateFullscreenText()},activate:function(e,t){var i=this.oldSceneId;this._super(e,t),("deleteData"===e||"keyboard"===e||"gamepad"===e)&&(this.oldSceneId=i)},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&this._onQuit()},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId)},_onSoundChange:function(e,t){if(e>t)a.play("backspace1",0);else{if(!(t>e))return;a.play("type1",0)}a.soundVolume=e,r.set("soundVolume",e),r.save()},_onMusicChange:function(e,t){if(e>t)a.play("backspace2",0);else{if(!(t>e))return;a.play("type2",0)}a.musicVolume=e,r.set("musicVolume",e),r.save()},_onKeyboard:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("keyboard")},_onGamepad:function(){a.play("select",0),this.captureInputEvents=!1,this.fireSceneEvent("gamepad")},_onDeleteData:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("deleteData")},_onToggleFullscreen:function(){r.set("fullscreen",!r.get("fullscreen")),r.get("fullscreen")?a.play("select",0):a.play("negate",0),n.toggleFullscreen(),this._updateFullscreenText()},_updateFullscreenText:function(){r.get("fullscreen")?this._fullscreen.text="(X) Fullscreen":this._fullscreen.text="( ) Fullscreen"}});t.defaults={backgroundColor:u.getColor("black"),musicKey:"streets"}}),n("js/view/scenes/ShareScene",["require","exports","module","djinn/view/View","djinn/view/Sprite","djinn/manifest","djinn/audio/jukebox","djinn/math/core","djinn/utils/string","./Scene","../../gameData","../Typer","../SuperTyper","../Screenshot","../avatarFactory","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/view/Sprite"),s=e("djinn/manifest"),r=e("djinn/audio/jukebox"),o=(e("djinn/math/core"),e("djinn/utils/string")),l=e("./Scene"),h=e("../../gameData"),u=e("../Typer"),d=e("../SuperTyper"),c=e("../Screenshot"),p=(e("../avatarFactory"),e("../style")),t=i.exports=l.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super();var e=s.title.toUpperCase();new d({parent:this,text:e,y:8}).align("center"),new u({parent:this,text:"------------------------------",color:"silver",x:8,y:24}),this._container=new n({parent:this,acceptInputEvents:!0,x:8,y:40}),this.sortChildren()},reset:function(){this._super(),this._button=null;var e=this._container;if(e.disposeChildren(),!h.codeData||h.codeData.error)var t=new u({parent:e,text:"Sorry, invalid code!",color:"red"});else{var i=h.codeData.game,l=h.codeData.developer,t=new c({parent:e,width:2*i.tiles[0].length,height:2*i.tiles.length});t.setGame(i);var d=new u({parent:e,text:i.name,x:t.right+8}),p=new u({parent:e,text:"by "+l,color:"silver",x:d.x,y:d.bottom}),g=this._button=new n({parent:e,acceptInputEvents:!0,image:"media/images/ui.png",imageY:34,x:t.right+8,y:p.bottom+8,width:54,height:14});g.on("inputStart",this,"_onButton");var m=new u({parent:e,text:"Play"});m.shrinkwrap(),m.centerOn(g)}var f=new u({parent:e,text:"------------------------------",color:"silver",y:t.bottom+8}),v=new a({parent:e,acceptInputEvents:!0,cancelInputEvents:!0,animations:{idle:{frameRate:2,frames:[[0,32],[16,32]]}},image:"media/images/actors.png",y:f.bottom+8,width:16,height:16});v.playAnimation("idle");var y=new u({parent:e,text:o.sprintf("Help %s get on",s.title),color:"silver",x:v.right+8,y:f.bottom+8}),w=new u({parent:e,text:"Steam! Show some love.",color:"silver",x:v.right+8,y:y.bottom}),_=new n({parent:e,acceptInputEvents:!0,image:"media/images/ui.png",imageX:54,imageY:34,x:v.right+8-2,y:w.bottom+8,width:54,height:14});_.on("inputStart",this,bind(this,function(){r.play("play",0),_.imageX=0,_.imageY=62,this.captureInputEvents=!1,location.href="https://www.thunderclap.it/projects/47430-indie-game-sim"}));var x=new u({parent:e,text:"Love"});x.shrinkwrap(),x.centerOn(_)},tick:function(e){this.captureInputEvents&&(this.getInput("negate")&&r.play("negate",0),this.getInput("action",!0)&&this._onButton())},_onButton:function(){r.play("play",0),this.captureInputEvents=!1,this.fireSceneEvent("level")}});t.defaults={backgroundColor:p.getColor("marketBG")}}),n("js/view/scenes/StatsScene",["require","exports","module","djinn/view/View","djinn/utils/string","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../Starfield","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/string"),s=e("djinn/audio/jukebox"),r=e("./Scene"),o=e("../../gameData"),l=e("../Typer"),h=e("../Starfield"),u=e("../style"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new h({parent:this}),new l({parent:this,text:"Stats v0.5",x:8,y:8}),new l({parent:this,text:"-----------------------------",color:"silver",x:8,y:16}),this._container=new n({parent:this,acceptInputEvents:!0,y:24}),this.addQuitX(),this.sortChildren()},reset:function(){this._super();var e=this._container;e.disposeChildren();var t=8,i=o.getDeveloperMoney(),n=new l({parent:e,text:"Money:",color:"silver",x:8,y:t}).shrinkwrap();new l({parent:e,text:"$"+a.formatMoney(i),x:n.right+8,y:t}),t+=16;var s=o.getSceneTime("edit"),r=new l({parent:e,text:"Development time:",color:"silver",x:8,y:t}).shrinkwrap();new l({parent:e,text:a.formatTime(s),x:r.right+8,y:t}),t+=16;var h=o.getSceneTime("playtest");new l({parent:e,text:"Playtest time:",color:"silver",x:8,y:t}).shrinkwrap();new l({parent:e,text:a.formatTime(h),x:r.right+8,y:t}),t+=16;var u=o.getSceneTime("research");new l({parent:e,text:"Research time:",color:"silver",x:8,y:t}).shrinkwrap();new l({parent:e,text:a.formatTime(u),x:r.right+8,y:t}),t+=16;var d=s+h+u;new l({parent:e,text:"Total time:",color:"silver",x:8,y:t}).shrinkwrap();new l({parent:e,text:a.formatTime(d),x:r.right+8,y:t})},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&this._onQuit()},_onQuit:function(){s.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent(this.oldSceneId||"computer")}});t.defaults={backgroundColor:u.getColor("black"),musicKey:"streets"}}),n("js/view/Product",["require","exports","module","djinn/view/View","djinn/utils/string","../products","./Typer","./style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/string"),s=e("../products"),r=e("./Typer"),o=e("./style"),t=i.exports=n.extend({init:function(e){var e=merge(e,t.defaults);this._super(e)},setProductId:function(e){var t=s[e];if(this.productId=e,this._avatar=new n(merge({parent:this,width:16,height:16},t.avatar)),this._name=new r({parent:this,text:t.name,color:"black",x:24}),0===t.price)var i="FREE";else var i="$"+a.formatMoney(t.price);this._price=new r({parent:this,text:i,color:"green"}),this._price.shrinkwrap(),this._price.align("right",null,-16),this._desc=new r({parent:this,text:t.description,color:"gray",x:24,y:8})},markAsLocked:function(){this._name.color="silver",this._desc.color="silver",this._price.color="silver",this._price.text="locked",this._price.shrinkwrap(),this._price.align("right",null,-16),this._avatar.overlayColor=o.getColor("silver")},markAsOwned:function(){this._name.color="silver",this._desc.color="silver",this._price.color="gray",this._price.text="owned",this._price.shrinkwrap(),this._price.align("right",null,-16)},markAsTooExpensive:function(){this._price.color="red"}});t.defaults={acceptInputEvents:!0,height:24}}),n("js/view/scenes/StoreScene",["require","exports","module","djinn/view/View","djinn/utils/string","djinn/audio/jukebox","./Scene","../../gameData","../../products","../Typer","../Scrollbar","../Product","../Reward","../Confirmation","../Titan","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/utils/string"),s=e("djinn/audio/jukebox"),r=e("./Scene"),o=e("../../gameData"),l=e("../../products"),h=e("../Typer"),u=e("../Scrollbar"),d=e("../Product"),c=e("../Reward"),p=e("../Confirmation"),g=e("../Titan"),m=e("../style"),t=i.exports=r.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new n({parent:this,image:"media/images/objects.png",imageX:112,x:4,y:8,width:16,height:16}),new h({parent:this,text:"Amazing Store",color:"black",x:24,y:8}),this._subtitle=new h({parent:this,color:"gray",x:24,y:16}),new h({parent:this,text:"---------------------",color:"black",x:8,y:24}),this._funds=new h({parent:this,color:"black",x:8,y:32}),this.addQuitX("black"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:48,width:240,height:80}),this._container=new n({parent:this._window,acceptInputEvents:!0});var e=this._scrollbar=new u({parent:this._window,barColor:m.getColor("white"),cursorColor:m.getColor("silver"),width:8}).align("right");e.attach(this._container),this._reward=new c({parent:this,backgroundColor:m.getColor("black")}).align("center","center"),this._reward.on("ok",this,"_onRewardOK");var t=this._confirmation=new p({parent:this,backgroundColor:m.getColor("black")}).align("center","center");t.on("confirm",this,"_onConfirmPurchase"),t.on("cancel",this,"_onConfirmCancel"),t.setBackgroundColor("silver"),t.setHeader("Purchase?"),t.setConfirmButton("Buy")},reset:function(){this._super(),this._titan&&this._titan.dispose(),this._titan=null,this._confirmation.hide(),this._updateFunds(),o.hasDeveloperBoughtEverything()?this._subtitle.text="Everything you bought":this._subtitle.text="Everything you need";var e=this._container;e.disposeChildren(),e.height=0;for(var t in l)this._addProduct(t);this._scrollbar.reset(),this._reward.hide(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&(this._confirmation.visible?this._onConfirmCancel():this._reward.visible?this._onRewardOK():this._onQuit()),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_addProduct:function(e){var t=this._container,i=l[e],n=new d({parent:t,y:t.height});n.setProductId(e),n.on("inputStart",this,"_onBuyProduct"),t.shrinkwrap(),o.developerUnlockedProduct(e)?o.developerOwnsProduct(e)?n.markAsOwned():i.price>o.getDeveloperMoney()&&n.markAsTooExpensive():n.markAsLocked()},_onBuyProduct:function(e){var t=e.target.productId,i=l[t];if(!o.developerUnlockedProduct(t)||o.developerOwnsProduct(t))return void s.play("negate",0);var i=l[t];return i.price>o.getDeveloperMoney()?void s.play("negate",0):(s.play("select",0),this.productId=t,this._confirmation.setContentConf(i.avatar),void this._confirmation.show())},_onRewardOK:function(){s.play("done",0),this._reward.hide()},_onConfirmPurchase:function(){s.play("increase",0);var e=this.productId;o.developerBuyProduct(e);var t=this._reward,i=l[e];t.setHeader("Bought"),t.setContentConf(i.avatar),t.show(),this._confirmation.hide(),this._updateFunds();for(var n=this._container.children,a=0,r=n.length;r>a;++a){var h=n[a],e=h.productId,i=l[e];o.developerUnlockedProduct(e)?o.developerOwnsProduct(e)?h.markAsOwned():i.price>o.getDeveloperMoney()&&h.markAsTooExpensive():h.markAsLocked()}},_onConfirmCancel:function(){s.play("negate",0),this._confirmation.hide()},_onDoubt:function(){this.captureInputEvents=!1,this.fireSceneEvent("doubt")},_onQuit:function(){var e=null;return!o.developerOwnsProduct("sizeMedium")||o.getDeveloperFlag("playerZombie")||o.getDeveloperFlag("playerRaga")?!o.developerOwnsProduct("sizeLarge")||o.getDeveloperFlag("playerFranklin")||o.getDeveloperFlag("playerTiger")||(e="large"):e="medium",e?(s.play("doubt",0),o.setDeveloperFlag("doubtKey",e),void(this._titan?this._titan.advance():this._titan=new g({parent:this}).on("done",this,"_onDoubt"))):(s.play("negate",0),this.captureInputEvents=!1,void this.fireSceneEvent("computer"))},_updateFunds:function(){var e=o.data.developer,t=a.formatMoney(o.getDeveloperMoney());this._funds.text=a.sprintf("%s: $%s",e,t)}});t.defaults={backgroundColor:m.getColor("white"),musicKey:"streets"}}),n("js/view/scenes/TerminalScene",["require","exports","module","djinn/view/View","djinn/client","djinn/audio/jukebox","./Scene","../../gameData","../../settings","../Slider","../Typer","../Color","../ColorPicker","../style"],function(e,t,i){var n=e("djinn/view/View"),a=(e("djinn/client"),e("djinn/audio/jukebox")),s=e("./Scene"),r=e("../../gameData"),o=(e("../../settings"),e("../Slider"),e("../Typer")),l=(e("../Color"),e("../ColorPicker"),e("../style")),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new o({parent:this,text:"Terminal v0.1",x:8,y:8}),new o({parent:this,text:"-------------",x:8,y:16}),this.addQuitX();var e=this._container=new n({parent:this,acceptInputEvents:!0,x:8,y:32});new o({parent:e,text:"Unlock all products",acceptInputEvents:!0}).on("inputStart",this,"_onUnlockAllProducts"),this.sortChildren()},reset:function(){},tick:function(e){this.captureInputEvents&&this.getInput("negate",!0)&&this._onQuit()},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("computer")},_onUnlockAllProducts:function(){a.play("select",0),r.unlockAllProducts()}});t.defaults={backgroundColor:l.getColor("orange")}}),n("js/view/scenes/TitleScene",["require","exports","module","djinn/view/View","djinn/client","djinn/math/core","djinn/view/shapes/Pinwheel","djinn/manifest","djinn/audio/jukebox","./Scene","../../gameData","../Typer","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/client"),s=e("djinn/math/core"),r=e("djinn/view/shapes/Pinwheel"),o=e("djinn/manifest"),l=e("djinn/audio/jukebox"),h=e("./Scene"),u=e("../../gameData"),d=e("../Typer"),c=e("../style"),p="Quitting ...",t=i.exports=h.extend({init:function(e){this._super(merge(e,t.defaults)),this._flashTimer=this.createTimer(0,"_onFlashTimer")},setup:function(){this._super(),this.pinwheel=new r({parent:this,rayColor:c.getColor("black"),rayRotationSpeed:1e-4}).align("center","center"),this._makeHeader(),this._headerY=this._header.y;var e=this._button=new n({parent:this,acceptInputEvents:!0,image:"media/images/ui.png",width:54,height:14}).align("center","center");e.on("inputStart",this,"_onPlay");var t=new d({parent:e,acceptInputEvents:!0,text:"Play"});t.shrinkwrap(),t.align("center","center"),this._quit=new d({parent:this,text:p}).shrinkwrap().align("center","center",0,32);var i=o.version.replace(/\./g,""),t=new d({parent:this,text:"v"+i+" LDG 2016",acceptInputEvents:!0,color:"black"});t.shrinkwrap().align("center","bottom",0,-8),this.sortChildren()},reset:function(){this._super(),this._header.y=this._headerY,this.normal=1;var e=this._button;e.imageY=34,this._quitElapsed=0,this._quit.visible=!1,u.hasRolledCredits()?(this.lightColor="gold",this.darkColor="orange",e.imageY+=2*e.height):u.getDeveloperCount()?(this.lightColor="blue",this.darkColor="darkBlue",e.imageY+=e.height):(this.lightColor="green",this.darkColor="darkGreen"),this.pinwheel.fillColor=c.getColor(this.darkColor)},activate:function(e,t){this._super(e,t),this._flashTimer.start(500)},tick:function(e){if(this.captureInputEvents)if(this.getInput("action",!0)&&this._onPlay(),this.getInput("negate")){this._quit.visible=!0,this._quitElapsed+=e;var t=1e3,i=this._quitElapsed/t,n=Math.round(p.length*i);this._quit.text=p.substr(0,n),this._quitElapsed>t&&(a.quit(),this._quitElapsed=0)}else this._quit.visible=!1,this._quitElapsed=0},_makeHeader:function(){for(var e=o.title.toUpperCase(),t=this._header=new n({parent:this,imageSmoothingEnabled:!1,scale:2,y:16,height:10}),i=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}],a=0,s=i.length;s>a;++a){var r=i[a];new d({parent:t,text:e,color:"black"}).shrinkwrap().align("center","center",r.x,r.y)}new d({parent:t,text:e,y:16}).shrinkwrap().align("center","center"),t.align("center")},_onFlashTimer:function(){var e=this.pinwheel;e.fillColor===c.getColor(this.darkColor)?e.fillColor=c.getColor(this.lightColor):e.fillColor=c.getColor(this.darkColor),e.rayRotationSpeed=s.lerp(.002,1e-4,this.normal),this._flashTimer.start(500*this.normal)},_onInputMove:function(e){this._super(e);var t=this._button,i=t.center,n=this._header,a=n.center,r=e.point,o=s.distance(r.x,r.y,a.x,a.y),l=s.distance(i.x,i.y,this.width,this.height),h=this.normal=o/l;n.y=s.lerp(t.y-t.height,this._headerY,h)},_onPlay:function(){l.play("start",0),this.captureInputEvents=!1,this.fireSceneEvent("play")}});t.defaults={backgroundColor:c.getColor("black"),musicKey:"funkBump"}}),n("js/view/scenes/UnpublishedGamesScene",["require","exports","module","djinn/view/View","djinn/audio/jukebox","./Scene","../../gameData","../GameListItem","../Typer","../Scrollbar","../BackButton","../style"],function(e,t,i){var n=e("djinn/view/View"),a=e("djinn/audio/jukebox"),s=e("./Scene"),r=e("../../gameData"),o=e("../GameListItem"),l=e("../Typer"),h=e("../Scrollbar"),u=e("../BackButton"),d=e("../style"),t=i.exports=s.extend({init:function(e){this._super(merge(e,t.defaults))},setup:function(){this._super(),new l({parent:this,text:"Vaultworks Publishing Tools",x:24,y:8}),new l({parent:this,text:"Publish new game",color:"silver",x:24,y:16}),new l({parent:this,text:"---------------------------",x:8,y:24});var e=new u({parent:this});e.align("left","top",4,8),e.on("inputPress",this,"_onQuit"),this._window=new n({parent:this,acceptInputEvents:!0,clip:!0,x:8,y:40,width:240,height:96}),this._container=new n({parent:this._window,acceptInputEvents:!0,y:40});var t=this._scrollbar=new h({parent:this._window,barColor:d.getColor("marketBG"),width:8}).align("right");t.attach(this._container),this.sortChildren()},reset:function(){this._super();var e=this._container;e.disposeChildren();var t=r.getUnpublishedGamesByDeveloper(r.data.developer);if(t.length)for(var i=0,n=0,a=t.length;a>n;++n){var s=new o({parent:e,y:i}),h=t[n];s.setGame(h),h.tested?(s.on("selectGame",this,"_onSelectGame"),s.addLabel("Ready to publish","green")):(s.on("selectGame",this,"_onRejectGame"),s.addLabel("Untested","red"),s.setNameColor("silver")),s.gameIndex=h.gameIndex,i+=s.height+8}else new l({parent:e,text:"No unpublished games found",color:"silver",x:8,y:0});e.shrinkwrap(),this._scrollbar.reset(),this.sortChildren()},tick:function(e){this.captureInputEvents&&(this.getInput("negate",!0)&&this._onQuit(),this.getInput("down")?this._scrollbar.scroll(1,e):this.getInput("up")&&this._scrollbar.scroll(-1,e))},_onSelectGame:function(e){a.play("select",0),r.data.publishGameIndex=e,r.save(),this.captureInputEvents=!1,this.fireSceneEvent("publishGame")},_onRejectGame:function(){a.play("negate",0)},_onQuit:function(){a.play("negate",0),this.captureInputEvents=!1,this.fireSceneEvent("quit")}});t.defaults={backgroundColor:d.getColor("marketBG"),musicKey:"streets"}}),n("js/scenes",["require","exports","module","./view/scenes/AnalyticsScene","./view/scenes/AuthScene","./view/scenes/BillboardScene","./view/scenes/ComputerScene","./view/scenes/CreditsScene","./view/scenes/CTAScene","./view/scenes/DeleteDataScene","./view/scenes/DevScene","./view/scenes/DevelopersScene","./view/scenes/DoubtScene","./view/scenes/EditScene","./view/scenes/GamepadScene","./view/scenes/ImpactScene","./view/scenes/KeyboardScene","./view/scenes/LevelScene","./view/scenes/LoginScene","./view/scenes/MarketAllScene","./view/scenes/MarketTopScene","./view/scenes/MarketGameScene","./view/scenes/MarketScene","./view/scenes/MarketAnalysisScene","./view/scenes/NewsScene","./view/scenes/ProfileScene","./view/scenes/PromoScene","./view/scenes/PublishedGamesScene","./view/scenes/PublishGameScene","./view/scenes/ReviewsScene","./view/scenes/SettingsScene","./view/scenes/ShareScene","./view/scenes/StatsScene","./view/scenes/StoreScene","./view/scenes/TerminalScene","./view/scenes/TitleScene","./view/scenes/UnpublishedGamesScene"],function(e,t,i){var n=e("./view/scenes/AnalyticsScene"),a=e("./view/scenes/AuthScene"),s=e("./view/scenes/BillboardScene"),r=e("./view/scenes/ComputerScene"),o=e("./view/scenes/CreditsScene"),l=e("./view/scenes/CTAScene"),h=e("./view/scenes/DeleteDataScene"),u=e("./view/scenes/DevScene"),d=e("./view/scenes/DevelopersScene"),c=e("./view/scenes/DoubtScene"),p=e("./view/scenes/EditScene"),g=e("./view/scenes/GamepadScene"),m=e("./view/scenes/ImpactScene"),f=e("./view/scenes/KeyboardScene"),v=e("./view/scenes/LevelScene"),y=e("./view/scenes/LoginScene"),w=e("./view/scenes/MarketAllScene"),_=e("./view/scenes/MarketTopScene"),x=e("./view/scenes/MarketGameScene"),b=e("./view/scenes/MarketScene"),k=e("./view/scenes/MarketAnalysisScene"),j=e("./view/scenes/NewsScene"),S=e("./view/scenes/ProfileScene"),C=e("./view/scenes/PromoScene"),I=e("./view/scenes/PublishedGamesScene"),T=e("./view/scenes/PublishGameScene"),D=e("./view/scenes/ReviewsScene"),E=e("./view/scenes/SettingsScene"),P=e("./view/scenes/ShareScene"),G=e("./view/scenes/StatsScene"),B=e("./view/scenes/StoreScene"),R=e("./view/scenes/TerminalScene"),A=e("./view/scenes/TitleScene"),M=e("./view/scenes/UnpublishedGamesScene"),L=100;t.title={ctor:A,events:{play:{id:"login",transitions:"fade",conf:{duration:L}}}},t.promo={ctor:C,events:{}},t.billboard={ctor:s,events:{}},t.impact={ctor:m,events:{}},t.cta={ctor:l,events:{}},t.computer={ctor:r,events:{doubt:{id:"doubt",transitions:"fade",conf:{duration:1e3}},dev:{id:"dev",transitions:"fade",conf:{duration:L}},market:{id:"market",transitions:"fade",conf:{duration:L}},news:{id:"news",transitions:"fade",conf:{duration:L}},settings:{id:"settings",transitions:"fade",conf:{duration:L}},stats:{id:"stats",transitions:"fade",conf:{duration:L}},quit:{id:"login",transitions:"fade",conf:{duration:L}},store:{id:"store",transitions:"fade",conf:{duration:L}}}},t.edit={ctor:p,events:{playtest:{id:"level",transitions:"fade",conf:{duration:L}},marketAnalysis:{id:"marketAnalysis",transitions:"fade",conf:{duration:L}},auth:{id:"auth",transitions:"fade",conf:{duration:L}},quit:{id:"dev",transitions:"fade",conf:{duration:L}}}},t.deleteData={ctor:h,events:{deleteData:{id:"title",transitions:"fade",conf:{duration:L}},login:{id:"login",transitions:"fade",conf:{duration:L}},settings:{id:"settings",transitions:"fade",conf:{duration:L}}}},t.dev={ctor:u,events:{edit:{id:"edit",transitions:"fade",conf:{duration:L}},doubt:{id:"doubt",transitions:"fade",conf:{duration:1e3}},quit:{id:"computer",transitions:"fade",conf:{duration:L}}}},t.marketAnalysis={ctor:k,events:{edit:{id:"edit",transitions:"fade",conf:{duration:L}}}},t.login={ctor:y,events:{play:{id:"computer",transitions:"fade",conf:{duration:L}},settings:{id:"settings",transitions:"fade",conf:{duration:L}},quit:{id:"title",transitions:"fade",conf:{duration:L}}}},t.auth={ctor:a,events:{edit:{id:"edit",transitions:"fade",conf:{duration:L}}}},t.level={ctor:v,events:{edit:{id:"edit",transitions:"fade",conf:{duration:250}},marketGame:{id:"marketGame",transitions:"fade",conf:{duration:250}},share:{id:"share",transitions:"fade",conf:{duration:250}}}},t.market={ctor:b,events:{game:{id:"marketGame",transitions:"fade",conf:{duration:L}},all:{id:"marketAll",transitions:"fade",conf:{duration:L}},top:{id:"marketTop",transitions:"fade",conf:{duration:L}},profile:{id:"profile",transitions:"fade",conf:{duration:L}},developers:{id:"developers",transitions:"fade",conf:{duration:L}},quit:{id:"computer",transitions:"fade",conf:{duration:L}}}},t.marketAll={ctor:w,events:{game:{id:"marketGame",transitions:"fade",conf:{duration:L}},profile:{id:"profile",transitions:"fade",conf:{duration:L}},quit:{id:"market",transitions:"fade",conf:{duration:L}}}},t.marketTop={ctor:_,events:{game:{id:"marketGame",transitions:"fade",conf:{duration:L}},profile:{id:"profile",transitions:"fade",conf:{duration:L}},quit:{id:"market",transitions:"fade",conf:{duration:L}}}},t.news={ctor:j,events:{computer:{id:"computer",transitions:"fade",conf:{duration:L}},credits:{
id:"credits",transitions:"fade",conf:{duration:L}}}},t.marketGame={ctor:x,events:{play:{id:"level",transitions:"fade",conf:{duration:L}},profile:{id:"profile",transitions:"fade",conf:{duration:L}},analytics:{id:"analytics",transitions:"fade",conf:{duration:L}},reviews:{id:"reviews",transitions:"fade",conf:{duration:L}},market:{id:"market",transitions:"fade",conf:{duration:L}},marketAll:{id:"marketAll",transitions:"fade",conf:{duration:L}},marketTop:{id:"marketTop",transitions:"fade",conf:{duration:L}}}},t.profile={ctor:S,events:{market:{id:"market",transitions:"fade",conf:{duration:L}},marketGame:{id:"marketGame",transitions:"fade",conf:{duration:L}},marketAll:{id:"marketAll",transitions:"fade",conf:{duration:L}},marketTop:{id:"marketTop",transitions:"fade",conf:{duration:L}}}},t.terminal={ctor:R,events:{computer:{id:"computer",transitions:"fade",conf:{duration:L}}}},t.settings={ctor:E,events:{computer:{id:"computer",transitions:"fade",conf:{duration:L}},login:{id:"login",transitions:"fade",conf:{duration:L}},keyboard:{id:"keyboard",transitions:"fade",conf:{duration:L}},gamepad:{id:"gamepad",transitions:"fade",conf:{duration:L}},deleteData:{id:"deleteData",transitions:"fade",conf:{duration:L}}}},t.developers={ctor:d,events:{publishedGames:{id:"publishedGames",transitions:"fade",conf:{duration:L}},unpublishedGames:{id:"unpublishedGames",transitions:"fade",conf:{duration:L}},quit:{id:"market",transitions:"fade",conf:{duration:L}}}},t.unpublishedGames={ctor:M,events:{publishGame:{id:"publishGame",transitions:"fade",conf:{duration:L}},quit:{id:"developers",transitions:"fade",conf:{duration:L}}}},t.publishedGames={ctor:I,events:{analytics:{id:"analytics",transitions:"fade",conf:{duration:L}},quit:{id:"developers",transitions:"fade",conf:{duration:L}}}},t.publishGame={ctor:T,events:{analytics:{id:"analytics",transitions:"fade",conf:{duration:L}},quit:{id:"unpublishedGames",transitions:"fade",conf:{duration:L}}}},t.analytics={ctor:n,events:{marketGame:{id:"marketGame",transitions:"fade",conf:{duration:L}},publishGame:{id:"developers",transitions:"fade",conf:{duration:L}},publishedGames:{id:"publishedGames",transitions:"fade",conf:{duration:L}},reviews:{id:"reviews",transitions:"fade",conf:{duration:L}}}},t.reviews={ctor:D,events:{analytics:{id:"analytics",transitions:"fade",conf:{duration:L}},marketGame:{id:"marketGame",transitions:"fade",conf:{duration:L}}}},t.share={ctor:P,events:{level:{id:"level",transitions:"fade",conf:{duration:L}}}},t.stats={ctor:G,events:{computer:{id:"computer",transitions:"fade",conf:{duration:L}}}},t.credits={ctor:o,events:{computer:{id:"computer",transitions:"fade",conf:{duration:L}},news:{id:"computer",transitions:"fade",conf:{duration:L}}}},t.store={ctor:B,events:{computer:{id:"computer",transitions:"fade",conf:{duration:L}},doubt:{id:"doubt",transitions:"fade",conf:{duration:1e3}}}},t.keyboard={ctor:f,events:{settings:{id:"settings",transitions:"fade",conf:{duration:L}}}},t.gamepad={ctor:g,events:{settings:{id:"settings",transitions:"fade",conf:{duration:L}}}},t.doubt={ctor:c,events:{computer:{id:"computer",transitions:"fade",conf:{duration:500}},store:{id:"store",transitions:"fade",conf:{duration:500}},dev:{id:"dev",transitions:"fade",conf:{duration:500}}}}}),n("js/sounds",{sounds:{add:{paths:["media/sounds/ui/add.ogg"]},backspace1:{paths:["media/sounds/ui/backspace1.ogg"]},backspace2:{paths:["media/sounds/ui/backspace2.ogg"]},choice1:{paths:["media/sounds/ui/choice1.ogg"]},choice2:{paths:["media/sounds/ui/choice2.ogg"]},clear:{paths:["media/sounds/ui/clear.ogg"]},close:{paths:["media/sounds/ui/close.ogg"]},create:{paths:["media/sounds/ui/create.ogg"]},done:{paths:["media/sounds/ui/done.ogg"]},doubt:{paths:["media/sounds/ui/doubt.ogg"]},doubt1:{paths:["media/sounds/ui/doubt1.ogg"]},doubt2:{paths:["media/sounds/ui/doubt2.ogg"]},doubt3:{paths:["media/sounds/ui/doubt3.ogg"]},doubt4:{paths:["media/sounds/ui/doubt4.ogg"]},dud:{paths:["media/sounds/ui/dud.ogg"]},error:{paths:["media/sounds/ui/error.ogg"]},increase:{paths:["media/sounds/ui/increase.ogg"]},negate:{paths:["media/sounds/ui/negate.ogg"]},open:{paths:["media/sounds/ui/open.ogg"]},phase:{paths:["media/sounds/ui/phase.ogg"]},placeMed1:{paths:["media/sounds/ui/placeMed1.ogg"]},placeMed2:{paths:["media/sounds/ui/placeMed2.ogg"]},placePos1:{paths:["media/sounds/ui/placePos1.ogg"]},placePos2:{paths:["media/sounds/ui/placePos2.ogg"]},placeNeg1:{paths:["media/sounds/ui/placeNeg1.ogg"]},placeNeg2:{paths:["media/sounds/ui/placeNeg2.ogg"]},play:{paths:["media/sounds/ui/play.ogg"]},remove:{paths:["media/sounds/ui/remove.ogg"]},select:{paths:["media/sounds/ui/select.ogg"]},set:{paths:["media/sounds/ui/set.ogg"]},start:{paths:["media/sounds/ui/start.ogg"]},success:{paths:["media/sounds/ui/success.ogg"]},trash1:{paths:["media/sounds/ui/trash1.ogg"]},trash2:{paths:["media/sounds/ui/trash2.ogg"]},type1:{paths:["media/sounds/ui/type1.ogg"]},type2:{paths:["media/sounds/ui/type2.ogg"]},unlock:{paths:["media/sounds/ui/unlock.ogg"]},appear:{paths:["media/sounds/gameplay/appear.ogg"]},banner1:{paths:["media/sounds/gameplay/banner1.ogg"]},banner2:{paths:["media/sounds/gameplay/banner2.ogg"]},beam:{paths:["media/sounds/gameplay/beam.ogg"]},bounce:{paths:["media/sounds/gameplay/bounce.ogg"]},cannon:{paths:["media/sounds/gameplay/cannon.ogg"]},collect1:{paths:["media/sounds/gameplay/collect1.ogg"]},collect2:{paths:["media/sounds/gameplay/collect2.ogg"]},damage:{paths:["media/sounds/gameplay/damage.ogg"]},death:{paths:["media/sounds/gameplay/death.ogg"]},disappear:{paths:["media/sounds/gameplay/disappear.ogg"]},explosion1:{paths:["media/sounds/gameplay/explosion1.ogg"]},explosion2:{paths:["media/sounds/gameplay/explosion2.ogg"]},fragileWarn:{paths:["media/sounds/gameplay/fragileWarn.ogg"]},grass:{paths:["media/sounds/gameplay/grass.ogg"]},gravity1:{paths:["media/sounds/gameplay/gravity1.ogg"]},gravity2:{paths:["media/sounds/gameplay/gravity2.ogg"]},joy1:{paths:["media/sounds/gameplay/joy1.ogg"]},joy2:{paths:["media/sounds/gameplay/joy2.ogg"]},jump:{paths:["media/sounds/gameplay/jump.ogg"]},jump2:{paths:["media/sounds/gameplay/jump2.ogg"]},pulse:{paths:["media/sounds/gameplay/pulse.ogg"]},pulseBlock:{paths:["media/sounds/gameplay/pulseBlock.ogg"]},pulseBlockSolid:{paths:["media/sounds/gameplay/pulseBlockSolid.ogg"]},shot:{paths:["media/sounds/gameplay/shot.ogg"]},survey1:{paths:["media/sounds/gameplay/survey1.ogg"]},survey2:{paths:["media/sounds/gameplay/survey2.ogg"]},teleport:{paths:["media/sounds/gameplay/teleport.ogg"]},warning:{paths:["media/sounds/gameplay/warning.ogg"]},woosh:{paths:["media/sounds/gameplay/woosh.ogg"]},alligators:{paths:["media/music/alligators.ogg"],loop:!0,type:"music"},corridor:{paths:["media/music/corridor.ogg"],loop:!0,type:"music"},flux:{paths:["media/music/flux.ogg"],loop:!0,type:"music"},funkBump:{paths:["media/music/funkBump.ogg"],loop:!0,type:"music"},holdPlease:{paths:["media/music/holdPlease.ogg"],loop:!0,type:"music"},streets:{paths:["media/music/streets.ogg"],loop:!0,type:"music"}}}),n("js/Main",["require","exports","module","djinn/utils/intl","./intl/en","djinn/Game","djinn/client","djinn/manifest","djinn/utils/request","djinn/audio/jukebox","djinn/input/keyboard","djinn/input/gamepad","./gameData","./scenes","./settings","./sounds"],function(e,t,i){var n=e("djinn/utils/intl"),a=e("./intl/en"),s=e("djinn/Game"),r=e("djinn/client"),o=e("djinn/manifest"),l=e("djinn/utils/request"),h=e("djinn/audio/jukebox"),u=e("djinn/input/keyboard"),d=e("djinn/input/gamepad"),c=e("./gameData"),p=e("./scenes"),g=e("./settings"),m=e("./sounds");i.exports=s.extend({init:function(e){var e=merge(e,t.defaults);this._super(e),n.addLanguage(a),n.setLanguage("en"),c.load(),g.get("fullscreen")&&r.enterFullscreen(),this.setupScenes(p),u.bind(g.get("keyBinds")),u.capture([u.keys.backspace]),h.configure(m),h.volumeExponent=5,h.soundVolume=g.get("soundVolume"),h.musicVolume=g.get("musicVolume"),d.bind(g.get("gamepadBinds")),d.analogDeadZoneLeft=g.get("analogDeadZoneLeft"),this.preloadAssets(["media/images/actors.png","media/images/credits.png","media/images/darkness.png","media/images/doubt.png","media/images/env.png","media/images/objects.png","media/images/parallax.png","media/images/ui.png","media/images/window.png","media/images/text/black.png","media/images/text/blue.png","media/images/text/gold.png","media/images/text/gray.png","media/images/text/green.png","media/images/text/red.png","media/images/text/silver.png","media/images/text/white.png"]),this.on("load",this,"_onGameLoad"),this.on("ready",this,"_onGameReady")},_onGameLoad:function(){h.preloadByType("sound")},_onGameReady:function(){this.view.sortChildren();var e=o.entry;if(l.params.oauth_verifier)e="auth";else if(l.params.code){e="share";var t=l.params.code,i=atob(t);try{var n=JSON.parse(i);c.codeData={game:n.game,developer:n.developer}}catch(a){c.codeData={error:!0}}}this.activateScene(e,"fade")}}),t.defaults={showLoadingScreen:!0}}),t(["js/Main"],function(e){var t=new e;t.run()}),n("_launch",function(){})}();;
